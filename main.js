/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var it=Object.defineProperty;var on=Object.getOwnPropertyDescriptor;var cn=Object.getOwnPropertyNames;var hn=Object.prototype.hasOwnProperty;var fn=(t,n)=>{for(var e in n)it(t,e,{get:n[e],enumerable:!0})},dn=(t,n,e,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of cn(n))!hn.call(t,s)&&s!==e&&it(t,s,{get:()=>n[s],enumerable:!(i=on(n,s))||i.enumerable});return t};var un=t=>dn(it({},"__esModule",{value:!0}),t);var Qa={};fn(Qa,{default:()=>Je});module.exports=un(Qa);var g=require("obsidian");var Ee=class{diff(n,e,i={}){let s;typeof i=="function"?(s=i,i={}):"callback"in i&&(s=i.callback);let a=this.castInput(n,i),l=this.castInput(e,i),c=this.removeEmpty(this.tokenize(a,i)),f=this.removeEmpty(this.tokenize(l,i));return this.diffWithOptionsObj(c,f,i,s)}diffWithOptionsObj(n,e,i,s){var a;let l=b=>{if(b=this.postProcess(b,i),s){setTimeout(function(){s(b)},0);return}else return b},c=e.length,f=n.length,r=1,o=c+f;i.maxEditLength!=null&&(o=Math.min(o,i.maxEditLength));let d=(a=i.timeout)!==null&&a!==void 0?a:1/0,u=Date.now()+d,h=[{oldPos:-1,lastComponent:void 0}],p=this.extractCommon(h[0],e,n,0,i);if(h[0].oldPos+1>=f&&p+1>=c)return l(this.buildValues(h[0].lastComponent,e,n));let E=-1/0,m=1/0,w=()=>{for(let b=Math.max(E,-r);b<=Math.min(m,r);b+=2){let y,v=h[b-1],_=h[b+1];v&&(h[b-1]=void 0);let S=!1;if(_){let T=_.oldPos-b;S=_&&0<=T&&T<c}let x=v&&v.oldPos+1<f;if(!S&&!x){h[b]=void 0;continue}if(!x||S&&v.oldPos<_.oldPos?y=this.addToPath(_,!0,!1,0,i):y=this.addToPath(v,!1,!0,1,i),p=this.extractCommon(y,e,n,b,i),y.oldPos+1>=f&&p+1>=c)return l(this.buildValues(y.lastComponent,e,n))||!0;h[b]=y,y.oldPos+1>=f&&(m=Math.min(m,b-1)),p+1>=c&&(E=Math.max(E,b+1))}r++};if(s)(function b(){setTimeout(function(){if(r>o||Date.now()>u)return s(void 0);w()||b()},0)})();else for(;r<=o&&Date.now()<=u;){let b=w();if(b)return b}}addToPath(n,e,i,s,a){let l=n.lastComponent;return l&&!a.oneChangePerToken&&l.added===e&&l.removed===i?{oldPos:n.oldPos+s,lastComponent:{count:l.count+1,added:e,removed:i,previousComponent:l.previousComponent}}:{oldPos:n.oldPos+s,lastComponent:{count:1,added:e,removed:i,previousComponent:l}}}extractCommon(n,e,i,s,a){let l=e.length,c=i.length,f=n.oldPos,r=f-s,o=0;for(;r+1<l&&f+1<c&&this.equals(i[f+1],e[r+1],a);)r++,f++,o++,a.oneChangePerToken&&(n.lastComponent={count:1,previousComponent:n.lastComponent,added:!1,removed:!1});return o&&!a.oneChangePerToken&&(n.lastComponent={count:o,previousComponent:n.lastComponent,added:!1,removed:!1}),n.oldPos=f,r}equals(n,e,i){return i.comparator?i.comparator(n,e):n===e||!!i.ignoreCase&&n.toLowerCase()===e.toLowerCase()}removeEmpty(n){let e=[];for(let i=0;i<n.length;i++)n[i]&&e.push(n[i]);return e}castInput(n,e){return n}tokenize(n,e){return Array.from(n)}join(n){return n.join("")}postProcess(n,e){return n}get useLongestToken(){return!1}buildValues(n,e,i){let s=[],a;for(;n;)s.push(n),a=n.previousComponent,delete n.previousComponent,n=a;s.reverse();let l=s.length,c=0,f=0,r=0;for(;c<l;c++){let o=s[c];if(o.removed)o.value=this.join(i.slice(r,r+o.count)),r+=o.count;else{if(!o.added&&this.useLongestToken){let d=e.slice(f,f+o.count);d=d.map(function(u,h){let p=i[r+h];return p.length>u.length?p:u}),o.value=this.join(d)}else o.value=this.join(e.slice(f,f+o.count));f+=o.count,o.added||(r+=o.count)}}return s}};var nt=class extends Ee{constructor(){super(...arguments),this.tokenize=gn}equals(n,e,i){return i.ignoreWhitespace?((!i.newlineIsToken||!n.includes(`
`))&&(n=n.trim()),(!i.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):i.ignoreNewlineAtEof&&!i.newlineIsToken&&(n.endsWith(`
`)&&(n=n.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),super.equals(n,e,i)}},Ot=new nt;function X(t,n,e){return Ot.diff(t,n,e)}function gn(t,n){n.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));let e=[],i=t.split(/(\n|\r\n)/);i[i.length-1]||i.pop();for(let s=0;s<i.length;s++){let a=i[s];s%2&&!n.newlineIsToken?e[e.length-1]+=a:e.push(a)}return e}function we(t){let n=t.length;for(;--n>=0;)t[n]=0}var _n=0,ki=1,vn=2,wn=3,mn=258,Tt=29,$e=256,Le=$e+1+Tt,pe=30,Dt=19,Ci=2*Le+1,re=15,st=16,bn=7,Lt=256,Ti=16,Di=17,Li=18,wt=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),je=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),xn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Ii=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),En=512,Y=new Array((Le+2)*2);we(Y);var Ce=new Array(pe*2);we(Ce);var Ie=new Array(En);we(Ie);var Ve=new Array(mn-wn+1);we(Ve);var It=new Array(Tt);we(It);var Ke=new Array(pe);we(Ke);function at(t,n,e,i,s){this.static_tree=t,this.extra_bits=n,this.extra_base=e,this.elems=i,this.max_length=s,this.has_stree=t&&t.length}var Vi,Ai,Fi;function rt(t,n){this.dyn_tree=t,this.max_code=0,this.stat_desc=n}var zi=t=>t<256?Ie[t]:Ie[256+(t>>>7)],Ae=(t,n)=>{t.pending_buf[t.pending++]=n&255,t.pending_buf[t.pending++]=n>>>8&255},R=(t,n,e)=>{t.bi_valid>st-e?(t.bi_buf|=n<<t.bi_valid&65535,Ae(t,t.bi_buf),t.bi_buf=n>>st-t.bi_valid,t.bi_valid+=e-st):(t.bi_buf|=n<<t.bi_valid&65535,t.bi_valid+=e)},j=(t,n,e)=>{R(t,e[n*2],e[n*2+1])},Ni=(t,n)=>{let e=0;do e|=t&1,t>>>=1,e<<=1;while(--n>0);return e>>>1},Sn=t=>{t.bi_valid===16?(Ae(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},yn=(t,n)=>{let e=n.dyn_tree,i=n.max_code,s=n.stat_desc.static_tree,a=n.stat_desc.has_stree,l=n.stat_desc.extra_bits,c=n.stat_desc.extra_base,f=n.stat_desc.max_length,r,o,d,u,h,p,E=0;for(u=0;u<=re;u++)t.bl_count[u]=0;for(e[t.heap[t.heap_max]*2+1]=0,r=t.heap_max+1;r<Ci;r++)o=t.heap[r],u=e[e[o*2+1]*2+1]+1,u>f&&(u=f,E++),e[o*2+1]=u,!(o>i)&&(t.bl_count[u]++,h=0,o>=c&&(h=l[o-c]),p=e[o*2],t.opt_len+=p*(u+h),a&&(t.static_len+=p*(s[o*2+1]+h)));if(E!==0){do{for(u=f-1;t.bl_count[u]===0;)u--;t.bl_count[u]--,t.bl_count[u+1]+=2,t.bl_count[f]--,E-=2}while(E>0);for(u=f;u!==0;u--)for(o=t.bl_count[u];o!==0;)d=t.heap[--r],!(d>i)&&(e[d*2+1]!==u&&(t.opt_len+=(u-e[d*2+1])*e[d*2],e[d*2+1]=u),o--)}},Bi=(t,n,e)=>{let i=new Array(re+1),s=0,a,l;for(a=1;a<=re;a++)s=s+e[a-1]<<1,i[a]=s;for(l=0;l<=n;l++){let c=t[l*2+1];c!==0&&(t[l*2]=Ni(i[c]++,c))}},kn=()=>{let t,n,e,i,s,a=new Array(re+1);for(e=0,i=0;i<Tt-1;i++)for(It[i]=e,t=0;t<1<<wt[i];t++)Ve[e++]=i;for(Ve[e-1]=i,s=0,i=0;i<16;i++)for(Ke[i]=s,t=0;t<1<<je[i];t++)Ie[s++]=i;for(s>>=7;i<pe;i++)for(Ke[i]=s<<7,t=0;t<1<<je[i]-7;t++)Ie[256+s++]=i;for(n=0;n<=re;n++)a[n]=0;for(t=0;t<=143;)Y[t*2+1]=8,t++,a[8]++;for(;t<=255;)Y[t*2+1]=9,t++,a[9]++;for(;t<=279;)Y[t*2+1]=7,t++,a[7]++;for(;t<=287;)Y[t*2+1]=8,t++,a[8]++;for(Bi(Y,Le+1,a),t=0;t<pe;t++)Ce[t*2+1]=5,Ce[t*2]=Ni(t,5);Vi=new at(Y,wt,$e+1,Le,re),Ai=new at(Ce,je,0,pe,re),Fi=new at(new Array(0),xn,0,Dt,bn)},$i=t=>{let n;for(n=0;n<Le;n++)t.dyn_ltree[n*2]=0;for(n=0;n<pe;n++)t.dyn_dtree[n*2]=0;for(n=0;n<Dt;n++)t.bl_tree[n*2]=0;t.dyn_ltree[Lt*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Mi=t=>{t.bi_valid>8?Ae(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Pt=(t,n,e,i)=>{let s=n*2,a=e*2;return t[s]<t[a]||t[s]===t[a]&&i[n]<=i[e]},lt=(t,n,e)=>{let i=t.heap[e],s=e<<1;for(;s<=t.heap_len&&(s<t.heap_len&&Pt(n,t.heap[s+1],t.heap[s],t.depth)&&s++,!Pt(n,i,t.heap[s],t.depth));)t.heap[e]=t.heap[s],e=s,s<<=1;t.heap[e]=i},Zt=(t,n,e)=>{let i,s,a=0,l,c;if(t.sym_next!==0)do i=t.pending_buf[t.sym_buf+a++]&255,i+=(t.pending_buf[t.sym_buf+a++]&255)<<8,s=t.pending_buf[t.sym_buf+a++],i===0?j(t,s,n):(l=Ve[s],j(t,l+$e+1,n),c=wt[l],c!==0&&(s-=It[l],R(t,s,c)),i--,l=zi(i),j(t,l,e),c=je[l],c!==0&&(i-=Ke[l],R(t,i,c)));while(a<t.sym_next);j(t,Lt,n)},mt=(t,n)=>{let e=n.dyn_tree,i=n.stat_desc.static_tree,s=n.stat_desc.has_stree,a=n.stat_desc.elems,l,c,f=-1,r;for(t.heap_len=0,t.heap_max=Ci,l=0;l<a;l++)e[l*2]!==0?(t.heap[++t.heap_len]=f=l,t.depth[l]=0):e[l*2+1]=0;for(;t.heap_len<2;)r=t.heap[++t.heap_len]=f<2?++f:0,e[r*2]=1,t.depth[r]=0,t.opt_len--,s&&(t.static_len-=i[r*2+1]);for(n.max_code=f,l=t.heap_len>>1;l>=1;l--)lt(t,e,l);r=a;do l=t.heap[1],t.heap[1]=t.heap[t.heap_len--],lt(t,e,1),c=t.heap[1],t.heap[--t.heap_max]=l,t.heap[--t.heap_max]=c,e[r*2]=e[l*2]+e[c*2],t.depth[r]=(t.depth[l]>=t.depth[c]?t.depth[l]:t.depth[c])+1,e[l*2+1]=e[c*2+1]=r,t.heap[1]=r++,lt(t,e,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],yn(t,n),Bi(e,f,t.bl_count)},Ht=(t,n,e)=>{let i,s=-1,a,l=n[0*2+1],c=0,f=7,r=4;for(l===0&&(f=138,r=3),n[(e+1)*2+1]=65535,i=0;i<=e;i++)a=l,l=n[(i+1)*2+1],!(++c<f&&a===l)&&(c<r?t.bl_tree[a*2]+=c:a!==0?(a!==s&&t.bl_tree[a*2]++,t.bl_tree[Ti*2]++):c<=10?t.bl_tree[Di*2]++:t.bl_tree[Li*2]++,c=0,s=a,l===0?(f=138,r=3):a===l?(f=6,r=3):(f=7,r=4))},Ut=(t,n,e)=>{let i,s=-1,a,l=n[0*2+1],c=0,f=7,r=4;for(l===0&&(f=138,r=3),i=0;i<=e;i++)if(a=l,l=n[(i+1)*2+1],!(++c<f&&a===l)){if(c<r)do j(t,a,t.bl_tree);while(--c!==0);else a!==0?(a!==s&&(j(t,a,t.bl_tree),c--),j(t,Ti,t.bl_tree),R(t,c-3,2)):c<=10?(j(t,Di,t.bl_tree),R(t,c-3,3)):(j(t,Li,t.bl_tree),R(t,c-11,7));c=0,s=a,l===0?(f=138,r=3):a===l?(f=6,r=3):(f=7,r=4)}},Cn=t=>{let n;for(Ht(t,t.dyn_ltree,t.l_desc.max_code),Ht(t,t.dyn_dtree,t.d_desc.max_code),mt(t,t.bl_desc),n=Dt-1;n>=3&&t.bl_tree[Ii[n]*2+1]===0;n--);return t.opt_len+=3*(n+1)+5+5+4,n},Tn=(t,n,e,i)=>{let s;for(R(t,n-257,5),R(t,e-1,5),R(t,i-4,4),s=0;s<i;s++)R(t,t.bl_tree[Ii[s]*2+1],3);Ut(t,t.dyn_ltree,n-1),Ut(t,t.dyn_dtree,e-1)},Dn=t=>{let n=4093624447,e;for(e=0;e<=31;e++,n>>>=1)if(n&1&&t.dyn_ltree[e*2]!==0)return 0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return 1;for(e=32;e<$e;e++)if(t.dyn_ltree[e*2]!==0)return 1;return 0},Wt=!1,Ln=t=>{Wt||(kn(),Wt=!0),t.l_desc=new rt(t.dyn_ltree,Vi),t.d_desc=new rt(t.dyn_dtree,Ai),t.bl_desc=new rt(t.bl_tree,Fi),t.bi_buf=0,t.bi_valid=0,$i(t)},Ri=(t,n,e,i)=>{R(t,(_n<<1)+(i?1:0),3),Mi(t),Ae(t,e),Ae(t,~e),e&&t.pending_buf.set(t.window.subarray(n,n+e),t.pending),t.pending+=e},In=t=>{R(t,ki<<1,3),j(t,Lt,Y),Sn(t)},Vn=(t,n,e,i)=>{let s,a,l=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=Dn(t)),mt(t,t.l_desc),mt(t,t.d_desc),l=Cn(t),s=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=s&&(s=a)):s=a=e+5,e+4<=s&&n!==-1?Ri(t,n,e,i):t.strategy===4||a===s?(R(t,(ki<<1)+(i?1:0),3),Zt(t,Y,Ce)):(R(t,(vn<<1)+(i?1:0),3),Tn(t,t.l_desc.max_code+1,t.d_desc.max_code+1,l+1),Zt(t,t.dyn_ltree,t.dyn_dtree)),$i(t),i&&Mi(t)},An=(t,n,e)=>(t.pending_buf[t.sym_buf+t.sym_next++]=n,t.pending_buf[t.sym_buf+t.sym_next++]=n>>8,t.pending_buf[t.sym_buf+t.sym_next++]=e,n===0?t.dyn_ltree[e*2]++:(t.matches++,n--,t.dyn_ltree[(Ve[e]+$e+1)*2]++,t.dyn_dtree[zi(n)*2]++),t.sym_next===t.sym_end),Fn=Ln,zn=Ri,Nn=Vn,Bn=An,$n=In,Mn={_tr_init:Fn,_tr_stored_block:zn,_tr_flush_block:Nn,_tr_tally:Bn,_tr_align:$n},Rn=(t,n,e,i)=>{let s=t&65535|0,a=t>>>16&65535|0,l=0;for(;e!==0;){l=e>2e3?2e3:e,e-=l;do s=s+n[i++]|0,a=a+s|0;while(--l);s%=65521,a%=65521}return s|a<<16|0},Fe=Rn,On=()=>{let t,n=[];for(var e=0;e<256;e++){t=e;for(var i=0;i<8;i++)t=t&1?3988292384^t>>>1:t>>>1;n[e]=t}return n},Pn=new Uint32Array(On()),Zn=(t,n,e,i)=>{let s=Pn,a=i+e;t^=-1;for(let l=i;l<a;l++)t=t>>>8^s[(t^n[l])&255];return t^-1},N=Zn,ce={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},me={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Hn,_tr_stored_block:bt,_tr_flush_block:Un,_tr_tally:te,_tr_align:Wn}=Mn,{Z_NO_FLUSH:ie,Z_PARTIAL_FLUSH:jn,Z_FULL_FLUSH:Kn,Z_FINISH:H,Z_BLOCK:jt,Z_OK:B,Z_STREAM_END:Kt,Z_STREAM_ERROR:K,Z_DATA_ERROR:Gn,Z_BUF_ERROR:ot,Z_DEFAULT_COMPRESSION:Xn,Z_FILTERED:qn,Z_HUFFMAN_ONLY:Pe,Z_RLE:Yn,Z_FIXED:Qn,Z_DEFAULT_STRATEGY:Jn,Z_UNKNOWN:es,Z_DEFLATED:qe}=me,ts=9,is=15,ns=8,ss=29,as=256,xt=as+1+ss,rs=30,ls=19,os=2*xt+1,cs=15,L=3,ee=258,G=ee+L+1,hs=32,_e=42,Vt=57,Et=69,St=73,yt=91,kt=103,le=113,ye=666,M=1,be=2,he=3,xe=4,fs=3,oe=(t,n)=>(t.msg=ce[n],n),Gt=t=>t*2-(t>4?9:0),J=t=>{let n=t.length;for(;--n>=0;)t[n]=0},ds=t=>{let n,e,i,s=t.w_size;n=t.hash_size,i=n;do e=t.head[--i],t.head[i]=e>=s?e-s:0;while(--n);n=s,i=n;do e=t.prev[--i],t.prev[i]=e>=s?e-s:0;while(--n)},us=(t,n,e)=>(n<<t.hash_shift^e)&t.hash_mask,ne=us,O=t=>{let n=t.state,e=n.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+e),t.next_out),t.next_out+=e,n.pending_out+=e,t.total_out+=e,t.avail_out-=e,n.pending-=e,n.pending===0&&(n.pending_out=0))},P=(t,n)=>{Un(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,n),t.block_start=t.strstart,O(t.strm)},I=(t,n)=>{t.pending_buf[t.pending++]=n},Se=(t,n)=>{t.pending_buf[t.pending++]=n>>>8&255,t.pending_buf[t.pending++]=n&255},Ct=(t,n,e,i)=>{let s=t.avail_in;return s>i&&(s=i),s===0?0:(t.avail_in-=s,n.set(t.input.subarray(t.next_in,t.next_in+s),e),t.state.wrap===1?t.adler=Fe(t.adler,n,s,e):t.state.wrap===2&&(t.adler=N(t.adler,n,s,e)),t.next_in+=s,t.total_in+=s,s)},Oi=(t,n)=>{let e=t.max_chain_length,i=t.strstart,s,a,l=t.prev_length,c=t.nice_match,f=t.strstart>t.w_size-G?t.strstart-(t.w_size-G):0,r=t.window,o=t.w_mask,d=t.prev,u=t.strstart+ee,h=r[i+l-1],p=r[i+l];t.prev_length>=t.good_match&&(e>>=2),c>t.lookahead&&(c=t.lookahead);do if(s=n,!(r[s+l]!==p||r[s+l-1]!==h||r[s]!==r[i]||r[++s]!==r[i+1])){i+=2,s++;do;while(r[++i]===r[++s]&&r[++i]===r[++s]&&r[++i]===r[++s]&&r[++i]===r[++s]&&r[++i]===r[++s]&&r[++i]===r[++s]&&r[++i]===r[++s]&&r[++i]===r[++s]&&i<u);if(a=ee-(u-i),i=u-ee,a>l){if(t.match_start=n,l=a,a>=c)break;h=r[i+l-1],p=r[i+l]}}while((n=d[n&o])>f&&--e!==0);return l<=t.lookahead?l:t.lookahead},ve=t=>{let n=t.w_size,e,i,s;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=n+(n-G)&&(t.window.set(t.window.subarray(n,n+n-i),0),t.match_start-=n,t.strstart-=n,t.block_start-=n,t.insert>t.strstart&&(t.insert=t.strstart),ds(t),i+=n),t.strm.avail_in===0)break;if(e=Ct(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=e,t.lookahead+t.insert>=L)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=ne(t,t.ins_h,t.window[s+1]);t.insert&&(t.ins_h=ne(t,t.ins_h,t.window[s+L-1]),t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<L)););}while(t.lookahead<G&&t.strm.avail_in!==0)},Pi=(t,n)=>{let e=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,i,s,a,l=0,c=t.strm.avail_in;do{if(i=65535,a=t.bi_valid+42>>3,t.strm.avail_out<a||(a=t.strm.avail_out-a,s=t.strstart-t.block_start,i>s+t.strm.avail_in&&(i=s+t.strm.avail_in),i>a&&(i=a),i<e&&(i===0&&n!==H||n===ie||i!==s+t.strm.avail_in)))break;l=n===H&&i===s+t.strm.avail_in?1:0,bt(t,0,0,l),t.pending_buf[t.pending-4]=i,t.pending_buf[t.pending-3]=i>>8,t.pending_buf[t.pending-2]=~i,t.pending_buf[t.pending-1]=~i>>8,O(t.strm),s&&(s>i&&(s=i),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+s),t.strm.next_out),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s,t.block_start+=s,i-=s),i&&(Ct(t.strm,t.strm.output,t.strm.next_out,i),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i)}while(l===0);return c-=t.strm.avail_in,c&&(c>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=c&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-c,t.strm.next_in),t.strstart),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),l?xe:n!==ie&&n!==H&&t.strm.avail_in===0&&t.strstart===t.block_start?be:(a=t.window_size-t.strstart,t.strm.avail_in>a&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,a+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),a>t.strm.avail_in&&(a=t.strm.avail_in),a&&(Ct(t.strm,t.window,t.strstart,a),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.high_water<t.strstart&&(t.high_water=t.strstart),a=t.bi_valid+42>>3,a=t.pending_buf_size-a>65535?65535:t.pending_buf_size-a,e=a>t.w_size?t.w_size:a,s=t.strstart-t.block_start,(s>=e||(s||n===H)&&n!==ie&&t.strm.avail_in===0&&s<=a)&&(i=s>a?a:s,l=n===H&&t.strm.avail_in===0&&i===s?1:0,bt(t,t.block_start,i,l),t.block_start+=i,O(t.strm)),l?he:M)},ct=(t,n)=>{let e,i;for(;;){if(t.lookahead<G){if(ve(t),t.lookahead<G&&n===ie)return M;if(t.lookahead===0)break}if(e=0,t.lookahead>=L&&(t.ins_h=ne(t,t.ins_h,t.window[t.strstart+L-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),e!==0&&t.strstart-e<=t.w_size-G&&(t.match_length=Oi(t,e)),t.match_length>=L)if(i=te(t,t.strstart-t.match_start,t.match_length-L),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=L){t.match_length--;do t.strstart++,t.ins_h=ne(t,t.ins_h,t.window[t.strstart+L-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=ne(t,t.ins_h,t.window[t.strstart+1]);else i=te(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(P(t,!1),t.strm.avail_out===0))return M}return t.insert=t.strstart<L-1?t.strstart:L-1,n===H?(P(t,!0),t.strm.avail_out===0?he:xe):t.sym_next&&(P(t,!1),t.strm.avail_out===0)?M:be},ue=(t,n)=>{let e,i,s;for(;;){if(t.lookahead<G){if(ve(t),t.lookahead<G&&n===ie)return M;if(t.lookahead===0)break}if(e=0,t.lookahead>=L&&(t.ins_h=ne(t,t.ins_h,t.window[t.strstart+L-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=L-1,e!==0&&t.prev_length<t.max_lazy_match&&t.strstart-e<=t.w_size-G&&(t.match_length=Oi(t,e),t.match_length<=5&&(t.strategy===qn||t.match_length===L&&t.strstart-t.match_start>4096)&&(t.match_length=L-1)),t.prev_length>=L&&t.match_length<=t.prev_length){s=t.strstart+t.lookahead-L,i=te(t,t.strstart-1-t.prev_match,t.prev_length-L),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=s&&(t.ins_h=ne(t,t.ins_h,t.window[t.strstart+L-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=L-1,t.strstart++,i&&(P(t,!1),t.strm.avail_out===0))return M}else if(t.match_available){if(i=te(t,0,t.window[t.strstart-1]),i&&P(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return M}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=te(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<L-1?t.strstart:L-1,n===H?(P(t,!0),t.strm.avail_out===0?he:xe):t.sym_next&&(P(t,!1),t.strm.avail_out===0)?M:be},gs=(t,n)=>{let e,i,s,a,l=t.window;for(;;){if(t.lookahead<=ee){if(ve(t),t.lookahead<=ee&&n===ie)return M;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=L&&t.strstart>0&&(s=t.strstart-1,i=l[s],i===l[++s]&&i===l[++s]&&i===l[++s])){a=t.strstart+ee;do;while(i===l[++s]&&i===l[++s]&&i===l[++s]&&i===l[++s]&&i===l[++s]&&i===l[++s]&&i===l[++s]&&i===l[++s]&&s<a);t.match_length=ee-(a-s),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=L?(e=te(t,1,t.match_length-L),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(e=te(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),e&&(P(t,!1),t.strm.avail_out===0))return M}return t.insert=0,n===H?(P(t,!0),t.strm.avail_out===0?he:xe):t.sym_next&&(P(t,!1),t.strm.avail_out===0)?M:be},ps=(t,n)=>{let e;for(;;){if(t.lookahead===0&&(ve(t),t.lookahead===0)){if(n===ie)return M;break}if(t.match_length=0,e=te(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,e&&(P(t,!1),t.strm.avail_out===0))return M}return t.insert=0,n===H?(P(t,!0),t.strm.avail_out===0?he:xe):t.sym_next&&(P(t,!1),t.strm.avail_out===0)?M:be};function W(t,n,e,i,s){this.good_length=t,this.max_lazy=n,this.nice_length=e,this.max_chain=i,this.func=s}var ke=[new W(0,0,0,0,Pi),new W(4,4,8,4,ct),new W(4,5,16,8,ct),new W(4,6,32,32,ct),new W(4,4,16,16,ue),new W(8,16,32,32,ue),new W(8,16,128,128,ue),new W(8,32,128,256,ue),new W(32,128,258,1024,ue),new W(32,258,258,4096,ue)],_s=t=>{t.window_size=2*t.w_size,J(t.head),t.max_lazy_match=ke[t.level].max_lazy,t.good_match=ke[t.level].good_length,t.nice_match=ke[t.level].nice_length,t.max_chain_length=ke[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=L-1,t.match_available=0,t.ins_h=0};function vs(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=qe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(os*2),this.dyn_dtree=new Uint16Array((2*rs+1)*2),this.bl_tree=new Uint16Array((2*ls+1)*2),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(cs+1),this.heap=new Uint16Array(2*xt+1),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*xt+1),J(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Me=t=>{if(!t)return 1;let n=t.state;return!n||n.strm!==t||n.status!==_e&&n.status!==Vt&&n.status!==Et&&n.status!==St&&n.status!==yt&&n.status!==kt&&n.status!==le&&n.status!==ye?1:0},Zi=t=>{if(Me(t))return oe(t,K);t.total_in=t.total_out=0,t.data_type=es;let n=t.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap===2?Vt:n.wrap?_e:le,t.adler=n.wrap===2?0:1,n.last_flush=-2,Hn(n),B},Hi=t=>{let n=Zi(t);return n===B&&_s(t.state),n},ws=(t,n)=>Me(t)||t.state.wrap!==2?K:(t.state.gzhead=n,B),Ui=(t,n,e,i,s,a)=>{if(!t)return K;let l=1;if(n===Xn&&(n=6),i<0?(l=0,i=-i):i>15&&(l=2,i-=16),s<1||s>ts||e!==qe||i<8||i>15||n<0||n>9||a<0||a>Qn||i===8&&l!==1)return oe(t,K);i===8&&(i=9);let c=new vs;return t.state=c,c.strm=t,c.status=_e,c.wrap=l,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=s+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+L-1)/L),c.window=new Uint8Array(c.w_size*2),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<s+6,c.pending_buf_size=c.lit_bufsize*4,c.pending_buf=new Uint8Array(c.pending_buf_size),c.sym_buf=c.lit_bufsize,c.sym_end=(c.lit_bufsize-1)*3,c.level=n,c.strategy=a,c.method=e,Hi(t)},ms=(t,n)=>Ui(t,n,qe,is,ns,Jn),bs=(t,n)=>{if(Me(t)||n>jt||n<0)return t?oe(t,K):K;let e=t.state;if(!t.output||t.avail_in!==0&&!t.input||e.status===ye&&n!==H)return oe(t,t.avail_out===0?ot:K);let i=e.last_flush;if(e.last_flush=n,e.pending!==0){if(O(t),t.avail_out===0)return e.last_flush=-1,B}else if(t.avail_in===0&&Gt(n)<=Gt(i)&&n!==H)return oe(t,ot);if(e.status===ye&&t.avail_in!==0)return oe(t,ot);if(e.status===_e&&e.wrap===0&&(e.status=le),e.status===_e){let s=qe+(e.w_bits-8<<4)<<8,a=-1;if(e.strategy>=Pe||e.level<2?a=0:e.level<6?a=1:e.level===6?a=2:a=3,s|=a<<6,e.strstart!==0&&(s|=hs),s+=31-s%31,Se(e,s),e.strstart!==0&&(Se(e,t.adler>>>16),Se(e,t.adler&65535)),t.adler=1,e.status=le,O(t),e.pending!==0)return e.last_flush=-1,B}if(e.status===Vt){if(t.adler=0,I(e,31),I(e,139),I(e,8),e.gzhead)I(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),I(e,e.gzhead.time&255),I(e,e.gzhead.time>>8&255),I(e,e.gzhead.time>>16&255),I(e,e.gzhead.time>>24&255),I(e,e.level===9?2:e.strategy>=Pe||e.level<2?4:0),I(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(I(e,e.gzhead.extra.length&255),I(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(t.adler=N(t.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=Et;else if(I(e,0),I(e,0),I(e,0),I(e,0),I(e,0),I(e,e.level===9?2:e.strategy>=Pe||e.level<2?4:0),I(e,fs),e.status=le,O(t),e.pending!==0)return e.last_flush=-1,B}if(e.status===Et){if(e.gzhead.extra){let s=e.pending,a=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+a>e.pending_buf_size;){let c=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+c),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>s&&(t.adler=N(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex+=c,O(t),e.pending!==0)return e.last_flush=-1,B;s=0,a-=c}let l=new Uint8Array(e.gzhead.extra);e.pending_buf.set(l.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending+=a,e.gzhead.hcrc&&e.pending>s&&(t.adler=N(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=St}if(e.status===St){if(e.gzhead.name){let s=e.pending,a;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(t.adler=N(t.adler,e.pending_buf,e.pending-s,s)),O(t),e.pending!==0)return e.last_flush=-1,B;s=0}e.gzindex<e.gzhead.name.length?a=e.gzhead.name.charCodeAt(e.gzindex++)&255:a=0,I(e,a)}while(a!==0);e.gzhead.hcrc&&e.pending>s&&(t.adler=N(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=yt}if(e.status===yt){if(e.gzhead.comment){let s=e.pending,a;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(t.adler=N(t.adler,e.pending_buf,e.pending-s,s)),O(t),e.pending!==0)return e.last_flush=-1,B;s=0}e.gzindex<e.gzhead.comment.length?a=e.gzhead.comment.charCodeAt(e.gzindex++)&255:a=0,I(e,a)}while(a!==0);e.gzhead.hcrc&&e.pending>s&&(t.adler=N(t.adler,e.pending_buf,e.pending-s,s))}e.status=kt}if(e.status===kt){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(O(t),e.pending!==0))return e.last_flush=-1,B;I(e,t.adler&255),I(e,t.adler>>8&255),t.adler=0}if(e.status=le,O(t),e.pending!==0)return e.last_flush=-1,B}if(t.avail_in!==0||e.lookahead!==0||n!==ie&&e.status!==ye){let s=e.level===0?Pi(e,n):e.strategy===Pe?ps(e,n):e.strategy===Yn?gs(e,n):ke[e.level].func(e,n);if((s===he||s===xe)&&(e.status=ye),s===M||s===he)return t.avail_out===0&&(e.last_flush=-1),B;if(s===be&&(n===jn?Wn(e):n!==jt&&(bt(e,0,0,!1),n===Kn&&(J(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),O(t),t.avail_out===0))return e.last_flush=-1,B}return n!==H?B:e.wrap<=0?Kt:(e.wrap===2?(I(e,t.adler&255),I(e,t.adler>>8&255),I(e,t.adler>>16&255),I(e,t.adler>>24&255),I(e,t.total_in&255),I(e,t.total_in>>8&255),I(e,t.total_in>>16&255),I(e,t.total_in>>24&255)):(Se(e,t.adler>>>16),Se(e,t.adler&65535)),O(t),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?B:Kt)},xs=t=>{if(Me(t))return K;let n=t.state.status;return t.state=null,n===le?oe(t,Gn):B},Es=(t,n)=>{let e=n.length;if(Me(t))return K;let i=t.state,s=i.wrap;if(s===2||s===1&&i.status!==_e||i.lookahead)return K;if(s===1&&(t.adler=Fe(t.adler,n,e,0)),i.wrap=0,e>=i.w_size){s===0&&(J(i.head),i.strstart=0,i.block_start=0,i.insert=0);let f=new Uint8Array(i.w_size);f.set(n.subarray(e-i.w_size,e),0),n=f,e=i.w_size}let a=t.avail_in,l=t.next_in,c=t.input;for(t.avail_in=e,t.next_in=0,t.input=n,ve(i);i.lookahead>=L;){let f=i.strstart,r=i.lookahead-(L-1);do i.ins_h=ne(i,i.ins_h,i.window[f+L-1]),i.prev[f&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=f,f++;while(--r);i.strstart=f,i.lookahead=L-1,ve(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=L-1,i.match_available=0,t.next_in=l,t.input=c,t.avail_in=a,i.wrap=s,B},Ss=ms,ys=Ui,ks=Hi,Cs=Zi,Ts=ws,Ds=bs,Ls=xs,Is=Es,Vs="pako deflate (from Nodeca project)",Te={deflateInit:Ss,deflateInit2:ys,deflateReset:ks,deflateResetKeep:Cs,deflateSetHeader:Ts,deflate:Ds,deflateEnd:Ls,deflateSetDictionary:Is,deflateInfo:Vs},As=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),Fs=function(t){let n=Array.prototype.slice.call(arguments,1);for(;n.length;){let e=n.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(let i in e)As(e,i)&&(t[i]=e[i])}}return t},zs=t=>{let n=0;for(let i=0,s=t.length;i<s;i++)n+=t[i].length;let e=new Uint8Array(n);for(let i=0,s=0,a=t.length;i<a;i++){let l=t[i];e.set(l,s),s+=l.length}return e},Ye={assign:Fs,flattenChunks:zs},Wi=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Wi=!1}var ze=new Uint8Array(256);for(let t=0;t<256;t++)ze[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;ze[254]=ze[254]=1;var Ns=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let n,e,i,s,a,l=t.length,c=0;for(s=0;s<l;s++)e=t.charCodeAt(s),(e&64512)===55296&&s+1<l&&(i=t.charCodeAt(s+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),c+=e<128?1:e<2048?2:e<65536?3:4;for(n=new Uint8Array(c),a=0,s=0;a<c;s++)e=t.charCodeAt(s),(e&64512)===55296&&s+1<l&&(i=t.charCodeAt(s+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),e<128?n[a++]=e:e<2048?(n[a++]=192|e>>>6,n[a++]=128|e&63):e<65536?(n[a++]=224|e>>>12,n[a++]=128|e>>>6&63,n[a++]=128|e&63):(n[a++]=240|e>>>18,n[a++]=128|e>>>12&63,n[a++]=128|e>>>6&63,n[a++]=128|e&63);return n},Bs=(t,n)=>{if(n<65534&&t.subarray&&Wi)return String.fromCharCode.apply(null,t.length===n?t:t.subarray(0,n));let e="";for(let i=0;i<n;i++)e+=String.fromCharCode(t[i]);return e},$s=(t,n)=>{let e=n||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,n));let i,s,a=new Array(e*2);for(s=0,i=0;i<e;){let l=t[i++];if(l<128){a[s++]=l;continue}let c=ze[l];if(c>4){a[s++]=65533,i+=c-1;continue}for(l&=c===2?31:c===3?15:7;c>1&&i<e;)l=l<<6|t[i++]&63,c--;if(c>1){a[s++]=65533;continue}l<65536?a[s++]=l:(l-=65536,a[s++]=55296|l>>10&1023,a[s++]=56320|l&1023)}return Bs(a,s)},Ms=(t,n)=>{n=n||t.length,n>t.length&&(n=t.length);let e=n-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?n:e+ze[t[e]]>n?e:n},Ne={string2buf:Ns,buf2string:$s,utf8border:Ms};function Rs(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var ji=Rs,Ki=Object.prototype.toString,{Z_NO_FLUSH:Os,Z_SYNC_FLUSH:Ps,Z_FULL_FLUSH:Zs,Z_FINISH:Hs,Z_OK:Ge,Z_STREAM_END:Us,Z_DEFAULT_COMPRESSION:Ws,Z_DEFAULT_STRATEGY:js,Z_DEFLATED:Ks}=me;function Re(t){this.options=Ye.assign({level:Ws,method:Ks,chunkSize:16384,windowBits:15,memLevel:8,strategy:js},t||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ji,this.strm.avail_out=0;let e=Te.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(e!==Ge)throw new Error(ce[e]);if(n.header&&Te.deflateSetHeader(this.strm,n.header),n.dictionary){let i;if(typeof n.dictionary=="string"?i=Ne.string2buf(n.dictionary):Ki.call(n.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(n.dictionary):i=n.dictionary,e=Te.deflateSetDictionary(this.strm,i),e!==Ge)throw new Error(ce[e]);this._dict_set=!0}}Re.prototype.push=function(t,n){let e=this.strm,i=this.options.chunkSize,s,a;if(this.ended)return!1;for(n===~~n?a=n:a=n===!0?Hs:Os,typeof t=="string"?e.input=Ne.string2buf(t):Ki.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),(a===Ps||a===Zs)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(s=Te.deflate(e,a),s===Us)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),s=Te.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Ge;if(e.avail_out===0){this.onData(e.output);continue}if(a>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};Re.prototype.onData=function(t){this.chunks.push(t)};Re.prototype.onEnd=function(t){t===Ge&&(this.result=Ye.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function At(t,n){let e=new Re(n);if(e.push(t,!0),e.err)throw e.msg||ce[e.err];return e.result}function Gs(t,n){return n=n||{},n.raw=!0,At(t,n)}function Xs(t,n){return n=n||{},n.gzip=!0,At(t,n)}var qs=Re,Ys=At,Qs=Gs,Js=Xs,ea=me,ta={Deflate:qs,deflate:Ys,deflateRaw:Qs,gzip:Js,constants:ea},Ze=16209,ia=16191,na=function(n,e){let i,s,a,l,c,f,r,o,d,u,h,p,E,m,w,b,y,v,_,S,x,T,D,C,k=n.state;i=n.next_in,D=n.input,s=i+(n.avail_in-5),a=n.next_out,C=n.output,l=a-(e-n.avail_out),c=a+(n.avail_out-257),f=k.dmax,r=k.wsize,o=k.whave,d=k.wnext,u=k.window,h=k.hold,p=k.bits,E=k.lencode,m=k.distcode,w=(1<<k.lenbits)-1,b=(1<<k.distbits)-1;e:do{p<15&&(h+=D[i++]<<p,p+=8,h+=D[i++]<<p,p+=8),y=E[h&w];t:for(;;){if(v=y>>>24,h>>>=v,p-=v,v=y>>>16&255,v===0)C[a++]=y&65535;else if(v&16){_=y&65535,v&=15,v&&(p<v&&(h+=D[i++]<<p,p+=8),_+=h&(1<<v)-1,h>>>=v,p-=v),p<15&&(h+=D[i++]<<p,p+=8,h+=D[i++]<<p,p+=8),y=m[h&b];i:for(;;){if(v=y>>>24,h>>>=v,p-=v,v=y>>>16&255,v&16){if(S=y&65535,v&=15,p<v&&(h+=D[i++]<<p,p+=8,p<v&&(h+=D[i++]<<p,p+=8)),S+=h&(1<<v)-1,S>f){n.msg="invalid distance too far back",k.mode=Ze;break e}if(h>>>=v,p-=v,v=a-l,S>v){if(v=S-v,v>o&&k.sane){n.msg="invalid distance too far back",k.mode=Ze;break e}if(x=0,T=u,d===0){if(x+=r-v,v<_){_-=v;do C[a++]=u[x++];while(--v);x=a-S,T=C}}else if(d<v){if(x+=r+d-v,v-=d,v<_){_-=v;do C[a++]=u[x++];while(--v);if(x=0,d<_){v=d,_-=v;do C[a++]=u[x++];while(--v);x=a-S,T=C}}}else if(x+=d-v,v<_){_-=v;do C[a++]=u[x++];while(--v);x=a-S,T=C}for(;_>2;)C[a++]=T[x++],C[a++]=T[x++],C[a++]=T[x++],_-=3;_&&(C[a++]=T[x++],_>1&&(C[a++]=T[x++]))}else{x=a-S;do C[a++]=C[x++],C[a++]=C[x++],C[a++]=C[x++],_-=3;while(_>2);_&&(C[a++]=C[x++],_>1&&(C[a++]=C[x++]))}}else if(v&64){n.msg="invalid distance code",k.mode=Ze;break e}else{y=m[(y&65535)+(h&(1<<v)-1)];continue i}break}}else if(v&64)if(v&32){k.mode=ia;break e}else{n.msg="invalid literal/length code",k.mode=Ze;break e}else{y=E[(y&65535)+(h&(1<<v)-1)];continue t}break}}while(i<s&&a<c);_=p>>3,i-=_,p-=_<<3,h&=(1<<p)-1,n.next_in=i,n.next_out=a,n.avail_in=i<s?5+(s-i):5-(i-s),n.avail_out=a<c?257+(c-a):257-(a-c),k.hold=h,k.bits=p},ge=15,Xt=852,qt=592,Yt=0,ht=1,Qt=2,sa=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),aa=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ra=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),la=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),oa=(t,n,e,i,s,a,l,c)=>{let f=c.bits,r=0,o=0,d=0,u=0,h=0,p=0,E=0,m=0,w=0,b=0,y,v,_,S,x,T=null,D,C=new Uint16Array(ge+1),k=new Uint16Array(ge+1),F=null,V,z,$;for(r=0;r<=ge;r++)C[r]=0;for(o=0;o<i;o++)C[n[e+o]]++;for(h=f,u=ge;u>=1&&C[u]===0;u--);if(h>u&&(h=u),u===0)return s[a++]=1<<24|64<<16|0,s[a++]=1<<24|64<<16|0,c.bits=1,0;for(d=1;d<u&&C[d]===0;d++);for(h<d&&(h=d),m=1,r=1;r<=ge;r++)if(m<<=1,m-=C[r],m<0)return-1;if(m>0&&(t===Yt||u!==1))return-1;for(k[1]=0,r=1;r<ge;r++)k[r+1]=k[r]+C[r];for(o=0;o<i;o++)n[e+o]!==0&&(l[k[n[e+o]]++]=o);if(t===Yt?(T=F=l,D=20):t===ht?(T=sa,F=aa,D=257):(T=ra,F=la,D=0),b=0,o=0,r=d,x=a,p=h,E=0,_=-1,w=1<<h,S=w-1,t===ht&&w>Xt||t===Qt&&w>qt)return 1;for(;;){V=r-E,l[o]+1<D?(z=0,$=l[o]):l[o]>=D?(z=F[l[o]-D],$=T[l[o]-D]):(z=32+64,$=0),y=1<<r-E,v=1<<p,d=v;do v-=y,s[x+(b>>E)+v]=V<<24|z<<16|$|0;while(v!==0);for(y=1<<r-1;b&y;)y>>=1;if(y!==0?(b&=y-1,b+=y):b=0,o++,--C[r]===0){if(r===u)break;r=n[e+l[o]]}if(r>h&&(b&S)!==_){for(E===0&&(E=h),x+=d,p=r-E,m=1<<p;p+E<u&&(m-=C[p+E],!(m<=0));)p++,m<<=1;if(w+=1<<p,t===ht&&w>Xt||t===Qt&&w>qt)return 1;_=b&S,s[_]=h<<24|p<<16|x-a|0}}return b!==0&&(s[x+b]=r-E<<24|64<<16|0),c.bits=h,0},De=oa,ca=0,Gi=1,Xi=2,{Z_FINISH:Jt,Z_BLOCK:ha,Z_TREES:He,Z_OK:fe,Z_STREAM_END:fa,Z_NEED_DICT:da,Z_STREAM_ERROR:U,Z_DATA_ERROR:qi,Z_MEM_ERROR:Yi,Z_BUF_ERROR:ua,Z_DEFLATED:ei}=me,Qe=16180,ti=16181,ii=16182,ni=16183,si=16184,ai=16185,ri=16186,li=16187,oi=16188,ci=16189,Xe=16190,q=16191,ft=16192,hi=16193,dt=16194,fi=16195,di=16196,ui=16197,gi=16198,Ue=16199,We=16200,pi=16201,_i=16202,vi=16203,wi=16204,mi=16205,ut=16206,bi=16207,xi=16208,A=16209,Qi=16210,Ji=16211,ga=852,pa=592,_a=15,va=_a,Ei=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function wa(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var de=t=>{if(!t)return 1;let n=t.state;return!n||n.strm!==t||n.mode<Qe||n.mode>Ji?1:0},en=t=>{if(de(t))return U;let n=t.state;return t.total_in=t.total_out=n.total=0,t.msg="",n.wrap&&(t.adler=n.wrap&1),n.mode=Qe,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(ga),n.distcode=n.distdyn=new Int32Array(pa),n.sane=1,n.back=-1,fe},tn=t=>{if(de(t))return U;let n=t.state;return n.wsize=0,n.whave=0,n.wnext=0,en(t)},nn=(t,n)=>{let e;if(de(t))return U;let i=t.state;return n<0?(e=0,n=-n):(e=(n>>4)+5,n<48&&(n&=15)),n&&(n<8||n>15)?U:(i.window!==null&&i.wbits!==n&&(i.window=null),i.wrap=e,i.wbits=n,tn(t))},sn=(t,n)=>{if(!t)return U;let e=new wa;t.state=e,e.strm=t,e.window=null,e.mode=Qe;let i=nn(t,n);return i!==fe&&(t.state=null),i},ma=t=>sn(t,va),Si=!0,gt,pt,ba=t=>{if(Si){gt=new Int32Array(512),pt=new Int32Array(32);let n=0;for(;n<144;)t.lens[n++]=8;for(;n<256;)t.lens[n++]=9;for(;n<280;)t.lens[n++]=7;for(;n<288;)t.lens[n++]=8;for(De(Gi,t.lens,0,288,gt,0,t.work,{bits:9}),n=0;n<32;)t.lens[n++]=5;De(Xi,t.lens,0,32,pt,0,t.work,{bits:5}),Si=!1}t.lencode=gt,t.lenbits=9,t.distcode=pt,t.distbits=5},an=(t,n,e,i)=>{let s,a=t.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(n.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(s=a.wsize-a.wnext,s>i&&(s=i),a.window.set(n.subarray(e-i,e-i+s),a.wnext),i-=s,i?(a.window.set(n.subarray(e-i,e),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0},xa=(t,n)=>{let e,i,s,a,l,c,f,r,o,d,u,h,p,E,m=0,w,b,y,v,_,S,x,T,D=new Uint8Array(4),C,k,F=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(de(t)||!t.output||!t.input&&t.avail_in!==0)return U;e=t.state,e.mode===q&&(e.mode=ft),l=t.next_out,s=t.output,f=t.avail_out,a=t.next_in,i=t.input,c=t.avail_in,r=e.hold,o=e.bits,d=c,u=f,T=fe;e:for(;;)switch(e.mode){case Qe:if(e.wrap===0){e.mode=ft;break}for(;o<16;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}if(e.wrap&2&&r===35615){e.wbits===0&&(e.wbits=15),e.check=0,D[0]=r&255,D[1]=r>>>8&255,e.check=N(e.check,D,2,0),r=0,o=0,e.mode=ti;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((r&255)<<8)+(r>>8))%31){t.msg="incorrect header check",e.mode=A;break}if((r&15)!==ei){t.msg="unknown compression method",e.mode=A;break}if(r>>>=4,o-=4,x=(r&15)+8,e.wbits===0&&(e.wbits=x),x>15||x>e.wbits){t.msg="invalid window size",e.mode=A;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=r&512?ci:q,r=0,o=0;break;case ti:for(;o<16;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}if(e.flags=r,(e.flags&255)!==ei){t.msg="unknown compression method",e.mode=A;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=A;break}e.head&&(e.head.text=r>>8&1),e.flags&512&&e.wrap&4&&(D[0]=r&255,D[1]=r>>>8&255,e.check=N(e.check,D,2,0)),r=0,o=0,e.mode=ii;case ii:for(;o<32;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}e.head&&(e.head.time=r),e.flags&512&&e.wrap&4&&(D[0]=r&255,D[1]=r>>>8&255,D[2]=r>>>16&255,D[3]=r>>>24&255,e.check=N(e.check,D,4,0)),r=0,o=0,e.mode=ni;case ni:for(;o<16;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}e.head&&(e.head.xflags=r&255,e.head.os=r>>8),e.flags&512&&e.wrap&4&&(D[0]=r&255,D[1]=r>>>8&255,e.check=N(e.check,D,2,0)),r=0,o=0,e.mode=si;case si:if(e.flags&1024){for(;o<16;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}e.length=r,e.head&&(e.head.extra_len=r),e.flags&512&&e.wrap&4&&(D[0]=r&255,D[1]=r>>>8&255,e.check=N(e.check,D,2,0)),r=0,o=0}else e.head&&(e.head.extra=null);e.mode=ai;case ai:if(e.flags&1024&&(h=e.length,h>c&&(h=c),h&&(e.head&&(x=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(i.subarray(a,a+h),x)),e.flags&512&&e.wrap&4&&(e.check=N(e.check,i,h,a)),c-=h,a+=h,e.length-=h),e.length))break e;e.length=0,e.mode=ri;case ri:if(e.flags&2048){if(c===0)break e;h=0;do x=i[a+h++],e.head&&x&&e.length<65536&&(e.head.name+=String.fromCharCode(x));while(x&&h<c);if(e.flags&512&&e.wrap&4&&(e.check=N(e.check,i,h,a)),c-=h,a+=h,x)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=li;case li:if(e.flags&4096){if(c===0)break e;h=0;do x=i[a+h++],e.head&&x&&e.length<65536&&(e.head.comment+=String.fromCharCode(x));while(x&&h<c);if(e.flags&512&&e.wrap&4&&(e.check=N(e.check,i,h,a)),c-=h,a+=h,x)break e}else e.head&&(e.head.comment=null);e.mode=oi;case oi:if(e.flags&512){for(;o<16;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}if(e.wrap&4&&r!==(e.check&65535)){t.msg="header crc mismatch",e.mode=A;break}r=0,o=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=q;break;case ci:for(;o<32;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}t.adler=e.check=Ei(r),r=0,o=0,e.mode=Xe;case Xe:if(e.havedict===0)return t.next_out=l,t.avail_out=f,t.next_in=a,t.avail_in=c,e.hold=r,e.bits=o,da;t.adler=e.check=1,e.mode=q;case q:if(n===ha||n===He)break e;case ft:if(e.last){r>>>=o&7,o-=o&7,e.mode=ut;break}for(;o<3;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}switch(e.last=r&1,r>>>=1,o-=1,r&3){case 0:e.mode=hi;break;case 1:if(ba(e),e.mode=Ue,n===He){r>>>=2,o-=2;break e}break;case 2:e.mode=di;break;case 3:t.msg="invalid block type",e.mode=A}r>>>=2,o-=2;break;case hi:for(r>>>=o&7,o-=o&7;o<32;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}if((r&65535)!==(r>>>16^65535)){t.msg="invalid stored block lengths",e.mode=A;break}if(e.length=r&65535,r=0,o=0,e.mode=dt,n===He)break e;case dt:e.mode=fi;case fi:if(h=e.length,h){if(h>c&&(h=c),h>f&&(h=f),h===0)break e;s.set(i.subarray(a,a+h),l),c-=h,a+=h,f-=h,l+=h,e.length-=h;break}e.mode=q;break;case di:for(;o<14;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}if(e.nlen=(r&31)+257,r>>>=5,o-=5,e.ndist=(r&31)+1,r>>>=5,o-=5,e.ncode=(r&15)+4,r>>>=4,o-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=A;break}e.have=0,e.mode=ui;case ui:for(;e.have<e.ncode;){for(;o<3;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}e.lens[F[e.have++]]=r&7,r>>>=3,o-=3}for(;e.have<19;)e.lens[F[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,C={bits:e.lenbits},T=De(ca,e.lens,0,19,e.lencode,0,e.work,C),e.lenbits=C.bits,T){t.msg="invalid code lengths set",e.mode=A;break}e.have=0,e.mode=gi;case gi:for(;e.have<e.nlen+e.ndist;){for(;m=e.lencode[r&(1<<e.lenbits)-1],w=m>>>24,b=m>>>16&255,y=m&65535,!(w<=o);){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}if(y<16)r>>>=w,o-=w,e.lens[e.have++]=y;else{if(y===16){for(k=w+2;o<k;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}if(r>>>=w,o-=w,e.have===0){t.msg="invalid bit length repeat",e.mode=A;break}x=e.lens[e.have-1],h=3+(r&3),r>>>=2,o-=2}else if(y===17){for(k=w+3;o<k;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}r>>>=w,o-=w,x=0,h=3+(r&7),r>>>=3,o-=3}else{for(k=w+7;o<k;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}r>>>=w,o-=w,x=0,h=11+(r&127),r>>>=7,o-=7}if(e.have+h>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=A;break}for(;h--;)e.lens[e.have++]=x}}if(e.mode===A)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=A;break}if(e.lenbits=9,C={bits:e.lenbits},T=De(Gi,e.lens,0,e.nlen,e.lencode,0,e.work,C),e.lenbits=C.bits,T){t.msg="invalid literal/lengths set",e.mode=A;break}if(e.distbits=6,e.distcode=e.distdyn,C={bits:e.distbits},T=De(Xi,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,C),e.distbits=C.bits,T){t.msg="invalid distances set",e.mode=A;break}if(e.mode=Ue,n===He)break e;case Ue:e.mode=We;case We:if(c>=6&&f>=258){t.next_out=l,t.avail_out=f,t.next_in=a,t.avail_in=c,e.hold=r,e.bits=o,na(t,u),l=t.next_out,s=t.output,f=t.avail_out,a=t.next_in,i=t.input,c=t.avail_in,r=e.hold,o=e.bits,e.mode===q&&(e.back=-1);break}for(e.back=0;m=e.lencode[r&(1<<e.lenbits)-1],w=m>>>24,b=m>>>16&255,y=m&65535,!(w<=o);){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}if(b&&!(b&240)){for(v=w,_=b,S=y;m=e.lencode[S+((r&(1<<v+_)-1)>>v)],w=m>>>24,b=m>>>16&255,y=m&65535,!(v+w<=o);){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}r>>>=v,o-=v,e.back+=v}if(r>>>=w,o-=w,e.back+=w,e.length=y,b===0){e.mode=mi;break}if(b&32){e.back=-1,e.mode=q;break}if(b&64){t.msg="invalid literal/length code",e.mode=A;break}e.extra=b&15,e.mode=pi;case pi:if(e.extra){for(k=e.extra;o<k;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}e.length+=r&(1<<e.extra)-1,r>>>=e.extra,o-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=_i;case _i:for(;m=e.distcode[r&(1<<e.distbits)-1],w=m>>>24,b=m>>>16&255,y=m&65535,!(w<=o);){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}if(!(b&240)){for(v=w,_=b,S=y;m=e.distcode[S+((r&(1<<v+_)-1)>>v)],w=m>>>24,b=m>>>16&255,y=m&65535,!(v+w<=o);){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}r>>>=v,o-=v,e.back+=v}if(r>>>=w,o-=w,e.back+=w,b&64){t.msg="invalid distance code",e.mode=A;break}e.offset=y,e.extra=b&15,e.mode=vi;case vi:if(e.extra){for(k=e.extra;o<k;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}e.offset+=r&(1<<e.extra)-1,r>>>=e.extra,o-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=A;break}e.mode=wi;case wi:if(f===0)break e;if(h=u-f,e.offset>h){if(h=e.offset-h,h>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=A;break}h>e.wnext?(h-=e.wnext,p=e.wsize-h):p=e.wnext-h,h>e.length&&(h=e.length),E=e.window}else E=s,p=l-e.offset,h=e.length;h>f&&(h=f),f-=h,e.length-=h;do s[l++]=E[p++];while(--h);e.length===0&&(e.mode=We);break;case mi:if(f===0)break e;s[l++]=e.length,f--,e.mode=We;break;case ut:if(e.wrap){for(;o<32;){if(c===0)break e;c--,r|=i[a++]<<o,o+=8}if(u-=f,t.total_out+=u,e.total+=u,e.wrap&4&&u&&(t.adler=e.check=e.flags?N(e.check,s,u,l-u):Fe(e.check,s,u,l-u)),u=f,e.wrap&4&&(e.flags?r:Ei(r))!==e.check){t.msg="incorrect data check",e.mode=A;break}r=0,o=0}e.mode=bi;case bi:if(e.wrap&&e.flags){for(;o<32;){if(c===0)break e;c--,r+=i[a++]<<o,o+=8}if(e.wrap&4&&r!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=A;break}r=0,o=0}e.mode=xi;case xi:T=fa;break e;case A:T=qi;break e;case Qi:return Yi;case Ji:default:return U}return t.next_out=l,t.avail_out=f,t.next_in=a,t.avail_in=c,e.hold=r,e.bits=o,(e.wsize||u!==t.avail_out&&e.mode<A&&(e.mode<ut||n!==Jt))&&an(t,t.output,t.next_out,u-t.avail_out),d-=t.avail_in,u-=t.avail_out,t.total_in+=d,t.total_out+=u,e.total+=u,e.wrap&4&&u&&(t.adler=e.check=e.flags?N(e.check,s,u,t.next_out-u):Fe(e.check,s,u,t.next_out-u)),t.data_type=e.bits+(e.last?64:0)+(e.mode===q?128:0)+(e.mode===Ue||e.mode===dt?256:0),(d===0&&u===0||n===Jt)&&T===fe&&(T=ua),T},Ea=t=>{if(de(t))return U;let n=t.state;return n.window&&(n.window=null),t.state=null,fe},Sa=(t,n)=>{if(de(t))return U;let e=t.state;return e.wrap&2?(e.head=n,n.done=!1,fe):U},ya=(t,n)=>{let e=n.length,i,s,a;return de(t)||(i=t.state,i.wrap!==0&&i.mode!==Xe)?U:i.mode===Xe&&(s=1,s=Fe(s,n,e,0),s!==i.check)?qi:(a=an(t,n,e,e),a?(i.mode=Qi,Yi):(i.havedict=1,fe))},ka=tn,Ca=nn,Ta=en,Da=ma,La=sn,Ia=xa,Va=Ea,Aa=Sa,Fa=ya,za="pako inflate (from Nodeca project)",Q={inflateReset:ka,inflateReset2:Ca,inflateResetKeep:Ta,inflateInit:Da,inflateInit2:La,inflate:Ia,inflateEnd:Va,inflateGetHeader:Aa,inflateSetDictionary:Fa,inflateInfo:za};function Na(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Ba=Na,rn=Object.prototype.toString,{Z_NO_FLUSH:$a,Z_FINISH:Ma,Z_OK:Be,Z_STREAM_END:_t,Z_NEED_DICT:vt,Z_STREAM_ERROR:Ra,Z_DATA_ERROR:yi,Z_MEM_ERROR:Oa}=me;function Oe(t){this.options=Ye.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});let n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),n.windowBits>=0&&n.windowBits<16&&!(t&&t.windowBits)&&(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(n.windowBits&15||(n.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ji,this.strm.avail_out=0;let e=Q.inflateInit2(this.strm,n.windowBits);if(e!==Be)throw new Error(ce[e]);if(this.header=new Ba,Q.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=Ne.string2buf(n.dictionary):rn.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(e=Q.inflateSetDictionary(this.strm,n.dictionary),e!==Be)))throw new Error(ce[e])}Oe.prototype.push=function(t,n){let e=this.strm,i=this.options.chunkSize,s=this.options.dictionary,a,l,c;if(this.ended)return!1;for(n===~~n?l=n:l=n===!0?Ma:$a,rn.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),a=Q.inflate(e,l),a===vt&&s&&(a=Q.inflateSetDictionary(e,s),a===Be?a=Q.inflate(e,l):a===yi&&(a=vt));e.avail_in>0&&a===_t&&e.state.wrap>0&&t[e.next_in]!==0;)Q.inflateReset(e),a=Q.inflate(e,l);switch(a){case Ra:case yi:case vt:case Oa:return this.onEnd(a),this.ended=!0,!1}if(c=e.avail_out,e.next_out&&(e.avail_out===0||a===_t))if(this.options.to==="string"){let f=Ne.utf8border(e.output,e.next_out),r=e.next_out-f,o=Ne.buf2string(e.output,f);e.next_out=r,e.avail_out=i-r,r&&e.output.set(e.output.subarray(f,f+r),0),this.onData(o)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(a===Be&&c===0)){if(a===_t)return a=Q.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Oe.prototype.onData=function(t){this.chunks.push(t)};Oe.prototype.onEnd=function(t){t===Be&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Ye.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Ft(t,n){let e=new Oe(n);if(e.push(t),e.err)throw e.msg||ce[e.err];return e.result}function Pa(t,n){return n=n||{},n.raw=!0,Ft(t,n)}var Za=Oe,Ha=Ft,Ua=Pa,Wa=Ft,ja=me,Ka={Inflate:Za,inflate:Ha,inflateRaw:Ua,ungzip:Wa,constants:ja},{Deflate:rr,deflate:lr,deflateRaw:or,gzip:Ga}=ta,{Inflate:cr,inflate:hr,inflateRaw:fr,ungzip:Xa}=Ka;var ln=Ga;var zt=Xa;var Ya={versionFolder:".versions",autoSave:!0,autoSaveInterval:5,autoClear:!0,maxVersions:50,enableMaxVersions:!0,maxDays:30,enableMaxDays:!1,useRelativeTime:!1,diffGranularity:"line",diffViewMode:"unified",enableDeduplication:!0,showNotifications:!0,excludedFolders:[],enableCompression:!0,enableIncrementalStorage:!0,versionsPerPage:20,rebuildBaseInterval:10,autoSaveOnModify:!0,autoSaveDelay:180,autoSaveMinChanges:10,autoSaveOnInterval:!1,autoSaveOnFileSwitch:!0,autoSaveOnFocusLost:!1,enableQuickPreview:!0,enableVersionTags:!0,defaultTags:["\u91CD\u8981","\u91CC\u7A0B\u7891","\u53D1\u5E03","\u5907\u4EFD","\u8349\u7A3F"],showVersionStats:!0,enableStatusBarDiff:!0},Je=class extends g.Plugin{constructor(){super(...arguments);this.autoSaveTimer=null;this.lastSavedContent=new Map;this.lastModifiedTime=new Map;this.pendingSaves=new Map;this.versionCache=new Map;this.previousActiveFile=null}async onload(){await this.loadSettings(),this.statusBarItem=this.addStatusBarItem(),this.updateStatusBar(),this.settings.enableStatusBarDiff&&(this.statusBarItem.addClass("version-control-statusbar-clickable"),this.statusBarItem.addEventListener("click",()=>{this.quickDiffFromStatusBar()})),this.registerView("version-history",e=>new tt(e,this)),this.addRibbonIcon("history","\u7248\u672C\u5386\u53F2",()=>{this.activateVersionHistoryView()}),this.addCommand({id:"create-version",name:"\u521B\u5EFA\u7248\u672C\u5FEB\u7167",callback:()=>this.createManualVersion()}),this.addCommand({id:"show-version-history",name:"\u663E\u793A\u7248\u672C\u5386\u53F2",callback:()=>this.activateVersionHistoryView()}),this.addCommand({id:"create-full-snapshot",name:"\u521B\u5EFA\u5168\u5E93\u7248\u672C",callback:()=>this.createFullSnapshot()}),this.addCommand({id:"compare-with-version",name:"\u4E0E\u5386\u53F2\u7248\u672C\u5BF9\u6BD4",callback:()=>this.quickCompare()}),this.addCommand({id:"restore-last-version",name:"\u6062\u590D\u5230\u4E0A\u4E00\u7248\u672C",callback:()=>this.restoreLastVersion()}),this.addCommand({id:"optimize-storage",name:"\u4F18\u5316\u5B58\u50A8\u7A7A\u95F4",callback:()=>this.optimizeAllVersionFiles()}),this.addCommand({id:"quick-preview-version",name:"\u5FEB\u901F\u9884\u89C8\u4E0A\u4E00\u7248\u672C",callback:()=>this.quickPreviewLastVersion()}),this.addCommand({id:"star-current-version",name:"\u6807\u8BB0\u5F53\u524D\u7248\u672C\u4E3A\u91CD\u8981",callback:()=>this.starLastVersion()}),this.addSettingTab(new Rt(this.app,this)),this.registerEvent(this.app.vault.on("modify",e=>{e instanceof g.TFile&&this.settings.autoSave&&this.settings.autoSaveOnModify&&this.scheduleAutoSave(e)})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.settings.autoSave&&this.settings.autoSaveOnFileSwitch&&this.handleFileSwitch()})),this.settings.autoSaveOnFocusLost&&this.registerDomEvent(window,"blur",()=>{this.settings.autoSave&&this.saveCurrentFileOnFocusLost()}),this.settings.autoSave&&this.settings.autoSaveOnInterval&&this.startAutoSave(),await this.ensureVersionFolder(),this.settings.showNotifications&&new g.Notice("\u2705 \u7248\u672C\u63A7\u5236\u63D2\u4EF6\u5DF2\u542F\u52A8")}onunload(){this.autoSaveTimer&&clearInterval(this.autoSaveTimer),this.pendingSaves.forEach(e=>clearTimeout(e)),this.pendingSaves.clear(),this.versionCache.clear()}async loadSettings(){this.settings=Object.assign({},Ya,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.updateStatusBar()}updateStatusBar(){if(!this.settings.autoSave){this.statusBarItem.setText("\u23F8 \u7248\u672C\u63A7\u5236: \u5DF2\u6682\u505C"),this.statusBarItem.title="\u70B9\u51FB\u5FEB\u901F\u5BF9\u6BD4\u5F53\u524D\u6587\u4EF6";return}let e=[];this.settings.autoSaveOnModify&&e.push("\u4FEE\u6539"),this.settings.autoSaveOnInterval&&e.push(`${this.settings.autoSaveInterval}\u5206\u949F`),this.settings.autoSaveOnFileSwitch&&e.push("\u5207\u6362"),this.settings.autoSaveOnFocusLost&&e.push("\u5931\u7126"),e.length>0?this.statusBarItem.setText(`\u23F1 \u7248\u672C\u63A7\u5236: ${e.join(" | ")}`):this.statusBarItem.setText("\u23F1 \u7248\u672C\u63A7\u5236: \u5DF2\u542F\u7528"),this.statusBarItem.title="\u70B9\u51FB\u5FEB\u901F\u5BF9\u6BD4\u5F53\u524D\u6587\u4EF6\u4E0E\u6700\u65B0\u7248\u672C"}async quickDiffFromStatusBar(){if(!this.settings.enableStatusBarDiff)return;let e=this.app.workspace.getActiveFile();if(!e){new g.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new g.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u5BF9\u6BD4");return}let s=i[0];new ae(this.app,this,e,s.id).open()}async ensureVersionFolder(){let e=this.app.vault.adapter,i=this.settings.versionFolder;try{await e.exists(i)||await e.mkdir(i)}catch(s){console.error("\u521B\u5EFA\u7248\u672C\u6587\u4EF6\u5939\u5931\u8D25:",s),new g.Notice("\u26A0\uFE0F \u65E0\u6CD5\u521B\u5EFA\u7248\u672C\u6587\u4EF6\u5939,\u8BF7\u68C0\u67E5\u6743\u9650")}}async activateVersionHistoryView(){let{workspace:e}=this.app,i=e.getLeavesOfType("version-history")[0];if(!i){let s=e.getRightLeaf(!1);if(!s){new g.Notice("\u65E0\u6CD5\u6253\u5F00\u7248\u672C\u5386\u53F2\u89C6\u56FE");return}i=s,await i.setViewState({type:"version-history",active:!0})}e.revealLeaf(i)}startAutoSave(){this.autoSaveTimer&&clearInterval(this.autoSaveTimer),this.settings.autoSaveOnInterval&&(this.autoSaveTimer=setInterval(()=>{this.autoSaveCurrentFile()},this.settings.autoSaveInterval*60*1e3))}scheduleAutoSave(e){if(this.isExcluded(e.path))return;let i=this.pendingSaves.get(e.path);i&&clearTimeout(i);let s=setTimeout(()=>{this.autoSaveFile(e),this.pendingSaves.delete(e.path)},this.settings.autoSaveDelay*1e3);this.pendingSaves.set(e.path,s)}async autoSaveFile(e){try{let i=await this.app.vault.read(e),s=this.lastSavedContent.get(e.path);if(s&&this.countChanges(s,i)<this.settings.autoSaveMinChanges)return;i!==s&&(await this.createVersion(e,"[Auto Save]",!1),this.lastSavedContent.set(e.path,i),this.lastModifiedTime.set(e.path,Date.now()),this.updateStatusBarWithLastSave())}catch(i){console.error("\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25:",i)}}countChanges(e,i){let s=0,a=Math.max(e.length,i.length);for(let l=0;l<a;l++)e[l]!==i[l]&&s++;return s}async handleFileSwitch(){let e=this.app.workspace.getActiveFile();if(this.previousActiveFile&&this.previousActiveFile!==e){let i=this.pendingSaves.get(this.previousActiveFile.path);i&&(clearTimeout(i),this.pendingSaves.delete(this.previousActiveFile.path),await this.autoSaveFile(this.previousActiveFile))}this.previousActiveFile=e}async saveCurrentFileOnFocusLost(){let e=this.app.workspace.getActiveFile();if(!e||this.isExcluded(e.path))return;let i=this.pendingSaves.get(e.path);i&&(clearTimeout(i),this.pendingSaves.delete(e.path)),await this.autoSaveFile(e)}updateStatusBarWithLastSave(){let e=this.app.workspace.getActiveFile();if(!e)return;let i=this.lastModifiedTime.get(e.path);if(i){let s=Date.now()-i,a=Math.floor(s/1e3);if(a<60)this.statusBarItem.title=`\u6700\u8FD1\u4FDD\u5B58: ${a}\u79D2\u524D`;else{let l=Math.floor(a/60);this.statusBarItem.title=`\u6700\u8FD1\u4FDD\u5B58: ${l}\u5206\u949F\u524D`}}}async autoSaveCurrentFile(){let e=this.app.workspace.getActiveFile();!e||this.isExcluded(e.path)||await this.autoSaveFile(e)}isExcluded(e){return this.settings.excludedFolders.some(i=>e.startsWith(i))}async createManualVersion(){let e=this.app.workspace.getActiveFile();if(!e){new g.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}new $t(this.app,this.settings,async(i,s)=>{await this.createVersion(e,i,!0,s),this.settings.showNotifications&&new g.Notice("\u2705 \u7248\u672C\u5DF2\u521B\u5EFA")}).open()}async createVersion(e,i,s=!1,a=[]){try{let l=await this.app.vault.read(e),c=Date.now(),f=`${c}`,r=this.hashContent(l),o=await this.loadVersionFile(e.path);if(this.settings.enableDeduplication&&o.versions.find(h=>h.hash===r)){s&&this.settings.showNotifications&&new g.Notice("\u2139\uFE0F \u5185\u5BB9\u672A\u53D8\u5316,\u8DF3\u8FC7\u521B\u5EFA\u7248\u672C");return}let d;if(this.settings.enableIncrementalStorage&&o.versions.length>0)if(o.versions.length%this.settings.rebuildBaseInterval===0)d={id:f,timestamp:c,message:i,content:l,size:l.length,hash:r,tags:a.length>0?a:void 0,starred:!1},o.baseVersion=l;else{let h=o.baseVersion||o.versions[0].content||"",p=this.createDiff(h,l);d={id:f,timestamp:c,message:i,diff:p,baseVersionId:o.versions[0].id,size:p.length,hash:r,tags:a.length>0?a:void 0,starred:!1}}else d={id:f,timestamp:c,message:i,content:l,size:l.length,hash:r,tags:a.length>0?a:void 0,starred:!1},this.settings.enableIncrementalStorage&&(o.baseVersion=l);o.versions.unshift(d),o.lastModified=c,this.settings.autoClear&&this.cleanupVersionsInMemory(o),this.buildVersionIndex(o),await this.saveVersionFile(e.path,o),this.versionCache.set(e.path,o),this.refreshVersionHistoryView(),s&&this.settings.showNotifications&&new g.Notice(`\u2705 \u7248\u672C\u5DF2\u521B\u5EFA: ${i}`)}catch(l){console.error("\u521B\u5EFA\u7248\u672C\u5931\u8D25:",l),new g.Notice("\u274C \u521B\u5EFA\u7248\u672C\u5931\u8D25,\u8BF7\u67E5\u770B\u63A7\u5236\u53F0")}}createDiff(e,i){let s=X(e,i);return JSON.stringify(s)}applyDiff(e,i){try{let s=JSON.parse(i),a="";for(let l of s)l.removed||(a+=l.value);return a}catch(s){return console.error("\u5E94\u7528\u5DEE\u5F02\u5931\u8D25:",s),e}}buildVersionIndex(e){let i=new Map;e.versions.forEach((s,a)=>{i.set(s.id,a)}),e.versionIndex=i}hashContent(e){let i=0;for(let s=0;s<e.length;s++){let a=e.charCodeAt(s);i=(i<<5)-i+a,i=i&i}return i.toString(36)}cleanupVersionsInMemory(e){let i=e.versions,s=i.filter(c=>c.starred),a=i.filter(c=>!c.starred);if(this.settings.enableMaxVersions){let c=Math.max(this.settings.maxVersions-s.length,10);a=a.slice(0,c)}if(this.settings.enableMaxDays){let c=Date.now()-this.settings.maxDays*24*60*60*1e3;a=a.filter(f=>f.timestamp>=c)}i=[...s,...a].sort((c,f)=>f.timestamp-c.timestamp);let l=e.versions.length-i.length;return e.versions=i,l}async loadVersionFile(e){if(this.versionCache.has(e))return this.versionCache.get(e);let i=this.getVersionFilePath(e),s=this.app.vault.adapter;try{if(await s.exists(i)){let l;if(this.settings.enableCompression)try{let f=await s.readBinary(i);l=zt(new Uint8Array(f),{to:"string"})}catch(f){l=await s.read(i)}else l=await s.read(i);let c=JSON.parse(l);return c.versionIndex||this.buildVersionIndex(c),this.versionCache.set(e,c),c}}catch(l){console.error("\u52A0\u8F7D\u7248\u672C\u6587\u4EF6\u5931\u8D25:",l)}let a={filePath:e,versions:[],lastModified:Date.now()};return this.versionCache.set(e,a),a}async saveVersionFile(e,i){let s=this.getVersionFilePath(e),a=this.app.vault.adapter;try{let l={...i,versionIndex:void 0},c=JSON.stringify(l,null,2);if(this.settings.enableCompression){let f=ln(c);await a.writeBinary(s,f.buffer)}else await a.write(s,c)}catch(l){throw console.error("\u4FDD\u5B58\u7248\u672C\u6587\u4EF6\u5931\u8D25:",l),l}}getVersionFilePath(e){let i=this.sanitizeFileName(e);return`${this.settings.versionFolder}/${i}.json`}async getVersions(e,i=0){try{let s=await this.loadVersionFile(e);if(this.settings.versionsPerPage>0){let a=i*this.settings.versionsPerPage,l=a+this.settings.versionsPerPage;return s.versions.slice(a,l)}return s.versions}catch(s){return console.error("\u83B7\u53D6\u7248\u672C\u5217\u8868\u5931\u8D25:",s),[]}}async getAllVersions(e){try{return(await this.loadVersionFile(e)).versions}catch(i){return console.error("\u83B7\u53D6\u7248\u672C\u5217\u8868\u5931\u8D25:",i),[]}}async getVersionContent(e,i){var s;try{let a=await this.loadVersionFile(e),l=(s=a.versionIndex)==null?void 0:s.get(i),c=l!==void 0?a.versions[l]:a.versions.find(f=>f.id===i);if(!c)throw new Error("\u7248\u672C\u4E0D\u5B58\u5728");if(c.content)return c.content;if(c.diff&&a.baseVersion)return this.applyDiff(a.baseVersion,c.diff);throw new Error("\u65E0\u6CD5\u83B7\u53D6\u7248\u672C\u5185\u5BB9")}catch(a){throw console.error("\u8BFB\u53D6\u7248\u672C\u5185\u5BB9\u5931\u8D25:",a),new Error("\u65E0\u6CD5\u8BFB\u53D6\u7248\u672C\u5185\u5BB9")}}async updateVersionTags(e,i,s){var a;try{let l=await this.loadVersionFile(e),c=(a=l.versionIndex)==null?void 0:a.get(i);c!==void 0&&(l.versions[c].tags=s.length>0?s:void 0,await this.saveVersionFile(e,l),this.versionCache.set(e,l),this.refreshVersionHistoryView())}catch(l){console.error("\u66F4\u65B0\u7248\u672C\u6807\u7B7E\u5931\u8D25:",l)}}async updateVersionNote(e,i,s){var a;try{let l=await this.loadVersionFile(e),c=(a=l.versionIndex)==null?void 0:a.get(i);c!==void 0&&(l.versions[c].note=s.trim()||void 0,await this.saveVersionFile(e,l),this.versionCache.set(e,l),this.refreshVersionHistoryView())}catch(l){console.error("\u66F4\u65B0\u7248\u672C\u5907\u6CE8\u5931\u8D25:",l)}}async toggleVersionStar(e,i){var s;try{let a=await this.loadVersionFile(e),l=(s=a.versionIndex)==null?void 0:s.get(i);l!==void 0&&(a.versions[l].starred=!a.versions[l].starred,await this.saveVersionFile(e,a),this.versionCache.set(e,a),this.refreshVersionHistoryView())}catch(a){console.error("\u5207\u6362\u661F\u6807\u5931\u8D25:",a)}}async starLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new g.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new g.Notice("\u6CA1\u6709\u53EF\u6807\u8BB0\u7684\u7248\u672C");return}await this.toggleVersionStar(e.path,i[0].id),new g.Notice("\u2B50 \u5DF2\u6807\u8BB0/\u53D6\u6D88\u6807\u8BB0")}async quickPreviewLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new g.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new g.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u9884\u89C8");return}new et(this.app,this,e,i[0].id).open()}async deleteVersion(e,i){try{let s=await this.loadVersionFile(e);s.versions=s.versions.filter(a=>a.id!==i),s.lastModified=Date.now(),this.buildVersionIndex(s),await this.saveVersionFile(e,s),this.versionCache.set(e,s)}catch(s){console.error("\u5220\u9664\u7248\u672C\u5931\u8D25:",s)}}async deleteVersions(e,i){try{let s=await this.loadVersionFile(e),a=new Set(i);s.versions=s.versions.filter(l=>!a.has(l.id)),s.lastModified=Date.now(),this.buildVersionIndex(s),await this.saveVersionFile(e,s),this.versionCache.set(e,s)}catch(s){console.error("\u6279\u91CF\u5220\u9664\u7248\u672C\u5931\u8D25:",s)}}async restoreVersion(e,i){try{await this.createVersion(e,"[Before Restore]",!1);let s=await this.getVersionContent(e.path,i);await this.app.vault.modify(e,s),this.settings.showNotifications&&new g.Notice("\u2705 \u7248\u672C\u5DF2\u6062\u590D"),this.refreshVersionHistoryView()}catch(s){console.error("\u6062\u590D\u7248\u672C\u5931\u8D25:",s),new g.Notice("\u274C \u6062\u590D\u7248\u672C\u5931\u8D25")}}async restoreLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new g.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new g.Notice("\u6CA1\u6709\u53EF\u6062\u590D\u7684\u7248\u672C");return}let s=i[0];new se(this.app,"\u6062\u590D\u5230\u4E0A\u4E00\u7248\u672C",`\u786E\u5B9A\u8981\u6062\u590D\u5230\u7248\u672C: ${this.formatTime(s.timestamp)}?

\u5F53\u524D\u672A\u4FDD\u5B58\u7684\u4FEE\u6539\u5C06\u4F1A\u4E22\u5931,\u63D2\u4EF6\u4F1A\u5728\u6062\u590D\u524D\u81EA\u52A8\u521B\u5EFA\u5907\u4EFD\u7248\u672C\u3002`,async()=>{await this.restoreVersion(e,s.id)}).open()}async quickCompare(){let e=this.app.workspace.getActiveFile();if(!e){new g.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new g.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u5BF9\u6BD4");return}let s=i[0];new ae(this.app,this,e,s.id).open()}async createFullSnapshot(){let e=this.app.vault.getMarkdownFiles(),i=0,s=0,a=new g.Notice("\u6B63\u5728\u521B\u5EFA\u5168\u5E93\u7248\u672C...",0);for(let l of e){if(this.isExcluded(l.path)){s++;continue}try{await this.createVersion(l,"[Full Snapshot]",!1),i++}catch(c){console.error(`\u521B\u5EFA\u7248\u672C\u5931\u8D25: ${l.path}`,c)}}a.hide(),this.settings.showNotifications&&new g.Notice(`\u2705 \u5168\u5E93\u7248\u672C\u5DF2\u521B\u5EFA
\u6210\u529F: ${i} \u4E2A\u6587\u4EF6${s>0?`
\u8DF3\u8FC7: ${s} \u4E2A\u6587\u4EF6`:""}`)}async optimizeAllVersionFiles(){var i,s;let e=new g.Notice("\u6B63\u5728\u4F18\u5316\u5B58\u50A8...",0);try{let a=this.app.vault.adapter,l=this.settings.versionFolder;if(!await a.exists(l)){e.hide(),new g.Notice("\u7248\u672C\u6587\u4EF6\u5939\u4E0D\u5B58\u5728");return}let c=await a.list(l),f=0,r=0;for(let o of c.files)if(o.endsWith(".json"))try{let d=((i=await a.stat(o))==null?void 0:i.size)||0,u=await a.read(o),h=JSON.parse(u);this.buildVersionIndex(h),await this.saveVersionFile(h.filePath,h);let p=((s=await a.stat(o))==null?void 0:s.size)||0;r+=d-p,f++}catch(d){console.error("\u4F18\u5316\u6587\u4EF6\u5931\u8D25:",o,d)}e.hide(),new g.Notice(`\u2705 \u4F18\u5316\u5B8C\u6210
\u5904\u7406: ${f} \u4E2A\u6587\u4EF6
\u8282\u7701: ${this.formatFileSize(r)}`)}catch(a){e.hide(),console.error("\u4F18\u5316\u5931\u8D25:",a),new g.Notice("\u274C \u4F18\u5316\u5931\u8D25")}}async getStorageStats(){let e=this.app.vault.adapter,i=this.settings.versionFolder;try{if(!await e.exists(i))return{totalSize:0,versionCount:0,fileCount:0,compressionRatio:0,starredCount:0,taggedCount:0};let s=await e.list(i),a=0,l=0,c=0,f=0,r=0,o=0;for(let u of s.files)if(u.endsWith(".json"))try{let h=await e.stat(u),p=(h==null?void 0:h.size)||0;a+=p;let E;if(this.settings.enableCompression)try{let m=await e.readBinary(u),w=zt(new Uint8Array(m),{to:"string"});E=JSON.parse(w)}catch(m){let w=await e.read(u);E=JSON.parse(w)}else{let m=await e.read(u);E=JSON.parse(m)}E.versions&&Array.isArray(E.versions)&&(l+=E.versions.length,E.versions.forEach(m=>{m.content?f+=m.content.length:m.diff&&(f+=m.diff.length),m.starred&&r++,m.tags&&m.tags.length>0&&o++}),c++)}catch(h){console.error("\u8BFB\u53D6\u7248\u672C\u6587\u4EF6\u5931\u8D25:",u,h)}let d=f>0?(1-a/f)*100:0;return{totalSize:a,versionCount:l,fileCount:c,compressionRatio:d,starredCount:r,taggedCount:o}}catch(s){return console.error("\u83B7\u53D6\u5B58\u50A8\u7EDF\u8BA1\u5931\u8D25:",s),{totalSize:0,versionCount:0,fileCount:0,compressionRatio:0,starredCount:0,taggedCount:0}}}async exportVersions(e){try{let i=await this.loadVersionFile(e),s=`${this.settings.versionFolder}/export_${Date.now()}.json`;await this.app.vault.adapter.write(s,JSON.stringify(i,null,2)),new g.Notice(`\u2705 \u7248\u672C\u5DF2\u5BFC\u51FA\u5230: ${s}`)}catch(i){console.error("\u5BFC\u51FA\u7248\u672C\u5931\u8D25:",i),new g.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}async exportVersionAsFile(e,i){try{let s=await this.getVersionContent(e,i),l=`${e.replace(/\.[^/.]+$/,"")}_v${i}.md`;await this.app.vault.create(l,s),new g.Notice(`\u2705 \u7248\u672C\u5DF2\u5BFC\u51FA\u4E3A: ${l}`)}catch(s){console.error("\u5BFC\u51FA\u7248\u672C\u4E3A\u6587\u4EF6\u5931\u8D25:",s),new g.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}sanitizeFileName(e){return e.replace(/[\/\\:*?"<>|]/g,"_")}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`}formatTime(e){return this.settings.useRelativeTime?this.getRelativeTime(e):new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}getRelativeTime(e){let i=Date.now()-e,s=Math.floor(i/1e3),a=Math.floor(s/60),l=Math.floor(a/60),c=Math.floor(l/24),f=Math.floor(c/30),r=Math.floor(c/365);return r>0?`${r} \u5E74\u524D`:f>0?`${f} \u4E2A\u6708\u524D`:c>0?`${c} \u5929\u524D`:l>0?`${l} \u5C0F\u65F6\u524D`:a>0?`${a} \u5206\u949F\u524D`:`${s} \u79D2\u524D`}refreshVersionHistoryView(){this.app.workspace.getLeavesOfType("version-history").forEach(i=>{i.view instanceof tt&&i.view.refresh()})}},et=class extends g.Modal{constructor(e,i,s,a){super(e);this.plugin=i,this.file=s,this.versionId=a}async onOpen(){let{contentEl:e}=this;e.addClass("quick-preview-modal");try{let i=await this.plugin.getVersionContent(this.file.path,this.versionId),a=(await this.plugin.getAllVersions(this.file.path)).find(b=>b.id===this.versionId),l=e.createEl("div",{cls:"preview-header"});if(l.createEl("h2",{text:"\u{1F4C4} \u5FEB\u901F\u9884\u89C8"}),a){let b=l.createEl("div",{cls:"preview-info"});b.createEl("span",{text:`\u23F0 ${this.plugin.formatTime(a.timestamp)}`,cls:"preview-time"}),b.createEl("span",{text:`\u{1F4AC} ${a.message}`,cls:"preview-message"}),b.createEl("span",{text:`\u{1F4E6} ${this.plugin.formatFileSize(a.size)}`,cls:"preview-size"})}let c=e.createEl("div",{cls:"preview-toolbar"});c.createEl("button",{text:"\u{1F4CB} \u590D\u5236\u5185\u5BB9",cls:"mod-cta"}).addEventListener("click",()=>{navigator.clipboard.writeText(i).then(()=>{new g.Notice("\u2705 \u5185\u5BB9\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(()=>{new g.Notice("\u274C \u590D\u5236\u5931\u8D25")})}),c.createEl("button",{text:"\u21A9\uFE0F \u6062\u590D\u6B64\u7248\u672C"}).addEventListener("click",async()=>{this.close(),await this.plugin.restoreVersion(this.file,this.versionId)}),c.createEl("button",{text:"\u{1F500} \u8BE6\u7EC6\u5BF9\u6BD4"}).addEventListener("click",()=>{this.close(),new ae(this.app,this.plugin,this.file,this.versionId).open()}),c.createEl("button",{text:"\u{1F4BE} \u5BFC\u51FA\u6587\u4EF6"}).addEventListener("click",async()=>{await this.plugin.exportVersionAsFile(this.file.path,this.versionId)});let u=e.createEl("div",{cls:"preview-content"}),h=i.split(`
`),p=u.createEl("div",{cls:"preview-line-numbers"});h.forEach((b,y)=>{p.createEl("div",{text:String(y+1),cls:"line-number"})}),u.createEl("pre").createEl("code",{text:i});let m=e.createEl("div",{cls:"preview-stats-bar"});m.createEl("span",{text:`\u{1F4DD} ${h.length} \u884C`}),m.createEl("span",{text:`\u{1F524} ${i.length} \u5B57\u7B26`});let w=i.split(/\s+/).filter(b=>b.length>0).length;m.createEl("span",{text:`\u{1F4C4} ${w} \u8BCD`})}catch(i){e.createEl("p",{text:"\u274C \u52A0\u8F7D\u9884\u89C8\u5931\u8D25"}),console.error("\u9884\u89C8\u52A0\u8F7D\u5931\u8D25:",i)}}onClose(){let{contentEl:e}=this;e.empty()}},tt=class extends g.ItemView{constructor(e,i){super(e);this.selectedVersions=new Set;this.currentFile=null;this.searchQuery="";this.currentPage=0;this.totalVersions=0;this.filterTag=null;this.showStarredOnly=!1;this.plugin=i}getViewType(){return"version-history"}getDisplayText(){return"\u7248\u672C\u5386\u53F2"}getIcon(){return"history"}async onOpen(){this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.currentPage=0,this.refresh()})),await this.refresh()}async refresh(){let e=this.containerEl.children[1];e.empty(),e.addClass("version-history-view");let i=this.app.workspace.getActiveFile();if(this.currentFile=i,!i){this.renderEmptyState(e,"\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6");return}let s=e.createEl("div",{cls:"version-header"}),a=s.createEl("div",{cls:"version-title"});a.createEl("h3",{text:i.basename}),a.createEl("span",{text:i.path,cls:"version-file-path"});let l=s.createEl("div",{cls:"version-file-stats"});try{let _=await this.app.vault.read(i),S=await this.app.vault.adapter.stat(i.path);l.createEl("span",{text:`\u{1F4C4} \u5927\u5C0F: ${this.plugin.formatFileSize(_.length)}`,cls:"file-stat-item"}),S&&l.createEl("span",{text:`\u{1F4C5} \u4FEE\u6539: ${new Date(S.mtime).toLocaleString("zh-CN")}`,cls:"file-stat-item"})}catch(_){console.error("\u83B7\u53D6\u6587\u4EF6\u4FE1\u606F\u5931\u8D25:",_)}let c=s.createEl("div",{cls:"version-header-actions"}),f=c.createEl("input",{type:"text",placeholder:"\u641C\u7D22\u7248\u672C...",cls:"version-search"});f.value=this.searchQuery,f.addEventListener("input",_=>{this.searchQuery=_.target.value,this.currentPage=0,this.refresh()}),c.createEl("button",{text:this.showStarredOnly?"\u2B50 \u5DF2\u7B5B\u9009":"\u2B50",cls:this.showStarredOnly?"mod-cta":"",attr:{title:"\u4EC5\u663E\u793A\u661F\u6807\u7248\u672C"}}).addEventListener("click",()=>{this.showStarredOnly=!this.showStarredOnly,this.currentPage=0,this.refresh()}),c.createEl("button",{text:"+ \u521B\u5EFA",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),c.createEl("button",{text:"\u22EE",attr:{title:"\u66F4\u591A\u64CD\u4F5C"}}).addEventListener("click",_=>{let S=new g.Menu;S.addItem(x=>x.setTitle("\u{1F4CA} \u67E5\u770B\u7EDF\u8BA1").setIcon("bar-chart").onClick(()=>{this.showDetailedStats()})),S.addItem(x=>x.setTitle("\u{1F4E5} \u5BFC\u51FA\u7248\u672C\u6570\u636E").setIcon("download").onClick(()=>{this.plugin.exportVersions(i.path)})),S.addItem(x=>x.setTitle("\u{1F4C2} \u521B\u5EFA\u5168\u5E93\u7248\u672C").setIcon("folder").onClick(()=>{this.plugin.createFullSnapshot()})),S.addItem(x=>x.setTitle("\u{1F5D1}\uFE0F \u6E05\u7406\u65E7\u7248\u672C").setIcon("trash").onClick(async()=>{await this.cleanupOldVersions(i)})),S.showAtMouseEvent(_)});let u=await this.plugin.getAllVersions(i.path);if(this.totalVersions=u.length,this.totalVersions===0){this.renderEmptyState(e,"\u6682\u65E0\u7248\u672C\u5386\u53F2");return}if(u.length>0)try{let _=await this.app.vault.read(i),S=u[0],x=await this.plugin.getVersionContent(i.path,S.id);if(_!==x){let T=X(x,_),D=T.filter(z=>z.added).length,C=T.filter(z=>z.removed).length,k=e.createEl("div",{cls:"version-diff-banner"});k.createEl("span",{text:"\u26A0\uFE0F \u6587\u4EF6\u5DF2\u4FEE\u6539"}),k.createEl("span",{text:`+${D} -${C}`,cls:"diff-stats"}),k.createEl("button",{text:"\u{1F4BE} \u7ACB\u5373\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),k.createEl("button",{text:"\u{1F441}\uFE0F \u67E5\u770B\u5DEE\u5F02"}).addEventListener("click",()=>{new ae(this.app,this.plugin,i,S.id).open()})}}catch(_){console.error("\u68C0\u67E5\u6587\u4EF6\u5DEE\u5F02\u5931\u8D25:",_)}let h=u;if(this.showStarredOnly&&(h=h.filter(_=>_.starred)),this.filterTag&&(h=h.filter(_=>_.tags&&_.tags.includes(this.filterTag))),this.searchQuery&&(h=h.filter(_=>_.message.toLowerCase().includes(this.searchQuery.toLowerCase())||this.plugin.formatTime(_.timestamp).toLowerCase().includes(this.searchQuery.toLowerCase())||_.tags&&_.tags.some(S=>S.toLowerCase().includes(this.searchQuery.toLowerCase())))),h.length===0){this.renderEmptyState(e,"\u672A\u627E\u5230\u5339\u914D\u7684\u7248\u672C");return}let p=this.plugin.settings.versionsPerPage||h.length,E=Math.ceil(h.length/p),m=this.currentPage*p,w=Math.min(m+p,h.length),b=h.slice(m,w);if(this.selectedVersions.size>0){let _=e.createEl("div",{cls:"version-toolbar"});_.createEl("span",{text:`\u5DF2\u9009\u62E9 ${this.selectedVersions.size} \u4E2A\u7248\u672C`}),_.createEl("button",{text:"\u6E05\u7A7A\u9009\u62E9"}).addEventListener("click",()=>{this.selectedVersions.clear(),this.refresh()}),_.createEl("button",{text:"\u6279\u91CF\u5220\u9664",cls:"mod-warning"}).addEventListener("click",()=>this.batchDelete(i))}let y=e.createEl("div",{cls:"version-list"});for(let _ of b){let S=y.createEl("div",{cls:"version-item"});_.starred&&S.addClass("version-starred");let x=S.createEl("input",{type:"checkbox",cls:"version-checkbox"});x.checked=this.selectedVersions.has(_.id),x.addEventListener("change",()=>{x.checked?this.selectedVersions.add(_.id):this.selectedVersions.delete(_.id),this.refresh()});let T=S.createEl("div",{cls:"version-info"}),D=T.createEl("div",{cls:"version-time-row"});D.createEl("span",{text:_.starred?"\u2B50":"\u2606",cls:"version-star-btn"}).addEventListener("click",async()=>{await this.plugin.toggleVersionStar(i.path,_.id)}),D.createEl("span",{text:this.plugin.formatTime(_.timestamp),cls:"version-time"});let k=T.createEl("div",{cls:"version-message-row"});_.message.includes("[Auto Save]")?k.createEl("span",{text:"\u81EA\u52A8\u4FDD\u5B58",cls:"version-tag version-tag-auto"}):_.message.includes("[Full Snapshot]")?k.createEl("span",{text:"\u5168\u5E93\u7248\u672C",cls:"version-tag version-tag-snapshot"}):_.message.includes("[Before Restore]")&&k.createEl("span",{text:"\u6062\u590D\u524D\u5907\u4EFD",cls:"version-tag version-tag-backup"}),_.diff?k.createEl("span",{text:"\u589E\u91CF",cls:"version-tag version-tag-incremental"}):_.content&&k.createEl("span",{text:"\u5B8C\u6574",cls:"version-tag version-tag-full"}),_.tags&&_.tags.length>0&&_.tags.forEach(Z=>{k.createEl("span",{text:Z,cls:"version-tag version-tag-custom"}).addEventListener("click",()=>{this.filterTag=Z,this.currentPage=0,this.refresh()})}),k.createEl("span",{text:_.message.replace(/\[.*?\]/g,"").trim()||"\u65E0\u63CF\u8FF0",cls:"version-message"}),_.note&&T.createEl("div",{text:`\u{1F4DD} ${_.note}`,cls:"version-note"}),T.createEl("div",{text:this.plugin.formatFileSize(_.size),cls:"version-size"});let F=S.createEl("div",{cls:"version-actions"});this.plugin.settings.enableQuickPreview&&F.createEl("button",{text:"\u{1F441}",cls:"version-btn",attr:{title:"\u5FEB\u901F\u9884\u89C8"}}).addEventListener("click",()=>{new et(this.app,this.plugin,i,_.id).open()}),F.createEl("button",{text:"\u6062\u590D",cls:"version-btn"}).addEventListener("click",()=>{this.confirmRestore(i,_.id)}),F.createEl("button",{text:"\u6BD4\u8F83",cls:"version-btn"}).addEventListener("click",()=>{this.showDiffModal(i,_.id)}),F.createEl("button",{text:"\u22EE",cls:"version-btn"}).addEventListener("click",Z=>{this.showVersionContextMenu(Z,i,_)})}if(E>1){let _=e.createEl("div",{cls:"version-pagination"}),S=_.createEl("button",{text:"\u2190 \u4E0A\u4E00\u9875",cls:"version-pagination-btn"});S.disabled=this.currentPage===0,S.addEventListener("click",()=>{this.currentPage>0&&(this.currentPage--,this.refresh())}),_.createEl("span",{text:`\u7B2C ${this.currentPage+1} / ${E} \u9875`,cls:"version-pagination-info"});let x=_.createEl("button",{text:"\u4E0B\u4E00\u9875 \u2192",cls:"version-pagination-btn"});x.disabled=this.currentPage>=E-1,x.addEventListener("click",()=>{this.currentPage<E-1&&(this.currentPage++,this.refresh())})}let v=e.createEl("div",{cls:"version-footer"});v.createEl("span",{text:`\u5171 ${this.totalVersions} \u4E2A\u7248\u672C`}),(this.searchQuery||this.showStarredOnly||this.filterTag)&&v.createEl("span",{text:` \xB7 \u663E\u793A ${h.length} \u4E2A\u7ED3\u679C`}),v.createEl("span",{text:` \xB7 \u663E\u793A ${m+1}-${w}`})}showVersionContextMenu(e,i,s){let a=new g.Menu;a.addItem(l=>l.setTitle("\u4E0E\u5F53\u524D\u6587\u4EF6\u5BF9\u6BD4").setIcon("file-diff").onClick(()=>{this.showDiffModal(i,s.id)})),a.addItem(l=>l.setTitle("\u9009\u62E9\u53E6\u4E00\u4E2A\u7248\u672C\u5BF9\u6BD4").setIcon("files").onClick(()=>{this.selectVersionForCompare(i,s.id)})),a.addSeparator(),a.addItem(l=>l.setTitle(s.starred?"\u53D6\u6D88\u661F\u6807":"\u6DFB\u52A0\u661F\u6807").setIcon("star").onClick(async()=>{await this.plugin.toggleVersionStar(i.path,s.id)})),this.plugin.settings.enableVersionTags&&a.addItem(l=>l.setTitle("\u7F16\u8F91\u6807\u7B7E").setIcon("tag").onClick(()=>{new Nt(this.app,this.plugin,i.path,s.id,s.tags||[]).open()})),a.addItem(l=>l.setTitle("\u6DFB\u52A0/\u7F16\u8F91\u5907\u6CE8").setIcon("edit").onClick(()=>{new Bt(this.app,this.plugin,i.path,s.id,s.note||"").open()})),a.addSeparator(),a.addItem(l=>l.setTitle("\u5BFC\u51FA\u4E3A\u6587\u4EF6").setIcon("download").onClick(async()=>{await this.plugin.exportVersionAsFile(i.path,s.id)})),a.addItem(l=>l.setTitle("\u5220\u9664\u7248\u672C").setIcon("trash").onClick(async()=>{new se(this.app,"\u786E\u8BA4\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u6B64\u7248\u672C\u5417?

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500!`,async()=>{await this.plugin.deleteVersion(i.path,s.id),this.plugin.settings.showNotifications&&new g.Notice("\u2705 \u7248\u672C\u5DF2\u5220\u9664"),this.refresh()}).open()})),a.showAtMouseEvent(e)}async showDetailedStats(){let e=this.currentFile;if(!e)return;let i=await this.plugin.getAllVersions(e.path),s=i.filter(o=>o.starred).length,a=i.filter(o=>o.tags&&o.tags.length>0).length,l=i.reduce((o,d)=>o+d.size,0),c=i.filter(o=>o.message.includes("[Auto Save]")).length,f=i.length-c,r="";if(i.length>0){let o=i[i.length-1].timestamp,d=i[0].timestamp,u=Math.floor((d-o)/(1e3*60*60*24));r=u>0?`${u} \u5929`:"\u4E0D\u8DB31\u5929"}new g.Notice(`\u{1F4CA} ${e.basename} \u7EDF\u8BA1

\u603B\u7248\u672C\u6570: ${i.length}
\u2B50 \u661F\u6807: ${s}
\u{1F3F7}\uFE0F \u5DF2\u6807\u7B7E: ${a}
\u{1F916} \u81EA\u52A8: ${c}
\u270B \u624B\u52A8: ${f}
\u{1F4E6} \u603B\u5927\u5C0F: ${this.plugin.formatFileSize(l)}
\u{1F4C5} \u65F6\u95F4\u8DE8\u5EA6: ${r}`,8e3)}async cleanupOldVersions(e){new se(this.app,"\u6E05\u7406\u65E7\u7248\u672C",`\u6839\u636E\u8BBE\u7F6E\u7684\u6E05\u7406\u89C4\u5219\u5220\u9664\u65E7\u7248\u672C

\u662F\u5426\u7EE7\u7EED?`,async()=>{let i=await this.plugin.loadVersionFile(e.path),s=i.versions.length,a=this.plugin.cleanupVersionsInMemory(i);a>0?(await this.plugin.saveVersionFile(e.path,i),this.plugin.versionCache.set(e.path,i),new g.Notice(`\u2705 \u5DF2\u6E05\u7406 ${a} \u4E2A\u65E7\u7248\u672C`),this.refresh()):new g.Notice("\u2139\uFE0F \u6CA1\u6709\u9700\u8981\u6E05\u7406\u7684\u7248\u672C")}).open()}renderEmptyState(e,i){let s=e.createEl("div",{cls:"version-history-empty"});s.createEl("div",{text:"\u{1F4CB}",cls:"version-empty-icon"}),s.createEl("div",{text:i}),this.currentFile&&i==="\u6682\u65E0\u7248\u672C\u5386\u53F2"&&s.createEl("button",{text:"\u521B\u5EFA\u7B2C\u4E00\u4E2A\u7248\u672C",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),(this.filterTag||this.showStarredOnly)&&s.createEl("button",{text:"\u6E05\u9664\u7B5B\u9009",cls:"mod-cta"}).addEventListener("click",()=>{this.filterTag=null,this.showStarredOnly=!1,this.currentPage=0,this.refresh()})}confirmRestore(e,i){new se(this.app,"\u786E\u8BA4\u6062\u590D\u7248\u672C",`\u5F53\u524D\u672A\u4FDD\u5B58\u7684\u4FEE\u6539\u5C06\u4F1A\u4E22\u5931,\u63D2\u4EF6\u4F1A\u5728\u6062\u590D\u524D\u81EA\u52A8\u521B\u5EFA\u5907\u4EFD\u7248\u672C\u3002

\u662F\u5426\u7EE7\u7EED?`,async()=>{await this.plugin.restoreVersion(e,i)}).open()}async batchDelete(e){new se(this.app,"\u786E\u8BA4\u6279\u91CF\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684 ${this.selectedVersions.size} \u4E2A\u7248\u672C\u5417?

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500!`,async()=>{let i=Array.from(this.selectedVersions);await this.plugin.deleteVersions(e.path,i),this.selectedVersions.clear(),this.plugin.settings.showNotifications&&new g.Notice("\u2705 \u5DF2\u5220\u9664\u9009\u4E2D\u7248\u672C"),this.refresh()}).open()}showDiffModal(e,i){new ae(this.app,this.plugin,e,i).open()}selectVersionForCompare(e,i){new Mt(this.app,this.plugin,e,i,s=>{new ae(this.app,this.plugin,e,i,s).open()}).open()}},Nt=class extends g.Modal{constructor(e,i,s,a,l){super(e);this.selectedTags=new Set;this.plugin=i,this.filePath=s,this.versionId=a,this.currentTags=l,this.selectedTags=new Set(l)}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"\u7F16\u8F91\u7248\u672C\u6807\u7B7E"});let i=e.createEl("div",{cls:"tag-edit-container"}),s=i.createEl("div",{cls:"tag-section"});s.createEl("h3",{text:"\u5E38\u7528\u6807\u7B7E"});let a=s.createEl("div",{cls:"tag-list"});this.plugin.settings.defaultTags.forEach(E=>{let m=a.createEl("span",{text:E,cls:this.selectedTags.has(E)?"tag-item tag-selected":"tag-item"});m.addEventListener("click",()=>{this.selectedTags.has(E)?(this.selectedTags.delete(E),m.removeClass("tag-selected")):(this.selectedTags.add(E),m.addClass("tag-selected"))})});let l=i.createEl("div",{cls:"tag-section"});l.createEl("h3",{text:"\u81EA\u5B9A\u4E49\u6807\u7B7E"});let c=l.createEl("div",{cls:"tag-input-container"}),f=c.createEl("input",{type:"text",placeholder:"\u8F93\u5165\u65B0\u6807\u7B7E..."});f.style.width="100%";let r=c.createEl("button",{text:"\u6DFB\u52A0",cls:"mod-cta"});r.addEventListener("click",()=>{let E=f.value.trim();E&&!this.selectedTags.has(E)&&(this.selectedTags.add(E),this.renderSelectedTags(d),f.value="")}),f.addEventListener("keydown",E=>{E.key==="Enter"&&r.click()});let o=i.createEl("div",{cls:"tag-section"});o.createEl("h3",{text:"\u5DF2\u9009\u6807\u7B7E"});let d=o.createEl("div",{cls:"tag-list"});this.renderSelectedTags(d);let u=e.createEl("div",{cls:"modal-button-container"});u.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),u.createEl("button",{text:"\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",async()=>{await this.plugin.updateVersionTags(this.filePath,this.versionId,Array.from(this.selectedTags)),new g.Notice("\u2705 \u6807\u7B7E\u5DF2\u66F4\u65B0"),this.close()})}renderSelectedTags(e){e.empty(),this.selectedTags.forEach(i=>{e.createEl("span",{text:i,cls:"tag-item tag-removable"}).createEl("span",{text:"\xD7",cls:"tag-remove"}).addEventListener("click",()=>{this.selectedTags.delete(i),this.renderSelectedTags(e)})})}onClose(){let{contentEl:e}=this;e.empty()}},Bt=class extends g.Modal{constructor(e,i,s,a,l){super(e);this.plugin=i,this.filePath=s,this.versionId=a,this.currentNote=l}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"\u7F16\u8F91\u7248\u672C\u5907\u6CE8"});let i=e.createEl("textarea",{placeholder:"\u4E3A\u6B64\u7248\u672C\u6DFB\u52A0\u8BE6\u7EC6\u5907\u6CE8..."});i.value=this.currentNote,i.style.width="100%",i.style.minHeight="150px";let s=e.createEl("div",{cls:"modal-button-container"});s.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),s.createEl("button",{text:"\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",async()=>{await this.plugin.updateVersionNote(this.filePath,this.versionId,i.value.trim()),new g.Notice("\u2705 \u5907\u6CE8\u5DF2\u66F4\u65B0"),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}},$t=class extends g.Modal{constructor(e,i,s){super(e);this.result="";this.tags=[];this.settings=i,this.onSubmit=s}onOpen(){let{contentEl:e}=this;if(e.createEl("h2",{text:"\u521B\u5EFA\u7248\u672C"}),new g.Setting(e).setName("\u63D0\u4EA4\u4FE1\u606F").setDesc("\u63CF\u8FF0\u6B64\u7248\u672C\u7684\u66F4\u6539\u5185\u5BB9").addText(l=>{this.inputEl=l,l.setPlaceholder("\u4F8B\u5982:\u6DFB\u52A0\u65B0\u7AE0\u8282\u3001\u4FEE\u590D\u9519\u8BEF\u7B49...").onChange(c=>{this.result=c}),l.inputEl.style.width="100%",l.inputEl.focus()}),this.settings.enableVersionTags&&this.settings.defaultTags.length>0){let l=e.createEl("div",{cls:"tag-section"});l.createEl("h3",{text:"\u6DFB\u52A0\u6807\u7B7E (\u53EF\u9009)"});let c=l.createEl("div",{cls:"tag-list"});this.settings.defaultTags.forEach(f=>{let r=c.createEl("span",{text:f,cls:"tag-item"});r.addEventListener("click",()=>{r.hasClass("tag-selected")?(r.removeClass("tag-selected"),this.tags=this.tags.filter(o=>o!==f)):(r.addClass("tag-selected"),this.tags.push(f))})})}let i=e.createEl("div",{cls:"modal-button-container"});i.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),i.createEl("button",{text:"\u521B\u5EFA",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.onSubmit(this.result||"[Manual Save]",this.tags)}),this.inputEl.inputEl.addEventListener("keydown",l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),this.close(),this.onSubmit(this.result||"[Manual Save]",this.tags))})}onClose(){let{contentEl:e}=this;e.empty()}},se=class extends g.Modal{constructor(e,i,s,a){super(e);this.title=i,this.message=s,this.onConfirm=a}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:this.title});let i=e.createEl("p",{cls:"confirm-message"});i.style.whiteSpace="pre-line",i.textContent=this.message;let s=e.createEl("div",{cls:"modal-button-container"});s.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),s.createEl("button",{text:"\u786E\u8BA4",cls:"mod-warning"}).addEventListener("click",()=>{this.close(),this.onConfirm()})}onClose(){let{contentEl:e}=this;e.empty()}},ae=class extends g.Modal{constructor(e,i,s,a,l){super(e);this.currentDiffIndex=0;this.totalDiffs=0;this.diffElements=[];this.showContext=!1;this.contextLines=3;this.collapsedSections=new Set;this.ignoreWhitespace=!1;this.showLineNumbers=!0;this.wrapLines=!1;this.highlightSyntax=!1;this.leftContent="";this.rightContent="";this.plugin=i,this.file=s,this.versionId=a,this.secondVersionId=l}async onOpen(){let{contentEl:e}=this;e.addClass("diff-modal"),e.createEl("h2",{text:"\u{1F4CA} \u7248\u672C\u5DEE\u5F02\u5BF9\u6BD4"});let i=e.createEl("div",{cls:"diff-toolbar"}),s=i.createEl("div",{cls:"diff-nav-group"}),a=s.createEl("button",{text:"\u2B06",attr:{title:"\u4E0A\u4E00\u4E2A\u5DEE\u5F02","aria-label":"\u4E0A\u4E00\u4E2A\u5DEE\u5F02 (\u2191)"}}),l=s.createEl("span",{cls:"diff-stats"}),c=s.createEl("button",{text:"\u2B07",attr:{title:"\u4E0B\u4E00\u4E2A\u5DEE\u5F02","aria-label":"\u4E0B\u4E00\u4E2A\u5DEE\u5F02 (\u2193)"}}),f=s.createEl("button",{text:"\u21C8",attr:{title:"\u7B2C\u4E00\u4E2A\u5DEE\u5F02","aria-label":"\u8DF3\u8F6C\u5230\u7B2C\u4E00\u4E2A\u5DEE\u5F02"}}),r=s.createEl("button",{text:"\u21CA",attr:{title:"\u6700\u540E\u4E00\u4E2A\u5DEE\u5F02","aria-label":"\u8DF3\u8F6C\u5230\u6700\u540E\u4E00\u4E2A\u5DEE\u5F02"}}),o=i.createEl("div",{cls:"diff-view-group"}),d=o.createEl("button",{text:"\u{1F4C4}",cls:"diff-context-toggle",attr:{title:"\u663E\u793A/\u9690\u85CF\u4E0A\u4E0B\u6587","aria-label":"\u4E0A\u4E0B\u6587"}});d.addEventListener("click",()=>{this.showContext=!this.showContext,d.toggleClass("active",this.showContext),F()});let u=o.createEl("input",{type:"number",attr:{min:"1",max:"10",value:String(this.contextLines),title:"\u4E0A\u4E0B\u6587\u884C\u6570","aria-label":"\u4E0A\u4E0B\u6587\u884C\u6570"}});u.style.width="50px",u.addEventListener("change",()=>{let V=parseInt(u.value);!isNaN(V)&&V>0&&V<=10&&(this.contextLines=V,F())});let h=o.createEl("button",{text:"\u{1F522}",cls:this.showLineNumbers?"active":"",attr:{title:"\u663E\u793A/\u9690\u85CF\u884C\u53F7","aria-label":"\u884C\u53F7"}});h.addEventListener("click",()=>{this.showLineNumbers=!this.showLineNumbers,h.toggleClass("active",this.showLineNumbers),F()}),this.wrapLines=!0;let p=o.createEl("button",{text:"\u21A9\uFE0F",cls:"active",attr:{title:"\u81EA\u52A8\u6362\u884C","aria-label":"\u81EA\u52A8\u6362\u884C"}});p.addEventListener("click",()=>{this.wrapLines=!this.wrapLines,p.toggleClass("active",this.wrapLines),F()});let E=o.createEl("button",{text:"\u2423",cls:this.ignoreWhitespace?"active":"",attr:{title:"\u5FFD\u7565\u7A7A\u767D\u5B57\u7B26","aria-label":"\u5FFD\u7565\u7A7A\u767D"}});E.addEventListener("click",()=>{this.ignoreWhitespace=!this.ignoreWhitespace,E.toggleClass("active",this.ignoreWhitespace),F()});let m=o.createEl("select",{cls:"diff-select",attr:{title:"\u89C6\u56FE\u6A21\u5F0F","aria-label":"\u89C6\u56FE\u6A21\u5F0F"}});m.createEl("option",{text:"\u7EDF\u4E00\u89C6\u56FE",value:"unified"}),m.createEl("option",{text:"\u5DE6\u53F3\u5206\u680F",value:"split"}),m.value=this.plugin.settings.diffViewMode;let w=i.createEl("div",{cls:"diff-action-group"});w.createEl("button",{text:"\u5C55\u5F00\u5168\u90E8",attr:{title:"\u5C55\u5F00\u6240\u6709\u6298\u53E0\u533A\u57DF","aria-label":"\u5C55\u5F00\u5168\u90E8"}}).addEventListener("click",()=>{this.collapsedSections.clear(),F()}),w.createEl("button",{text:"\u6298\u53E0\u5168\u90E8",attr:{title:"\u6298\u53E0\u6240\u6709\u672A\u4FEE\u6539\u533A\u57DF","aria-label":"\u6298\u53E0\u5168\u90E8"}}).addEventListener("click",()=>{let V=e.querySelector(".diff-container");V&&(V.querySelectorAll(".diff-collapse-btn").forEach(($,Z)=>{this.collapsedSections.has(Z)||this.collapsedSections.add(Z)}),F())}),w.createEl("button",{text:"\u{1F50D}",attr:{title:"\u641C\u7D22\u5DEE\u5F02\u5185\u5BB9 (Ctrl+F)","aria-label":"\u641C\u7D22"}}).addEventListener("click",()=>{this.showSearchBox()}),w.createEl("button",{text:"\u{1F4C8}",attr:{title:"\u663E\u793A\u8BE6\u7EC6\u7EDF\u8BA1","aria-label":"\u7EDF\u8BA1"}}).addEventListener("click",()=>{this.showDetailedStats()}),w.createEl("button",{text:"\u{1F4CB}",attr:{title:"\u590D\u5236\u5DEE\u5F02","aria-label":"\u590D\u5236"}}).addEventListener("click",()=>{this.copyDiffToClipboard()}),w.createEl("button",{text:"\u{1F4BE}",attr:{title:"\u5BFC\u51FA\u5DEE\u5F02\u62A5\u544A","aria-label":"\u5BFC\u51FA"}}).addEventListener("click",()=>{this.exportDiffReport()});let T,D;try{if(this.secondVersionId){this.leftContent=await this.plugin.getVersionContent(this.file.path,this.versionId),this.rightContent=await this.plugin.getVersionContent(this.file.path,this.secondVersionId);let V=await this.plugin.getAllVersions(this.file.path),z=V.find(Z=>Z.id===this.versionId),$=V.find(Z=>Z.id===this.secondVersionId);T=z?`\u7248\u672C A: ${this.plugin.formatTime(z.timestamp)}`:"\u7248\u672C A",D=$?`\u7248\u672C B: ${this.plugin.formatTime($.timestamp)}`:"\u7248\u672C B"}else{this.leftContent=await this.plugin.getVersionContent(this.file.path,this.versionId),this.rightContent=await this.app.vault.read(this.file);let z=(await this.plugin.getAllVersions(this.file.path)).find($=>$.id===this.versionId);T=z?`\u5386\u53F2\u7248\u672C: ${this.plugin.formatTime(z.timestamp)}`:"\u5386\u53F2\u7248\u672C",D="\u5F53\u524D\u6587\u4EF6"}}catch(V){new g.Notice("\u274C \u52A0\u8F7D\u7248\u672C\u5185\u5BB9\u5931\u8D25"),this.close();return}let C=e.createEl("div",{cls:"diff-info-banner-compact"});this.updateCompactDiffInfo(C);let k=e.createEl("div",{cls:"diff-container"}),F=()=>{k.empty(),this.diffElements=[],this.currentDiffIndex=0,this.totalDiffs=0;let V="line",z=this.leftContent,$=this.rightContent;this.ignoreWhitespace&&(z=this.leftContent.replace(/\s+/g," ").trim(),$=this.rightContent.replace(/\s+/g," ").trim()),m.value==="unified"?this.renderUnifiedDiff(k,z,$,V):this.renderSplitDiff(k,z,$,V,T,D),this.wrapLines?k.addClass("diff-wrap-lines"):k.removeClass("diff-wrap-lines"),this.totalDiffs=this.diffElements.length,this.totalDiffs>0?(l.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`),a.disabled=!1,c.disabled=this.totalDiffs===1,f.disabled=!1,r.disabled=this.totalDiffs===1,setTimeout(()=>this.scrollToDiff(),100)):(l.setText(z===$?"\u2705 \u76F8\u540C":"\u{1F4CA} \u65E0\u5DEE\u5F02"),a.disabled=!0,c.disabled=!0,f.disabled=!0,r.disabled=!0),this.updateCompactDiffInfo(C),this.plugin.refreshVersionHistoryView()};m.addEventListener("change",()=>{this.collapsedSections.clear(),F()}),a.addEventListener("click",()=>{this.currentDiffIndex>0&&(this.currentDiffIndex--,this.scrollToDiff(),l.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`),a.disabled=this.currentDiffIndex===0,c.disabled=!1,f.disabled=this.currentDiffIndex===0)}),c.addEventListener("click",()=>{this.currentDiffIndex<this.totalDiffs-1&&(this.currentDiffIndex++,this.scrollToDiff(),l.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`),a.disabled=!1,c.disabled=this.currentDiffIndex>=this.totalDiffs-1,r.disabled=this.currentDiffIndex>=this.totalDiffs-1)}),f.addEventListener("click",()=>{this.currentDiffIndex>0&&(this.currentDiffIndex=0,this.scrollToDiff(),l.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`),a.disabled=!0,c.disabled=!1,f.disabled=!0,r.disabled=!1)}),r.addEventListener("click",()=>{this.currentDiffIndex<this.totalDiffs-1&&(this.currentDiffIndex=this.totalDiffs-1,this.scrollToDiff(),l.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`),a.disabled=!1,c.disabled=!0,f.disabled=!1,r.disabled=!0)}),this.scope.register([],"ArrowUp",()=>(a.disabled||a.click(),!1)),this.scope.register([],"ArrowDown",()=>(c.disabled||c.click(),!1)),this.scope.register(["Ctrl"],"f",V=>(V.preventDefault(),this.showSearchBox(),!1)),this.scope.register(["Mod"],"f",V=>(V.preventDefault(),this.showSearchBox(),!1)),F()}updateCompactDiffInfo(e){e.empty();let i=X(this.leftContent,this.rightContent),s=0,a=0,l=0;for(let r of i){let o=r.value.split(`
`).length-1;r.added?(s+=o,l+=o):r.removed&&(a+=o,l+=o)}let c=this.leftContent.split(`
`).length,f=c>0?(l/c*100).toFixed(1):"0";e.createEl("span",{text:`\u{1F4CA} \u603B\u884C\u6570: ${c}`,cls:"diff-info-item"}),e.createEl("span",{text:`+${s}`,cls:"diff-info-added"}),e.createEl("span",{text:`-${a}`,cls:"diff-info-removed"}),e.createEl("span",{text:`~${l}`,cls:"diff-info-changed"}),e.createEl("span",{text:`\u53D8\u5316\u7387: ${f}%`,cls:"diff-info-percent"})}showDetailedStats(){let e=X(this.leftContent,this.rightContent),i=0,s=0,a=0,l=0;for(let o of e)o.added?(i+=o.value.split(`
`).length-1,a+=o.value.length):o.removed&&(s+=o.value.split(`
`).length-1,l+=o.value.length);let c=this.leftContent.split(`
`).length,f=this.rightContent.split(`
`).length,r=this.calculateSimilarity(this.leftContent,this.rightContent);new g.Notice(`\u{1F4CA} \u8BE6\u7EC6\u7EDF\u8BA1

\u5DE6\u4FA7\u7248\u672C: ${c} \u884C, ${this.leftContent.length} \u5B57\u7B26
\u53F3\u4FA7\u7248\u672C: ${f} \u884C, ${this.rightContent.length} \u5B57\u7B26

\u65B0\u589E: ${i} \u884C, ${a} \u5B57\u7B26
\u5220\u9664: ${s} \u884C, ${l} \u5B57\u7B26
\u76F8\u4F3C\u5EA6: ${r.toFixed(1)}%
\u5DEE\u5F02\u5757: ${this.totalDiffs} \u4E2A`,1e4)}calculateSimilarity(e,i){let s=e.length,a=i.length,l=Math.max(s,a);if(l===0)return 100;let c=0,f=Math.min(s,a);for(let r=0;r<f;r++)e[r]===i[r]&&c++;return c/l*100}showSearchBox(){let e=this.containerEl.createEl("div",{cls:"diff-search-container"}),i=e.createEl("input",{type:"text",placeholder:"\u641C\u7D22\u5DEE\u5F02\u5185\u5BB9...",cls:"diff-search-input"}),s=e.createEl("span",{cls:"diff-search-results"}),a=e.createEl("button",{text:"\xD7",cls:"diff-search-close"}),l=[],c=0;i.addEventListener("input",()=>{let r=i.value.toLowerCase();if(l.forEach(o=>o.removeClass("diff-search-match")),l=[],c=0,r.length<2){s.setText("");return}this.diffElements.forEach(o=>{var u;(((u=o.textContent)==null?void 0:u.toLowerCase())||"").includes(r)&&(o.addClass("diff-search-match"),l.push(o))}),l.length>0?(s.setText(`${c+1} / ${l.length}`),l[0].addClass("diff-search-current"),l[0].scrollIntoView({behavior:"smooth",block:"center"})):s.setText("\u65E0\u7ED3\u679C")}),i.addEventListener("keydown",r=>{r.key==="Enter"?(r.preventDefault(),l.length>0&&(l[c].removeClass("diff-search-current"),c=(c+1)%l.length,l[c].addClass("diff-search-current"),l[c].scrollIntoView({behavior:"smooth",block:"center"}),s.setText(`${c+1} / ${l.length}`))):r.key==="Escape"&&e.remove()}),a.addEventListener("click",()=>{l.forEach(r=>{r.removeClass("diff-search-match"),r.removeClass("diff-search-current")}),e.remove()});let f=this.containerEl.querySelector(".diff-toolbar");f&&f.insertAdjacentElement("afterend",e),i.focus()}async exportDiffReport(){try{let e=X(this.leftContent,this.rightContent),i=`# \u7248\u672C\u5DEE\u5F02\u62A5\u544A

`;i+=`**\u6587\u4EF6**: ${this.file.path}
`,i+=`**\u751F\u6210\u65F6\u95F4**: ${new Date().toLocaleString("zh-CN")}

`;let s=await this.plugin.getAllVersions(this.file.path),a=s.find(o=>o.id===this.versionId);if(a&&(i+=`**\u5BF9\u6BD4\u7248\u672C**: ${this.plugin.formatTime(a.timestamp)}
`),this.secondVersionId){let o=s.find(d=>d.id===this.secondVersionId);o&&(i+=`**\u76EE\u6807\u7248\u672C**: ${this.plugin.formatTime(o.timestamp)}
`)}else i+=`**\u76EE\u6807\u7248\u672C**: \u5F53\u524D\u6587\u4EF6
`;i+=`
## \u7EDF\u8BA1\u4FE1\u606F

`;let l=0,c=0,f=0;for(let o of e){let d=o.value.split(`
`).length-1;o.added?l+=d:o.removed?c+=d:f+=d}i+=`- \u65B0\u589E\u884C\u6570: ${l}
`,i+=`- \u5220\u9664\u884C\u6570: ${c}
`,i+=`- \u672A\u53D8\u5316\u884C\u6570: ${f}
`,i+=`- \u603B\u884C\u6570: ${l+c+f}

`,i+=`## \u5DEE\u5F02\u5185\u5BB9

`,i+="```diff\n";for(let o of e){let d=o.added?"+":o.removed?"-":" ",u=o.value.split(`
`);u.forEach((h,p)=>{p<u.length-1&&(i+=`${d} ${h}
`)})}i+="```\n";let r=`diff_report_${Date.now()}.md`;await this.app.vault.create(r,i),new g.Notice(`\u2705 \u5DEE\u5F02\u62A5\u544A\u5DF2\u5BFC\u51FA: ${r}`)}catch(e){console.error("\u5BFC\u51FA\u5DEE\u5F02\u62A5\u544A\u5931\u8D25:",e),new g.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}renderUnifiedDiff(e,i,s,a){let l=X(i,s);this.renderLineDiff(e,l,"unified")}renderLineDiff(e,i,s){let a=[],l=1,c=0;for(let h of i){let p=h.value.split(`
`);p[p.length-1]===""&&p.pop();for(let E of p)h.added?a.push({lineNumber:l++,content:E,type:"added",diffIndex:c++}):h.removed?a.push({lineNumber:null,content:E,type:"removed",diffIndex:c++}):a.push({lineNumber:l++,content:E,type:"context"})}let f=[],r=[],o=null,d=1;for(let h of a){let p=h.type==="context"?"context":"diff";p!==o?(r.length>0&&f.push({type:o,lines:r,startLine:d}),r=[h],o=p,d=h.lineNumber||d):r.push(h)}r.length>0&&f.push({type:o,lines:r,startLine:d});let u=0;for(let h of f){if(h.type==="context"&&!this.showContext&&h.lines.length>this.contextLines*2){let p=this.collapsedSections.has(u);for(let w=0;w<this.contextLines;w++)this.renderDiffLine(e,h.lines[w],s);let E=e.createEl("div",{cls:"diff-collapse-btn",text:p?`\u22EF \u5C55\u5F00 ${h.lines.length-this.contextLines*2} \u884C\u672A\u4FEE\u6539\u5185\u5BB9 \u22EF`:`\u22EF \u6298\u53E0 ${h.lines.length-this.contextLines*2} \u884C \u22EF`}),m=u;if(E.addEventListener("click",()=>{this.collapsedSections.has(m)?this.collapsedSections.delete(m):this.collapsedSections.add(m);let w=e.parentElement;if(w){let b=this.containerEl.querySelector(".diff-select");this.renderUnifiedDiff(w,this.leftContent,this.rightContent,(b==null?void 0:b.value)||"line")}}),!p)for(let w=this.contextLines;w<h.lines.length-this.contextLines;w++)this.renderDiffLine(e,h.lines[w],s);for(let w=Math.max(this.contextLines,h.lines.length-this.contextLines);w<h.lines.length;w++)this.renderDiffLine(e,h.lines[w],s);u++;continue}for(let p of h.lines)this.renderDiffLine(e,p,s)}}renderDiffLine(e,i,s){let a=e.createEl("div",{cls:"diff-line"});i.diffIndex!==void 0&&(a.dataset.diffIndex=String(i.diffIndex),this.diffElements.push(a)),i.type==="added"?(a.addClass("diff-added"),this.showLineNumbers&&a.createEl("span",{cls:"line-number",text:String(i.lineNumber)}),a.createEl("span",{cls:"diff-marker",text:"+"}),a.createEl("span",{cls:"line-content",text:i.content})):i.type==="removed"?(a.addClass("diff-removed"),this.showLineNumbers&&a.createEl("span",{cls:"line-number",text:""}),a.createEl("span",{cls:"diff-marker",text:"-"}),a.createEl("span",{cls:"line-content",text:i.content})):(a.addClass("diff-context"),this.showLineNumbers&&a.createEl("span",{cls:"line-number",text:String(i.lineNumber)}),a.createEl("span",{cls:"diff-marker",text:" "}),a.createEl("span",{cls:"line-content",text:i.content}))}renderInlineDiff(e,i,s){let a=e.createEl("div",{cls:"diff-inline-with-lines"}),l=a.createEl("div",{cls:"diff-line-numbers"}),c=a.createEl("div",{cls:"diff-line-content"}),f=[],r=1,o=[],d=!1,u=0;for(let h of i){let p=h.value.split(`
`);for(let E=0;E<p.length;E++){let m=p[E];if(E>0&&(f.push({number:r,hasChange:d,spans:o}),r++,o=[],d=!1),m){let w=document.createElement("span");w.textContent=m,h.added?(w.className="diff-char-added",w.dataset.diffIndex=String(u++),this.diffElements.push(w),d=!0):h.removed&&(w.className="diff-char-removed",w.dataset.diffIndex=String(u++),this.diffElements.push(w),d=!0),o.push(w)}}}f.push({number:r,hasChange:d,spans:o});for(let h of f)if(this.showContext||h.hasChange){l.createEl("div",{text:String(h.number),cls:"line-number"});let p=c.createEl("div",{cls:"diff-content-line"});h.spans.length===0?p.innerHTML="&nbsp;":p.innerHTML=h.spans.map(E=>E.outerHTML).join("")}}renderSplitDiff(e,i,s,a,l,c){e.addClass("diff-split");let f=e.createEl("div",{cls:"diff-panel"}),r=e.createEl("div",{cls:"diff-panel"});f.createEl("h3",{text:l}),r.createEl("h3",{text:c});let o=f.createEl("div",{cls:"diff-content"}),d=r.createEl("div",{cls:"diff-content"}),u=X(i,s);this.renderSplitLineDiff(o,d,u);let h=!1;o.addEventListener("scroll",()=>{h||(h=!0,d.scrollTop=o.scrollTop,setTimeout(()=>{h=!1},50))}),d.addEventListener("scroll",()=>{h||(h=!0,o.scrollTop=d.scrollTop,setTimeout(()=>{h=!1},50))})}renderSplitLineDiff(e,i,s){let a=1,l=1,c=0;for(let f of s){if(!this.showContext&&!f.added&&!f.removed){let o=f.value.split(`
`);if(o[o.length-1]===""&&o.pop(),o.length>this.contextLines*2){let d=e.createEl("div",{cls:"diff-collapse-btn"}),u=i.createEl("div",{cls:"diff-collapse-btn"});d.setText(`\u22EF ${o.length} \u884C\u672A\u4FEE\u6539 \u22EF`),u.setText(`\u22EF ${o.length} \u884C\u672A\u4FEE\u6539 \u22EF`),a+=o.length,l+=o.length;continue}for(let d of o.slice(0,this.contextLines)){let u=e.createEl("div",{cls:"diff-line diff-context"});u.createEl("span",{cls:"line-number",text:String(a)}),u.createEl("span",{cls:"diff-marker",text:" "}),u.createEl("span",{cls:"line-content",text:d});let h=i.createEl("div",{cls:"diff-line diff-context"});h.createEl("span",{cls:"line-number",text:String(l)}),h.createEl("span",{cls:"diff-marker",text:" "}),h.createEl("span",{cls:"line-content",text:d}),a++,l++}a+=Math.max(0,o.length-this.contextLines),l+=Math.max(0,o.length-this.contextLines);continue}let r=f.value.split(`
`);r[r.length-1]===""&&r.pop();for(let o of r)if(f.removed){let d=e.createEl("div",{cls:"diff-line diff-removed"});d.dataset.diffIndex=String(c++),d.createEl("span",{cls:"line-number",text:String(a)}),d.createEl("span",{cls:"diff-marker",text:"-"}),d.createEl("span",{cls:"line-content",text:o}),this.diffElements.push(d),a++,i.createEl("div",{cls:"diff-line diff-placeholder"})}else if(f.added){let d=i.createEl("div",{cls:"diff-line diff-added"});d.dataset.diffIndex=String(c++),d.createEl("span",{cls:"line-number",text:String(l)}),d.createEl("span",{cls:"diff-marker",text:"+"}),d.createEl("span",{cls:"line-content",text:o}),this.diffElements.push(d),l++,e.createEl("div",{cls:"diff-line diff-placeholder"})}else{let d=e.createEl("div",{cls:"diff-line diff-context"});d.createEl("span",{cls:"line-number",text:String(a)}),d.createEl("span",{cls:"diff-marker",text:" "}),d.createEl("span",{cls:"line-content",text:o});let u=i.createEl("div",{cls:"diff-line diff-context"});u.createEl("span",{cls:"line-number",text:String(l)}),u.createEl("span",{cls:"diff-marker",text:" "}),u.createEl("span",{cls:"line-content",text:o}),a++,l++}}}renderSplitInlineDiff(e,i,s){let a=e.createEl("div",{cls:"diff-inline-with-lines"}),l=i.createEl("div",{cls:"diff-inline-with-lines"}),c=a.createEl("div",{cls:"diff-line-numbers"}),f=a.createEl("div",{cls:"diff-line-content"}),r=l.createEl("div",{cls:"diff-line-numbers"}),o=l.createEl("div",{cls:"diff-line-content"}),d=[],u=1,h=1,p=[],E=[],m=!1,w=0;for(let b of s){let y=b.value.split(`
`);for(let v=0;v<y.length;v++){let _=y[v];if(v>0&&(d.push({left:u,right:h,hasChange:m,leftSpans:p,rightSpans:E}),u++,h++,p=[],E=[],m=!1),_){let S=document.createElement("span");if(S.textContent=_,b.added)S.className="diff-char-added",S.dataset.diffIndex=String(w++),this.diffElements.push(S),E.push(S),m=!0;else if(b.removed)S.className="diff-char-removed",S.dataset.diffIndex=String(w++),this.diffElements.push(S),p.push(S),m=!0;else{let x=document.createElement("span");x.textContent=_,p.push(x);let T=document.createElement("span");T.textContent=_,E.push(T)}}}}d.push({left:u,right:h,hasChange:m,leftSpans:p,rightSpans:E});for(let b of d)if(this.showContext||b.hasChange){c.createEl("div",{text:String(b.left),cls:"line-number"});let y=f.createEl("div",{cls:"diff-content-line"});y.innerHTML=b.leftSpans.length>0?b.leftSpans.map(_=>_.outerHTML).join(""):"&nbsp;",r.createEl("div",{text:String(b.right),cls:"line-number"});let v=o.createEl("div",{cls:"diff-content-line"});v.innerHTML=b.rightSpans.length>0?b.rightSpans.map(_=>_.outerHTML).join(""):"&nbsp;"}}scrollToDiff(){if(this.diffElements.length===0||this.currentDiffIndex>=this.diffElements.length)return;let e=this.diffElements[this.currentDiffIndex];this.diffElements.forEach(i=>i.removeClass("diff-current")),e.addClass("diff-current"),e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{let i=e.getBoundingClientRect(),s=this.containerEl.querySelector(".diff-container");if(s){let a=s.getBoundingClientRect();(i.top<a.top||i.bottom>a.bottom)&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}},100)}copyDiffToClipboard(){let e=this.containerEl.querySelector(".diff-container");if(!e)return;let i=e.textContent||"";navigator.clipboard.writeText(i).then(()=>{new g.Notice("\u2705 \u5DEE\u5F02\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(()=>{new g.Notice("\u274C \u590D\u5236\u5931\u8D25")})}onClose(){let{contentEl:e}=this;e.empty()}},Mt=class extends g.Modal{constructor(e,i,s,a,l){super(e);this.searchQuery="";this.plugin=i,this.file=s,this.firstVersionId=a,this.onSelect=l}async onOpen(){let{contentEl:e}=this;e.addClass("version-select-modal"),e.createEl("h2",{text:"\u9009\u62E9\u5BF9\u6BD4\u7248\u672C"}),e.createEl("p",{text:"\u9009\u62E9\u8981\u4E0E\u4E4B\u5BF9\u6BD4\u7684\u7248\u672C",cls:"version-select-hint"}),e.createEl("div",{cls:"version-search-container"}).createEl("input",{type:"text",placeholder:"\u641C\u7D22\u7248\u672C...",cls:"version-search-input"}).addEventListener("input",l=>{this.searchQuery=l.target.value,this.renderVersionList()});let a=e.createEl("div",{cls:"version-select-list"});this.renderVersionList()}async renderVersionList(){let e=this.containerEl.querySelector(".version-select-list");if(!e)return;e.empty();let s=(await this.plugin.getAllVersions(this.file.path)).filter(a=>{if(a.id===this.firstVersionId)return!1;if(!this.searchQuery)return!0;let l=this.searchQuery.toLowerCase();return a.message.toLowerCase().includes(l)||this.plugin.formatTime(a.timestamp).toLowerCase().includes(l)});if(s.length===0){e.createEl("div",{text:this.searchQuery?`\u672A\u627E\u5230\u5339\u914D "${this.searchQuery}" \u7684\u7248\u672C`:"\u6CA1\u6709\u5176\u4ED6\u7248\u672C",cls:"version-select-empty"});return}for(let a of s){let l=e.createEl("div",{cls:"version-select-item"}),c=l.createEl("div",{cls:"version-info"});c.createEl("div",{text:this.plugin.formatTime(a.timestamp),cls:"version-time"}),c.createEl("div",{text:a.message,cls:"version-message"}),c.createEl("div",{text:this.plugin.formatFileSize(a.size),cls:"version-size"}),l.createEl("button",{text:"\u9009\u62E9"}).addEventListener("click",()=>{this.close(),this.onSelect(a.id)})}}onClose(){let{contentEl:e}=this;e.empty()}},Rt=class extends g.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i}async display(){let{containerEl:e}=this;if(e.empty(),e.createEl("h2",{text:"\u7248\u672C\u63A7\u5236\u8BBE\u7F6E"}),this.plugin.settings.showVersionStats){let r=await this.plugin.getStorageStats(),o=e.createEl("div",{cls:"version-stats"});o.createEl("h3",{text:"\u{1F4CA} \u5B58\u50A8\u7EDF\u8BA1"});let d=o.createEl("div",{cls:"stats-grid"});d.createEl("div",{text:`\u603B\u5927\u5C0F: ${this.plugin.formatFileSize(r.totalSize)}`}),d.createEl("div",{text:`\u7248\u672C\u6570\u91CF: ${r.versionCount}`}),d.createEl("div",{text:`\u6587\u4EF6\u6570\u91CF: ${r.fileCount}`}),d.createEl("div",{text:`\u661F\u6807\u7248\u672C: ${r.starredCount}`}),d.createEl("div",{text:`\u6807\u7B7E\u7248\u672C: ${r.taggedCount}`}),(this.plugin.settings.enableCompression||this.plugin.settings.enableIncrementalStorage)&&d.createEl("div",{text:`\u538B\u7F29\u7387: ${r.compressionRatio.toFixed(1)}%`}),o.createEl("button",{text:"\u{1F504} \u5237\u65B0\u7EDF\u8BA1"}).addEventListener("click",()=>{this.display()})}e.createEl("h3",{text:"\u2699\uFE0F \u57FA\u7840\u8BBE\u7F6E"}),new g.Setting(e).setName("\u542F\u7528\u72B6\u6001\u680F\u5FEB\u901F\u5BF9\u6BD4").setDesc("\u70B9\u51FB\u72B6\u6001\u680F\u53EF\u5FEB\u901F\u5BF9\u6BD4\u5F53\u524D\u6587\u4EF6\u4E0E\u6700\u65B0\u7248\u672C").addToggle(r=>r.setValue(this.plugin.settings.enableStatusBarDiff).onChange(async o=>{this.plugin.settings.enableStatusBarDiff=o,await this.plugin.saveSettings(),o?(this.plugin.statusBarItem.addClass("version-control-statusbar-clickable"),new g.Notice("\u72B6\u6001\u680F\u5FEB\u901F\u5BF9\u6BD4\u5DF2\u542F\u7528\uFF0C\u70B9\u51FB\u72B6\u6001\u680F\u53EF\u5FEB\u901F\u5BF9\u6BD4")):this.plugin.statusBarItem.removeClass("version-control-statusbar-clickable")})),new g.Setting(e).setName("\u7248\u672C\u5B58\u50A8\u8DEF\u5F84").setDesc("\u6307\u5B9A\u7248\u672C\u6570\u636E\u7684\u5B58\u50A8\u4F4D\u7F6E(\u76F8\u5BF9\u4E8E\u5E93\u6839\u76EE\u5F55)").addText(r=>r.setPlaceholder(".versions").setValue(this.plugin.settings.versionFolder).onChange(async o=>{this.plugin.settings.versionFolder=o||".versions",await this.plugin.saveSettings(),await this.plugin.ensureVersionFolder()})),new g.Setting(e).setName("\u663E\u793A\u901A\u77E5").setDesc("\u5728\u521B\u5EFA\u3001\u6062\u590D\u7248\u672C\u65F6\u663E\u793A\u63D0\u793A\u6D88\u606F").addToggle(r=>r.setValue(this.plugin.settings.showNotifications).onChange(async o=>{this.plugin.settings.showNotifications=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("\u663E\u793A\u7EDF\u8BA1\u4FE1\u606F").setDesc("\u5728\u8BBE\u7F6E\u9875\u9762\u663E\u793A\u7248\u672C\u7EDF\u8BA1").addToggle(r=>r.setValue(this.plugin.settings.showVersionStats).onChange(async o=>{this.plugin.settings.showVersionStats=o,await this.plugin.saveSettings(),this.display()})),e.createEl("h3",{text:"\u{1F3F7}\uFE0F \u7248\u672C\u6807\u7B7E\u4E0E\u5907\u6CE8"}),new g.Setting(e).setName("\u542F\u7528\u7248\u672C\u6807\u7B7E").setDesc("\u4E3A\u7248\u672C\u6DFB\u52A0\u6807\u7B7E\u4EE5\u4FBF\u5206\u7C7B\u548C\u7B5B\u9009").addToggle(r=>r.setValue(this.plugin.settings.enableVersionTags).onChange(async o=>{this.plugin.settings.enableVersionTags=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("\u9ED8\u8BA4\u6807\u7B7E\u5217\u8868").setDesc("\u9884\u8BBE\u7684\u5E38\u7528\u6807\u7B7E(\u6BCF\u884C\u4E00\u4E2A)").addTextArea(r=>{r.setValue(this.plugin.settings.defaultTags.join(`
`)).setPlaceholder(`\u91CD\u8981
\u91CC\u7A0B\u7891
\u53D1\u5E03
\u5907\u4EFD
\u8349\u7A3F`).onChange(async o=>{this.plugin.settings.defaultTags=o.split(`
`).map(d=>d.trim()).filter(d=>d.length>0),await this.plugin.saveSettings()}),r.inputEl.rows=4,r.inputEl.style.width="100%"}),new g.Setting(e).setName("\u542F\u7528\u5FEB\u901F\u9884\u89C8").setDesc("\u5728\u7248\u672C\u5386\u53F2\u4E2D\u663E\u793A\u5FEB\u901F\u9884\u89C8\u6309\u94AE").addToggle(r=>r.setValue(this.plugin.settings.enableQuickPreview).onChange(async o=>{this.plugin.settings.enableQuickPreview=o,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView()})),e.createEl("h3",{text:"\u{1F916} \u81EA\u52A8\u4FDD\u5B58"}),new g.Setting(e).setName("\u542F\u7528\u81EA\u52A8\u4FDD\u5B58").setDesc("\u81EA\u52A8\u521B\u5EFA\u7248\u672C\u5FEB\u7167").addToggle(r=>r.setValue(this.plugin.settings.autoSave).onChange(async o=>{this.plugin.settings.autoSave=o,await this.plugin.saveSettings(),o&&this.plugin.settings.autoSaveOnInterval?this.plugin.startAutoSave():this.plugin.autoSaveTimer&&clearInterval(this.plugin.autoSaveTimer)}));let i=e.createEl("div",{cls:"setting-item-description"});i.innerHTML="\u9009\u62E9\u4EE5\u4E0B\u4E00\u79CD\u6216\u591A\u79CD\u81EA\u52A8\u4FDD\u5B58\u89E6\u53D1\u65B9\u5F0F:",i.style.marginBottom="10px",i.style.color="var(--text-muted)",new g.Setting(e).setName("\u270F\uFE0F \u4FEE\u6539\u65F6\u81EA\u52A8\u4FDD\u5B58").setDesc("\u6587\u4EF6\u4FEE\u6539\u540E\u5EF6\u8FDF\u4FDD\u5B58(\u63A8\u8350)").addToggle(r=>r.setValue(this.plugin.settings.autoSaveOnModify).onChange(async o=>{this.plugin.settings.autoSaveOnModify=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("\u4FDD\u5B58\u5EF6\u8FDF (\u79D2)").setDesc("\u4FEE\u6539\u540E\u7B49\u5F85\u591A\u4E45\u624D\u4FDD\u5B58,\u907F\u514D\u9891\u7E41\u521B\u5EFA\u7248\u672C").addSlider(r=>r.setLimits(30,600,30).setValue(this.plugin.settings.autoSaveDelay).setDynamicTooltip().onChange(async o=>{this.plugin.settings.autoSaveDelay=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("\u6700\u5C0F\u53D8\u5316\u5B57\u7B26\u6570").setDesc("\u53EA\u6709\u53D8\u5316\u8D85\u8FC7\u6B64\u5B57\u7B26\u6570\u65F6\u624D\u4FDD\u5B58\u7248\u672C").addSlider(r=>r.setLimits(0,100,5).setValue(this.plugin.settings.autoSaveMinChanges).setDynamicTooltip().onChange(async o=>{this.plugin.settings.autoSaveMinChanges=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("\u23F0 \u5B9A\u65F6\u81EA\u52A8\u4FDD\u5B58").setDesc("\u6309\u56FA\u5B9A\u65F6\u95F4\u95F4\u9694\u4FDD\u5B58").addToggle(r=>r.setValue(this.plugin.settings.autoSaveOnInterval).onChange(async o=>{this.plugin.settings.autoSaveOnInterval=o,await this.plugin.saveSettings(),o&&this.plugin.settings.autoSave?this.plugin.startAutoSave():this.plugin.autoSaveTimer&&(clearInterval(this.plugin.autoSaveTimer),this.plugin.autoSaveTimer=null)})),new g.Setting(e).setName("\u5B9A\u65F6\u95F4\u9694 (\u5206\u949F)").setDesc("\u6BCF\u9694\u591A\u4E45\u81EA\u52A8\u68C0\u67E5\u5E76\u4FDD\u5B58").addText(r=>r.setPlaceholder("5").setValue(String(this.plugin.settings.autoSaveInterval)).onChange(async o=>{let d=parseInt(o);!isNaN(d)&&d>0&&(this.plugin.settings.autoSaveInterval=d,await this.plugin.saveSettings(),this.plugin.settings.autoSave&&this.plugin.settings.autoSaveOnInterval&&this.plugin.startAutoSave())})),new g.Setting(e).setName("\u{1F504} \u5207\u6362\u6587\u4EF6\u65F6\u4FDD\u5B58").setDesc("\u5207\u6362\u5230\u5176\u4ED6\u6587\u4EF6\u65F6\u81EA\u52A8\u4FDD\u5B58\u5F53\u524D\u6587\u4EF6").addToggle(r=>r.setValue(this.plugin.settings.autoSaveOnFileSwitch).onChange(async o=>{this.plugin.settings.autoSaveOnFileSwitch=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("\u{1F441}\uFE0F \u5931\u53BB\u7126\u70B9\u65F6\u4FDD\u5B58").setDesc("\u7A97\u53E3\u5931\u53BB\u7126\u70B9\u65F6\u81EA\u52A8\u4FDD\u5B58(\u5207\u6362\u5E94\u7528\u65F6)").addToggle(r=>r.setValue(this.plugin.settings.autoSaveOnFocusLost).onChange(async o=>{this.plugin.settings.autoSaveOnFocusLost=o,await this.plugin.saveSettings(),o&&new g.Notice("\u5931\u53BB\u7126\u70B9\u4FDD\u5B58\u5C06\u5728\u91CD\u542F Obsidian \u540E\u751F\u6548")})),new g.Setting(e).setName("\u542F\u7528\u53BB\u91CD").setDesc("\u8DF3\u8FC7\u5185\u5BB9\u76F8\u540C\u7684\u7248\u672C\u521B\u5EFA,\u8282\u7701\u5B58\u50A8\u7A7A\u95F4").addToggle(r=>r.setValue(this.plugin.settings.enableDeduplication).onChange(async o=>{this.plugin.settings.enableDeduplication=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("\u6392\u9664\u7684\u6587\u4EF6\u5939").setDesc("\u4E0D\u5BF9\u8FD9\u4E9B\u6587\u4EF6\u5939\u4E2D\u7684\u6587\u4EF6\u521B\u5EFA\u7248\u672C(\u6BCF\u884C\u4E00\u4E2A\u8DEF\u5F84)").addTextArea(r=>{r.setValue(this.plugin.settings.excludedFolders.join(`
`)).setPlaceholder(`\u4F8B\u5982:
templates/
.trash/`).onChange(async o=>{this.plugin.settings.excludedFolders=o.split(`
`).map(d=>d.trim()).filter(d=>d.length>0),await this.plugin.saveSettings()}),r.inputEl.rows=4,r.inputEl.style.width="100%"}),e.createEl("h3",{text:"\u{1F4BE} \u5B58\u50A8\u4F18\u5316"}),new g.Setting(e).setName("\u542F\u7528\u538B\u7F29").setDesc("\u4F7F\u7528 gzip \u538B\u7F29\u7248\u672C\u6587\u4EF6,\u663E\u8457\u51CF\u5C11\u5B58\u50A8\u7A7A\u95F4\u5360\u7528").addToggle(r=>r.setValue(this.plugin.settings.enableCompression).onChange(async o=>{this.plugin.settings.enableCompression=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("\u542F\u7528\u589E\u91CF\u5B58\u50A8").setDesc("\u53EA\u4FDD\u5B58\u7248\u672C\u95F4\u7684\u5DEE\u5F02,\u5927\u5E45\u964D\u4F4E\u5B58\u50A8\u7A7A\u95F4\u4F7F\u7528").addToggle(r=>r.setValue(this.plugin.settings.enableIncrementalStorage).onChange(async o=>{this.plugin.settings.enableIncrementalStorage=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("\u57FA\u51C6\u7248\u672C\u95F4\u9694").setDesc("\u6BCFN\u4E2A\u7248\u672C\u521B\u5EFA\u4E00\u6B21\u5B8C\u6574\u5FEB\u7167(\u5EFA\u8BAE10-20),\u7528\u4E8E\u589E\u91CF\u5B58\u50A8\u7684\u57FA\u51C6").addText(r=>r.setPlaceholder("10").setValue(String(this.plugin.settings.rebuildBaseInterval)).onChange(async o=>{let d=parseInt(o);!isNaN(d)&&d>0&&(this.plugin.settings.rebuildBaseInterval=d,await this.plugin.saveSettings())})),new g.Setting(e).setName("\u6BCF\u9875\u663E\u793A\u7248\u672C\u6570").setDesc("\u7248\u672C\u5386\u53F2\u89C6\u56FE\u4E2D\u6BCF\u9875\u663E\u793A\u7684\u7248\u672C\u6570\u91CF(0=\u4E0D\u5206\u9875)").addText(r=>r.setPlaceholder("20").setValue(String(this.plugin.settings.versionsPerPage)).onChange(async o=>{let d=parseInt(o);!isNaN(d)&&d>=0&&(this.plugin.settings.versionsPerPage=d,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView())})),new g.Setting(e).setName("\u4F18\u5316\u5B58\u50A8").setDesc("\u91CD\u65B0\u538B\u7F29\u548C\u4F18\u5316\u6240\u6709\u7248\u672C\u6587\u4EF6").addButton(r=>r.setButtonText("\u7ACB\u5373\u4F18\u5316").onClick(async()=>{await this.plugin.optimizeAllVersionFiles(),this.display()})),e.createEl("h3",{text:"\u{1F5D1}\uFE0F \u81EA\u52A8\u6E05\u7406"}),new g.Setting(e).setName("\u542F\u7528\u81EA\u52A8\u6E05\u7406").setDesc("\u81EA\u52A8\u5220\u9664\u65E7\u7248\u672C\u4EE5\u8282\u7701\u7A7A\u95F4").addToggle(r=>r.setValue(this.plugin.settings.autoClear).onChange(async o=>{this.plugin.settings.autoClear=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("\u6309\u6570\u91CF\u6E05\u7406").setDesc("\u4FDD\u7559\u6307\u5B9A\u6570\u91CF\u7684\u6700\u65B0\u7248\u672C").addToggle(r=>r.setValue(this.plugin.settings.enableMaxVersions).onChange(async o=>{this.plugin.settings.enableMaxVersions=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("\u6700\u5927\u7248\u672C\u6570").setDesc("\u6BCF\u4E2A\u6587\u4EF6\u6700\u591A\u4FDD\u7559\u7684\u7248\u672C\u6570\u91CF").addText(r=>r.setPlaceholder("50").setValue(String(this.plugin.settings.maxVersions)).onChange(async o=>{let d=parseInt(o);!isNaN(d)&&d>0&&(this.plugin.settings.maxVersions=d,await this.plugin.saveSettings())})),new g.Setting(e).setName("\u6309\u5929\u6570\u6E05\u7406").setDesc("\u81EA\u52A8\u5220\u9664\u8D85\u8FC7\u6307\u5B9A\u5929\u6570\u7684\u7248\u672C").addToggle(r=>r.setValue(this.plugin.settings.enableMaxDays).onChange(async o=>{this.plugin.settings.enableMaxDays=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("\u6700\u5927\u4FDD\u7559\u5929\u6570").setDesc("\u5220\u9664\u8D85\u8FC7\u6B64\u5929\u6570\u7684\u65E7\u7248\u672C").addText(r=>r.setPlaceholder("30").setValue(String(this.plugin.settings.maxDays)).onChange(async o=>{let d=parseInt(o);!isNaN(d)&&d>0&&(this.plugin.settings.maxDays=d,await this.plugin.saveSettings())})),e.createEl("h3",{text:"\u{1F3A8} \u663E\u793A\u8BBE\u7F6E"}),new g.Setting(e).setName("\u4F7F\u7528\u76F8\u5BF9\u65F6\u95F4").setDesc('\u663E\u793A"3\u5C0F\u65F6\u524D"\u800C\u4E0D\u662F\u5177\u4F53\u65F6\u95F4').addToggle(r=>r.setValue(this.plugin.settings.useRelativeTime).onChange(async o=>{this.plugin.settings.useRelativeTime=o,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView()})),e.createEl("h3",{text:"\u{1F500} \u5DEE\u5F02\u5BF9\u6BD4\u8BBE\u7F6E"}),new g.Setting(e).setName("\u5DEE\u5F02\u7C92\u5EA6").setDesc("\u9009\u62E9\u5DEE\u5F02\u8BA1\u7B97\u7684\u7CBE\u7EC6\u7A0B\u5EA6").addDropdown(r=>r.addOption("char","\u5B57\u7B26\u7EA7 - \u6700\u7CBE\u786E,\u663E\u793A\u6BCF\u4E2A\u5B57\u7B26\u7684\u53D8\u5316").addOption("word","\u5355\u8BCD\u7EA7 - \u6309\u5355\u8BCD\u663E\u793A\u5DEE\u5F02").addOption("line","\u884C\u7EA7 - \u6309\u884C\u663E\u793A\u5DEE\u5F02").setValue(this.plugin.settings.diffGranularity).onChange(async o=>{this.plugin.settings.diffGranularity=o,await this.plugin.saveSettings()})),new g.Setting(e).setName("\u9ED8\u8BA4\u89C6\u56FE\u6A21\u5F0F").setDesc("\u9009\u62E9\u5DEE\u5F02\u5BF9\u6BD4\u7684\u9ED8\u8BA4\u663E\u793A\u65B9\u5F0F").addDropdown(r=>r.addOption("unified","\u7EDF\u4E00\u89C6\u56FE - \u4E0A\u4E0B\u5BF9\u6BD4").addOption("split","\u5DE6\u53F3\u5206\u680F - \u5E76\u6392\u663E\u793A").setValue(this.plugin.settings.diffViewMode).onChange(async o=>{this.plugin.settings.diffViewMode=o,await this.plugin.saveSettings()})),e.createEl("h3",{text:"\u{1F6E0}\uFE0F \u7EF4\u62A4\u64CD\u4F5C"}),new g.Setting(e).setName("\u6E05\u7406\u6240\u6709\u7248\u672C").setDesc("\u5220\u9664\u6240\u6709\u7248\u672C\u6570\u636E(\u8C28\u614E\u64CD\u4F5C)").addButton(r=>r.setButtonText("\u6E05\u7A7A\u6240\u6709\u7248\u672C").setWarning().onClick(async()=>{new se(this.app,"\u786E\u8BA4\u6E05\u7A7A\u6240\u6709\u7248\u672C",`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664\u6240\u6709\u6587\u4EF6\u7684\u6240\u6709\u7248\u672C\u5386\u53F2!

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500,\u8BF7\u8C28\u614E\u64CD\u4F5C!`,async()=>{await this.clearAllVersions()}).open()})),new g.Setting(e).setName("\u5BFC\u51FA\u7248\u672C\u6570\u636E").setDesc("\u5C06\u7248\u672C\u6587\u4EF6\u5939\u6253\u5305\u5BFC\u51FA").addButton(r=>r.setButtonText("\u521B\u5EFA\u5907\u4EFD").onClick(async()=>{new g.Notice("\u8BF7\u624B\u52A8\u590D\u5236 .versions \u6587\u4EF6\u5939\u8FDB\u884C\u5907\u4EFD")})),e.createEl("h3",{text:"\u{1F4D6} \u4F7F\u7528\u8BF4\u660E"});let s=e.createEl("div",{cls:"version-info-section"}),a=s.createEl("div",{cls:"feature-item"});a.createEl("strong",{text:"\u2728 \u65B0\u529F\u80FD:"});let l=a.createEl("ul");l.createEl("li",{text:"\u7248\u672C\u6807\u7B7E\u7CFB\u7EDF - \u4E3A\u91CD\u8981\u7248\u672C\u6DFB\u52A0\u6807\u7B7E\u8FDB\u884C\u5206\u7C7B"}),l.createEl("li",{text:"\u5FEB\u901F\u9884\u89C8 - \u65E0\u9700\u5B8C\u6574\u5BF9\u6BD4\u5373\u53EF\u67E5\u770B\u7248\u672C\u5185\u5BB9"}),l.createEl("li",{text:"\u7248\u672C\u5907\u6CE8 - \u4E3A\u7248\u672C\u6DFB\u52A0\u8BE6\u7EC6\u8BF4\u660E"}),l.createEl("li",{text:"\u661F\u6807\u6807\u8BB0 - \u6807\u8BB0\u91CD\u8981\u7248\u672C\u4FBF\u4E8E\u67E5\u627E"}),l.createEl("li",{text:"\u9AD8\u7EA7\u7B5B\u9009 - \u6309\u6807\u7B7E\u3001\u661F\u6807\u7B5B\u9009\u7248\u672C"}),l.createEl("li",{text:"\u589E\u5F3A\u5DEE\u5F02\u5BF9\u6BD4 - \u667A\u80FD\u6298\u53E0\u3001\u884C\u53F7\u663E\u793A\u3001\u952E\u76D8\u5BFC\u822A"});let c=s.createEl("div",{cls:"feature-item"});c.createEl("strong",{text:"\u{1F4A1} \u4F7F\u7528\u6280\u5DE7:"});let f=c.createEl("ul");f.createEl("li",{text:"\u53F3\u952E\u70B9\u51FB\u7248\u672C\u53EF\u67E5\u770B\u66F4\u591A\u64CD\u4F5C\u9009\u9879"}),f.createEl("li",{text:"\u70B9\u51FB\u6807\u7B7E\u53EF\u5FEB\u901F\u7B5B\u9009\u76F8\u5173\u7248\u672C"}),f.createEl("li",{text:"\u4F7F\u7528\u661F\u6807\u6807\u8BB0\u91CD\u8981\u7684\u91CC\u7A0B\u7891\u7248\u672C"}),f.createEl("li",{text:'\u5B9A\u671F\u8FD0\u884C"\u4F18\u5316\u5B58\u50A8"\u4EE5\u4FDD\u6301\u6700\u4F73\u6027\u80FD'}),f.createEl("li",{text:"\u589E\u91CF\u5B58\u50A8\u548C\u538B\u7F29\u53EF\u8282\u770190%\u4EE5\u4E0A\u7684\u7A7A\u95F4"}),f.createEl("li",{text:"\u5DEE\u5F02\u5BF9\u6BD4\u4E2D\u4F7F\u7528\u65B9\u5411\u952E \u2191/\u2193 \u5FEB\u901F\u5BFC\u822A"})}async clearAllVersions(){try{let e=this.app.vault.adapter,i=this.plugin.settings.versionFolder;if(await e.exists(i)){let s=await e.list(i),a=0;for(let l of s.files)l.endsWith(".json")&&(await e.remove(l),a++);this.plugin.versionCache.clear(),new g.Notice(`\u2705 \u5DF2\u6E05\u7A7A\u6240\u6709\u7248\u672C(\u5220\u9664 ${a} \u4E2A\u7248\u672C\u6587\u4EF6)`),this.plugin.refreshVersionHistoryView(),this.display()}}catch(e){console.error("\u6E05\u7A7A\u7248\u672C\u5931\u8D25:",e),new g.Notice("\u274C \u6E05\u7A7A\u5931\u8D25,\u8BF7\u67E5\u770B\u63A7\u5236\u53F0")}}};
/*! Bundled license information:

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
