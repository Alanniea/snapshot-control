/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var _t=Object.defineProperty;var qi=Object.getOwnPropertyDescriptor;var Yi=Object.getOwnPropertyNames;var Xi=Object.prototype.hasOwnProperty;var Qi=(t,i)=>{for(var e in i)_t(t,e,{get:i[e],enumerable:!0})},Ji=(t,i,e,n)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of Yi(i))!Xi.call(t,s)&&s!==e&&_t(t,s,{get:()=>i[s],enumerable:!(n=qi(i,s))||n.enumerable});return t};var Ki=t=>Ji(_t({},"__esModule",{value:!0}),t);var Zr={};Qi(Zr,{default:()=>vt});module.exports=Ki(Zr);var w=require("obsidian");var j=class{diff(i,e,n={}){let s;typeof n=="function"?(s=n,n={}):"callback"in n&&(s=n.callback);let a=this.castInput(i,n),r=this.castInput(e,n),l=this.removeEmpty(this.tokenize(a,n)),f=this.removeEmpty(this.tokenize(r,n));return this.diffWithOptionsObj(l,f,n,s)}diffWithOptionsObj(i,e,n,s){var a;let r=y=>{if(y=this.postProcess(y,n),s){setTimeout(function(){s(y)},0);return}else return y},l=e.length,f=i.length,o=1,c=l+f;n.maxEditLength!=null&&(c=Math.min(c,n.maxEditLength));let h=(a=n.timeout)!==null&&a!==void 0?a:1/0,g=Date.now()+h,d=[{oldPos:-1,lastComponent:void 0}],u=this.extractCommon(d[0],e,i,0,n);if(d[0].oldPos+1>=f&&u+1>=l)return r(this.buildValues(d[0].lastComponent,e,i));let p=-1/0,v=1/0,_=()=>{for(let y=Math.max(p,-o);y<=Math.min(v,o);y+=2){let x,m=d[y-1],S=d[y+1];m&&(d[y-1]=void 0);let D=!1;if(S){let k=S.oldPos-y;D=S&&0<=k&&k<l}let b=m&&m.oldPos+1<f;if(!D&&!b){d[y]=void 0;continue}if(!b||D&&m.oldPos<S.oldPos?x=this.addToPath(S,!0,!1,0,n):x=this.addToPath(m,!1,!0,1,n),u=this.extractCommon(x,e,i,y,n),x.oldPos+1>=f&&u+1>=l)return r(this.buildValues(x.lastComponent,e,i))||!0;d[y]=x,x.oldPos+1>=f&&(v=Math.min(v,y-1)),u+1>=l&&(p=Math.max(p,y+1))}o++};if(s)(function y(){setTimeout(function(){if(o>c||Date.now()>g)return s(void 0);_()||y()},0)})();else for(;o<=c&&Date.now()<=g;){let y=_();if(y)return y}}addToPath(i,e,n,s,a){let r=i.lastComponent;return r&&!a.oneChangePerToken&&r.added===e&&r.removed===n?{oldPos:i.oldPos+s,lastComponent:{count:r.count+1,added:e,removed:n,previousComponent:r.previousComponent}}:{oldPos:i.oldPos+s,lastComponent:{count:1,added:e,removed:n,previousComponent:r}}}extractCommon(i,e,n,s,a){let r=e.length,l=n.length,f=i.oldPos,o=f-s,c=0;for(;o+1<r&&f+1<l&&this.equals(n[f+1],e[o+1],a);)o++,f++,c++,a.oneChangePerToken&&(i.lastComponent={count:1,previousComponent:i.lastComponent,added:!1,removed:!1});return c&&!a.oneChangePerToken&&(i.lastComponent={count:c,previousComponent:i.lastComponent,added:!1,removed:!1}),i.oldPos=f,o}equals(i,e,n){return n.comparator?n.comparator(i,e):i===e||!!n.ignoreCase&&i.toLowerCase()===e.toLowerCase()}removeEmpty(i){let e=[];for(let n=0;n<i.length;n++)i[n]&&e.push(i[n]);return e}castInput(i,e){return i}tokenize(i,e){return Array.from(i)}join(i){return i.join("")}postProcess(i,e){return i}get useLongestToken(){return!1}buildValues(i,e,n){let s=[],a;for(;i;)s.push(i),a=i.previousComponent,delete i.previousComponent,i=a;s.reverse();let r=s.length,l=0,f=0,o=0;for(;l<r;l++){let c=s[l];if(c.removed)c.value=this.join(n.slice(o,o+c.count)),o+=c.count;else{if(!c.added&&this.useLongestToken){let h=e.slice(f,f+c.count);h=h.map(function(g,d){let u=n[o+d];return u.length>g.length?u:g}),c.value=this.join(h)}else c.value=this.join(e.slice(f,f+c.count));f+=c.count,c.added||(o+=c.count)}}return s}};var xt=class extends j{},vn=new xt;function ge(t,i,e){return vn.diff(t,i,e)}function bt(t,i){let e;for(e=0;e<t.length&&e<i.length;e++)if(t[e]!=i[e])return t.slice(0,e);return t.slice(0,e)}function Et(t,i){let e;if(!t||!i||t[t.length-1]!=i[i.length-1])return"";for(e=0;e<t.length&&e<i.length;e++)if(t[t.length-(e+1)]!=i[i.length-(e+1)])return t.slice(-e);return t.slice(-e)}function et(t,i,e){if(t.slice(0,i.length)!=i)throw Error(`string ${JSON.stringify(t)} doesn't start with prefix ${JSON.stringify(i)}; this is a bug`);return e+t.slice(i.length)}function tt(t,i,e){if(!i)return t+e;if(t.slice(-i.length)!=i)throw Error(`string ${JSON.stringify(t)} doesn't end with suffix ${JSON.stringify(i)}; this is a bug`);return t.slice(0,-i.length)+e}function Ee(t,i){return et(t,i,"")}function Fe(t,i){return tt(t,i,"")}function yt(t,i){return i.slice(0,es(t,i))}function es(t,i){let e=0;t.length>i.length&&(e=t.length-i.length);let n=i.length;t.length<i.length&&(n=t.length);let s=Array(n),a=0;s[0]=0;for(let r=1;r<n;r++){for(i[r]==i[a]?s[r]=s[a]:s[r]=a;a>0&&i[r]!=i[a];)a=s[a];i[r]==i[a]&&a++}a=0;for(let r=e;r<t.length;r++){for(;a>0&&t[r]!=i[a];)a=s[a];t[r]==i[a]&&a++}return a}function mn(t){return t.includes(`\r
`)&&!t.startsWith(`
`)&&!t.match(/[^\r]\n/)}function wn(t){return!t.includes(`\r
`)&&t.includes(`
`)}function ye(t){let i;for(i=t.length-1;i>=0&&t[i].match(/\s/);i--);return t.substring(i+1)}function J(t){let i=t.match(/^\s*/);return i?i[0]:""}var nt="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",ts=new RegExp(`[${nt}]+|\\s+|[^${nt}]`,"ug"),St=class extends j{equals(i,e,n){return n.ignoreCase&&(i=i.toLowerCase(),e=e.toLowerCase()),i.trim()===e.trim()}tokenize(i,e={}){let n;if(e.intlSegmenter){let r=e.intlSegmenter;if(r.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');n=Array.from(r.segment(i),l=>l.segment)}else n=i.match(ts)||[];let s=[],a=null;return n.forEach(r=>{/\s/.test(r)?a==null?s.push(r):s.push(s.pop()+r):a!=null&&/\s/.test(a)?s[s.length-1]==a?s.push(s.pop()+r):s.push(a+r):s.push(r),a=r}),s}join(i){return i.map((e,n)=>n==0?e:e.replace(/^\s+/,"")).join("")}postProcess(i,e){if(!i||e.oneChangePerToken)return i;let n=null,s=null,a=null;return i.forEach(r=>{r.added?s=r:r.removed?a=r:((s||a)&&_n(n,a,s,r),n=r,s=null,a=null)}),(s||a)&&_n(n,a,s,null),i}},ns=new St;function _n(t,i,e,n){if(i&&e){let s=J(i.value),a=ye(i.value),r=J(e.value),l=ye(e.value);if(t){let f=bt(s,r);t.value=tt(t.value,r,f),i.value=Ee(i.value,f),e.value=Ee(e.value,f)}if(n){let f=Et(a,l);n.value=et(n.value,l,f),i.value=Fe(i.value,f),e.value=Fe(e.value,f)}}else if(e){if(t){let s=J(e.value);e.value=e.value.substring(s.length)}if(n){let s=J(n.value);n.value=n.value.substring(s.length)}}else if(t&&n){let s=J(n.value),a=J(i.value),r=ye(i.value),l=bt(s,a);i.value=Ee(i.value,l);let f=Et(Ee(s,l),r);i.value=Fe(i.value,f),n.value=et(n.value,s,f),t.value=tt(t.value,s,s.slice(0,s.length-f.length))}else if(n){let s=J(n.value),a=ye(i.value),r=yt(a,s);i.value=Fe(i.value,r)}else if(t){let s=ye(t.value),a=J(i.value),r=yt(s,a);i.value=Ee(i.value,r)}}var Ct=class extends j{tokenize(i){let e=new RegExp(`(\\r?\\n)|[${nt}]+|[^\\S\\n\\r]+|[^${nt}]`,"ug");return i.match(e)||[]}},xn=new Ct;function Be(t,i,e){return xn.diff(t,i,e)}var kt=class extends j{constructor(){super(...arguments),this.tokenize=is}equals(i,e,n){return n.ignoreWhitespace?((!n.newlineIsToken||!i.includes(`
`))&&(i=i.trim()),(!n.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(i.endsWith(`
`)&&(i=i.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),super.equals(i,e,n)}},bn=new kt;function O(t,i,e){return bn.diff(t,i,e)}function is(t,i){i.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));let e=[],n=t.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(let s=0;s<n.length;s++){let a=n[s];s%2&&!i.newlineIsToken?e[e.length-1]+=a:e.push(a)}return e}function Tt(t){return Array.isArray(t)?t.map(i=>Tt(i)):Object.assign(Object.assign({},t),{hunks:t.hunks.map(i=>Object.assign(Object.assign({},i),{lines:i.lines.map((e,n)=>{var s;return e.startsWith("\\")||e.endsWith("\r")||!((s=i.lines[n+1])===null||s===void 0)&&s.startsWith("\\")?e:e+"\r"})}))})}function Dt(t){return Array.isArray(t)?t.map(i=>Dt(i)):Object.assign(Object.assign({},t),{hunks:t.hunks.map(i=>Object.assign(Object.assign({},i),{lines:i.lines.map(e=>e.endsWith("\r")?e.substring(0,e.length-1):e)}))})}function En(t){return Array.isArray(t)||(t=[t]),!t.some(i=>i.hunks.some(e=>e.lines.some(n=>!n.startsWith("\\")&&n.endsWith("\r"))))}function yn(t){return Array.isArray(t)||(t=[t]),t.some(i=>i.hunks.some(e=>e.lines.some(n=>n.endsWith("\r"))))&&t.every(i=>i.hunks.every(e=>e.lines.every((n,s)=>{var a;return n.startsWith("\\")||n.endsWith("\r")||((a=e.lines[s+1])===null||a===void 0?void 0:a.startsWith("\\"))})))}function Sn(t){let i=t.split(/\n/),e=[],n=0;function s(){let l={};for(e.push(l);n<i.length;){let f=i[n];if(/^(---|\+\+\+|@@)\s/.test(f))break;let o=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(f);o&&(l.index=o[1]),n++}for(a(l),a(l),l.hunks=[];n<i.length;){let f=i[n];if(/^(Index:\s|diff\s|---\s|\+\+\+\s|===================================================================)/.test(f))break;if(/^@@/.test(f))l.hunks.push(r());else{if(f)throw new Error("Unknown line "+(n+1)+" "+JSON.stringify(f));n++}}}function a(l){let f=/^(---|\+\+\+)\s+(.*)\r?$/.exec(i[n]);if(f){let o=f[2].split("	",2),c=(o[1]||"").trim(),h=o[0].replace(/\\\\/g,"\\");/^".*"$/.test(h)&&(h=h.substr(1,h.length-2)),f[1]==="---"?(l.oldFileName=h,l.oldHeader=c):(l.newFileName=h,l.newHeader=c),n++}}function r(){var l;let f=n,o=i[n++],c=o.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),h={oldStart:+c[1],oldLines:typeof c[2]=="undefined"?1:+c[2],newStart:+c[3],newLines:typeof c[4]=="undefined"?1:+c[4],lines:[]};h.oldLines===0&&(h.oldStart+=1),h.newLines===0&&(h.newStart+=1);let g=0,d=0;for(;n<i.length&&(d<h.oldLines||g<h.newLines||!((l=i[n])===null||l===void 0)&&l.startsWith("\\"));n++){let u=i[n].length==0&&n!=i.length-1?" ":i[n][0];if(u==="+"||u==="-"||u===" "||u==="\\")h.lines.push(i[n]),u==="+"?g++:u==="-"?d++:u===" "&&(g++,d++);else throw new Error(`Hunk at line ${f+1} contained invalid line ${i[n]}`)}if(!g&&h.newLines===1&&(h.newLines=0),!d&&h.oldLines===1&&(h.oldLines=0),g!==h.newLines)throw new Error("Added line count did not match for hunk at line "+(f+1));if(d!==h.oldLines)throw new Error("Removed line count did not match for hunk at line "+(f+1));return h}for(;n<i.length;)s();return e}function Cn(t,i,e){let n=!0,s=!1,a=!1,r=1;return function l(){if(n&&!a){if(s?r++:n=!1,t+r<=e)return t+r;a=!0}if(!s)return a||(n=!0),i<=t-r?t-r++:(s=!0,l())}}function Lt(t,i,e={}){let n;if(typeof i=="string"?n=Sn(i):Array.isArray(i)?n=i:n=[i],n.length>1)throw new Error("applyPatch only works with a single input.");return ss(t,n[0],e)}function ss(t,i,e={}){(e.autoConvertLineEndings||e.autoConvertLineEndings==null)&&(mn(t)&&En(i)?i=Tt(i):wn(t)&&yn(i)&&(i=Dt(i)));let n=t.split(`
`),s=i.hunks,a=e.compareLine||((u,p,v,_)=>p===_),r=e.fuzzFactor||0,l=0;if(r<0||!Number.isInteger(r))throw new Error("fuzzFactor must be a non-negative integer");if(!s.length)return t;let f="",o=!1,c=!1;for(let u=0;u<s[s.length-1].lines.length;u++){let p=s[s.length-1].lines[u];p[0]=="\\"&&(f[0]=="+"?o=!0:f[0]=="-"&&(c=!0)),f=p}if(o){if(c){if(!r&&n[n.length-1]=="")return!1}else if(n[n.length-1]=="")n.pop();else if(!r)return!1}else if(c){if(n[n.length-1]!="")n.push("");else if(!r)return!1}function h(u,p,v,_=0,y=!0,x=[],m=0){let S=0,D=!1;for(;_<u.length;_++){let b=u[_],k=b.length>0?b[0]:" ",E=b.length>0?b.substr(1):b;if(k==="-")if(a(p+1,n[p],k,E))p++,S=0;else return!v||n[p]==null?null:(x[m]=n[p],h(u,p+1,v-1,_,!1,x,m+1));if(k==="+"){if(!y)return null;x[m]=E,m++,S=0,D=!0}if(k===" ")if(S++,x[m]=n[p],a(p+1,n[p],k,E))m++,y=!0,D=!1,p++;else return D||!v?null:n[p]&&(h(u,p+1,v-1,_+1,!1,x,m+1)||h(u,p+1,v-1,_,!1,x,m+1))||h(u,p,v-1,_+1,!1,x,m)}return m-=S,p-=S,x.length=m,{patchedLines:x,oldLineLastI:p-1}}let g=[],d=0;for(let u=0;u<s.length;u++){let p=s[u],v,_=n.length-p.oldLines+r,y;for(let x=0;x<=r;x++){y=p.oldStart+d-1;let m=Cn(y,l,_);for(;y!==void 0&&(v=h(p.lines,y,x),!v);y=m());if(v)break}if(!v)return!1;for(let x=l;x<y;x++)g.push(n[x]);for(let x=0;x<v.patchedLines.length;x++){let m=v.patchedLines[x];g.push(m)}l=v.oldLineLastI+1,d=y+1-p.oldStart}for(let u=l;u<n.length;u++)g.push(n[u]);return g.join(`
`)}function It(t,i,e,n,s,a,r){let l;r?typeof r=="function"?l={callback:r}:l=r:l={},typeof l.context=="undefined"&&(l.context=4);let f=l.context;if(l.newlineIsToken)throw new Error("newlineIsToken may not be used with patch-generation functions, only with diffing functions");if(l.callback){let{callback:c}=l;O(e,n,Object.assign(Object.assign({},l),{callback:h=>{let g=o(h);c(g)}}))}else return o(O(e,n,l));function o(c){if(!c)return;c.push({value:"",lines:[]});function h(y){return y.map(function(x){return" "+x})}let g=[],d=0,u=0,p=[],v=1,_=1;for(let y=0;y<c.length;y++){let x=c[y],m=x.lines||as(x.value);if(x.lines=m,x.added||x.removed){if(!d){let S=c[y-1];d=v,u=_,S&&(p=f>0?h(S.lines.slice(-f)):[],d-=p.length,u-=p.length)}for(let S of m)p.push((x.added?"+":"-")+S);x.added?_+=m.length:v+=m.length}else{if(d)if(m.length<=f*2&&y<c.length-2)for(let S of h(m))p.push(S);else{let S=Math.min(m.length,f);for(let b of h(m.slice(0,S)))p.push(b);let D={oldStart:d,oldLines:v-d+S,newStart:u,newLines:_-u+S,lines:p};g.push(D),d=0,u=0,p=[]}v+=m.length,_+=m.length}}for(let y of g)for(let x=0;x<y.lines.length;x++)y.lines[x].endsWith(`
`)?y.lines[x]=y.lines[x].slice(0,-1):(y.lines.splice(x+1,0,"\\ No newline at end of file"),x++);return{oldFileName:t,newFileName:i,oldHeader:s,newHeader:a,hunks:g}}}function it(t){if(Array.isArray(t))return t.map(it).join(`
`);let i=[];t.oldFileName==t.newFileName&&i.push("Index: "+t.oldFileName),i.push("==================================================================="),i.push("--- "+t.oldFileName+(typeof t.oldHeader=="undefined"?"":"	"+t.oldHeader)),i.push("+++ "+t.newFileName+(typeof t.newHeader=="undefined"?"":"	"+t.newHeader));for(let e=0;e<t.hunks.length;e++){let n=t.hunks[e];n.oldLines===0&&(n.oldStart-=1),n.newLines===0&&(n.newStart-=1),i.push("@@ -"+n.oldStart+","+n.oldLines+" +"+n.newStart+","+n.newLines+" @@");for(let s of n.lines)i.push(s)}return i.join(`
`)+`
`}function kn(t,i,e,n,s,a,r){if(typeof r=="function"&&(r={callback:r}),r!=null&&r.callback){let{callback:l}=r;It(t,i,e,n,s,a,Object.assign(Object.assign({},r),{callback:f=>{l(f?it(f):void 0)}}))}else{let l=It(t,i,e,n,s,a,r);return l?it(l):void 0}}function Vt(t,i,e,n,s,a){return kn(t,t,i,e,n,s,a)}function as(t){let i=t.endsWith(`
`),e=t.split(`
`).map(n=>n+`
`);return i?e.pop():e.push(e.pop().slice(0,-1)),e}function Le(t){let i=t.length;for(;--i>=0;)t[i]=0}var os=0,di=1,ls=2,cs=3,fs=258,tn=29,Ye=256,Pe=Ye+1+tn,ke=30,nn=19,hi=2*Pe+1,pe=15,At=16,ds=7,sn=256,ui=16,gi=17,pi=18,jt=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ct=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),hs=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),vi=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),us=512,ee=new Array((Pe+2)*2);Le(ee);var $e=new Array(ke*2);Le($e);var He=new Array(us);Le(He);var Ze=new Array(fs-cs+1);Le(Ze);var an=new Array(tn);Le(an);var ft=new Array(ke);Le(ft);function Ft(t,i,e,n,s){this.static_tree=t,this.extra_bits=i,this.extra_base=e,this.elems=n,this.max_length=s,this.has_stree=t&&t.length}var mi,wi,_i;function Bt(t,i){this.dyn_tree=t,this.max_code=0,this.stat_desc=i}var xi=t=>t<256?He[t]:He[256+(t>>>7)],We=(t,i)=>{t.pending_buf[t.pending++]=i&255,t.pending_buf[t.pending++]=i>>>8&255},R=(t,i,e)=>{t.bi_valid>At-e?(t.bi_buf|=i<<t.bi_valid&65535,We(t,t.bi_buf),t.bi_buf=i>>At-t.bi_valid,t.bi_valid+=e-At):(t.bi_buf|=i<<t.bi_valid&65535,t.bi_valid+=e)},q=(t,i,e)=>{R(t,e[i*2],e[i*2+1])},bi=(t,i)=>{let e=0;do e|=t&1,t>>>=1,e<<=1;while(--i>0);return e>>>1},gs=t=>{t.bi_valid===16?(We(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},ps=(t,i)=>{let e=i.dyn_tree,n=i.max_code,s=i.stat_desc.static_tree,a=i.stat_desc.has_stree,r=i.stat_desc.extra_bits,l=i.stat_desc.extra_base,f=i.stat_desc.max_length,o,c,h,g,d,u,p=0;for(g=0;g<=pe;g++)t.bl_count[g]=0;for(e[t.heap[t.heap_max]*2+1]=0,o=t.heap_max+1;o<hi;o++)c=t.heap[o],g=e[e[c*2+1]*2+1]+1,g>f&&(g=f,p++),e[c*2+1]=g,!(c>n)&&(t.bl_count[g]++,d=0,c>=l&&(d=r[c-l]),u=e[c*2],t.opt_len+=u*(g+d),a&&(t.static_len+=u*(s[c*2+1]+d)));if(p!==0){do{for(g=f-1;t.bl_count[g]===0;)g--;t.bl_count[g]--,t.bl_count[g+1]+=2,t.bl_count[f]--,p-=2}while(p>0);for(g=f;g!==0;g--)for(c=t.bl_count[g];c!==0;)h=t.heap[--o],!(h>n)&&(e[h*2+1]!==g&&(t.opt_len+=(g-e[h*2+1])*e[h*2],e[h*2+1]=g),c--)}},Ei=(t,i,e)=>{let n=new Array(pe+1),s=0,a,r;for(a=1;a<=pe;a++)s=s+e[a-1]<<1,n[a]=s;for(r=0;r<=i;r++){let l=t[r*2+1];l!==0&&(t[r*2]=bi(n[l]++,l))}},vs=()=>{let t,i,e,n,s,a=new Array(pe+1);for(e=0,n=0;n<tn-1;n++)for(an[n]=e,t=0;t<1<<jt[n];t++)Ze[e++]=n;for(Ze[e-1]=n,s=0,n=0;n<16;n++)for(ft[n]=s,t=0;t<1<<ct[n];t++)He[s++]=n;for(s>>=7;n<ke;n++)for(ft[n]=s<<7,t=0;t<1<<ct[n]-7;t++)He[256+s++]=n;for(i=0;i<=pe;i++)a[i]=0;for(t=0;t<=143;)ee[t*2+1]=8,t++,a[8]++;for(;t<=255;)ee[t*2+1]=9,t++,a[9]++;for(;t<=279;)ee[t*2+1]=7,t++,a[7]++;for(;t<=287;)ee[t*2+1]=8,t++,a[8]++;for(Ei(ee,Pe+1,a),t=0;t<ke;t++)$e[t*2+1]=5,$e[t*2]=bi(t,5);mi=new Ft(ee,jt,Ye+1,Pe,pe),wi=new Ft($e,ct,0,ke,pe),_i=new Ft(new Array(0),hs,0,nn,ds)},yi=t=>{let i;for(i=0;i<Pe;i++)t.dyn_ltree[i*2]=0;for(i=0;i<ke;i++)t.dyn_dtree[i*2]=0;for(i=0;i<nn;i++)t.bl_tree[i*2]=0;t.dyn_ltree[sn*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Si=t=>{t.bi_valid>8?We(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Tn=(t,i,e,n)=>{let s=i*2,a=e*2;return t[s]<t[a]||t[s]===t[a]&&n[i]<=n[e]},zt=(t,i,e)=>{let n=t.heap[e],s=e<<1;for(;s<=t.heap_len&&(s<t.heap_len&&Tn(i,t.heap[s+1],t.heap[s],t.depth)&&s++,!Tn(i,n,t.heap[s],t.depth));)t.heap[e]=t.heap[s],e=s,s<<=1;t.heap[e]=n},Dn=(t,i,e)=>{let n,s,a=0,r,l;if(t.sym_next!==0)do n=t.pending_buf[t.sym_buf+a++]&255,n+=(t.pending_buf[t.sym_buf+a++]&255)<<8,s=t.pending_buf[t.sym_buf+a++],n===0?q(t,s,i):(r=Ze[s],q(t,r+Ye+1,i),l=jt[r],l!==0&&(s-=an[r],R(t,s,l)),n--,r=xi(n),q(t,r,e),l=ct[r],l!==0&&(n-=ft[r],R(t,n,l)));while(a<t.sym_next);q(t,sn,i)},Gt=(t,i)=>{let e=i.dyn_tree,n=i.stat_desc.static_tree,s=i.stat_desc.has_stree,a=i.stat_desc.elems,r,l,f=-1,o;for(t.heap_len=0,t.heap_max=hi,r=0;r<a;r++)e[r*2]!==0?(t.heap[++t.heap_len]=f=r,t.depth[r]=0):e[r*2+1]=0;for(;t.heap_len<2;)o=t.heap[++t.heap_len]=f<2?++f:0,e[o*2]=1,t.depth[o]=0,t.opt_len--,s&&(t.static_len-=n[o*2+1]);for(i.max_code=f,r=t.heap_len>>1;r>=1;r--)zt(t,e,r);o=a;do r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],zt(t,e,1),l=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=l,e[o*2]=e[r*2]+e[l*2],t.depth[o]=(t.depth[r]>=t.depth[l]?t.depth[r]:t.depth[l])+1,e[r*2+1]=e[l*2+1]=o,t.heap[1]=o++,zt(t,e,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],ps(t,i),Ei(e,f,t.bl_count)},Ln=(t,i,e)=>{let n,s=-1,a,r=i[0*2+1],l=0,f=7,o=4;for(r===0&&(f=138,o=3),i[(e+1)*2+1]=65535,n=0;n<=e;n++)a=r,r=i[(n+1)*2+1],!(++l<f&&a===r)&&(l<o?t.bl_tree[a*2]+=l:a!==0?(a!==s&&t.bl_tree[a*2]++,t.bl_tree[ui*2]++):l<=10?t.bl_tree[gi*2]++:t.bl_tree[pi*2]++,l=0,s=a,r===0?(f=138,o=3):a===r?(f=6,o=3):(f=7,o=4))},In=(t,i,e)=>{let n,s=-1,a,r=i[0*2+1],l=0,f=7,o=4;for(r===0&&(f=138,o=3),n=0;n<=e;n++)if(a=r,r=i[(n+1)*2+1],!(++l<f&&a===r)){if(l<o)do q(t,a,t.bl_tree);while(--l!==0);else a!==0?(a!==s&&(q(t,a,t.bl_tree),l--),q(t,ui,t.bl_tree),R(t,l-3,2)):l<=10?(q(t,gi,t.bl_tree),R(t,l-3,3)):(q(t,pi,t.bl_tree),R(t,l-11,7));l=0,s=a,r===0?(f=138,o=3):a===r?(f=6,o=3):(f=7,o=4)}},ms=t=>{let i;for(Ln(t,t.dyn_ltree,t.l_desc.max_code),Ln(t,t.dyn_dtree,t.d_desc.max_code),Gt(t,t.bl_desc),i=nn-1;i>=3&&t.bl_tree[vi[i]*2+1]===0;i--);return t.opt_len+=3*(i+1)+5+5+4,i},ws=(t,i,e,n)=>{let s;for(R(t,i-257,5),R(t,e-1,5),R(t,n-4,4),s=0;s<n;s++)R(t,t.bl_tree[vi[s]*2+1],3);In(t,t.dyn_ltree,i-1),In(t,t.dyn_dtree,e-1)},_s=t=>{let i=4093624447,e;for(e=0;e<=31;e++,i>>>=1)if(i&1&&t.dyn_ltree[e*2]!==0)return 0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return 1;for(e=32;e<Ye;e++)if(t.dyn_ltree[e*2]!==0)return 1;return 0},Vn=!1,xs=t=>{Vn||(vs(),Vn=!0),t.l_desc=new Bt(t.dyn_ltree,mi),t.d_desc=new Bt(t.dyn_dtree,wi),t.bl_desc=new Bt(t.bl_tree,_i),t.bi_buf=0,t.bi_valid=0,yi(t)},Ci=(t,i,e,n)=>{R(t,(os<<1)+(n?1:0),3),Si(t),We(t,e),We(t,~e),e&&t.pending_buf.set(t.window.subarray(i,i+e),t.pending),t.pending+=e},bs=t=>{R(t,di<<1,3),q(t,sn,ee),gs(t)},Es=(t,i,e,n)=>{let s,a,r=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=_s(t)),Gt(t,t.l_desc),Gt(t,t.d_desc),r=ms(t),s=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=s&&(s=a)):s=a=e+5,e+4<=s&&i!==-1?Ci(t,i,e,n):t.strategy===4||a===s?(R(t,(di<<1)+(n?1:0),3),Dn(t,ee,$e)):(R(t,(ls<<1)+(n?1:0),3),ws(t,t.l_desc.max_code+1,t.d_desc.max_code+1,r+1),Dn(t,t.dyn_ltree,t.dyn_dtree)),yi(t),n&&Si(t)},ys=(t,i,e)=>(t.pending_buf[t.sym_buf+t.sym_next++]=i,t.pending_buf[t.sym_buf+t.sym_next++]=i>>8,t.pending_buf[t.sym_buf+t.sym_next++]=e,i===0?t.dyn_ltree[e*2]++:(t.matches++,i--,t.dyn_ltree[(Ze[e]+Ye+1)*2]++,t.dyn_dtree[xi(i)*2]++),t.sym_next===t.sym_end),Ss=xs,Cs=Ci,ks=Es,Ts=ys,Ds=bs,Ls={_tr_init:Ss,_tr_stored_block:Cs,_tr_flush_block:ks,_tr_tally:Ts,_tr_align:Ds},Is=(t,i,e,n)=>{let s=t&65535|0,a=t>>>16&65535|0,r=0;for(;e!==0;){r=e>2e3?2e3:e,e-=r;do s=s+i[n++]|0,a=a+s|0;while(--r);s%=65521,a%=65521}return s|a<<16|0},Ue=Is,Vs=()=>{let t,i=[];for(var e=0;e<256;e++){t=e;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;i[e]=t}return i},As=new Uint32Array(Vs()),Fs=(t,i,e,n)=>{let s=As,a=n+e;t^=-1;for(let r=n;r<a;r++)t=t>>>8^s[(t^i[r])&255];return t^-1},B=Fs,we={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ie={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Bs,_tr_stored_block:qt,_tr_flush_block:zs,_tr_tally:ae,_tr_align:Ms}=Ls,{Z_NO_FLUSH:re,Z_PARTIAL_FLUSH:Ns,Z_FULL_FLUSH:$s,Z_FINISH:Z,Z_BLOCK:An,Z_OK:z,Z_STREAM_END:Fn,Z_STREAM_ERROR:Y,Z_DATA_ERROR:Rs,Z_BUF_ERROR:Mt,Z_DEFAULT_COMPRESSION:Os,Z_FILTERED:Ps,Z_HUFFMAN_ONLY:st,Z_RLE:Hs,Z_FIXED:Zs,Z_DEFAULT_STRATEGY:Ws,Z_UNKNOWN:Us,Z_DEFLATED:ut}=Ie,js=9,Gs=15,qs=8,Ys=29,Xs=256,Yt=Xs+1+Ys,Qs=30,Js=19,Ks=2*Yt+1,ea=15,L=3,se=258,X=se+L+1,ta=32,Te=42,rn=57,Xt=69,Qt=73,Jt=91,Kt=103,ve=113,Me=666,N=1,Ve=2,_e=3,Ae=4,na=3,me=(t,i)=>(t.msg=we[i],i),Bn=t=>t*2-(t>4?9:0),ie=t=>{let i=t.length;for(;--i>=0;)t[i]=0},ia=t=>{let i,e,n,s=t.w_size;i=t.hash_size,n=i;do e=t.head[--n],t.head[n]=e>=s?e-s:0;while(--i);i=s,n=i;do e=t.prev[--n],t.prev[n]=e>=s?e-s:0;while(--i)},sa=(t,i,e)=>(i<<t.hash_shift^e)&t.hash_mask,oe=sa,P=t=>{let i=t.state,e=i.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+e),t.next_out),t.next_out+=e,i.pending_out+=e,t.total_out+=e,t.avail_out-=e,i.pending-=e,i.pending===0&&(i.pending_out=0))},H=(t,i)=>{zs(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,i),t.block_start=t.strstart,P(t.strm)},I=(t,i)=>{t.pending_buf[t.pending++]=i},ze=(t,i)=>{t.pending_buf[t.pending++]=i>>>8&255,t.pending_buf[t.pending++]=i&255},en=(t,i,e,n)=>{let s=t.avail_in;return s>n&&(s=n),s===0?0:(t.avail_in-=s,i.set(t.input.subarray(t.next_in,t.next_in+s),e),t.state.wrap===1?t.adler=Ue(t.adler,i,s,e):t.state.wrap===2&&(t.adler=B(t.adler,i,s,e)),t.next_in+=s,t.total_in+=s,s)},ki=(t,i)=>{let e=t.max_chain_length,n=t.strstart,s,a,r=t.prev_length,l=t.nice_match,f=t.strstart>t.w_size-X?t.strstart-(t.w_size-X):0,o=t.window,c=t.w_mask,h=t.prev,g=t.strstart+se,d=o[n+r-1],u=o[n+r];t.prev_length>=t.good_match&&(e>>=2),l>t.lookahead&&(l=t.lookahead);do if(s=i,!(o[s+r]!==u||o[s+r-1]!==d||o[s]!==o[n]||o[++s]!==o[n+1])){n+=2,s++;do;while(o[++n]===o[++s]&&o[++n]===o[++s]&&o[++n]===o[++s]&&o[++n]===o[++s]&&o[++n]===o[++s]&&o[++n]===o[++s]&&o[++n]===o[++s]&&o[++n]===o[++s]&&n<g);if(a=se-(g-n),n=g-se,a>r){if(t.match_start=i,r=a,a>=l)break;d=o[n+r-1],u=o[n+r]}}while((i=h[i&c])>f&&--e!==0);return r<=t.lookahead?r:t.lookahead},De=t=>{let i=t.w_size,e,n,s;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=i+(i-X)&&(t.window.set(t.window.subarray(i,i+i-n),0),t.match_start-=i,t.strstart-=i,t.block_start-=i,t.insert>t.strstart&&(t.insert=t.strstart),ia(t),n+=i),t.strm.avail_in===0)break;if(e=en(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=e,t.lookahead+t.insert>=L)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=oe(t,t.ins_h,t.window[s+1]);t.insert&&(t.ins_h=oe(t,t.ins_h,t.window[s+L-1]),t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<L)););}while(t.lookahead<X&&t.strm.avail_in!==0)},Ti=(t,i)=>{let e=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,n,s,a,r=0,l=t.strm.avail_in;do{if(n=65535,a=t.bi_valid+42>>3,t.strm.avail_out<a||(a=t.strm.avail_out-a,s=t.strstart-t.block_start,n>s+t.strm.avail_in&&(n=s+t.strm.avail_in),n>a&&(n=a),n<e&&(n===0&&i!==Z||i===re||n!==s+t.strm.avail_in)))break;r=i===Z&&n===s+t.strm.avail_in?1:0,qt(t,0,0,r),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,P(t.strm),s&&(s>n&&(s=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+s),t.strm.next_out),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s,t.block_start+=s,n-=s),n&&(en(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(r===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),r?Ae:i!==re&&i!==Z&&t.strm.avail_in===0&&t.strstart===t.block_start?Ve:(a=t.window_size-t.strstart,t.strm.avail_in>a&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,a+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),a>t.strm.avail_in&&(a=t.strm.avail_in),a&&(en(t.strm,t.window,t.strstart,a),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.high_water<t.strstart&&(t.high_water=t.strstart),a=t.bi_valid+42>>3,a=t.pending_buf_size-a>65535?65535:t.pending_buf_size-a,e=a>t.w_size?t.w_size:a,s=t.strstart-t.block_start,(s>=e||(s||i===Z)&&i!==re&&t.strm.avail_in===0&&s<=a)&&(n=s>a?a:s,r=i===Z&&t.strm.avail_in===0&&n===s?1:0,qt(t,t.block_start,n,r),t.block_start+=n,P(t.strm)),r?_e:N)},Nt=(t,i)=>{let e,n;for(;;){if(t.lookahead<X){if(De(t),t.lookahead<X&&i===re)return N;if(t.lookahead===0)break}if(e=0,t.lookahead>=L&&(t.ins_h=oe(t,t.ins_h,t.window[t.strstart+L-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),e!==0&&t.strstart-e<=t.w_size-X&&(t.match_length=ki(t,e)),t.match_length>=L)if(n=ae(t,t.strstart-t.match_start,t.match_length-L),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=L){t.match_length--;do t.strstart++,t.ins_h=oe(t,t.ins_h,t.window[t.strstart+L-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=oe(t,t.ins_h,t.window[t.strstart+1]);else n=ae(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(H(t,!1),t.strm.avail_out===0))return N}return t.insert=t.strstart<L-1?t.strstart:L-1,i===Z?(H(t,!0),t.strm.avail_out===0?_e:Ae):t.sym_next&&(H(t,!1),t.strm.avail_out===0)?N:Ve},Se=(t,i)=>{let e,n,s;for(;;){if(t.lookahead<X){if(De(t),t.lookahead<X&&i===re)return N;if(t.lookahead===0)break}if(e=0,t.lookahead>=L&&(t.ins_h=oe(t,t.ins_h,t.window[t.strstart+L-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=L-1,e!==0&&t.prev_length<t.max_lazy_match&&t.strstart-e<=t.w_size-X&&(t.match_length=ki(t,e),t.match_length<=5&&(t.strategy===Ps||t.match_length===L&&t.strstart-t.match_start>4096)&&(t.match_length=L-1)),t.prev_length>=L&&t.match_length<=t.prev_length){s=t.strstart+t.lookahead-L,n=ae(t,t.strstart-1-t.prev_match,t.prev_length-L),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=s&&(t.ins_h=oe(t,t.ins_h,t.window[t.strstart+L-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=L-1,t.strstart++,n&&(H(t,!1),t.strm.avail_out===0))return N}else if(t.match_available){if(n=ae(t,0,t.window[t.strstart-1]),n&&H(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return N}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=ae(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<L-1?t.strstart:L-1,i===Z?(H(t,!0),t.strm.avail_out===0?_e:Ae):t.sym_next&&(H(t,!1),t.strm.avail_out===0)?N:Ve},aa=(t,i)=>{let e,n,s,a,r=t.window;for(;;){if(t.lookahead<=se){if(De(t),t.lookahead<=se&&i===re)return N;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=L&&t.strstart>0&&(s=t.strstart-1,n=r[s],n===r[++s]&&n===r[++s]&&n===r[++s])){a=t.strstart+se;do;while(n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&s<a);t.match_length=se-(a-s),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=L?(e=ae(t,1,t.match_length-L),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(e=ae(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),e&&(H(t,!1),t.strm.avail_out===0))return N}return t.insert=0,i===Z?(H(t,!0),t.strm.avail_out===0?_e:Ae):t.sym_next&&(H(t,!1),t.strm.avail_out===0)?N:Ve},ra=(t,i)=>{let e;for(;;){if(t.lookahead===0&&(De(t),t.lookahead===0)){if(i===re)return N;break}if(t.match_length=0,e=ae(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,e&&(H(t,!1),t.strm.avail_out===0))return N}return t.insert=0,i===Z?(H(t,!0),t.strm.avail_out===0?_e:Ae):t.sym_next&&(H(t,!1),t.strm.avail_out===0)?N:Ve};function G(t,i,e,n,s){this.good_length=t,this.max_lazy=i,this.nice_length=e,this.max_chain=n,this.func=s}var Ne=[new G(0,0,0,0,Ti),new G(4,4,8,4,Nt),new G(4,5,16,8,Nt),new G(4,6,32,32,Nt),new G(4,4,16,16,Se),new G(8,16,32,32,Se),new G(8,16,128,128,Se),new G(8,32,128,256,Se),new G(32,128,258,1024,Se),new G(32,258,258,4096,Se)],oa=t=>{t.window_size=2*t.w_size,ie(t.head),t.max_lazy_match=Ne[t.level].max_lazy,t.good_match=Ne[t.level].good_length,t.nice_match=Ne[t.level].nice_length,t.max_chain_length=Ne[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=L-1,t.match_available=0,t.ins_h=0};function la(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ut,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Ks*2),this.dyn_dtree=new Uint16Array((2*Qs+1)*2),this.bl_tree=new Uint16Array((2*Js+1)*2),ie(this.dyn_ltree),ie(this.dyn_dtree),ie(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(ea+1),this.heap=new Uint16Array(2*Yt+1),ie(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Yt+1),ie(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Xe=t=>{if(!t)return 1;let i=t.state;return!i||i.strm!==t||i.status!==Te&&i.status!==rn&&i.status!==Xt&&i.status!==Qt&&i.status!==Jt&&i.status!==Kt&&i.status!==ve&&i.status!==Me?1:0},Di=t=>{if(Xe(t))return me(t,Y);t.total_in=t.total_out=0,t.data_type=Us;let i=t.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap===2?rn:i.wrap?Te:ve,t.adler=i.wrap===2?0:1,i.last_flush=-2,Bs(i),z},Li=t=>{let i=Di(t);return i===z&&oa(t.state),i},ca=(t,i)=>Xe(t)||t.state.wrap!==2?Y:(t.state.gzhead=i,z),Ii=(t,i,e,n,s,a)=>{if(!t)return Y;let r=1;if(i===Os&&(i=6),n<0?(r=0,n=-n):n>15&&(r=2,n-=16),s<1||s>js||e!==ut||n<8||n>15||i<0||i>9||a<0||a>Zs||n===8&&r!==1)return me(t,Y);n===8&&(n=9);let l=new la;return t.state=l,l.strm=t,l.status=Te,l.wrap=r,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+L-1)/L),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=i,l.strategy=a,l.method=e,Li(t)},fa=(t,i)=>Ii(t,i,ut,Gs,qs,Ws),da=(t,i)=>{if(Xe(t)||i>An||i<0)return t?me(t,Y):Y;let e=t.state;if(!t.output||t.avail_in!==0&&!t.input||e.status===Me&&i!==Z)return me(t,t.avail_out===0?Mt:Y);let n=e.last_flush;if(e.last_flush=i,e.pending!==0){if(P(t),t.avail_out===0)return e.last_flush=-1,z}else if(t.avail_in===0&&Bn(i)<=Bn(n)&&i!==Z)return me(t,Mt);if(e.status===Me&&t.avail_in!==0)return me(t,Mt);if(e.status===Te&&e.wrap===0&&(e.status=ve),e.status===Te){let s=ut+(e.w_bits-8<<4)<<8,a=-1;if(e.strategy>=st||e.level<2?a=0:e.level<6?a=1:e.level===6?a=2:a=3,s|=a<<6,e.strstart!==0&&(s|=ta),s+=31-s%31,ze(e,s),e.strstart!==0&&(ze(e,t.adler>>>16),ze(e,t.adler&65535)),t.adler=1,e.status=ve,P(t),e.pending!==0)return e.last_flush=-1,z}if(e.status===rn){if(t.adler=0,I(e,31),I(e,139),I(e,8),e.gzhead)I(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),I(e,e.gzhead.time&255),I(e,e.gzhead.time>>8&255),I(e,e.gzhead.time>>16&255),I(e,e.gzhead.time>>24&255),I(e,e.level===9?2:e.strategy>=st||e.level<2?4:0),I(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(I(e,e.gzhead.extra.length&255),I(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(t.adler=B(t.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=Xt;else if(I(e,0),I(e,0),I(e,0),I(e,0),I(e,0),I(e,e.level===9?2:e.strategy>=st||e.level<2?4:0),I(e,na),e.status=ve,P(t),e.pending!==0)return e.last_flush=-1,z}if(e.status===Xt){if(e.gzhead.extra){let s=e.pending,a=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+a>e.pending_buf_size;){let l=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+l),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>s&&(t.adler=B(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex+=l,P(t),e.pending!==0)return e.last_flush=-1,z;s=0,a-=l}let r=new Uint8Array(e.gzhead.extra);e.pending_buf.set(r.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending+=a,e.gzhead.hcrc&&e.pending>s&&(t.adler=B(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=Qt}if(e.status===Qt){if(e.gzhead.name){let s=e.pending,a;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(t.adler=B(t.adler,e.pending_buf,e.pending-s,s)),P(t),e.pending!==0)return e.last_flush=-1,z;s=0}e.gzindex<e.gzhead.name.length?a=e.gzhead.name.charCodeAt(e.gzindex++)&255:a=0,I(e,a)}while(a!==0);e.gzhead.hcrc&&e.pending>s&&(t.adler=B(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=Jt}if(e.status===Jt){if(e.gzhead.comment){let s=e.pending,a;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(t.adler=B(t.adler,e.pending_buf,e.pending-s,s)),P(t),e.pending!==0)return e.last_flush=-1,z;s=0}e.gzindex<e.gzhead.comment.length?a=e.gzhead.comment.charCodeAt(e.gzindex++)&255:a=0,I(e,a)}while(a!==0);e.gzhead.hcrc&&e.pending>s&&(t.adler=B(t.adler,e.pending_buf,e.pending-s,s))}e.status=Kt}if(e.status===Kt){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(P(t),e.pending!==0))return e.last_flush=-1,z;I(e,t.adler&255),I(e,t.adler>>8&255),t.adler=0}if(e.status=ve,P(t),e.pending!==0)return e.last_flush=-1,z}if(t.avail_in!==0||e.lookahead!==0||i!==re&&e.status!==Me){let s=e.level===0?Ti(e,i):e.strategy===st?ra(e,i):e.strategy===Hs?aa(e,i):Ne[e.level].func(e,i);if((s===_e||s===Ae)&&(e.status=Me),s===N||s===_e)return t.avail_out===0&&(e.last_flush=-1),z;if(s===Ve&&(i===Ns?Ms(e):i!==An&&(qt(e,0,0,!1),i===$s&&(ie(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),P(t),t.avail_out===0))return e.last_flush=-1,z}return i!==Z?z:e.wrap<=0?Fn:(e.wrap===2?(I(e,t.adler&255),I(e,t.adler>>8&255),I(e,t.adler>>16&255),I(e,t.adler>>24&255),I(e,t.total_in&255),I(e,t.total_in>>8&255),I(e,t.total_in>>16&255),I(e,t.total_in>>24&255)):(ze(e,t.adler>>>16),ze(e,t.adler&65535)),P(t),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?z:Fn)},ha=t=>{if(Xe(t))return Y;let i=t.state.status;return t.state=null,i===ve?me(t,Rs):z},ua=(t,i)=>{let e=i.length;if(Xe(t))return Y;let n=t.state,s=n.wrap;if(s===2||s===1&&n.status!==Te||n.lookahead)return Y;if(s===1&&(t.adler=Ue(t.adler,i,e,0)),n.wrap=0,e>=n.w_size){s===0&&(ie(n.head),n.strstart=0,n.block_start=0,n.insert=0);let f=new Uint8Array(n.w_size);f.set(i.subarray(e-n.w_size,e),0),i=f,e=n.w_size}let a=t.avail_in,r=t.next_in,l=t.input;for(t.avail_in=e,t.next_in=0,t.input=i,De(n);n.lookahead>=L;){let f=n.strstart,o=n.lookahead-(L-1);do n.ins_h=oe(n,n.ins_h,n.window[f+L-1]),n.prev[f&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=f,f++;while(--o);n.strstart=f,n.lookahead=L-1,De(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=L-1,n.match_available=0,t.next_in=r,t.input=l,t.avail_in=a,n.wrap=s,z},ga=fa,pa=Ii,va=Li,ma=Di,wa=ca,_a=da,xa=ha,ba=ua,Ea="pako deflate (from Nodeca project)",Re={deflateInit:ga,deflateInit2:pa,deflateReset:va,deflateResetKeep:ma,deflateSetHeader:wa,deflate:_a,deflateEnd:xa,deflateSetDictionary:ba,deflateInfo:Ea},ya=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),Sa=function(t){let i=Array.prototype.slice.call(arguments,1);for(;i.length;){let e=i.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(let n in e)ya(e,n)&&(t[n]=e[n])}}return t},Ca=t=>{let i=0;for(let n=0,s=t.length;n<s;n++)i+=t[n].length;let e=new Uint8Array(i);for(let n=0,s=0,a=t.length;n<a;n++){let r=t[n];e.set(r,s),s+=r.length}return e},gt={assign:Sa,flattenChunks:Ca},Vi=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Vi=!1}var je=new Uint8Array(256);for(let t=0;t<256;t++)je[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;je[254]=je[254]=1;var ka=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let i,e,n,s,a,r=t.length,l=0;for(s=0;s<r;s++)e=t.charCodeAt(s),(e&64512)===55296&&s+1<r&&(n=t.charCodeAt(s+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),s++)),l+=e<128?1:e<2048?2:e<65536?3:4;for(i=new Uint8Array(l),a=0,s=0;a<l;s++)e=t.charCodeAt(s),(e&64512)===55296&&s+1<r&&(n=t.charCodeAt(s+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),s++)),e<128?i[a++]=e:e<2048?(i[a++]=192|e>>>6,i[a++]=128|e&63):e<65536?(i[a++]=224|e>>>12,i[a++]=128|e>>>6&63,i[a++]=128|e&63):(i[a++]=240|e>>>18,i[a++]=128|e>>>12&63,i[a++]=128|e>>>6&63,i[a++]=128|e&63);return i},Ta=(t,i)=>{if(i<65534&&t.subarray&&Vi)return String.fromCharCode.apply(null,t.length===i?t:t.subarray(0,i));let e="";for(let n=0;n<i;n++)e+=String.fromCharCode(t[n]);return e},Da=(t,i)=>{let e=i||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,i));let n,s,a=new Array(e*2);for(s=0,n=0;n<e;){let r=t[n++];if(r<128){a[s++]=r;continue}let l=je[r];if(l>4){a[s++]=65533,n+=l-1;continue}for(r&=l===2?31:l===3?15:7;l>1&&n<e;)r=r<<6|t[n++]&63,l--;if(l>1){a[s++]=65533;continue}r<65536?a[s++]=r:(r-=65536,a[s++]=55296|r>>10&1023,a[s++]=56320|r&1023)}return Ta(a,s)},La=(t,i)=>{i=i||t.length,i>t.length&&(i=t.length);let e=i-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?i:e+je[t[e]]>i?e:i},Ge={string2buf:ka,buf2string:Da,utf8border:La};function Ia(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Ai=Ia,Fi=Object.prototype.toString,{Z_NO_FLUSH:Va,Z_SYNC_FLUSH:Aa,Z_FULL_FLUSH:Fa,Z_FINISH:Ba,Z_OK:dt,Z_STREAM_END:za,Z_DEFAULT_COMPRESSION:Ma,Z_DEFAULT_STRATEGY:Na,Z_DEFLATED:$a}=Ie;function Qe(t){this.options=gt.assign({level:Ma,method:$a,chunkSize:16384,windowBits:15,memLevel:8,strategy:Na},t||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ai,this.strm.avail_out=0;let e=Re.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(e!==dt)throw new Error(we[e]);if(i.header&&Re.deflateSetHeader(this.strm,i.header),i.dictionary){let n;if(typeof i.dictionary=="string"?n=Ge.string2buf(i.dictionary):Fi.call(i.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(i.dictionary):n=i.dictionary,e=Re.deflateSetDictionary(this.strm,n),e!==dt)throw new Error(we[e]);this._dict_set=!0}}Qe.prototype.push=function(t,i){let e=this.strm,n=this.options.chunkSize,s,a;if(this.ended)return!1;for(i===~~i?a=i:a=i===!0?Ba:Va,typeof t=="string"?e.input=Ge.string2buf(t):Fi.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),(a===Aa||a===Fa)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(s=Re.deflate(e,a),s===za)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),s=Re.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===dt;if(e.avail_out===0){this.onData(e.output);continue}if(a>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};Qe.prototype.onData=function(t){this.chunks.push(t)};Qe.prototype.onEnd=function(t){t===dt&&(this.result=gt.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function on(t,i){let e=new Qe(i);if(e.push(t,!0),e.err)throw e.msg||we[e.err];return e.result}function Ra(t,i){return i=i||{},i.raw=!0,on(t,i)}function Oa(t,i){return i=i||{},i.gzip=!0,on(t,i)}var Pa=Qe,Ha=on,Za=Ra,Wa=Oa,Ua=Ie,ja={Deflate:Pa,deflate:Ha,deflateRaw:Za,gzip:Wa,constants:Ua},at=16209,Ga=16191,qa=function(i,e){let n,s,a,r,l,f,o,c,h,g,d,u,p,v,_,y,x,m,S,D,b,k,E,C,T=i.state;n=i.next_in,E=i.input,s=n+(i.avail_in-5),a=i.next_out,C=i.output,r=a-(e-i.avail_out),l=a+(i.avail_out-257),f=T.dmax,o=T.wsize,c=T.whave,h=T.wnext,g=T.window,d=T.hold,u=T.bits,p=T.lencode,v=T.distcode,_=(1<<T.lenbits)-1,y=(1<<T.distbits)-1;e:do{u<15&&(d+=E[n++]<<u,u+=8,d+=E[n++]<<u,u+=8),x=p[d&_];t:for(;;){if(m=x>>>24,d>>>=m,u-=m,m=x>>>16&255,m===0)C[a++]=x&65535;else if(m&16){S=x&65535,m&=15,m&&(u<m&&(d+=E[n++]<<u,u+=8),S+=d&(1<<m)-1,d>>>=m,u-=m),u<15&&(d+=E[n++]<<u,u+=8,d+=E[n++]<<u,u+=8),x=v[d&y];n:for(;;){if(m=x>>>24,d>>>=m,u-=m,m=x>>>16&255,m&16){if(D=x&65535,m&=15,u<m&&(d+=E[n++]<<u,u+=8,u<m&&(d+=E[n++]<<u,u+=8)),D+=d&(1<<m)-1,D>f){i.msg="invalid distance too far back",T.mode=at;break e}if(d>>>=m,u-=m,m=a-r,D>m){if(m=D-m,m>c&&T.sane){i.msg="invalid distance too far back",T.mode=at;break e}if(b=0,k=g,h===0){if(b+=o-m,m<S){S-=m;do C[a++]=g[b++];while(--m);b=a-D,k=C}}else if(h<m){if(b+=o+h-m,m-=h,m<S){S-=m;do C[a++]=g[b++];while(--m);if(b=0,h<S){m=h,S-=m;do C[a++]=g[b++];while(--m);b=a-D,k=C}}}else if(b+=h-m,m<S){S-=m;do C[a++]=g[b++];while(--m);b=a-D,k=C}for(;S>2;)C[a++]=k[b++],C[a++]=k[b++],C[a++]=k[b++],S-=3;S&&(C[a++]=k[b++],S>1&&(C[a++]=k[b++]))}else{b=a-D;do C[a++]=C[b++],C[a++]=C[b++],C[a++]=C[b++],S-=3;while(S>2);S&&(C[a++]=C[b++],S>1&&(C[a++]=C[b++]))}}else if(m&64){i.msg="invalid distance code",T.mode=at;break e}else{x=v[(x&65535)+(d&(1<<m)-1)];continue n}break}}else if(m&64)if(m&32){T.mode=Ga;break e}else{i.msg="invalid literal/length code",T.mode=at;break e}else{x=p[(x&65535)+(d&(1<<m)-1)];continue t}break}}while(n<s&&a<l);S=u>>3,n-=S,u-=S<<3,d&=(1<<u)-1,i.next_in=n,i.next_out=a,i.avail_in=n<s?5+(s-n):5-(n-s),i.avail_out=a<l?257+(l-a):257-(a-l),T.hold=d,T.bits=u},Ce=15,zn=852,Mn=592,Nn=0,$t=1,$n=2,Ya=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Xa=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Qa=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ja=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Ka=(t,i,e,n,s,a,r,l)=>{let f=l.bits,o=0,c=0,h=0,g=0,d=0,u=0,p=0,v=0,_=0,y=0,x,m,S,D,b,k=null,E,C=new Uint16Array(Ce+1),T=new Uint16Array(Ce+1),V=null,U,fe,$;for(o=0;o<=Ce;o++)C[o]=0;for(c=0;c<n;c++)C[i[e+c]]++;for(d=f,g=Ce;g>=1&&C[g]===0;g--);if(d>g&&(d=g),g===0)return s[a++]=1<<24|64<<16|0,s[a++]=1<<24|64<<16|0,l.bits=1,0;for(h=1;h<g&&C[h]===0;h++);for(d<h&&(d=h),v=1,o=1;o<=Ce;o++)if(v<<=1,v-=C[o],v<0)return-1;if(v>0&&(t===Nn||g!==1))return-1;for(T[1]=0,o=1;o<Ce;o++)T[o+1]=T[o]+C[o];for(c=0;c<n;c++)i[e+c]!==0&&(r[T[i[e+c]]++]=c);if(t===Nn?(k=V=r,E=20):t===$t?(k=Ya,V=Xa,E=257):(k=Qa,V=Ja,E=0),y=0,c=0,o=h,b=a,u=d,p=0,S=-1,_=1<<d,D=_-1,t===$t&&_>zn||t===$n&&_>Mn)return 1;for(;;){U=o-p,r[c]+1<E?(fe=0,$=r[c]):r[c]>=E?(fe=V[r[c]-E],$=k[r[c]-E]):(fe=32+64,$=0),x=1<<o-p,m=1<<u,h=m;do m-=x,s[b+(y>>p)+m]=U<<24|fe<<16|$|0;while(m!==0);for(x=1<<o-1;y&x;)x>>=1;if(x!==0?(y&=x-1,y+=x):y=0,c++,--C[o]===0){if(o===g)break;o=i[e+r[c]]}if(o>d&&(y&D)!==S){for(p===0&&(p=d),b+=h,u=o-p,v=1<<u;u+p<g&&(v-=C[u+p],!(v<=0));)u++,v<<=1;if(_+=1<<u,t===$t&&_>zn||t===$n&&_>Mn)return 1;S=y&D,s[S]=d<<24|u<<16|b-a|0}}return y!==0&&(s[b+y]=o-p<<24|64<<16|0),l.bits=d,0},Oe=Ka,er=0,Bi=1,zi=2,{Z_FINISH:Rn,Z_BLOCK:tr,Z_TREES:rt,Z_OK:xe,Z_STREAM_END:nr,Z_NEED_DICT:ir,Z_STREAM_ERROR:W,Z_DATA_ERROR:Mi,Z_MEM_ERROR:Ni,Z_BUF_ERROR:sr,Z_DEFLATED:On}=Ie,pt=16180,Pn=16181,Hn=16182,Zn=16183,Wn=16184,Un=16185,jn=16186,Gn=16187,qn=16188,Yn=16189,ht=16190,K=16191,Rt=16192,Xn=16193,Ot=16194,Qn=16195,Jn=16196,Kn=16197,ei=16198,ot=16199,lt=16200,ti=16201,ni=16202,ii=16203,si=16204,ai=16205,Pt=16206,ri=16207,oi=16208,F=16209,$i=16210,Ri=16211,ar=852,rr=592,or=15,lr=or,li=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function cr(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var be=t=>{if(!t)return 1;let i=t.state;return!i||i.strm!==t||i.mode<pt||i.mode>Ri?1:0},Oi=t=>{if(be(t))return W;let i=t.state;return t.total_in=t.total_out=i.total=0,t.msg="",i.wrap&&(t.adler=i.wrap&1),i.mode=pt,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(ar),i.distcode=i.distdyn=new Int32Array(rr),i.sane=1,i.back=-1,xe},Pi=t=>{if(be(t))return W;let i=t.state;return i.wsize=0,i.whave=0,i.wnext=0,Oi(t)},Hi=(t,i)=>{let e;if(be(t))return W;let n=t.state;return i<0?(e=0,i=-i):(e=(i>>4)+5,i<48&&(i&=15)),i&&(i<8||i>15)?W:(n.window!==null&&n.wbits!==i&&(n.window=null),n.wrap=e,n.wbits=i,Pi(t))},Zi=(t,i)=>{if(!t)return W;let e=new cr;t.state=e,e.strm=t,e.window=null,e.mode=pt;let n=Hi(t,i);return n!==xe&&(t.state=null),n},fr=t=>Zi(t,lr),ci=!0,Ht,Zt,dr=t=>{if(ci){Ht=new Int32Array(512),Zt=new Int32Array(32);let i=0;for(;i<144;)t.lens[i++]=8;for(;i<256;)t.lens[i++]=9;for(;i<280;)t.lens[i++]=7;for(;i<288;)t.lens[i++]=8;for(Oe(Bi,t.lens,0,288,Ht,0,t.work,{bits:9}),i=0;i<32;)t.lens[i++]=5;Oe(zi,t.lens,0,32,Zt,0,t.work,{bits:5}),ci=!1}t.lencode=Ht,t.lenbits=9,t.distcode=Zt,t.distbits=5},Wi=(t,i,e,n)=>{let s,a=t.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(i.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(s=a.wsize-a.wnext,s>n&&(s=n),a.window.set(i.subarray(e-n,e-n+s),a.wnext),n-=s,n?(a.window.set(i.subarray(e-n,e),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0},hr=(t,i)=>{let e,n,s,a,r,l,f,o,c,h,g,d,u,p,v=0,_,y,x,m,S,D,b,k,E=new Uint8Array(4),C,T,V=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(be(t)||!t.output||!t.input&&t.avail_in!==0)return W;e=t.state,e.mode===K&&(e.mode=Rt),r=t.next_out,s=t.output,f=t.avail_out,a=t.next_in,n=t.input,l=t.avail_in,o=e.hold,c=e.bits,h=l,g=f,k=xe;e:for(;;)switch(e.mode){case pt:if(e.wrap===0){e.mode=Rt;break}for(;c<16;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}if(e.wrap&2&&o===35615){e.wbits===0&&(e.wbits=15),e.check=0,E[0]=o&255,E[1]=o>>>8&255,e.check=B(e.check,E,2,0),o=0,c=0,e.mode=Pn;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((o&255)<<8)+(o>>8))%31){t.msg="incorrect header check",e.mode=F;break}if((o&15)!==On){t.msg="unknown compression method",e.mode=F;break}if(o>>>=4,c-=4,b=(o&15)+8,e.wbits===0&&(e.wbits=b),b>15||b>e.wbits){t.msg="invalid window size",e.mode=F;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=o&512?Yn:K,o=0,c=0;break;case Pn:for(;c<16;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}if(e.flags=o,(e.flags&255)!==On){t.msg="unknown compression method",e.mode=F;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=F;break}e.head&&(e.head.text=o>>8&1),e.flags&512&&e.wrap&4&&(E[0]=o&255,E[1]=o>>>8&255,e.check=B(e.check,E,2,0)),o=0,c=0,e.mode=Hn;case Hn:for(;c<32;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}e.head&&(e.head.time=o),e.flags&512&&e.wrap&4&&(E[0]=o&255,E[1]=o>>>8&255,E[2]=o>>>16&255,E[3]=o>>>24&255,e.check=B(e.check,E,4,0)),o=0,c=0,e.mode=Zn;case Zn:for(;c<16;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}e.head&&(e.head.xflags=o&255,e.head.os=o>>8),e.flags&512&&e.wrap&4&&(E[0]=o&255,E[1]=o>>>8&255,e.check=B(e.check,E,2,0)),o=0,c=0,e.mode=Wn;case Wn:if(e.flags&1024){for(;c<16;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}e.length=o,e.head&&(e.head.extra_len=o),e.flags&512&&e.wrap&4&&(E[0]=o&255,E[1]=o>>>8&255,e.check=B(e.check,E,2,0)),o=0,c=0}else e.head&&(e.head.extra=null);e.mode=Un;case Un:if(e.flags&1024&&(d=e.length,d>l&&(d=l),d&&(e.head&&(b=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(a,a+d),b)),e.flags&512&&e.wrap&4&&(e.check=B(e.check,n,d,a)),l-=d,a+=d,e.length-=d),e.length))break e;e.length=0,e.mode=jn;case jn:if(e.flags&2048){if(l===0)break e;d=0;do b=n[a+d++],e.head&&b&&e.length<65536&&(e.head.name+=String.fromCharCode(b));while(b&&d<l);if(e.flags&512&&e.wrap&4&&(e.check=B(e.check,n,d,a)),l-=d,a+=d,b)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=Gn;case Gn:if(e.flags&4096){if(l===0)break e;d=0;do b=n[a+d++],e.head&&b&&e.length<65536&&(e.head.comment+=String.fromCharCode(b));while(b&&d<l);if(e.flags&512&&e.wrap&4&&(e.check=B(e.check,n,d,a)),l-=d,a+=d,b)break e}else e.head&&(e.head.comment=null);e.mode=qn;case qn:if(e.flags&512){for(;c<16;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}if(e.wrap&4&&o!==(e.check&65535)){t.msg="header crc mismatch",e.mode=F;break}o=0,c=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=K;break;case Yn:for(;c<32;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}t.adler=e.check=li(o),o=0,c=0,e.mode=ht;case ht:if(e.havedict===0)return t.next_out=r,t.avail_out=f,t.next_in=a,t.avail_in=l,e.hold=o,e.bits=c,ir;t.adler=e.check=1,e.mode=K;case K:if(i===tr||i===rt)break e;case Rt:if(e.last){o>>>=c&7,c-=c&7,e.mode=Pt;break}for(;c<3;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}switch(e.last=o&1,o>>>=1,c-=1,o&3){case 0:e.mode=Xn;break;case 1:if(dr(e),e.mode=ot,i===rt){o>>>=2,c-=2;break e}break;case 2:e.mode=Jn;break;case 3:t.msg="invalid block type",e.mode=F}o>>>=2,c-=2;break;case Xn:for(o>>>=c&7,c-=c&7;c<32;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}if((o&65535)!==(o>>>16^65535)){t.msg="invalid stored block lengths",e.mode=F;break}if(e.length=o&65535,o=0,c=0,e.mode=Ot,i===rt)break e;case Ot:e.mode=Qn;case Qn:if(d=e.length,d){if(d>l&&(d=l),d>f&&(d=f),d===0)break e;s.set(n.subarray(a,a+d),r),l-=d,a+=d,f-=d,r+=d,e.length-=d;break}e.mode=K;break;case Jn:for(;c<14;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}if(e.nlen=(o&31)+257,o>>>=5,c-=5,e.ndist=(o&31)+1,o>>>=5,c-=5,e.ncode=(o&15)+4,o>>>=4,c-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=F;break}e.have=0,e.mode=Kn;case Kn:for(;e.have<e.ncode;){for(;c<3;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}e.lens[V[e.have++]]=o&7,o>>>=3,c-=3}for(;e.have<19;)e.lens[V[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,C={bits:e.lenbits},k=Oe(er,e.lens,0,19,e.lencode,0,e.work,C),e.lenbits=C.bits,k){t.msg="invalid code lengths set",e.mode=F;break}e.have=0,e.mode=ei;case ei:for(;e.have<e.nlen+e.ndist;){for(;v=e.lencode[o&(1<<e.lenbits)-1],_=v>>>24,y=v>>>16&255,x=v&65535,!(_<=c);){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}if(x<16)o>>>=_,c-=_,e.lens[e.have++]=x;else{if(x===16){for(T=_+2;c<T;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}if(o>>>=_,c-=_,e.have===0){t.msg="invalid bit length repeat",e.mode=F;break}b=e.lens[e.have-1],d=3+(o&3),o>>>=2,c-=2}else if(x===17){for(T=_+3;c<T;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}o>>>=_,c-=_,b=0,d=3+(o&7),o>>>=3,c-=3}else{for(T=_+7;c<T;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}o>>>=_,c-=_,b=0,d=11+(o&127),o>>>=7,c-=7}if(e.have+d>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=F;break}for(;d--;)e.lens[e.have++]=b}}if(e.mode===F)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=F;break}if(e.lenbits=9,C={bits:e.lenbits},k=Oe(Bi,e.lens,0,e.nlen,e.lencode,0,e.work,C),e.lenbits=C.bits,k){t.msg="invalid literal/lengths set",e.mode=F;break}if(e.distbits=6,e.distcode=e.distdyn,C={bits:e.distbits},k=Oe(zi,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,C),e.distbits=C.bits,k){t.msg="invalid distances set",e.mode=F;break}if(e.mode=ot,i===rt)break e;case ot:e.mode=lt;case lt:if(l>=6&&f>=258){t.next_out=r,t.avail_out=f,t.next_in=a,t.avail_in=l,e.hold=o,e.bits=c,qa(t,g),r=t.next_out,s=t.output,f=t.avail_out,a=t.next_in,n=t.input,l=t.avail_in,o=e.hold,c=e.bits,e.mode===K&&(e.back=-1);break}for(e.back=0;v=e.lencode[o&(1<<e.lenbits)-1],_=v>>>24,y=v>>>16&255,x=v&65535,!(_<=c);){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}if(y&&!(y&240)){for(m=_,S=y,D=x;v=e.lencode[D+((o&(1<<m+S)-1)>>m)],_=v>>>24,y=v>>>16&255,x=v&65535,!(m+_<=c);){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}o>>>=m,c-=m,e.back+=m}if(o>>>=_,c-=_,e.back+=_,e.length=x,y===0){e.mode=ai;break}if(y&32){e.back=-1,e.mode=K;break}if(y&64){t.msg="invalid literal/length code",e.mode=F;break}e.extra=y&15,e.mode=ti;case ti:if(e.extra){for(T=e.extra;c<T;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}e.length+=o&(1<<e.extra)-1,o>>>=e.extra,c-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=ni;case ni:for(;v=e.distcode[o&(1<<e.distbits)-1],_=v>>>24,y=v>>>16&255,x=v&65535,!(_<=c);){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}if(!(y&240)){for(m=_,S=y,D=x;v=e.distcode[D+((o&(1<<m+S)-1)>>m)],_=v>>>24,y=v>>>16&255,x=v&65535,!(m+_<=c);){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}o>>>=m,c-=m,e.back+=m}if(o>>>=_,c-=_,e.back+=_,y&64){t.msg="invalid distance code",e.mode=F;break}e.offset=x,e.extra=y&15,e.mode=ii;case ii:if(e.extra){for(T=e.extra;c<T;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}e.offset+=o&(1<<e.extra)-1,o>>>=e.extra,c-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=F;break}e.mode=si;case si:if(f===0)break e;if(d=g-f,e.offset>d){if(d=e.offset-d,d>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=F;break}d>e.wnext?(d-=e.wnext,u=e.wsize-d):u=e.wnext-d,d>e.length&&(d=e.length),p=e.window}else p=s,u=r-e.offset,d=e.length;d>f&&(d=f),f-=d,e.length-=d;do s[r++]=p[u++];while(--d);e.length===0&&(e.mode=lt);break;case ai:if(f===0)break e;s[r++]=e.length,f--,e.mode=lt;break;case Pt:if(e.wrap){for(;c<32;){if(l===0)break e;l--,o|=n[a++]<<c,c+=8}if(g-=f,t.total_out+=g,e.total+=g,e.wrap&4&&g&&(t.adler=e.check=e.flags?B(e.check,s,g,r-g):Ue(e.check,s,g,r-g)),g=f,e.wrap&4&&(e.flags?o:li(o))!==e.check){t.msg="incorrect data check",e.mode=F;break}o=0,c=0}e.mode=ri;case ri:if(e.wrap&&e.flags){for(;c<32;){if(l===0)break e;l--,o+=n[a++]<<c,c+=8}if(e.wrap&4&&o!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=F;break}o=0,c=0}e.mode=oi;case oi:k=nr;break e;case F:k=Mi;break e;case $i:return Ni;case Ri:default:return W}return t.next_out=r,t.avail_out=f,t.next_in=a,t.avail_in=l,e.hold=o,e.bits=c,(e.wsize||g!==t.avail_out&&e.mode<F&&(e.mode<Pt||i!==Rn))&&Wi(t,t.output,t.next_out,g-t.avail_out),h-=t.avail_in,g-=t.avail_out,t.total_in+=h,t.total_out+=g,e.total+=g,e.wrap&4&&g&&(t.adler=e.check=e.flags?B(e.check,s,g,t.next_out-g):Ue(e.check,s,g,t.next_out-g)),t.data_type=e.bits+(e.last?64:0)+(e.mode===K?128:0)+(e.mode===ot||e.mode===Ot?256:0),(h===0&&g===0||i===Rn)&&k===xe&&(k=sr),k},ur=t=>{if(be(t))return W;let i=t.state;return i.window&&(i.window=null),t.state=null,xe},gr=(t,i)=>{if(be(t))return W;let e=t.state;return e.wrap&2?(e.head=i,i.done=!1,xe):W},pr=(t,i)=>{let e=i.length,n,s,a;return be(t)||(n=t.state,n.wrap!==0&&n.mode!==ht)?W:n.mode===ht&&(s=1,s=Ue(s,i,e,0),s!==n.check)?Mi:(a=Wi(t,i,e,e),a?(n.mode=$i,Ni):(n.havedict=1,xe))},vr=Pi,mr=Hi,wr=Oi,_r=fr,xr=Zi,br=hr,Er=ur,yr=gr,Sr=pr,Cr="pako inflate (from Nodeca project)",te={inflateReset:vr,inflateReset2:mr,inflateResetKeep:wr,inflateInit:_r,inflateInit2:xr,inflate:br,inflateEnd:Er,inflateGetHeader:yr,inflateSetDictionary:Sr,inflateInfo:Cr};function kr(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Tr=kr,Ui=Object.prototype.toString,{Z_NO_FLUSH:Dr,Z_FINISH:Lr,Z_OK:qe,Z_STREAM_END:Wt,Z_NEED_DICT:Ut,Z_STREAM_ERROR:Ir,Z_DATA_ERROR:fi,Z_MEM_ERROR:Vr}=Ie;function Je(t){this.options=gt.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});let i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),i.windowBits>=0&&i.windowBits<16&&!(t&&t.windowBits)&&(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&(i.windowBits&15||(i.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ai,this.strm.avail_out=0;let e=te.inflateInit2(this.strm,i.windowBits);if(e!==qe)throw new Error(we[e]);if(this.header=new Tr,te.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=Ge.string2buf(i.dictionary):Ui.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(e=te.inflateSetDictionary(this.strm,i.dictionary),e!==qe)))throw new Error(we[e])}Je.prototype.push=function(t,i){let e=this.strm,n=this.options.chunkSize,s=this.options.dictionary,a,r,l;if(this.ended)return!1;for(i===~~i?r=i:r=i===!0?Lr:Dr,Ui.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),a=te.inflate(e,r),a===Ut&&s&&(a=te.inflateSetDictionary(e,s),a===qe?a=te.inflate(e,r):a===fi&&(a=Ut));e.avail_in>0&&a===Wt&&e.state.wrap>0&&t[e.next_in]!==0;)te.inflateReset(e),a=te.inflate(e,r);switch(a){case Ir:case fi:case Ut:case Vr:return this.onEnd(a),this.ended=!0,!1}if(l=e.avail_out,e.next_out&&(e.avail_out===0||a===Wt))if(this.options.to==="string"){let f=Ge.utf8border(e.output,e.next_out),o=e.next_out-f,c=Ge.buf2string(e.output,f);e.next_out=o,e.avail_out=n-o,o&&e.output.set(e.output.subarray(f,f+o),0),this.onData(c)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(a===qe&&l===0)){if(a===Wt)return a=te.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Je.prototype.onData=function(t){this.chunks.push(t)};Je.prototype.onEnd=function(t){t===qe&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=gt.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function ln(t,i){let e=new Je(i);if(e.push(t),e.err)throw e.msg||we[e.err];return e.result}function Ar(t,i){return i=i||{},i.raw=!0,ln(t,i)}var Fr=Je,Br=ln,zr=Ar,Mr=ln,Nr=Ie,$r={Inflate:Fr,inflate:Br,inflateRaw:zr,ungzip:Mr,constants:Nr},{Deflate:_o,deflate:xo,deflateRaw:bo,gzip:Rr}=ja,{Inflate:Eo,inflate:yo,inflateRaw:So,ungzip:Or}=$r;var ji=Rr;var cn=Or;var Hr={versionFolder:".versions",autoSave:!0,autoSaveInterval:5,autoClear:!0,maxVersions:50,enableMaxVersions:!0,maxDays:30,enableMaxDays:!1,useRelativeTime:!1,diffGranularity:"char",diffViewMode:"unified",enableDeduplication:!0,showNotifications:!0,excludedFolders:[],enableCompression:!0,enableIncrementalStorage:!0,versionsPerPage:20,rebuildBaseInterval:10,autoSaveOnModify:!0,autoSaveDelay:180,autoSaveMinChanges:10,autoSaveOnInterval:!1,autoSaveOnFileSwitch:!0,autoSaveOnFocusLost:!1,enableQuickPreview:!0,enableVersionTags:!0,defaultTags:["\u91CD\u8981","\u91CC\u7A0B\u7891","\u53D1\u5E03","\u5907\u4EFD","\u8349\u7A3F"],showVersionStats:!0,enableStatusBarDiff:!0,showLastSaveTimeInStatusBar:!0},vt=class extends w.Plugin{constructor(){super(...arguments);this.autoSaveTimer=null;this.lastSavedContent=new Map;this.lastModifiedTime=new Map;this.pendingSaves=new Map;this.versionCache=new Map;this.previousActiveFile=null;this.statusBarTimer=null}async onload(){await this.loadSettings(),this.statusBarItem=this.addStatusBarItem(),this.updateStatusBar(),this.settings.enableStatusBarDiff&&(this.statusBarItem.addClass("version-control-statusbar-clickable"),this.statusBarItem.addEventListener("click",()=>{this.quickDiffFromStatusBar()})),this.registerView("version-history",e=>new wt(e,this)),this.addRibbonIcon("history","\u7248\u672C\u5386\u53F2",()=>{this.activateVersionHistoryView()}),this.addCommand({id:"create-version",name:"\u521B\u5EFA\u7248\u672C\u5FEB\u7167",callback:()=>this.createManualVersion()}),this.addCommand({id:"show-version-history",name:"\u663E\u793A\u7248\u672C\u5386\u53F2",callback:()=>this.activateVersionHistoryView()}),this.addCommand({id:"create-full-snapshot",name:"\u521B\u5EFA\u5168\u5E93\u7248\u672C",callback:()=>this.createFullSnapshot()}),this.addCommand({id:"compare-with-version",name:"\u4E0E\u5386\u53F2\u7248\u672C\u5BF9\u6BD4",callback:()=>this.quickCompare()}),this.addCommand({id:"restore-last-version",name:"\u6062\u590D\u5230\u4E0A\u4E00\u7248\u672C",callback:()=>this.restoreLastVersion()}),this.addCommand({id:"optimize-storage",name:"\u4F18\u5316\u5B58\u50A8\u7A7A\u95F4",callback:()=>this.optimizeAllVersionFiles()}),this.addCommand({id:"quick-preview-version",name:"\u5FEB\u901F\u9884\u89C8\u4E0A\u4E00\u7248\u672C",callback:()=>this.quickPreviewLastVersion()}),this.addCommand({id:"star-current-version",name:"\u6807\u8BB0\u5F53\u524D\u7248\u672C\u4E3A\u91CD\u8981",callback:()=>this.starLastVersion()}),this.addSettingTab(new gn(this.app,this)),this.registerEvent(this.app.vault.on("modify",e=>{e instanceof w.TFile&&this.settings.autoSave&&this.settings.autoSaveOnModify&&this.scheduleAutoSave(e)})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.statusBarTimer&&(clearInterval(this.statusBarTimer),this.statusBarTimer=null),this.settings.autoSave&&this.settings.autoSaveOnFileSwitch&&this.handleFileSwitch(),this.updateStatusBar()})),this.settings.autoSaveOnFocusLost&&this.registerDomEvent(window,"blur",()=>{this.settings.autoSave&&this.saveCurrentFileOnFocusLost()}),this.settings.autoSave&&this.settings.autoSaveOnInterval&&this.startAutoSave(),await this.ensureVersionFolder(),this.settings.showNotifications&&new w.Notice("\u2705 \u7248\u672C\u63A7\u5236\u63D2\u4EF6\u5DF2\u542F\u52A8")}onunload(){this.autoSaveTimer&&clearInterval(this.autoSaveTimer),this.statusBarTimer&&clearInterval(this.statusBarTimer),this.pendingSaves.forEach(e=>clearTimeout(e)),this.pendingSaves.clear(),this.versionCache.clear()}async loadSettings(){this.settings=Object.assign({},Hr,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.updateStatusBar()}async updateStatusBar(){if(!this.settings.autoSave){this.statusBarItem.setText("\u23F8 \u7248\u672C\u63A7\u5236: \u5DF2\u6682\u505C"),this.statusBarItem.title="\u81EA\u52A8\u4FDD\u5B58\u5DF2\u6682\u505C";return}let e=this.app.workspace.getActiveFile();if(!this.settings.showLastSaveTimeInStatusBar||!e){this.statusBarItem.setText("\u23F1 \u7248\u672C\u63A7\u5236: \u5DF2\u542F\u7528"),this.statusBarItem.title="\u70B9\u51FB\u53EF\u5FEB\u901F\u5BF9\u6BD4\u5F53\u524D\u6587\u4EF6\u4E0E\u6700\u65B0\u7248\u672C";return}let n=this.lastModifiedTime.get(e.path);if(!n){let s=await this.getAllVersions(e.path);s.length>0&&(n=s[0].timestamp,this.lastModifiedTime.set(e.path,n))}if(n){let s=this.getRelativeTime(n);this.statusBarItem.setText(`\u4E0A\u6B21\u4FDD\u5B58: ${s}`),this.statusBarItem.title=`\u4E0A\u6B21\u4FDD\u5B58\u4E8E ${new Date(n).toLocaleString("zh-CN")}. \u70B9\u51FB\u53EF\u5FEB\u901F\u5BF9\u6BD4\u3002`}else this.statusBarItem.setText("\u23F1 \u7248\u672C\u63A7\u5236: \u5DF2\u542F\u7528"),this.statusBarItem.title="\u5F53\u524D\u6587\u4EF6\u65E0\u5386\u53F2\u7248\u672C\u3002\u70B9\u51FB\u53EF\u5FEB\u901F\u5BF9\u6BD4\u3002"}async quickDiffFromStatusBar(){if(!this.settings.enableStatusBarDiff)return;let e=this.app.workspace.getActiveFile();if(!e){new w.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let n=await this.getAllVersions(e.path);if(n.length===0){new w.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u5BF9\u6BD4");return}let s=n[0];new ce(this.app,this,e,s.id).open()}async ensureVersionFolder(){let e=this.app.vault.adapter,n=this.settings.versionFolder;try{await e.exists(n)||await e.mkdir(n)}catch(s){console.error("\u521B\u5EFA\u7248\u672C\u6587\u4EF6\u5939\u5931\u8D25:",s),new w.Notice("\u26A0\uFE0F \u65E0\u6CD5\u521B\u5EFA\u7248\u672C\u6587\u4EF6\u5939,\u8BF7\u68C0\u67E5\u6743\u9650")}}async activateVersionHistoryView(){let{workspace:e}=this.app,n=e.getLeavesOfType("version-history")[0];if(!n){let s=e.getRightLeaf(!1);if(!s){new w.Notice("\u65E0\u6CD5\u6253\u5F00\u7248\u672C\u5386\u53F2\u89C6\u56FE");return}n=s,await n.setViewState({type:"version-history",active:!0})}e.revealLeaf(n)}startAutoSave(){this.autoSaveTimer&&clearInterval(this.autoSaveTimer),this.settings.autoSaveOnInterval&&(this.autoSaveTimer=setInterval(()=>{this.autoSaveCurrentFile()},this.settings.autoSaveInterval*60*1e3))}scheduleAutoSave(e){if(this.isExcluded(e.path))return;let n=this.pendingSaves.get(e.path);n&&clearTimeout(n);let s=setTimeout(()=>{this.autoSaveFile(e),this.pendingSaves.delete(e.path)},this.settings.autoSaveDelay*1e3);this.pendingSaves.set(e.path,s)}async autoSaveFile(e){try{let n=await this.app.vault.read(e),s=this.lastSavedContent.get(e.path)||"";if(n===s||this.countChanges(s,n)<this.settings.autoSaveMinChanges)return;await this.createVersion(e,"[Auto Save]",!1),this.lastSavedContent.set(e.path,n)}catch(n){console.error("\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25:",n)}}countChanges(e,n){let s=ge(e,n),a=0;for(let r of s)(r.added||r.removed)&&(a+=r.value.length);return a}async handleFileSwitch(){let e=this.app.workspace.getActiveFile();if(this.previousActiveFile&&this.previousActiveFile!==e){let n=this.pendingSaves.get(this.previousActiveFile.path);n&&(clearTimeout(n),this.pendingSaves.delete(this.previousActiveFile.path),await this.autoSaveFile(this.previousActiveFile))}this.previousActiveFile=e}async saveCurrentFileOnFocusLost(){let e=this.app.workspace.getActiveFile();if(!e||this.isExcluded(e.path))return;let n=this.pendingSaves.get(e.path);n&&(clearTimeout(n),this.pendingSaves.delete(e.path)),await this.autoSaveFile(e)}async autoSaveCurrentFile(){let e=this.app.workspace.getActiveFile();!e||this.isExcluded(e.path)||await this.autoSaveFile(e)}isExcluded(e){return this.settings.excludedFolders.some(n=>e.startsWith(n))}async createManualVersion(){let e=this.app.workspace.getActiveFile();if(!e){new w.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}new hn(this.app,this.settings,async(n,s)=>{await this.createVersion(e,n,!0,s),this.settings.showNotifications&&new w.Notice("\u2705 \u7248\u672C\u5DF2\u521B\u5EFA")}).open()}async createVersion(e,n,s=!1,a=[]){try{let r=await this.app.vault.read(e),l=Date.now(),f=`${l}-${Math.random().toString(36).substring(2,9)}`,o=this.hashContent(r),c=await this.loadVersionFile(e.path);if(this.settings.enableDeduplication){let u=c.versions[0];if(u&&u.hash===o){s&&this.settings.showNotifications&&new w.Notice("\u2139\uFE0F \u5185\u5BB9\u672A\u53D8\u5316,\u8DF3\u8FC7\u521B\u5EFA\u7248\u672C");return}}let h,g=0,d=0;if(c.versions.length>0){let u=await this.getVersionContent(e.path,c.versions[0].id);O(u,r).forEach(v=>{v.added&&(g+=v.count||0),v.removed&&(d+=v.count||0)})}else g=r.split(`
`).length;if(this.settings.enableIncrementalStorage&&c.versions.length>0)if(c.versions.length%this.settings.rebuildBaseInterval===0||!c.baseVersion)h={id:f,timestamp:l,message:n,content:r,size:r.length,hash:o,tags:a.length>0?a:void 0,starred:!1,addedLines:g,removedLines:d},c.baseVersion=r;else{let p=c.baseVersion||"",v=this.createDiff(p,r);h={id:f,timestamp:l,message:n,diff:v,baseVersionId:c.versions[0].id,size:v.length,hash:o,tags:a.length>0?a:void 0,starred:!1,addedLines:g,removedLines:d}}else h={id:f,timestamp:l,message:n,content:r,size:r.length,hash:o,tags:a.length>0?a:void 0,starred:!1,addedLines:g,removedLines:d},this.settings.enableIncrementalStorage&&(c.baseVersion=r);c.versions.unshift(h),c.lastModified=l,this.settings.autoClear&&this.cleanupVersionsInMemory(c),this.buildVersionIndex(c),await this.saveVersionFile(e.path,c),this.versionCache.set(e.path,c),this.refreshVersionHistoryView(),this.lastModifiedTime.set(e.path,l),this.updateStatusBar(),this.statusBarTimer&&clearInterval(this.statusBarTimer),this.statusBarTimer=setInterval(()=>{let u=this.lastModifiedTime.get(e.path),p=this.app.workspace.getActiveFile();!u||Date.now()-u>=60*1e3||(p==null?void 0:p.path)!==e.path?(this.statusBarTimer&&(clearInterval(this.statusBarTimer),this.statusBarTimer=null),(p==null?void 0:p.path)===e.path&&this.updateStatusBar()):this.updateStatusBar()},1e3),s&&this.settings.showNotifications&&new w.Notice(`\u2705 \u7248\u672C\u5DF2\u521B\u5EFA: ${n}`)}catch(r){console.error("\u521B\u5EFA\u7248\u672C\u5931\u8D25:",r),new w.Notice("\u274C \u521B\u5EFA\u7248\u672C\u5931\u8D25,\u8BF7\u67E5\u770B\u63A7\u5236\u53F0")}}createDiff(e,n){return Vt("file",e,n,"","")}applyDiff(e,n){try{let s=Lt(e,n);if(s===!1){console.error("\u5E94\u7528\u5DEE\u5F02\u5931\u8D25: applyPatch returned false");try{let a=JSON.parse(n),r="";for(let l of a)l.removed||(r+=l.value);return r}catch(a){return e}}return s}catch(s){return console.error("\u5E94\u7528\u5DEE\u5F02\u5931\u8D25:",s),e}}buildVersionIndex(e){let n=new Map;e.versions.forEach((s,a)=>{n.set(s.id,a)}),e.versionIndex=n}hashContent(e){let n=0;for(let s=0;s<e.length;s++){let a=e.charCodeAt(s);n=(n<<5)-n+a,n=n&n}return n.toString(36)}cleanupVersionsInMemory(e){let n=e.versions,s=n.filter(l=>l.starred),a=n.filter(l=>!l.starred);if(this.settings.enableMaxVersions){let l=Math.max(this.settings.maxVersions-s.length,10);a=a.slice(0,l)}if(this.settings.enableMaxDays){let l=Date.now()-this.settings.maxDays*24*60*60*1e3;a=a.filter(f=>f.timestamp>=l)}n=[...s,...a].sort((l,f)=>f.timestamp-l.timestamp);let r=e.versions.length-n.length;return e.versions=n,r}async loadVersionFile(e){if(this.versionCache.has(e))return this.versionCache.get(e);let n=this.getVersionFilePath(e),s=this.app.vault.adapter;try{if(await s.exists(n)){let r;if(this.settings.enableCompression)try{let f=await s.readBinary(n);r=cn(new Uint8Array(f),{to:"string"})}catch(f){r=await s.read(n)}else r=await s.read(n);let l=JSON.parse(r);return l.versionIndex||this.buildVersionIndex(l),this.versionCache.set(e,l),l}}catch(r){console.error("\u52A0\u8F7D\u7248\u672C\u6587\u4EF6\u5931\u8D25:",r)}let a={filePath:e,versions:[],lastModified:Date.now()};return this.versionCache.set(e,a),a}async saveVersionFile(e,n){let s=this.getVersionFilePath(e),a=this.app.vault.adapter;try{let r={...n,versionIndex:void 0},l=JSON.stringify(r,null,2);if(this.settings.enableCompression){let f=ji(l);await a.writeBinary(s,f.buffer)}else await a.write(s,l)}catch(r){throw console.error("\u4FDD\u5B58\u7248\u672C\u6587\u4EF6\u5931\u8D25:",r),r}}getVersionFilePath(e){let n=this.sanitizeFileName(e);return`${this.settings.versionFolder}/${n}.json`}async getVersions(e,n=0){try{let s=await this.loadVersionFile(e);if(this.settings.versionsPerPage>0){let a=n*this.settings.versionsPerPage,r=a+this.settings.versionsPerPage;return s.versions.slice(a,r)}return s.versions}catch(s){return console.error("\u83B7\u53D6\u7248\u672C\u5217\u8868\u5931\u8D25:",s),[]}}async getAllVersions(e){try{return(await this.loadVersionFile(e)).versions}catch(n){return console.error("\u83B7\u53D6\u7248\u672C\u5217\u8868\u5931\u8D25:",n),[]}}async getVersionContent(e,n){var s;try{let a=await this.loadVersionFile(e),r=(s=a.versionIndex)==null?void 0:s.get(n),l=r!==void 0?a.versions[r]:a.versions.find(f=>f.id===n);if(!l)throw new Error("\u7248\u672C\u4E0D\u5B58\u5728");if(l.content)return l.content;if(l.diff&&a.baseVersion)return this.applyDiff(a.baseVersion,l.diff);if(l.diff&&l.baseVersionId){let f=await this.getVersionContent(e,l.baseVersionId);return this.applyDiff(f,l.diff)}throw new Error("\u65E0\u6CD5\u83B7\u53D6\u7248\u672C\u5185\u5BB9")}catch(a){throw console.error("\u8BFB\u53D6\u7248\u672C\u5185\u5BB9\u5931\u8D25:",a),new Error("\u65E0\u6CD5\u8BFB\u53D6\u7248\u672C\u5185\u5BB9")}}async updateVersionTags(e,n,s){var a;try{let r=await this.loadVersionFile(e),l=(a=r.versionIndex)==null?void 0:a.get(n);l!==void 0&&(r.versions[l].tags=s.length>0?s:void 0,await this.saveVersionFile(e,r),this.versionCache.set(e,r),this.refreshVersionHistoryView())}catch(r){console.error("\u66F4\u65B0\u7248\u672C\u6807\u7B7E\u5931\u8D25:",r)}}async updateVersionNote(e,n,s){var a;try{let r=await this.loadVersionFile(e),l=(a=r.versionIndex)==null?void 0:a.get(n);l!==void 0&&(r.versions[l].note=s.trim()||void 0,await this.saveVersionFile(e,r),this.versionCache.set(e,r),this.refreshVersionHistoryView())}catch(r){console.error("\u66F4\u65B0\u7248\u672C\u5907\u6CE8\u5931\u8D25:",r)}}async toggleVersionStar(e,n){var s;try{let a=await this.loadVersionFile(e),r=(s=a.versionIndex)==null?void 0:s.get(n);r!==void 0&&(a.versions[r].starred=!a.versions[r].starred,await this.saveVersionFile(e,a),this.versionCache.set(e,a),this.refreshVersionHistoryView())}catch(a){console.error("\u5207\u6362\u661F\u6807\u5931\u8D25:",a)}}async starLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new w.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let n=await this.getAllVersions(e.path);if(n.length===0){new w.Notice("\u6CA1\u6709\u53EF\u6807\u8BB0\u7684\u7248\u672C");return}await this.toggleVersionStar(e.path,n[0].id),new w.Notice("\u2B50 \u5DF2\u6807\u8BB0/\u53D6\u6D88\u6807\u8BB0")}async quickPreviewLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new w.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let n=await this.getAllVersions(e.path);if(n.length===0){new w.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u9884\u89C8");return}new mt(this.app,this,e,n[0].id).open()}async deleteVersion(e,n){try{let s=await this.loadVersionFile(e);s.versions=s.versions.filter(a=>a.id!==n),s.lastModified=Date.now(),this.buildVersionIndex(s),await this.saveVersionFile(e,s),this.versionCache.set(e,s)}catch(s){console.error("\u5220\u9664\u7248\u672C\u5931\u8D25:",s)}}async deleteVersions(e,n){try{let s=await this.loadVersionFile(e),a=new Set(n);s.versions=s.versions.filter(r=>!a.has(r.id)),s.lastModified=Date.now(),this.buildVersionIndex(s),await this.saveVersionFile(e,s),this.versionCache.set(e,s)}catch(s){console.error("\u6279\u91CF\u5220\u9664\u7248\u672C\u5931\u8D25:",s)}}async restoreVersion(e,n){try{await this.createVersion(e,"[Before Restore]",!1);let s=await this.getVersionContent(e.path,n);await this.app.vault.modify(e,s),this.settings.showNotifications&&new w.Notice("\u2705 \u7248\u672C\u5DF2\u6062\u590D"),this.refreshVersionHistoryView()}catch(s){console.error("\u6062\u590D\u7248\u672C\u5931\u8D25:",s),new w.Notice("\u274C \u6062\u590D\u7248\u672C\u5931\u8D25")}}async restoreLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new w.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let n=await this.getAllVersions(e.path);if(n.length===0){new w.Notice("\u6CA1\u6709\u53EF\u6062\u590D\u7684\u7248\u672C");return}let s=n[0];new le(this.app,"\u6062\u590D\u5230\u4E0A\u4E00\u7248\u672C",`\u786E\u5B9A\u8981\u6062\u590D\u5230\u7248\u672C: ${this.formatTime(s.timestamp)}?

\u5F53\u524D\u672A\u4FDD\u5B58\u7684\u4FEE\u6539\u5C06\u4F1A\u4E22\u5931,\u63D2\u4EF6\u4F1A\u5728\u6062\u590D\u524D\u81EA\u52A8\u521B\u5EFA\u5907\u4EFD\u7248\u672C\u3002`,async()=>{await this.restoreVersion(e,s.id)}).open()}async quickCompare(){let e=this.app.workspace.getActiveFile();if(!e){new w.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let n=await this.getAllVersions(e.path);if(n.length===0){new w.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u5BF9\u6BD4");return}let s=n[0];new ce(this.app,this,e,s.id).open()}async createFullSnapshot(){let e=this.app.vault.getMarkdownFiles(),n=0,s=0,a=new w.Notice("\u6B63\u5728\u521B\u5EFA\u5168\u5E93\u7248\u672C...",0);for(let r of e){if(this.isExcluded(r.path)){s++;continue}try{await this.createVersion(r,"[Full Snapshot]",!1),n++}catch(l){console.error(`\u521B\u5EFA\u7248\u672C\u5931\u8D25: ${r.path}`,l)}}a.hide(),this.settings.showNotifications&&new w.Notice(`\u2705 \u5168\u5E93\u7248\u672C\u5DF2\u521B\u5EFA
\u6210\u529F: ${n} \u4E2A\u6587\u4EF6${s>0?`
\u8DF3\u8FC7: ${s} \u4E2A\u6587\u4EF6`:""}`)}async optimizeAllVersionFiles(){var n,s;let e=new w.Notice("\u6B63\u5728\u4F18\u5316\u5B58\u50A8...",0);try{let a=this.app.vault.adapter,r=this.settings.versionFolder;if(!await a.exists(r)){e.hide(),new w.Notice("\u7248\u672C\u6587\u4EF6\u5939\u4E0D\u5B58\u5728");return}let l=await a.list(r),f=0,o=0;for(let c of l.files)if(c.endsWith(".json"))try{let h=((n=await a.stat(c))==null?void 0:n.size)||0,g=await a.read(c),d=JSON.parse(g);this.buildVersionIndex(d),await this.saveVersionFile(d.filePath,d);let u=((s=await a.stat(c))==null?void 0:s.size)||0;o+=h-u,f++}catch(h){console.error("\u4F18\u5316\u6587\u4EF6\u5931\u8D25:",c,h)}e.hide(),new w.Notice(`\u2705 \u4F18\u5316\u5B8C\u6210
\u5904\u7406: ${f} \u4E2A\u6587\u4EF6
\u8282\u7701: ${this.formatFileSize(o)}`)}catch(a){e.hide(),console.error("\u4F18\u5316\u5931\u8D25:",a),new w.Notice("\u274C \u4F18\u5316\u5931\u8D25")}}async getStorageStats(){let e=this.app.vault.adapter,n=this.settings.versionFolder;try{if(!await e.exists(n))return{totalSize:0,versionCount:0,fileCount:0,compressionRatio:0,starredCount:0,taggedCount:0};let s=await e.list(n),a=0,r=0,l=0,f=0,o=0,c=0;for(let g of s.files)if(g.endsWith(".json"))try{let d=await e.stat(g),u=(d==null?void 0:d.size)||0;a+=u;let p;if(this.settings.enableCompression)try{let v=await e.readBinary(g),_=cn(new Uint8Array(v),{to:"string"});p=JSON.parse(_)}catch(v){let _=await e.read(g);p=JSON.parse(_)}else{let v=await e.read(g);p=JSON.parse(v)}p.versions&&Array.isArray(p.versions)&&(r+=p.versions.length,p.versions.forEach(v=>{v.content?f+=v.content.length:v.diff&&(f+=v.diff.length),v.starred&&o++,v.tags&&v.tags.length>0&&c++}),l++)}catch(d){console.error("\u8BFB\u53D6\u7248\u672C\u6587\u4EF6\u5931\u8D25:",g,d)}let h=f>0?(1-a/f)*100:0;return{totalSize:a,versionCount:r,fileCount:l,compressionRatio:h,starredCount:o,taggedCount:c}}catch(s){return console.error("\u83B7\u53D6\u5B58\u50A8\u7EDF\u8BA1\u5931\u8D25:",s),{totalSize:0,versionCount:0,fileCount:0,compressionRatio:0,starredCount:0,taggedCount:0}}}async exportVersions(e){try{let n=await this.loadVersionFile(e),s=`${this.settings.versionFolder}/export_${Date.now()}.json`;await this.app.vault.adapter.write(s,JSON.stringify(n,null,2)),new w.Notice(`\u2705 \u7248\u672C\u5DF2\u5BFC\u51FA\u5230: ${s}`)}catch(n){console.error("\u5BFC\u51FA\u7248\u672C\u5931\u8D25:",n),new w.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}async exportVersionAsFile(e,n){try{let s=await this.getVersionContent(e,n),r=`${e.replace(/\.[^/.]+$/,"")}_v${n}.md`;await this.app.vault.create(r,s),new w.Notice(`\u2705 \u7248\u672C\u5DF2\u5BFC\u51FA\u4E3A: ${r}`)}catch(s){console.error("\u5BFC\u51FA\u7248\u672C\u4E3A\u6587\u4EF6\u5931\u8D25:",s),new w.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}sanitizeFileName(e){return e.replace(/[\/\\:*?"<>|]/g,"_")}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`}formatTime(e){return this.settings.useRelativeTime?this.getRelativeTime(e):new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}getRelativeTime(e){let n=Date.now()-e,s=Math.floor(n/1e3),a=Math.floor(s/60),r=Math.floor(a/60),l=Math.floor(r/24),f=Math.floor(l/30),o=Math.floor(l/365);return o>0?`${o} \u5E74\u524D`:f>0?`${f} \u4E2A\u6708\u524D`:l>0?`${l} \u5929\u524D`:r>0?`${r} \u5C0F\u65F6\u524D`:a>0?`${a} \u5206\u949F\u524D`:s<5?"\u521A\u521A":`${s} \u79D2\u524D`}refreshVersionHistoryView(){this.app.workspace.getLeavesOfType("version-history").forEach(n=>{n.view instanceof wt&&n.view.refresh()})}},mt=class extends w.Modal{constructor(e,n,s,a){super(e);this.isRenderedView=!0;this.plugin=n,this.file=s,this.versionId=a}async onOpen(){let{contentEl:e}=this;e.addClass("quick-preview-modal");try{this.versionContent=await this.plugin.getVersionContent(this.file.path,this.versionId);let s=(await this.plugin.getAllVersions(this.file.path)).find(u=>u.id===this.versionId),a=e.createEl("div",{cls:"preview-header"});if(a.createEl("h2",{text:"\u{1F4C4} \u5FEB\u901F\u9884\u89C8"}),s){let u=a.createEl("div",{cls:"preview-info"});u.createEl("span",{text:`\u23F0 ${this.plugin.formatTime(s.timestamp)}`,cls:"preview-time"}),u.createEl("span",{text:`\u{1F4AC} ${s.message}`,cls:"preview-message"}),u.createEl("span",{text:`\u{1F4E6} ${this.plugin.formatFileSize(s.size)}`,cls:"preview-size"})}let r=e.createEl("div",{cls:"preview-toolbar"});this.toggleButton=r.createEl("button",{text:"\u{1F453} \u5207\u6362\u539F\u59CB\u6587\u672C"}),this.toggleButton.addEventListener("click",()=>{this.isRenderedView=!this.isRenderedView,this.renderContent()}),r.createEl("button",{text:"\u{1F4CB} \u590D\u5236\u5185\u5BB9",cls:"mod-cta"}).addEventListener("click",()=>{navigator.clipboard.writeText(this.versionContent).then(()=>{new w.Notice("\u2705 \u5185\u5BB9\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(()=>{new w.Notice("\u274C \u590D\u5236\u5931\u8D25")})}),r.createEl("button",{text:"\u21A9\uFE0F \u6062\u590D\u6B64\u7248\u672C"}).addEventListener("click",async()=>{this.close(),await this.plugin.restoreVersion(this.file,this.versionId)}),r.createEl("button",{text:"\u{1F500} \u8BE6\u7EC6\u5BF9\u6BD4"}).addEventListener("click",()=>{this.close(),new ce(this.app,this.plugin,this.file,this.versionId).open()}),r.createEl("button",{text:"\u{1F4BE} \u5BFC\u51FA\u6587\u4EF6"}).addEventListener("click",async()=>{await this.plugin.exportVersionAsFile(this.file.path,this.versionId)}),this.contentContainer=e.createEl("div",{cls:"preview-content-container"}),this.renderContent();let h=e.createEl("div",{cls:"preview-stats-bar"}),g=this.versionContent.split(`
`);h.createEl("span",{text:`\u{1F4DD} ${g.length} \u884C`}),h.createEl("span",{text:`\u{1F524} ${this.versionContent.length} \u5B57\u7B26`});let d=this.versionContent.split(/\s+/).filter(u=>u.length>0).length;h.createEl("span",{text:`\u{1F4C4} ${d} \u8BCD`})}catch(n){e.createEl("p",{text:"\u274C \u52A0\u8F7D\u9884\u89C8\u5931\u8D25"}),console.error("\u9884\u89C8\u52A0\u8F7D\u5931\u8D25:",n)}}async renderContent(){if(this.contentContainer.empty(),this.isRenderedView){this.toggleButton.setText("\u{1F453} \u5207\u6362\u539F\u59CB\u6587\u672C");let e=this.contentContainer.createEl("div",{cls:"preview-rendered-content"});await w.MarkdownRenderer.renderMarkdown(this.versionContent,e,this.file.path,this.plugin)}else{this.toggleButton.setText("\u{1F4D6} \u5207\u6362\u6E32\u67D3\u89C6\u56FE");let e=this.contentContainer.createEl("div",{cls:"preview-raw-container"}),n=this.versionContent.split(`
`),s=e.createEl("div",{cls:"preview-line-numbers"});n.forEach((r,l)=>{s.createEl("div",{text:String(l+1),cls:"line-number"})}),e.createEl("pre").createEl("code",{text:this.versionContent})}}onClose(){let{contentEl:e}=this;e.empty()}},wt=class extends w.ItemView{constructor(e,n){super(e);this.selectedVersions=new Set;this.currentFile=null;this.searchQuery="";this.currentPage=0;this.totalVersions=0;this.filterTag=null;this.showStarredOnly=!1;this.plugin=n}getViewType(){return"version-history"}getDisplayText(){return"\u7248\u672C\u5386\u53F2"}getIcon(){return"history"}async onOpen(){this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.currentPage=0,this.refresh()})),await this.refresh()}getRelativeDateGroup(e){let n=new Date,s=new Date(e),a=new Date(n.getFullYear(),n.getMonth(),n.getDate()),r=new Date(n.getFullYear(),n.getMonth(),n.getDate()-1),l=new Date(s.getFullYear(),s.getMonth(),s.getDate());return l.getTime()===a.getTime()?"\u4ECA\u5929":l.getTime()===r.getTime()?"\u6628\u5929":n.getFullYear()===s.getFullYear()&&n.getMonth()===s.getMonth()?"\u672C\u6708":n.getFullYear()===s.getFullYear()?`${s.getMonth()+1}\u6708`:`${s.getFullYear()}\u5E74`}async calculateAndCacheDiffStats(e,n){let s=e.versions[n];if(!(typeof s.addedLines=="number"&&typeof s.removedLines=="number"))try{let a=await this.plugin.getVersionContent(e.filePath,s.id),r=e.versions[n+1],l=0,f=0;if(r){let o=await this.plugin.getVersionContent(e.filePath,r.id);O(o,a).forEach(h=>{h.added&&(l+=h.count||0),h.removed&&(f+=h.count||0)})}else l=a.split(`
`).length;s.addedLines=l,s.removedLines=f,this.plugin.saveVersionFile(e.filePath,e).catch(o=>{console.error("Failed to save version file after caching diff stats:",o)}),this.refresh()}catch(a){console.error(`Failed to calculate diff stats for version ${s.id}:`,a)}}async refresh(){let e=this.containerEl.children[1];e.empty(),e.addClass("version-history-view");let n=this.app.workspace.getActiveFile();if(this.currentFile=n,!n){this.renderEmptyState(e,"\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6");return}let s=e.createEl("div",{cls:"version-header"}),a=s.createEl("div",{cls:"version-title"});a.createEl("h3",{text:n.basename}),a.createEl("span",{text:n.path,cls:"version-file-path"});let r=s.createEl("div",{cls:"version-file-stats"});try{let b=await this.app.vault.read(n),k=await this.app.vault.adapter.stat(n.path);r.createEl("span",{text:`\u{1F4C4} \u5927\u5C0F: ${this.plugin.formatFileSize(b.length)}`,cls:"file-stat-item"}),k&&r.createEl("span",{text:`\u{1F4C5} \u4FEE\u6539: ${new Date(k.mtime).toLocaleString("zh-CN")}`,cls:"file-stat-item"})}catch(b){console.error("\u83B7\u53D6\u6587\u4EF6\u4FE1\u606F\u5931\u8D25:",b)}let l=s.createEl("div",{cls:"version-header-actions"}),f=l.createEl("input",{type:"text",placeholder:"\u641C\u7D22\u7248\u672C...",cls:"version-search"});f.value=this.searchQuery,f.addEventListener("input",b=>{this.searchQuery=b.target.value,this.currentPage=0,this.refresh()}),l.createEl("button",{text:this.showStarredOnly?"\u5DF2\u7B5B\u9009\u661F\u6807":"\u7B5B\u9009\u661F\u6807",cls:this.showStarredOnly?"mod-cta":"",attr:{title:"\u4EC5\u663E\u793A\u661F\u6807\u7248\u672C"}}).addEventListener("click",()=>{this.showStarredOnly=!this.showStarredOnly,this.currentPage=0,this.refresh()}),l.createEl("button",{text:"+ \u521B\u5EFA",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),l.createEl("button",{text:"\u66F4\u591A",attr:{title:"\u66F4\u591A\u64CD\u4F5C"}}).addEventListener("click",b=>{let k=new w.Menu;k.addItem(E=>E.setTitle("\u{1F4CA} \u67E5\u770B\u7EDF\u8BA1").setIcon("bar-chart").onClick(()=>{this.showDetailedStats()})),k.addItem(E=>E.setTitle("\u{1F4E5} \u5BFC\u51FA\u7248\u672C\u6570\u636E").setIcon("download").onClick(()=>{this.plugin.exportVersions(n.path)})),k.addItem(E=>E.setTitle("\u{1F4C2} \u521B\u5EFA\u5168\u5E93\u7248\u672C").setIcon("folder").onClick(()=>{this.plugin.createFullSnapshot()})),k.addItem(E=>E.setTitle("\u{1F5D1}\uFE0F \u6E05\u7406\u65E7\u7248\u672C").setIcon("trash").onClick(async()=>{await this.cleanupOldVersions(n)})),k.showAtMouseEvent(b)});let g=await this.plugin.loadVersionFile(n.path),d=g.versions;if(this.totalVersions=d.length,this.totalVersions===0){this.renderEmptyState(e,"\u6682\u65E0\u7248\u672C\u5386\u53F2");return}if(d.length>0)try{let b=await this.app.vault.read(n),k=d[0],E=await this.plugin.getVersionContent(n.path,k.id);if(b!==E){let C=O(E,b),T=0,V=0;C.forEach(ne=>{ne.added&&(T+=ne.count||0),ne.removed&&(V+=ne.count||0)});let U=e.createEl("div",{cls:"version-diff-banner"});U.createEl("span",{text:"\u26A0\uFE0F \u6587\u4EF6\u5DF2\u4FEE\u6539"}),U.createEl("span",{text:`+${T} -${V}`,cls:"diff-stats"}),U.createEl("button",{text:"\u{1F4BE} \u7ACB\u5373\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),U.createEl("button",{text:"\u{1F441}\uFE0F \u67E5\u770B\u5DEE\u5F02"}).addEventListener("click",()=>{new ce(this.app,this.plugin,n,k.id).open()})}}catch(b){console.error("\u68C0\u67E5\u6587\u4EF6\u5DEE\u5F02\u5931\u8D25:",b)}let u=d;if(this.showStarredOnly&&(u=u.filter(b=>b.starred)),this.filterTag&&(u=u.filter(b=>b.tags&&b.tags.includes(this.filterTag))),this.searchQuery&&(u=u.filter(b=>b.message.toLowerCase().includes(this.searchQuery.toLowerCase())||this.plugin.formatTime(b.timestamp).toLowerCase().includes(this.searchQuery.toLowerCase())||b.tags&&b.tags.some(k=>k.toLowerCase().includes(this.searchQuery.toLowerCase())))),u.length===0){this.renderEmptyState(e,"\u672A\u627E\u5230\u5339\u914D\u7684\u7248\u672C");return}let p=this.plugin.settings.versionsPerPage||u.length,v=Math.ceil(u.length/p),_=this.currentPage*p,y=Math.min(_+p,u.length),x=u.slice(_,y);if(this.selectedVersions.size>0){let b=e.createEl("div",{cls:"version-toolbar"});b.createEl("span",{text:`\u5DF2\u9009\u62E9 ${this.selectedVersions.size} \u4E2A\u7248\u672C`}),b.createEl("button",{text:"\u6E05\u7A7A\u9009\u62E9"}).addEventListener("click",()=>{this.selectedVersions.clear(),this.refresh()}),b.createEl("button",{text:"\u6279\u91CF\u5220\u9664",cls:"mod-warning"}).addEventListener("click",()=>this.batchDelete(n))}let m=e.createEl("div",{cls:"version-list"}),S={};x.forEach(b=>{let k=this.getRelativeDateGroup(b.timestamp);S[k]||(S[k]=[]),S[k].push(b)});for(let b in S){m.createEl("h4",{text:b,cls:"version-group-header"});let k=S[b];for(let E of k){let C=m.createEl("div",{cls:"version-item"});E.starred&&C.addClass("version-starred");let T=C.createEl("input",{type:"checkbox",cls:"version-checkbox"});T.checked=this.selectedVersions.has(E.id),T.addEventListener("change",()=>{T.checked?this.selectedVersions.add(E.id):this.selectedVersions.delete(E.id),this.refresh()});let V=C.createEl("div",{cls:"version-info"}),U=V.createEl("div",{cls:"version-time-row"});U.createEl("span",{text:E.starred?"\u2B50":"\u2606",cls:"version-star-btn"}).addEventListener("click",async()=>{await this.plugin.toggleVersionStar(n.path,E.id)}),U.createEl("span",{text:this.plugin.formatTime(E.timestamp),cls:"version-time"});let $=V.createEl("div",{cls:"version-message-row"});E.message.includes("[Auto Save]")?$.createEl("span",{text:"\u81EA\u52A8\u4FDD\u5B58",cls:"version-tag version-tag-auto"}):E.message.includes("[Full Snapshot]")?$.createEl("span",{text:"\u5168\u5E93\u7248\u672C",cls:"version-tag version-tag-snapshot"}):E.message.includes("[Before Restore]")&&$.createEl("span",{text:"\u6062\u590D\u524D\u5907\u4EFD",cls:"version-tag version-tag-backup"}),E.diff?$.createEl("span",{text:"\u589E\u91CF",cls:"version-tag version-tag-incremental"}):E.content&&$.createEl("span",{text:"\u5B8C\u6574",cls:"version-tag version-tag-full"}),E.tags&&E.tags.length>0&&E.tags.forEach(M=>{$.createEl("span",{text:M,cls:"version-tag version-tag-custom"}).addEventListener("click",()=>{this.filterTag=M,this.currentPage=0,this.refresh()})}),$.createEl("span",{text:E.message.replace(/\[.*?\]/g,"").trim()||"\u65E0\u63CF\u8FF0",cls:"version-message"}),E.note&&V.createEl("div",{text:`\u{1F4DD} ${E.note}`,cls:"version-note"});let ne=V.createEl("div",{cls:"version-stats-row"});ne.createEl("span",{text:this.plugin.formatFileSize(E.size),cls:"version-size"});let Q=ne.createEl("div",{cls:"version-diff-stats"});if(typeof E.addedLines=="number"&&typeof E.removedLines=="number"){let M=E.addedLines+E.removedLines;if(M>0){let Ke=E.addedLines/M*100,Gi=E.removedLines/M*100,pn=Q.createEl("div",{cls:"diff-stats-bar"});E.addedLines>0&&pn.createEl("div",{cls:"diff-stats-added",attr:{style:`width: ${Ke}%`}}),E.removedLines>0&&pn.createEl("div",{cls:"diff-stats-removed",attr:{style:`width: ${Gi}%`}}),Q.createEl("span",{text:`+${E.addedLines}`,cls:"diff-stats-text-added"}),Q.createEl("span",{text:`-${E.removedLines}`,cls:"diff-stats-text-removed"}),Q.title=`\u65B0\u589E ${E.addedLines} \u884C, \u5220\u9664 ${E.removedLines} \u884C`}else Q.setText("\u65E0\u4EE3\u7801\u53D8\u66F4")}else{Q.setText("\u8BA1\u7B97\u4E2D...");let M=d.findIndex(Ke=>Ke.id===E.id);M!==-1&&this.calculateAndCacheDiffStats(g,M)}let A=C.createEl("div",{cls:"version-actions"});this.plugin.settings.enableQuickPreview&&A.createEl("button",{text:"\u9884\u89C8",cls:"version-btn",attr:{title:"\u5FEB\u901F\u9884\u89C8"}}).addEventListener("click",()=>{new mt(this.app,this.plugin,n,E.id).open()}),A.createEl("button",{text:"\u6062\u590D",cls:"version-btn"}).addEventListener("click",()=>{this.confirmRestore(n,E.id)}),A.createEl("button",{text:"\u6BD4\u8F83",cls:"version-btn"}).addEventListener("click",()=>{this.showDiffModal(n,E.id)}),A.createEl("button",{text:"\u66F4\u591A",cls:"version-btn"}).addEventListener("click",M=>{this.showVersionContextMenu(M,n,E)})}}if(v>1){let b=e.createEl("div",{cls:"version-pagination"}),k=b.createEl("button",{text:"\u2190 \u4E0A\u4E00\u9875",cls:"version-pagination-btn"});k.disabled=this.currentPage===0,k.addEventListener("click",()=>{this.currentPage>0&&(this.currentPage--,this.refresh())}),b.createEl("span",{text:`\u7B2C ${this.currentPage+1} / ${v} \u9875`,cls:"version-pagination-info"});let E=b.createEl("button",{text:"\u4E0B\u4E00\u9875 \u2192",cls:"version-pagination-btn"});E.disabled=this.currentPage>=v-1,E.addEventListener("click",()=>{this.currentPage<v-1&&(this.currentPage++,this.refresh())})}let D=e.createEl("div",{cls:"version-footer"});D.createEl("span",{text:`\u5171 ${this.totalVersions} \u4E2A\u7248\u672C`}),(this.searchQuery||this.showStarredOnly||this.filterTag)&&D.createEl("span",{text:` \xB7 \u663E\u793A ${u.length} \u4E2A\u7ED3\u679C`}),D.createEl("span",{text:` \xB7 \u663E\u793A ${_+1}-${y}`})}showVersionContextMenu(e,n,s){let a=new w.Menu;a.addItem(r=>r.setTitle("\u4E0E\u5F53\u524D\u6587\u4EF6\u5BF9\u6BD4").setIcon("file-diff").onClick(()=>{this.showDiffModal(n,s.id)})),a.addItem(r=>r.setTitle("\u4E0E\u53E6\u4E00\u4E2A\u7248\u672C\u5BF9\u6BD4").setIcon("files").onClick(()=>{this.selectVersionForCompare(n,s.id)})),a.addSeparator(),a.addItem(r=>r.setTitle(s.starred?"\u53D6\u6D88\u661F\u6807":"\u6DFB\u52A0\u661F\u6807").setIcon("star").onClick(async()=>{await this.plugin.toggleVersionStar(n.path,s.id)})),this.plugin.settings.enableVersionTags&&a.addItem(r=>r.setTitle("\u7F16\u8F91\u6807\u7B7E").setIcon("tag").onClick(()=>{new fn(this.app,this.plugin,n.path,s.id,s.tags||[]).open()})),a.addItem(r=>r.setTitle("\u6DFB\u52A0/\u7F16\u8F91\u5907\u6CE8").setIcon("edit").onClick(()=>{new dn(this.app,this.plugin,n.path,s.id,s.note||"").open()})),a.addSeparator(),a.addItem(r=>r.setTitle("\u5BFC\u51FA\u4E3A\u6587\u4EF6").setIcon("download").onClick(async()=>{await this.plugin.exportVersionAsFile(n.path,s.id)})),a.addItem(r=>r.setTitle("\u5220\u9664\u7248\u672C").setIcon("trash").onClick(async()=>{new le(this.app,"\u786E\u8BA4\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u6B64\u7248\u672C\u5417?

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500!`,async()=>{await this.plugin.deleteVersion(n.path,s.id),this.plugin.settings.showNotifications&&new w.Notice("\u2705 \u7248\u672C\u5DF2\u5220\u9664"),this.refresh()}).open()})),a.showAtMouseEvent(e)}async showDetailedStats(){let e=this.currentFile;if(!e)return;let n=await this.plugin.getAllVersions(e.path),s=n.filter(c=>c.starred).length,a=n.filter(c=>c.tags&&c.tags.length>0).length,r=n.reduce((c,h)=>c+h.size,0),l=n.filter(c=>c.message.includes("[Auto Save]")).length,f=n.length-l,o="";if(n.length>0){let c=n[n.length-1].timestamp,h=n[0].timestamp,g=Math.floor((h-c)/(1e3*60*60*24));o=g>0?`${g} \u5929`:"\u4E0D\u8DB31\u5929"}new w.Notice(`\u{1F4CA} ${e.basename} \u7EDF\u8BA1

\u603B\u7248\u672C\u6570: ${n.length}
\u2B50 \u661F\u6807: ${s}
\u{1F3F7}\uFE0F \u5DF2\u6807\u7B7E: ${a}
\u{1F916} \u81EA\u52A8: ${l}
\u270B \u624B\u52A8: ${f}
\u{1F4E6} \u603B\u5927\u5C0F: ${this.plugin.formatFileSize(r)}
\u{1F4C5} \u65F6\u95F4\u8DE8\u5EA6: ${o}`,8e3)}async cleanupOldVersions(e){new le(this.app,"\u6E05\u7406\u65E7\u7248\u672C",`\u6839\u636E\u8BBE\u7F6E\u7684\u6E05\u7406\u89C4\u5219\u5220\u9664\u65E7\u7248\u672C

\u662F\u5426\u7EE7\u7EED?`,async()=>{let n=await this.plugin.loadVersionFile(e.path),s=n.versions.length,a=this.plugin.cleanupVersionsInMemory(n);a>0?(await this.plugin.saveVersionFile(e.path,n),this.plugin.versionCache.set(e.path,n),new w.Notice(`\u2705 \u5DF2\u6E05\u7406 ${a} \u4E2A\u65E7\u7248\u672C`),this.refresh()):new w.Notice("\u2139\uFE0F \u6CA1\u6709\u9700\u8981\u6E05\u7406\u7684\u7248\u672C")}).open()}renderEmptyState(e,n){let s=e.createEl("div",{cls:"version-history-empty"});s.createEl("div",{text:"\u{1F4CB}",cls:"version-empty-icon"}),s.createEl("div",{text:n}),this.currentFile&&n==="\u6682\u65E0\u7248\u672C\u5386\u53F2"&&s.createEl("button",{text:"\u521B\u5EFA\u7B2C\u4E00\u4E2A\u7248\u672C",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),(this.filterTag||this.showStarredOnly)&&s.createEl("button",{text:"\u6E05\u9664\u7B5B\u9009",cls:"mod-cta"}).addEventListener("click",()=>{this.filterTag=null,this.showStarredOnly=!1,this.currentPage=0,this.refresh()})}confirmRestore(e,n){new le(this.app,"\u786E\u8BA4\u6062\u590D\u7248\u672C",`\u5F53\u524D\u672A\u4FDD\u5B58\u7684\u4FEE\u6539\u5C06\u4F1A\u4E22\u5931,\u63D2\u4EF6\u4F1A\u5728\u6062\u590D\u524D\u81EA\u52A8\u521B\u5EFA\u5907\u4EFD\u7248\u672C\u3002

\u662F\u5426\u7EE7\u7EED?`,async()=>{await this.plugin.restoreVersion(e,n)}).open()}async batchDelete(e){new le(this.app,"\u786E\u8BA4\u6279\u91CF\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684 ${this.selectedVersions.size} \u4E2A\u7248\u672C\u5417?

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500!`,async()=>{let n=Array.from(this.selectedVersions);await this.plugin.deleteVersions(e.path,n),this.selectedVersions.clear(),this.plugin.settings.showNotifications&&new w.Notice("\u2705 \u5DF2\u5220\u9664\u9009\u4E2D\u7248\u672C"),this.refresh()}).open()}showDiffModal(e,n){new ce(this.app,this.plugin,e,n).open()}selectVersionForCompare(e,n){new un(this.app,this.plugin,e,n,s=>{new ce(this.app,this.plugin,e,n,s).open()}).open()}},fn=class extends w.Modal{constructor(e,n,s,a,r){super(e);this.selectedTags=new Set;this.plugin=n,this.filePath=s,this.versionId=a,this.currentTags=r,this.selectedTags=new Set(r)}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"\u7F16\u8F91\u7248\u672C\u6807\u7B7E"});let n=e.createEl("div",{cls:"tag-edit-container"}),s=n.createEl("div",{cls:"tag-section"});s.createEl("h3",{text:"\u5E38\u7528\u6807\u7B7E"});let a=s.createEl("div",{cls:"tag-list"});this.plugin.settings.defaultTags.forEach(p=>{let v=a.createEl("span",{text:p,cls:this.selectedTags.has(p)?"tag-item tag-selected":"tag-item"});v.addEventListener("click",()=>{this.selectedTags.has(p)?(this.selectedTags.delete(p),v.removeClass("tag-selected")):(this.selectedTags.add(p),v.addClass("tag-selected"))})});let r=n.createEl("div",{cls:"tag-section"});r.createEl("h3",{text:"\u81EA\u5B9A\u4E49\u6807\u7B7E"});let l=r.createEl("div",{cls:"tag-input-container"}),f=l.createEl("input",{type:"text",placeholder:"\u8F93\u5165\u65B0\u6807\u7B7E..."});f.style.width="100%";let o=l.createEl("button",{text:"\u6DFB\u52A0",cls:"mod-cta"});o.addEventListener("click",()=>{let p=f.value.trim();p&&!this.selectedTags.has(p)&&(this.selectedTags.add(p),this.renderSelectedTags(h),f.value="")}),f.addEventListener("keydown",p=>{p.key==="Enter"&&o.click()});let c=n.createEl("div",{cls:"tag-section"});c.createEl("h3",{text:"\u5DF2\u9009\u6807\u7B7E"});let h=c.createEl("div",{cls:"tag-list"});this.renderSelectedTags(h);let g=e.createEl("div",{cls:"modal-button-container"});g.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),g.createEl("button",{text:"\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",async()=>{await this.plugin.updateVersionTags(this.filePath,this.versionId,Array.from(this.selectedTags)),new w.Notice("\u2705 \u6807\u7B7E\u5DF2\u66F4\u65B0"),this.close()})}renderSelectedTags(e){e.empty(),this.selectedTags.forEach(n=>{e.createEl("span",{text:n,cls:"tag-item tag-removable"}).createEl("span",{text:"\xD7",cls:"tag-remove"}).addEventListener("click",()=>{this.selectedTags.delete(n),this.renderSelectedTags(e)})})}onClose(){let{contentEl:e}=this;e.empty()}},dn=class extends w.Modal{constructor(e,n,s,a,r){super(e);this.plugin=n,this.filePath=s,this.versionId=a,this.currentNote=r}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"\u7F16\u8F91\u7248\u672C\u5907\u6CE8"});let n=e.createEl("textarea",{placeholder:"\u4E3A\u6B64\u7248\u672C\u6DFB\u52A0\u8BE6\u7EC6\u5907\u6CE8..."});n.value=this.currentNote,n.style.width="100%",n.style.minHeight="150px";let s=e.createEl("div",{cls:"modal-button-container"});s.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),s.createEl("button",{text:"\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",async()=>{await this.plugin.updateVersionNote(this.filePath,this.versionId,n.value.trim()),new w.Notice("\u2705 \u5907\u6CE8\u5DF2\u66F4\u65B0"),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}},hn=class extends w.Modal{constructor(e,n,s){super(e);this.result="";this.tags=[];this.settings=n,this.onSubmit=s}onOpen(){let{contentEl:e}=this;if(e.createEl("h2",{text:"\u521B\u5EFA\u7248\u672C"}),new w.Setting(e).setName("\u63D0\u4EA4\u4FE1\u606F").setDesc("\u63CF\u8FF0\u6B64\u7248\u672C\u7684\u66F4\u6539\u5185\u5BB9").addText(r=>{this.inputEl=r,r.setPlaceholder("\u4F8B\u5982:\u6DFB\u52A0\u65B0\u7AE0\u8282\u3001\u4FEE\u590D\u9519\u8BEF\u7B49...").onChange(l=>{this.result=l}),r.inputEl.style.width="100%",r.inputEl.focus()}),this.settings.enableVersionTags&&this.settings.defaultTags.length>0){let r=e.createEl("div",{cls:"tag-section"});r.createEl("h3",{text:"\u6DFB\u52A0\u6807\u7B7E (\u53EF\u9009)"});let l=r.createEl("div",{cls:"tag-list"});this.settings.defaultTags.forEach(f=>{let o=l.createEl("span",{text:f,cls:"tag-item"});o.addEventListener("click",()=>{o.hasClass("tag-selected")?(o.removeClass("tag-selected"),this.tags=this.tags.filter(c=>c!==f)):(o.addClass("tag-selected"),this.tags.push(f))})})}let n=e.createEl("div",{cls:"modal-button-container"});n.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\u521B\u5EFA",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.onSubmit(this.result||"[Manual Save]",this.tags)}),this.inputEl.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),this.close(),this.onSubmit(this.result||"[Manual Save]",this.tags))})}onClose(){let{contentEl:e}=this;e.empty()}},le=class extends w.Modal{constructor(e,n,s,a){super(e);this.title=n,this.message=s,this.onConfirm=a}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:this.title});let n=e.createEl("p",{cls:"confirm-message"});n.style.whiteSpace="pre-line",n.textContent=this.message;let s=e.createEl("div",{cls:"modal-button-container"});s.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),s.createEl("button",{text:"\u786E\u8BA4",cls:"mod-warning"}).addEventListener("click",()=>{this.close(),this.onConfirm()})}onClose(){let{contentEl:e}=this;e.empty()}},ce=class extends w.Modal{constructor(e,n,s,a,r){super(e);this.currentDiffIndex=0;this.totalDiffs=0;this.diffElements=[];this.showContext=!1;this.contextLines=3;this.collapsedSections=new Set;this.ignoreWhitespace=!1;this.showLineNumbers=!0;this.wrapLines=!1;this.highlightSyntax=!1;this.leftContent="";this.rightContent="";this.showOnlyChanges=!0;this.enableMoveDetection=!0;this.showWhitespace=!1;this.currentView="text";this.isRenderedViewBuilt=!1;this.allVersions=[];this.plugin=n,this.file=s,this.versionId=a,this.secondVersionId=r||"current",this.currentGranularity=this.plugin.settings.diffGranularity}processDiffForMoves(e){let n=e.map(l=>({...l,type:l.added?"added":l.removed?"removed":"context"})),s=new Map,a=new Map;n.forEach((l,f)=>{if(l.removed){let o=l.value.trim();s.has(o)||s.set(o,[]),s.get(o).push(f)}else if(l.added){let o=l.value.trim();a.has(o)||a.set(o,[]),a.get(o).push(f)}});let r=0;for(let[l,f]of s.entries())if(a.has(l)){let o=a.get(l),c=Math.min(f.length,o.length);for(let h=0;h<c;h++){let g=f.shift(),d=o.shift();n[g].type="moved-from",n[g].moveId=r,n[d].type="moved-to",n[d].moveId=r,r++}}return n}visualizeWhitespace(e){return e.replace(/\t/g,"\u2192   ").replace(/ /g,"\xB7")}async onOpen(){let{contentEl:e}=this;e.addClass("diff-modal"),e.createEl("h2",{text:"\u{1F4CA} \u7248\u672C\u5DEE\u5F02\u5BF9\u6BD4"});let n=e.createEl("div"),s=e.createEl("div",{cls:"diff-main-container"});this.textDiffContainer=s.createEl("div",{cls:"diff-container"}),this.renderedDiffContainer=s.createEl("div",{cls:"rendered-diff-container",attr:{style:"display: none;"}});try{this.allVersions=await this.plugin.getAllVersions(this.file.path)}catch(A){new w.Notice("\u274C \u52A0\u8F7D\u7248\u672C\u5217\u8868\u5931\u8D25"),this.close();return}this.renderVersionSelectors(n),this.infoBannerContainer=n.createEl("div",{cls:"diff-info-banner-compact"});let a=n.createEl("div",{cls:"diff-toolbar"}),r=a.createEl("div",{cls:"diff-view-switcher"}),l=r.createEl("button",{text:"\u6587\u672C\u5DEE\u5F02",cls:"active"}),f=r.createEl("button",{text:"\u6E32\u67D3\u9884\u89C8"}),o=a.createEl("div",{cls:"diff-nav-group"}),c=o.createEl("button",{text:"\u4E0A\u4E00\u4E2A",attr:{title:"\u4E0A\u4E00\u4E2A\u5DEE\u5F02","aria-label":"\u4E0A\u4E00\u4E2A\u5DEE\u5F02 (\u2191)"}}),h=o.createEl("span",{cls:"diff-stats"}),g=o.createEl("button",{text:"\u4E0B\u4E00\u4E2A",attr:{title:"\u4E0B\u4E00\u4E2A\u5DEE\u5F02","aria-label":"\u4E0B\u4E00\u4E2A\u5DEE\u5F02 (\u2193)"}}),d=o.createEl("button",{text:"\u7B2C\u4E00\u4E2A",attr:{title:"\u7B2C\u4E00\u4E2A\u5DEE\u5F02","aria-label":"\u8DF3\u8F6C\u5230\u7B2C\u4E00\u4E2A\u5DEE\u5F02"}}),u=o.createEl("button",{text:"\u6700\u540E\u4E00\u4E2A",attr:{title:"\u6700\u540E\u4E00\u4E2A\u5DEE\u5F02","aria-label":"\u8DF3\u8F6C\u5230\u6700\u540E\u4E00\u4E2A\u5DEE\u5F02"}}),p=a.createEl("div",{cls:"diff-view-group"}),v=p.createEl("button",{text:"\u68C0\u6D4B\u79FB\u52A8",cls:this.enableMoveDetection?"active":"",attr:{title:"\u542F\u7528/\u7981\u7528\u6587\u672C\u79FB\u52A8\u68C0\u6D4B","aria-label":"\u68C0\u6D4B\u79FB\u52A8"}});v.addEventListener("click",()=>{this.enableMoveDetection=!this.enableMoveDetection,v.toggleClass("active",this.enableMoveDetection),this.renderTextDiff()});let _=p.createEl("button",{text:"\u4E0A\u4E0B\u6587",cls:"diff-context-toggle",attr:{title:"\u663E\u793A/\u9690\u85CF\u4E0A\u4E0B\u6587","aria-label":"\u4E0A\u4E0B\u6587"}});_.addEventListener("click",()=>{this.showContext=!this.showContext,_.toggleClass("active",this.showContext),this.renderTextDiff()});let y=p.createEl("input",{type:"number",attr:{min:"1",max:"10",value:String(this.contextLines),title:"\u4E0A\u4E0B\u6587\u884C\u6570","aria-label":"\u4E0A\u4E0B\u6587\u884C\u6570"}});y.style.width="50px",y.addEventListener("change",()=>{let A=parseInt(y.value);!isNaN(A)&&A>0&&A<=10&&(this.contextLines=A,this.renderTextDiff())});let x=p.createEl("button",{text:"\u884C\u53F7",cls:this.showLineNumbers?"active":"",attr:{title:"\u663E\u793A/\u9690\u85CF\u884C\u53F7","aria-label":"\u884C\u53F7"}});x.addEventListener("click",()=>{this.showLineNumbers=!this.showLineNumbers,x.toggleClass("active",this.showLineNumbers),this.renderTextDiff()}),this.wrapLines=!0;let m=p.createEl("button",{text:"\u6362\u884C",cls:"active",attr:{title:"\u81EA\u52A8\u6362\u884C","aria-label":"\u81EA\u52A8\u6362\u884C"}});m.addEventListener("click",()=>{this.wrapLines=!this.wrapLines,m.toggleClass("active",this.wrapLines),this.renderTextDiff()});let S=p.createEl("button",{text:"\u5FFD\u7565\u7A7A\u767D",cls:this.ignoreWhitespace?"active":"",attr:{title:"\u5FFD\u7565\u7A7A\u767D\u5B57\u7B26\u7684\u5DEE\u5F02","aria-label":"\u5FFD\u7565\u7A7A\u767D"}});S.addEventListener("click",()=>{this.ignoreWhitespace=!this.ignoreWhitespace,S.toggleClass("active",this.ignoreWhitespace),this.renderTextDiff()});let D=p.createEl("button",{text:"\u663E\u793A\u7A7A\u767D",cls:this.showWhitespace?"active":"",attr:{title:"\u53EF\u89C6\u5316\u663E\u793A\u7A7A\u683C\u548CTab","aria-label":"\u663E\u793A\u7A7A\u767D"}});D.addEventListener("click",()=>{this.showWhitespace=!this.showWhitespace,D.toggleClass("active",this.showWhitespace),this.renderTextDiff()});let b=p.createEl("button",{text:"\u4EC5\u53D8\u66F4",cls:this.showOnlyChanges?"active":"",attr:{title:"\u4EC5\u663E\u793A\u6709\u53D8\u5316\u7684\u5185\u5BB9","aria-label":"\u4EC5\u663E\u793A\u53D8\u66F4"}});b.addEventListener("click",()=>{this.showOnlyChanges=!this.showOnlyChanges,b.toggleClass("active",this.showOnlyChanges),this.renderTextDiff()});let k=p.createEl("select",{cls:"diff-select",attr:{title:"\u5DEE\u5F02\u7C92\u5EA6","aria-label":"\u5DEE\u5F02\u7C92\u5EA6"}});k.createEl("option",{text:"\u5B57\u7B26",value:"char"}),k.createEl("option",{text:"\u5355\u8BCD",value:"word"}),k.createEl("option",{text:"\u884C",value:"line"}),k.value=this.currentGranularity,k.addEventListener("change",()=>{this.currentGranularity=k.value,this.collapsedSections.clear(),this.renderTextDiff()});let E=p.createEl("select",{cls:"diff-select",attr:{title:"\u89C6\u56FE\u6A21\u5F0F","aria-label":"\u89C6\u56FE\u6A21\u5F0F"}});E.createEl("option",{text:"\u7EDF\u4E00\u89C6\u56FE",value:"unified"}),E.createEl("option",{text:"\u5DE6\u53F3\u5206\u680F",value:"split"}),E.value=this.plugin.settings.diffViewMode;let C=a.createEl("div",{cls:"diff-action-group"});C.createEl("button",{text:"\u5C55\u5F00\u5168\u90E8",attr:{title:"\u5C55\u5F00\u6240\u6709\u6298\u53E0\u533A\u57DF","aria-label":"\u5C55\u5F00\u5168\u90E8"}}).addEventListener("click",()=>{this.collapsedSections.clear(),this.renderTextDiff()}),C.createEl("button",{text:"\u6298\u53E0\u5168\u90E8",attr:{title:"\u6298\u53E0\u6240\u6709\u672A\u4FEE\u6539\u533A\u57DF","aria-label":"\u6298\u53E0\u5168\u90E8"}}).addEventListener("click",()=>{let A=e.querySelector(".diff-container");A&&(A.querySelectorAll(".diff-collapse-btn").forEach((he,ue)=>{this.collapsedSections.has(ue)||this.collapsedSections.add(ue)}),this.renderTextDiff())}),C.createEl("button",{text:"\u641C\u7D22",attr:{title:"\u641C\u7D22\u5DEE\u5F02\u5185\u5BB9 (Ctrl+F)","aria-label":"\u641C\u7D22"}}).addEventListener("click",()=>{this.showSearchBox()}),C.createEl("button",{text:"\u7EDF\u8BA1",attr:{title:"\u663E\u793A\u8BE6\u7EC6\u7EDF\u8BA1","aria-label":"\u7EDF\u8BA1"}}).addEventListener("click",()=>{this.showDetailedStats()}),C.createEl("button",{text:"\u590D\u5236",attr:{title:"\u590D\u5236\u5DEE\u5F02","aria-label":"\u590D\u5236"}}).addEventListener("click",()=>{this.copyDiffToClipboard()}),C.createEl("button",{text:"\u5BFC\u51FA",attr:{title:"\u5BFC\u51FA\u5DEE\u5F02\u62A5\u544A","aria-label":"\u5BFC\u51FA"}}).addEventListener("click",()=>{this.exportDiffReport()});let Q=A=>{this.currentView=A,A==="text"?(l.addClass("active"),f.removeClass("active"),this.textDiffContainer.style.display="",this.renderedDiffContainer.style.display="none",[o,p,C].forEach(de=>de.style.display="flex")):(l.removeClass("active"),f.addClass("active"),this.textDiffContainer.style.display="none",this.renderedDiffContainer.style.display="",[o,p,C].forEach(de=>de.style.display="none"),this.isRenderedViewBuilt||(this.renderRenderedView(),this.isRenderedViewBuilt=!0))};l.addEventListener("click",()=>Q("text")),f.addEventListener("click",()=>Q("rendered")),E.addEventListener("change",()=>{this.collapsedSections.clear(),this.renderTextDiff()}),c.addEventListener("click",()=>{this.currentDiffIndex>0&&(this.currentDiffIndex--,this.scrollToDiff(),h.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`),c.disabled=this.currentDiffIndex===0,g.disabled=!1,d.disabled=this.currentDiffIndex===0)}),g.addEventListener("click",()=>{this.currentDiffIndex<this.totalDiffs-1&&(this.currentDiffIndex++,this.scrollToDiff(),h.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`),c.disabled=!1,g.disabled=this.currentDiffIndex>=this.totalDiffs-1,u.disabled=this.currentDiffIndex>=this.totalDiffs-1)}),d.addEventListener("click",()=>{this.currentDiffIndex>0&&(this.currentDiffIndex=0,this.scrollToDiff(),h.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`),c.disabled=!0,g.disabled=!1,d.disabled=!0,u.disabled=!1)}),u.addEventListener("click",()=>{this.currentDiffIndex<this.totalDiffs-1&&(this.currentDiffIndex=this.totalDiffs-1,this.scrollToDiff(),h.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`),c.disabled=!1,g.disabled=!0,d.disabled=!1,u.disabled=!0)}),this.scope.register([],"ArrowUp",()=>(this.currentView==="text"&&!c.disabled&&c.click(),!1)),this.scope.register([],"ArrowDown",()=>(this.currentView==="text"&&!g.disabled&&g.click(),!1)),this.scope.register(["Ctrl"],"f",A=>(this.currentView==="text"&&(A.preventDefault(),this.showSearchBox()),!1)),this.scope.register(["Mod"],"f",A=>(this.currentView==="text"&&(A.preventDefault(),this.showSearchBox()),!1)),this.textDiffContainer.addEventListener("mouseover",A=>{let he=A.target.closest("[data-move-id]");if(he){let ue=he.dataset.moveId;this.textDiffContainer.querySelectorAll(`[data-move-id="${ue}"]`).forEach(M=>{M.addClass("diff-move-highlight")})}}),this.textDiffContainer.addEventListener("mouseout",A=>{let he=A.target.closest("[data-move-id]");if(he){let ue=he.dataset.moveId;this.textDiffContainer.querySelectorAll(`[data-move-id="${ue}"]`).forEach(M=>{M.removeClass("diff-move-highlight")})}}),await this.updateDiffView()}renderVersionSelectors(e){let n=e.createEl("div",{cls:"diff-version-selector-container"}),s=n.createEl("div",{cls:"diff-version-selector"});s.createEl("span",{text:"\u7248\u672C A:",cls:"diff-selector-label"}),s.createEl("button",{text:"\u52A0\u8F7D\u4E2D...",cls:"diff-selector-btn",attr:{id:"diff-left-version-btn"}}).addEventListener("click",o=>{this.showVersionSelectionMenu(o,"left")}),n.createEl("button",{text:"\u2194\uFE0F",cls:"diff-swap-btn",attr:{title:"\u4EA4\u6362\u5BF9\u6BD4\u7248\u672C"}}).addEventListener("click",async()=>{[this.versionId,this.secondVersionId]=[this.secondVersionId,this.versionId],await this.updateDiffView()});let l=n.createEl("div",{cls:"diff-version-selector"});l.createEl("span",{text:"\u7248\u672C B:",cls:"diff-selector-label"}),l.createEl("button",{text:"\u52A0\u8F7D\u4E2D...",cls:"diff-selector-btn",attr:{id:"diff-right-version-btn"}}).addEventListener("click",o=>{this.showVersionSelectionMenu(o,"right")})}showVersionSelectionMenu(e,n){let s=new w.Menu;s.addItem(a=>a.setTitle("\u{1F4C4} \u5F53\u524D\u6587\u4EF6").setIcon("file-text").onClick(()=>{this.handleVersionChange(n,"current")})),s.addSeparator(),this.allVersions.forEach(a=>{s.addItem(r=>r.setTitle(`${this.plugin.formatTime(a.timestamp)} - ${a.message}`).setIcon("history").onClick(()=>{this.handleVersionChange(n,a.id)}))}),s.showAtMouseEvent(e)}async handleVersionChange(e,n){let s=this.versionId,a=this.secondVersionId;if(e==="left"){if(n===s)return;n===a?[this.versionId,this.secondVersionId]=[this.secondVersionId,this.versionId]:this.versionId=n}else{if(n===a)return;n===s?[this.versionId,this.secondVersionId]=[this.secondVersionId,this.versionId]:this.secondVersionId=n}await this.updateDiffView()}async updateDiffView(){let e=new w.Notice("\u6B63\u5728\u52A0\u8F7D\u65B0\u7248\u672C...",0);try{this.versionId==="current"?this.leftContent=await this.app.vault.read(this.file):this.leftContent=await this.plugin.getVersionContent(this.file.path,this.versionId),this.secondVersionId==="current"?this.rightContent=await this.app.vault.read(this.file):this.rightContent=await this.plugin.getVersionContent(this.file.path,this.secondVersionId),this.updateSelectorButtonLabels(),this.renderTextDiff(),this.isRenderedViewBuilt&&(this.isRenderedViewBuilt=!1,this.currentView==="rendered"&&(this.renderRenderedView(),this.isRenderedViewBuilt=!0))}catch(n){console.error("\u52A0\u8F7D\u5DEE\u5F02\u5931\u8D25:",n),new w.Notice("\u274C \u52A0\u8F7D\u7248\u672C\u5185\u5BB9\u5931\u8D25")}finally{e.hide()}}updateSelectorButtonLabels(){let e=this.containerEl.querySelector("#diff-left-version-btn"),n=this.containerEl.querySelector("#diff-right-version-btn");if(e)if(this.versionId==="current")e.setText("\u{1F4C4} \u5F53\u524D\u6587\u4EF6");else{let s=this.allVersions.find(a=>a.id===this.versionId);e.setText(s?`\u{1F552} ${this.plugin.formatTime(s.timestamp)}`:"\u672A\u77E5\u7248\u672C")}if(n)if(this.secondVersionId==="current")n.setText("\u{1F4C4} \u5F53\u524D\u6587\u4EF6");else{let s=this.allVersions.find(a=>a.id===this.secondVersionId);n.setText(s?`\u{1F552} ${this.plugin.formatTime(s.timestamp)}`:"\u672A\u77E5\u7248\u672C")}}async renderRenderedView(){this.renderedDiffContainer.empty();let e=this.renderedDiffContainer.createEl("div",{cls:"rendered-diff-panel"}),n=this.renderedDiffContainer.createEl("div",{cls:"rendered-diff-panel"}),s=this.allVersions.find(g=>g.id===this.versionId),a=this.allVersions.find(g=>g.id===this.secondVersionId),r=this.versionId==="current"?"\u5F53\u524D\u6587\u4EF6":s?`\u7248\u672C A: ${this.plugin.formatTime(s.timestamp)}`:"\u7248\u672C A",l=this.secondVersionId==="current"?"\u5F53\u524D\u6587\u4EF6":a?`\u7248\u672C B: ${this.plugin.formatTime(a.timestamp)}`:"\u7248\u672C B";e.createEl("h3",{text:r}),n.createEl("h3",{text:l});let f=e.createEl("div",{cls:"rendered-diff-content"}),o=n.createEl("div",{cls:"rendered-diff-content"});await w.MarkdownRenderer.renderMarkdown(this.leftContent,f,this.file.path,this.plugin),await w.MarkdownRenderer.renderMarkdown(this.rightContent,o,this.file.path,this.plugin);let c=!1,h=(g,d)=>{c||(c=!0,d.scrollTop=g.scrollTop,setTimeout(()=>{c=!1},50))};f.addEventListener("scroll",()=>h(f,o)),o.addEventListener("scroll",()=>h(o,f))}renderTextDiff(){let e=this.textDiffContainer;e.empty(),this.diffElements=[],this.currentDiffIndex=0,this.totalDiffs=0;let n=this.leftContent,s=this.rightContent;if(this.ignoreWhitespace&&(n=this.leftContent.replace(/\s+/g," ").trim(),s=this.rightContent.replace(/\s+/g," ").trim()),e.toggleClass("show-whitespace-active",this.showWhitespace),this.containerEl.querySelector('.diff-select[aria-label="\u89C6\u56FE\u6A21\u5F0F"]').value==="unified")this.renderUnifiedDiff(e,n,s,this.currentGranularity);else{let h=this.containerEl.querySelector("#diff-left-version-btn"),g=this.containerEl.querySelector("#diff-right-version-btn");this.renderSplitDiff(e,n,s,this.currentGranularity,h.textContent||"\u7248\u672C A",g.textContent||"\u7248\u672C B")}this.wrapLines?e.addClass("diff-wrap-lines"):e.removeClass("diff-wrap-lines"),this.totalDiffs=this.diffElements.length;let r=this.containerEl.querySelector(".diff-stats"),l=this.containerEl.querySelector(".diff-nav-group button:first-child"),f=this.containerEl.querySelector(".diff-nav-group button:nth-child(3)"),o=this.containerEl.querySelector(".diff-nav-group button:nth-child(4)"),c=this.containerEl.querySelector(".diff-nav-group button:last-child");this.totalDiffs>0?(r.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`),l.disabled=this.currentDiffIndex===0,f.disabled=this.currentDiffIndex>=this.totalDiffs-1,o.disabled=this.currentDiffIndex===0,c.disabled=this.currentDiffIndex>=this.totalDiffs-1,setTimeout(()=>this.scrollToDiff(),100)):(r.setText(n===s?"\u2705 \u5185\u5BB9\u76F8\u540C":"\u{1F4CA} \u65E0\u5DEE\u5F02"),l.disabled=!0,f.disabled=!0,o.disabled=!0,c.disabled=!0),this.updateCompactDiffInfo(),this.plugin.refreshVersionHistoryView()}updateCompactDiffInfo(){let e=this.infoBannerContainer;if(!e)return;e.empty();let n=this.leftContent,s=this.rightContent;this.ignoreWhitespace&&(n=this.leftContent.replace(/\s+/g," ").trim(),s=this.rightContent.replace(/\s+/g," ").trim());let a=O(n,s),r=0,l=0;for(let h of a)h.added?r+=h.count||0:h.removed&&(l+=h.count||0);let f=this.leftContent.split(`
`).length,o=r+l,c=f>0?(o/f*100).toFixed(1):"0";e.createEl("span",{text:`\u{1F4CA} \u603B\u884C\u6570: ${f}`,cls:"diff-info-item"}),e.createEl("span",{text:`+${r}`,cls:"diff-info-added"}),e.createEl("span",{text:`-${l}`,cls:"diff-info-removed"}),e.createEl("span",{text:`~${o}`,cls:"diff-info-changed"}),e.createEl("span",{text:`\u53D8\u5316\u7387: ${c}%`,cls:"diff-info-percent"}),e.addClass("diff-info-updated"),setTimeout(()=>{e.removeClass("diff-info-updated")},500)}showDetailedStats(){let e=O(this.leftContent,this.rightContent),n=0,s=0,a=0,r=0;for(let c of e)c.added?(n+=(c.value.match(/\n/g)||[]).length,a+=c.value.length):c.removed&&(s+=(c.value.match(/\n/g)||[]).length,r+=c.value.length);let l=this.leftContent.split(`
`).length,f=this.rightContent.split(`
`).length,o=this.calculateSimilarity(this.leftContent,this.rightContent);new w.Notice(`\u{1F4CA} \u8BE6\u7EC6\u7EDF\u8BA1

\u5DE6\u4FA7\u7248\u672C: ${l} \u884C, ${this.leftContent.length} \u5B57\u7B26
\u53F3\u4FA7\u7248\u672C: ${f} \u884C, ${this.rightContent.length} \u5B57\u7B26

\u65B0\u589E: ${n} \u884C, ${a} \u5B57\u7B26
\u5220\u9664: ${s} \u884C, ${r} \u5B57\u7B26
\u76F8\u4F3C\u5EA6: ${o.toFixed(1)}%
\u5DEE\u5F02\u5757: ${this.totalDiffs} \u4E2A`,1e4)}calculateSimilarity(e,n){let s=e.length,a=n.length,r=Math.max(s,a);if(r===0)return 100;let l=0,f=Math.min(s,a);for(let o=0;o<f;o++)e[o]===n[o]&&l++;return l/r*100}showSearchBox(){let e=this.containerEl.createEl("div",{cls:"diff-search-container"}),n=e.createEl("input",{type:"text",placeholder:"\u641C\u7D22\u5DEE\u5F02\u5185\u5BB9...",cls:"diff-search-input"}),s=e.createEl("span",{cls:"diff-search-results"}),a=e.createEl("button",{text:"\xD7",cls:"diff-search-close"}),r=[],l=0;n.addEventListener("input",()=>{let o=n.value.toLowerCase();if(r.forEach(c=>c.removeClass("diff-search-match")),r=[],l=0,o.length<2){s.setText("");return}this.diffElements.forEach(c=>{var g;(((g=c.textContent)==null?void 0:g.toLowerCase())||"").includes(o)&&(c.addClass("diff-search-match"),r.push(c))}),r.length>0?(s.setText(`${l+1} / ${r.length}`),r[0].addClass("diff-search-current"),r[0].scrollIntoView({behavior:"smooth",block:"center"})):s.setText("\u65E0\u7ED3\u679C")}),n.addEventListener("keydown",o=>{o.key==="Enter"?(o.preventDefault(),r.length>0&&(r[l].removeClass("diff-search-current"),l=(l+1)%r.length,r[l].addClass("diff-search-current"),r[l].scrollIntoView({behavior:"smooth",block:"center"}),s.setText(`${l+1} / ${r.length}`))):o.key==="Escape"&&e.remove()}),a.addEventListener("click",()=>{r.forEach(o=>{o.removeClass("diff-search-match"),o.removeClass("diff-search-current")}),e.remove()});let f=this.containerEl.querySelector(".diff-toolbar");f&&f.insertAdjacentElement("afterend",e),n.focus()}async exportDiffReport(){try{let e=O(this.leftContent,this.rightContent),n=`# \u7248\u672C\u5DEE\u5F02\u62A5\u544A

`;n+=`**\u6587\u4EF6**: ${this.file.path}
`,n+=`**\u751F\u6210\u65F6\u95F4**: ${new Date().toLocaleString("zh-CN")}

`;let s=await this.plugin.getAllVersions(this.file.path),a=s.find(c=>c.id===this.versionId);if(a&&(n+=`**\u5BF9\u6BD4\u7248\u672C**: ${this.plugin.formatTime(a.timestamp)}
`),this.secondVersionId){let c=s.find(h=>h.id===this.secondVersionId);c&&(n+=`**\u76EE\u6807\u7248\u672C**: ${this.plugin.formatTime(c.timestamp)}
`)}else n+=`**\u76EE\u6807\u7248\u672C**: \u5F53\u524D\u6587\u4EF6
`;n+=`
## \u7EDF\u8BA1\u4FE1\u606F

`;let r=0,l=0,f=0;for(let c of e){let h=c.value.split(`
`).length-1;c.added?r+=h:c.removed?l+=h:f+=h}n+=`- \u65B0\u589E\u884C\u6570: ${r}
`,n+=`- \u5220\u9664\u884C\u6570: ${l}
`,n+=`- \u672A\u53D8\u5316\u884C\u6570: ${f}
`,n+=`- \u603B\u884C\u6570: ${r+l+f}

`,n+=`## \u5DEE\u5F02\u5185\u5BB9

`,n+="```diff\n";for(let c of e){let h=c.added?"+":c.removed?"-":" ",g=c.value.split(`
`);g.forEach((d,u)=>{u<g.length-1&&(n+=`${h} ${d}
`)})}n+="```\n";let o=`diff_report_${Date.now()}.md`;await this.app.vault.create(o,n),new w.Notice(`\u2705 \u5DEE\u5F02\u62A5\u544A\u5DF2\u5BFC\u51FA: ${o}`)}catch(e){console.error("\u5BFC\u51FA\u5DEE\u5F02\u62A5\u544A\u5931\u8D25:",e),new w.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}renderUnifiedDiff(e,n,s,a){if(a==="line"){let r=O(n,s),l=this.enableMoveDetection?this.processDiffForMoves(r):r.map(f=>({...f,type:f.added?"added":f.removed?"removed":"context"}));this.renderLineDiff(e,l)}else{let r=a==="word"?Be(n,s):ge(n,s);this.renderInlineDiff(e,r)}}renderLineDiff(e,n){let s=1,a=1,r=0,l=(o,c,h,g)=>{if(this.showOnlyChanges&&c==="context")return;let d=e.createEl("div",{cls:`diff-line diff-${c}`});c!=="context"&&(d.dataset.diffIndex=String(r++),this.diffElements.push(d)),g!==void 0&&(d.dataset.moveId=String(g)),this.showLineNumbers&&d.createEl("span",{cls:"line-number",text:h!==null?String(h):""});let u=c==="added"?"+":c==="removed"?"-":c==="moved-from"?"\u2192":c==="moved-to"?"\u2190":" ";d.createEl("span",{cls:"diff-marker",text:u});let p=this.showWhitespace?this.visualizeWhitespace(o):o;d.createEl("span",{cls:"line-content",text:p})},f=(o,c,h)=>{let g=e.createEl("div",{cls:`diff-line diff-${c}`});g.dataset.diffIndex=String(r++),this.diffElements.push(g),this.showLineNumbers&&g.createEl("span",{cls:"line-number",text:h!==null?String(h):""});let d=c==="added"?"+":"-";g.createEl("span",{cls:"diff-marker",text:d});let u=g.createEl("span",{cls:"line-content"});for(let p=0;p<o.length;p++){let v=o[p],_=o[p+1],y=x=>this.showWhitespace?this.visualizeWhitespace(x):x;v.removed&&_&&_.added?(ge(v.value,_.value).forEach(m=>{if(c==="removed"&&!m.added){let S=u.createEl("span",{text:y(m.value)});m.removed&&S.addClass("diff-char-removed")}else if(c==="added"&&!m.removed){let S=u.createEl("span",{text:y(m.value)});m.added&&S.addClass("diff-char-added")}}),p++):v.added&&c==="added"?u.createEl("span",{text:y(v.value),cls:"diff-word-added"}):v.removed&&c==="removed"?u.createEl("span",{text:y(v.value),cls:"diff-word-removed"}):!v.added&&!v.removed&&u.appendText(y(v.value))}};for(let o=0;o<n.length;o++){let c=n[o],h=n[o+1];if(c.type==="moved-from"||c.type==="moved-to"){let g=c.value.replace(/\n$/,"").split(`
`);for(let d of g)c.type==="moved-from"?l(d,"moved-from",s++,c.moveId):l(d,"moved-to",a++,c.moveId);continue}if(c.removed&&h&&h.added){let g=c.value.replace(/\n$/,"").split(`
`),d=h.value.replace(/\n$/,"").split(`
`),u=Math.max(g.length,d.length);for(let p=0;p<u;p++){let v=g[p],_=d[p];if(v!==void 0&&_!==void 0){let y=Be(v,_);f(y,"removed",s++),f(y,"added",a++)}else v!==void 0?l(v,"removed",s++):_!==void 0&&l(_,"added",a++)}o++}else{let g=c.value.replace(/\n$/,"").split(`
`);for(let d of g)c.added?l(d,"added",a++):c.removed?l(d,"removed",s++):(this.showOnlyChanges||l(d,"context",a),s++,a++)}}}renderInlineDiff(e,n){let s=e.createEl("div",{cls:"diff-inline-with-lines"}),a=s.createEl("div",{cls:"diff-line-numbers"}),r=s.createEl("div",{cls:"diff-line-content"}),l=[],f=[],o=!1,c=!1,h=0;for(let u of n){let p=u.value.split(/(\n)/g);for(let v of p){if(v===`
`){l.push({number:c?0:null,spans:f,hasChange:o}),f=[],o=!1,c=!1;continue}if(v==="")continue;let _=document.createElement("span");_.textContent=this.showWhitespace?this.visualizeWhitespace(v):v,f.push(_),u.added?(_.className="diff-char-added",_.dataset.diffIndex=String(h++),this.diffElements.push(_),o=!0,c=!0):u.removed?(_.className="diff-char-removed",_.dataset.diffIndex=String(h++),this.diffElements.push(_),o=!0):c=!0}}f.length>0&&l.push({number:c?0:null,spans:f,hasChange:o});let g=this.showOnlyChanges?l.filter(u=>u.hasChange):l,d=1;for(let u of g){let p=null;u.number!==null&&(p=d++),this.showLineNumbers&&a.createEl("div",{text:p!==null?String(p):"",cls:"line-number"});let v=r.createEl("div",{cls:"diff-content-line"});this.wrapLines&&(v.style.whiteSpace="pre-wrap",v.style.wordBreak="break-all"),u.spans.length===0?v.innerHTML="&nbsp;":u.spans.forEach(_=>v.appendChild(_))}}renderSplitDiff(e,n,s,a,r,l){e.addClass("diff-split");let f=e.createEl("div",{cls:"diff-panel"}),o=e.createEl("div",{cls:"diff-panel"});f.createEl("h3",{text:r}),o.createEl("h3",{text:l});let c=f.createEl("div",{cls:"diff-content"}),h=o.createEl("div",{cls:"diff-content"});this.renderSplitAdvanced(c,h,n,s,a);let g=!1,d=(u,p)=>{g||(g=!0,p.scrollTop=u.scrollTop,setTimeout(()=>{g=!1},50))};c.addEventListener("scroll",()=>d(c,h)),h.addEventListener("scroll",()=>d(h,c))}renderSplitAdvanced(e,n,s,a,r){let l=1,f=1,o=0,c=(d,u,p,v,_,y)=>{let x=d.createEl("div",{cls:`diff-line diff-${p}`});(p==="added"||p==="removed"||p==="moved-from"||p==="moved-to")&&(x.dataset.diffIndex=String(o++),this.diffElements.push(x)),y!==void 0&&(x.dataset.moveId=String(y)),this.showLineNumbers&&x.createEl("span",{cls:"line-number",text:v!==null?String(v):""}),x.createEl("span",{cls:"diff-marker",text:_});let m=x.createEl("span",{cls:"line-content"});m.textContent=this.showWhitespace?this.visualizeWhitespace(u):u,u===""&&(m.innerHTML="&nbsp;")},h=O(s,a),g=this.enableMoveDetection?this.processDiffForMoves(h):h.map(d=>({...d,type:d.added?"added":d.removed?"removed":"context"}));for(let d=0;d<g.length;d++){let u=g[d],p=g[d+1];if(this.showOnlyChanges&&u.type==="context"){let v=(u.value.match(/\n/g)||[]).length;l+=v,f+=v;continue}if(u.type==="moved-from"){u.value.replace(/\n$/,"").split(`
`).forEach(_=>{c(e,_,"moved-from",l++,"\u2192",u.moveId),c(n,"","placeholder",null," ")});continue}if(u.type==="moved-to"){u.value.replace(/\n$/,"").split(`
`).forEach(_=>{c(e,"","placeholder",null," "),c(n,_,"moved-to",f++,"\u2190",u.moveId)});continue}if(u.removed&&p&&p.added){let _=(r==="line"?"word":r)==="word"?Be(u.value,p.value):ge(u.value,p.value),y=[],x=[],m=()=>{let S=e.createEl("div",{cls:"diff-line diff-modified"}),D=n.createEl("div",{cls:"diff-line diff-modified"}),b=S.createSpan({cls:"diff-marker",text:"~"});D.createSpan({cls:"diff-marker",text:"~"}),this.diffElements.push(b),this.showLineNumbers&&(S.createEl("span",{cls:"line-number",text:String(l)}),D.createEl("span",{cls:"line-number",text:String(f)}));let k=S.createEl("span",{cls:"line-content"}),E=D.createEl("span",{cls:"line-content"});y.length===0?k.innerHTML="&nbsp;":y.forEach(C=>k.appendChild(C)),x.length===0?E.innerHTML="&nbsp;":x.forEach(C=>E.appendChild(C)),l++,f++,y=[],x=[]};for(let S=0;S<_.length;S++){let D=_[S],b=_[S+1],k=E=>this.showWhitespace?this.visualizeWhitespace(E):E;if(D.removed&&b&&b.added)ge(D.value,b.value).forEach(C=>{if(!C.added){let T=document.createElement("span");T.textContent=k(C.value),C.removed&&(T.className="diff-char-removed"),y.push(T)}if(!C.removed){let T=document.createElement("span");T.textContent=k(C.value),C.added&&(T.className="diff-char-added"),x.push(T)}}),S++;else{let E=D.value.split(`
`);for(let C=0;C<E.length;C++){let T=E[C];if(T){let V=document.createElement("span");V.textContent=k(T),D.added?(V.className="diff-word-added",x.push(V)):D.removed?(V.className="diff-word-removed",y.push(V)):(y.push(V.cloneNode(!0)),x.push(V.cloneNode(!0)))}C<E.length-1&&m()}}}(y.length>0||x.length>0)&&m(),d++}else u.removed?u.value.replace(/\n$/,"").split(`
`).forEach(_=>{c(e,_,"removed",l++,"-"),c(n,"","placeholder",null," ")}):u.added?u.value.replace(/\n$/,"").split(`
`).forEach(_=>{c(e,"","placeholder",null," "),c(n,_,"added",f++,"+")}):u.value.replace(/\n$/,"").split(`
`).forEach(_=>{c(e,_,"context",l++," "),c(n,_,"context",f++," ")})}}scrollToDiff(){if(this.diffElements.length===0||this.currentDiffIndex>=this.diffElements.length)return;let e=this.diffElements[this.currentDiffIndex];this.diffElements.forEach(n=>n.removeClass("diff-current")),e.addClass("diff-current"),e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{let n=e.getBoundingClientRect(),s=this.containerEl.querySelector(".diff-container");if(s){let a=s.getBoundingClientRect();(n.top<a.top||n.bottom>a.bottom)&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}},100)}copyDiffToClipboard(){let e=this.containerEl.querySelector(".diff-container");if(!e)return;let n=e.textContent||"";navigator.clipboard.writeText(n).then(()=>{new w.Notice("\u2705 \u5DEE\u5F02\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(()=>{new w.Notice("\u274C \u590D\u5236\u5931\u8D25")})}onClose(){let{contentEl:e}=this;e.empty()}},un=class extends w.Modal{constructor(e,n,s,a,r){super(e);this.searchQuery="";this.plugin=n,this.file=s,this.firstVersionId=a,this.onSelect=r}async onOpen(){let{contentEl:e}=this;e.addClass("version-select-modal"),e.createEl("h2",{text:"\u9009\u62E9\u5BF9\u6BD4\u7248\u672C"}),e.createEl("p",{text:"\u9009\u62E9\u8981\u4E0E\u4E4B\u5BF9\u6BD4\u7684\u7248\u672C",cls:"version-select-hint"}),e.createEl("div",{cls:"version-search-container"}).createEl("input",{type:"text",placeholder:"\u641C\u7D22\u7248\u672C...",cls:"version-search-input"}).addEventListener("input",r=>{this.searchQuery=r.target.value,this.renderVersionList()});let a=e.createEl("div",{cls:"version-select-list"});this.renderVersionList()}async renderVersionList(){let e=this.containerEl.querySelector(".version-select-list");if(!e)return;e.empty();let s=(await this.plugin.getAllVersions(this.file.path)).filter(a=>{if(a.id===this.firstVersionId)return!1;if(!this.searchQuery)return!0;let r=this.searchQuery.toLowerCase();return a.message.toLowerCase().includes(r)||this.plugin.formatTime(a.timestamp).toLowerCase().includes(r)});if(s.length===0){e.createEl("div",{text:this.searchQuery?`\u672A\u627E\u5230\u5339\u914D "${this.searchQuery}" \u7684\u7248\u672C`:"\u6CA1\u6709\u5176\u4ED6\u7248\u672C",cls:"version-select-empty"});return}for(let a of s){let r=e.createEl("div",{cls:"version-select-item"}),l=r.createEl("div",{cls:"version-info"});l.createEl("div",{text:this.plugin.formatTime(a.timestamp),cls:"version-time"}),l.createEl("div",{text:a.message,cls:"version-message"}),l.createEl("div",{text:this.plugin.formatFileSize(a.size),cls:"version-size"}),r.createEl("button",{text:"\u9009\u62E9"}).addEventListener("click",()=>{this.close(),this.onSelect(a.id)})}}onClose(){let{contentEl:e}=this;e.empty()}},gn=class extends w.PluginSettingTab{constructor(e,n){super(e,n);this.plugin=n}async display(){let{containerEl:e}=this;if(e.empty(),e.createEl("h2",{text:"\u7248\u672C\u63A7\u5236\u8BBE\u7F6E"}),this.plugin.settings.showVersionStats){let o=await this.plugin.getStorageStats(),c=e.createEl("div",{cls:"version-stats"});c.createEl("h3",{text:"\u{1F4CA} \u5B58\u50A8\u7EDF\u8BA1"});let h=c.createEl("div",{cls:"stats-grid"});h.createEl("div",{text:`\u603B\u5927\u5C0F: ${this.plugin.formatFileSize(o.totalSize)}`}),h.createEl("div",{text:`\u7248\u672C\u6570\u91CF: ${o.versionCount}`}),h.createEl("div",{text:`\u6587\u4EF6\u6570\u91CF: ${o.fileCount}`}),h.createEl("div",{text:`\u661F\u6807\u7248\u672C: ${o.starredCount}`}),h.createEl("div",{text:`\u6807\u7B7E\u7248\u672C: ${o.taggedCount}`}),(this.plugin.settings.enableCompression||this.plugin.settings.enableIncrementalStorage)&&h.createEl("div",{text:`\u538B\u7F29\u7387: ${o.compressionRatio.toFixed(1)}%`}),c.createEl("button",{text:"\u{1F504} \u5237\u65B0\u7EDF\u8BA1"}).addEventListener("click",()=>{this.display()})}e.createEl("h3",{text:"\u2699\uFE0F \u57FA\u7840\u8BBE\u7F6E"}),new w.Setting(e).setName("\u5728\u72B6\u6001\u680F\u663E\u793A\u4E0A\u6B21\u4FDD\u5B58\u65F6\u95F4").setDesc("\u5F00\u542F\u540E\uFF0C\u72B6\u6001\u680F\u5C06\u663E\u793A\u76F8\u5BF9\u7684\u4E0A\u6B21\u4FDD\u5B58\u65F6\u95F4\uFF1B\u5173\u95ED\u5219\u663E\u793A\u901A\u7528\u72B6\u6001\u3002").addToggle(o=>o.setValue(this.plugin.settings.showLastSaveTimeInStatusBar).onChange(async c=>{this.plugin.settings.showLastSaveTimeInStatusBar=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u542F\u7528\u72B6\u6001\u680F\u5FEB\u901F\u5BF9\u6BD4").setDesc("\u70B9\u51FB\u72B6\u6001\u680F\u53EF\u5FEB\u901F\u5BF9\u6BD4\u5F53\u524D\u6587\u4EF6\u4E0E\u6700\u65B0\u7248\u672C").addToggle(o=>o.setValue(this.plugin.settings.enableStatusBarDiff).onChange(async c=>{this.plugin.settings.enableStatusBarDiff=c,await this.plugin.saveSettings(),c?(this.plugin.statusBarItem.addClass("version-control-statusbar-clickable"),new w.Notice("\u72B6\u6001\u680F\u5FEB\u901F\u5BF9\u6BD4\u5DF2\u542F\u7528,\u70B9\u51FB\u72B6\u6001\u680F\u53EF\u5FEB\u901F\u5BF9\u6BD4")):this.plugin.statusBarItem.removeClass("version-control-statusbar-clickable")})),new w.Setting(e).setName("\u7248\u672C\u5B58\u50A8\u8DEF\u5F84").setDesc("\u6307\u5B9A\u7248\u672C\u6570\u636E\u7684\u5B58\u50A8\u4F4D\u7F6E(\u76F8\u5BF9\u4E8E\u5E93\u6839\u76EE\u5F55)").addText(o=>o.setPlaceholder(".versions").setValue(this.plugin.settings.versionFolder).onChange(async c=>{this.plugin.settings.versionFolder=c||".versions",await this.plugin.saveSettings(),await this.plugin.ensureVersionFolder()})),new w.Setting(e).setName("\u663E\u793A\u901A\u77E5").setDesc("\u5728\u521B\u5EFA\u3001\u6062\u590D\u7248\u672C\u65F6\u663E\u793A\u63D0\u793A\u6D88\u606F").addToggle(o=>o.setValue(this.plugin.settings.showNotifications).onChange(async c=>{this.plugin.settings.showNotifications=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u663E\u793A\u7EDF\u8BA1\u4FE1\u606F").setDesc("\u5728\u8BBE\u7F6E\u9875\u9762\u663E\u793A\u7248\u672C\u7EDF\u8BA1").addToggle(o=>o.setValue(this.plugin.settings.showVersionStats).onChange(async c=>{this.plugin.settings.showVersionStats=c,await this.plugin.saveSettings(),this.display()})),e.createEl("h3",{text:"\u{1F3F7}\uFE0F \u7248\u672C\u6807\u7B7E\u4E0E\u5907\u6CE8"}),new w.Setting(e).setName("\u542F\u7528\u7248\u672C\u6807\u7B7E").setDesc("\u4E3A\u7248\u672C\u6DFB\u52A0\u6807\u7B7E\u4EE5\u4FBF\u5206\u7C7B\u548C\u7B5B\u9009").addToggle(o=>o.setValue(this.plugin.settings.enableVersionTags).onChange(async c=>{this.plugin.settings.enableVersionTags=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u9ED8\u8BA4\u6807\u7B7E\u5217\u8868").setDesc("\u9884\u8BBE\u7684\u5E38\u7528\u6807\u7B7E(\u6BCF\u884C\u4E00\u4E2A)").addTextArea(o=>{o.setValue(this.plugin.settings.defaultTags.join(`
`)).setPlaceholder(`\u91CD\u8981
\u91CC\u7A0B\u7891
\u53D1\u5E03
\u5907\u4EFD
\u8349\u7A3F`).onChange(async c=>{this.plugin.settings.defaultTags=c.split(`
`).map(h=>h.trim()).filter(h=>h.length>0),await this.plugin.saveSettings()}),o.inputEl.rows=4,o.inputEl.style.width="100%"}),new w.Setting(e).setName("\u542F\u7528\u5FEB\u901F\u9884\u89C8").setDesc("\u5728\u7248\u672C\u5386\u53F2\u4E2D\u663E\u793A\u5FEB\u901F\u9884\u89C8\u6309\u94AE").addToggle(o=>o.setValue(this.plugin.settings.enableQuickPreview).onChange(async c=>{this.plugin.settings.enableQuickPreview=c,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView()})),e.createEl("h3",{text:"\u{1F916} \u81EA\u52A8\u4FDD\u5B58"}),new w.Setting(e).setName("\u542F\u7528\u81EA\u52A8\u4FDD\u5B58").setDesc("\u81EA\u52A8\u521B\u5EFA\u7248\u672C\u5FEB\u7167").addToggle(o=>o.setValue(this.plugin.settings.autoSave).onChange(async c=>{this.plugin.settings.autoSave=c,await this.plugin.saveSettings(),c&&this.plugin.settings.autoSaveOnInterval?this.plugin.startAutoSave():this.plugin.autoSaveTimer&&clearInterval(this.plugin.autoSaveTimer)}));let n=e.createEl("div",{cls:"setting-item-description"});n.innerHTML="\u9009\u62E9\u4EE5\u4E0B\u4E00\u79CD\u6216\u591A\u79CD\u81EA\u52A8\u4FDD\u5B58\u89E6\u53D1\u65B9\u5F0F:",n.style.marginBottom="10px",n.style.color="var(--text-muted)",new w.Setting(e).setName("\u270F\uFE0F \u4FEE\u6539\u65F6\u81EA\u52A8\u4FDD\u5B58").setDesc("\u6587\u4EF6\u4FEE\u6539\u540E\u5EF6\u8FDF\u4FDD\u5B58(\u63A8\u8350)").addToggle(o=>o.setValue(this.plugin.settings.autoSaveOnModify).onChange(async c=>{this.plugin.settings.autoSaveOnModify=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u4FDD\u5B58\u5EF6\u8FDF (\u79D2)").setDesc("\u4FEE\u6539\u540E\u7B49\u5F85\u591A\u4E45\u624D\u4FDD\u5B58,\u907F\u514D\u9891\u7E41\u521B\u5EFA\u7248\u672C").addSlider(o=>o.setLimits(30,600,30).setValue(this.plugin.settings.autoSaveDelay).setDynamicTooltip().onChange(async c=>{this.plugin.settings.autoSaveDelay=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u6700\u5C0F\u53D8\u5316\u5B57\u7B26\u6570").setDesc("\u53EA\u6709\u53D8\u5316\u8D85\u8FC7\u6B64\u5B57\u7B26\u6570\u65F6\u624D\u4FDD\u5B58\u7248\u672C").addSlider(o=>o.setLimits(0,100,5).setValue(this.plugin.settings.autoSaveMinChanges).setDynamicTooltip().onChange(async c=>{this.plugin.settings.autoSaveMinChanges=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u23F0 \u5B9A\u65F6\u81EA\u52A8\u4FDD\u5B58").setDesc("\u6309\u56FA\u5B9A\u65F6\u95F4\u95F4\u9694\u4FDD\u5B58").addToggle(o=>o.setValue(this.plugin.settings.autoSaveOnInterval).onChange(async c=>{this.plugin.settings.autoSaveOnInterval=c,await this.plugin.saveSettings(),c&&this.plugin.settings.autoSave?this.plugin.startAutoSave():this.plugin.autoSaveTimer&&(clearInterval(this.plugin.autoSaveTimer),this.plugin.autoSaveTimer=null)})),new w.Setting(e).setName("\u5B9A\u65F6\u95F4\u9694 (\u5206\u949F)").setDesc("\u6BCF\u9694\u591A\u4E45\u81EA\u52A8\u68C0\u67E5\u5E76\u4FDD\u5B58").addText(o=>o.setPlaceholder("5").setValue(String(this.plugin.settings.autoSaveInterval)).onChange(async c=>{let h=parseInt(c);!isNaN(h)&&h>0&&(this.plugin.settings.autoSaveInterval=h,await this.plugin.saveSettings(),this.plugin.settings.autoSave&&this.plugin.settings.autoSaveOnInterval&&this.plugin.startAutoSave())})),new w.Setting(e).setName("\u{1F4C4} \u5207\u6362\u6587\u4EF6\u65F6\u4FDD\u5B58").setDesc("\u5207\u6362\u5230\u5176\u4ED6\u6587\u4EF6\u65F6\u81EA\u52A8\u4FDD\u5B58\u5F53\u524D\u6587\u4EF6").addToggle(o=>o.setValue(this.plugin.settings.autoSaveOnFileSwitch).onChange(async c=>{this.plugin.settings.autoSaveOnFileSwitch=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u{1F441}\uFE0F \u5931\u53BB\u7126\u70B9\u65F6\u4FDD\u5B58").setDesc("\u7A97\u53E3\u5931\u53BB\u7126\u70B9\u65F6\u81EA\u52A8\u4FDD\u5B58(\u5207\u6362\u5E94\u7528\u65F6)").addToggle(o=>o.setValue(this.plugin.settings.autoSaveOnFocusLost).onChange(async c=>{this.plugin.settings.autoSaveOnFocusLost=c,await this.plugin.saveSettings(),c&&new w.Notice("\u5931\u53BB\u7126\u70B9\u4FDD\u5B58\u5C06\u5728\u91CD\u542F Obsidian \u540E\u751F\u6548")})),new w.Setting(e).setName("\u542F\u7528\u53BB\u91CD").setDesc("\u8DF3\u8FC7\u5185\u5BB9\u76F8\u540C\u7684\u7248\u672C\u521B\u5EFA,\u8282\u7701\u5B58\u50A8\u7A7A\u95F4").addToggle(o=>o.setValue(this.plugin.settings.enableDeduplication).onChange(async c=>{this.plugin.settings.enableDeduplication=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u6392\u9664\u7684\u6587\u4EF6\u5939").setDesc("\u4E0D\u5BF9\u8FD9\u4E9B\u6587\u4EF6\u5939\u4E2D\u7684\u6587\u4EF6\u521B\u5EFA\u7248\u672C(\u6BCF\u884C\u4E00\u4E2A\u8DEF\u5F84)").addTextArea(o=>{o.setValue(this.plugin.settings.excludedFolders.join(`
`)).setPlaceholder(`\u4F8B\u5982:
templates/
.trash/`).onChange(async c=>{this.plugin.settings.excludedFolders=c.split(`
`).map(h=>h.trim()).filter(h=>h.length>0),await this.plugin.saveSettings()}),o.inputEl.rows=4,o.inputEl.style.width="100%"}),e.createEl("h3",{text:"\u{1F4BE} \u5B58\u50A8\u4F18\u5316"}),new w.Setting(e).setName("\u542F\u7528\u538B\u7F29").setDesc("\u4F7F\u7528 gzip \u538B\u7F29\u7248\u672C\u6587\u4EF6,\u663E\u8457\u51CF\u5C11\u5B58\u50A8\u7A7A\u95F4\u5360\u7528").addToggle(o=>o.setValue(this.plugin.settings.enableCompression).onChange(async c=>{this.plugin.settings.enableCompression=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u542F\u7528\u589E\u91CF\u5B58\u50A8").setDesc("\u53EA\u4FDD\u5B58\u7248\u672C\u95F4\u7684\u5DEE\u5F02,\u5927\u5E45\u964D\u4F4E\u5B58\u50A8\u7A7A\u95F4\u4F7F\u7528").addToggle(o=>o.setValue(this.plugin.settings.enableIncrementalStorage).onChange(async c=>{this.plugin.settings.enableIncrementalStorage=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u57FA\u51C6\u7248\u672C\u95F4\u9694").setDesc("\u6BCFN\u4E2A\u7248\u672C\u521B\u5EFA\u4E00\u6B21\u5B8C\u6574\u5FEB\u7167(\u5EFA\u8BAE10-20),\u7528\u4E8E\u589E\u91CF\u5B58\u50A8\u7684\u57FA\u51C6").addText(o=>o.setPlaceholder("10").setValue(String(this.plugin.settings.rebuildBaseInterval)).onChange(async c=>{let h=parseInt(c);!isNaN(h)&&h>0&&(this.plugin.settings.rebuildBaseInterval=h,await this.plugin.saveSettings())})),new w.Setting(e).setName("\u6BCF\u9875\u663E\u793A\u7248\u672C\u6570").setDesc("\u7248\u672C\u5386\u53F2\u89C6\u56FE\u4E2D\u6BCF\u9875\u663E\u793A\u7684\u7248\u672C\u6570\u91CF(0=\u4E0D\u5206\u9875)").addText(o=>o.setPlaceholder("20").setValue(String(this.plugin.settings.versionsPerPage)).onChange(async c=>{let h=parseInt(c);!isNaN(h)&&h>=0&&(this.plugin.settings.versionsPerPage=h,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView())})),new w.Setting(e).setName("\u4F18\u5316\u5B58\u50A8").setDesc("\u91CD\u65B0\u538B\u7F29\u548C\u4F18\u5316\u6240\u6709\u7248\u672C\u6587\u4EF6").addButton(o=>o.setButtonText("\u7ACB\u5373\u4F18\u5316").onClick(async()=>{await this.plugin.optimizeAllVersionFiles(),this.display()})),e.createEl("h3",{text:"\u{1F5D1}\uFE0F \u81EA\u52A8\u6E05\u7406"}),new w.Setting(e).setName("\u542F\u7528\u81EA\u52A8\u6E05\u7406").setDesc("\u81EA\u52A8\u5220\u9664\u65E7\u7248\u672C\u4EE5\u8282\u7701\u7A7A\u95F4").addToggle(o=>o.setValue(this.plugin.settings.autoClear).onChange(async c=>{this.plugin.settings.autoClear=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u6309\u6570\u91CF\u6E05\u7406").setDesc("\u4FDD\u7559\u6307\u5B9A\u6570\u91CF\u7684\u6700\u65B0\u7248\u672C").addToggle(o=>o.setValue(this.plugin.settings.enableMaxVersions).onChange(async c=>{this.plugin.settings.enableMaxVersions=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u6700\u5927\u7248\u672C\u6570").setDesc("\u6BCF\u4E2A\u6587\u4EF6\u6700\u591A\u4FDD\u7559\u7684\u7248\u672C\u6570\u91CF").addText(o=>o.setPlaceholder("50").setValue(String(this.plugin.settings.maxVersions)).onChange(async c=>{let h=parseInt(c);!isNaN(h)&&h>0&&(this.plugin.settings.maxVersions=h,await this.plugin.saveSettings())})),new w.Setting(e).setName("\u6309\u5929\u6570\u6E05\u7406").setDesc("\u81EA\u52A8\u5220\u9664\u8D85\u8FC7\u6307\u5B9A\u5929\u6570\u7684\u7248\u672C").addToggle(o=>o.setValue(this.plugin.settings.enableMaxDays).onChange(async c=>{this.plugin.settings.enableMaxDays=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u6700\u5927\u4FDD\u7559\u5929\u6570").setDesc("\u5220\u9664\u8D85\u8FC7\u6B64\u5929\u6570\u7684\u65E7\u7248\u672C").addText(o=>o.setPlaceholder("30").setValue(String(this.plugin.settings.maxDays)).onChange(async c=>{let h=parseInt(c);!isNaN(h)&&h>0&&(this.plugin.settings.maxDays=h,await this.plugin.saveSettings())})),e.createEl("h3",{text:"\u{1F3A8} \u663E\u793A\u8BBE\u7F6E"}),new w.Setting(e).setName("\u4F7F\u7528\u76F8\u5BF9\u65F6\u95F4").setDesc('\u663E\u793A"3\u5C0F\u65F6\u524D"\u800C\u4E0D\u662F\u5177\u4F53\u65F6\u95F4').addToggle(o=>o.setValue(this.plugin.settings.useRelativeTime).onChange(async c=>{this.plugin.settings.useRelativeTime=c,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView()})),e.createEl("h3",{text:"\u{1F500} \u5DEE\u5F02\u5BF9\u6BD4\u8BBE\u7F6E"}),new w.Setting(e).setName("\u5DEE\u5F02\u7C92\u5EA6").setDesc("\u9009\u62E9\u5DEE\u5F02\u8BA1\u7B97\u7684\u7CBE\u7EC6\u7A0B\u5EA6").addDropdown(o=>o.addOption("char","\u5B57\u7B26\u7EA7 - \u6700\u7CBE\u786E,\u663E\u793A\u6BCF\u4E2A\u5B57\u7B26\u7684\u53D8\u5316").addOption("word","\u5355\u8BCD\u7EA7 - \u6309\u5355\u8BCD\u663E\u793A\u5DEE\u5F02").addOption("line","\u884C\u7EA7 - [\u63A8\u8350] \u6309\u884C\u663E\u793A\u5DEE\u5F02,\u5E76\u9AD8\u4EAE\u884C\u5185\u5355\u8BCD/\u5B57\u7B26\u53D8\u5316").setValue(this.plugin.settings.diffGranularity).onChange(async c=>{this.plugin.settings.diffGranularity=c,await this.plugin.saveSettings()})),new w.Setting(e).setName("\u9ED8\u8BA4\u89C6\u56FE\u6A21\u5F0F").setDesc("\u9009\u62E9\u5DEE\u5F02\u5BF9\u6BD4\u7684\u9ED8\u8BA4\u663E\u793A\u65B9\u5F0F").addDropdown(o=>o.addOption("unified","\u7EDF\u4E00\u89C6\u56FE - \u4E0A\u4E0B\u5BF9\u6BD4").addOption("split","\u5DE6\u53F3\u5206\u680F - \u5E76\u6392\u663E\u793A").setValue(this.plugin.settings.diffViewMode).onChange(async c=>{this.plugin.settings.diffViewMode=c,await this.plugin.saveSettings()})),e.createEl("h3",{text:"\u{1F6E0}\uFE0F \u7EF4\u62A4\u64CD\u4F5C"}),new w.Setting(e).setName("\u6E05\u7406\u6240\u6709\u7248\u672C").setDesc("\u5220\u9664\u6240\u6709\u7248\u672C\u6570\u636E(\u8C28\u614E\u64CD\u4F5C)").addButton(o=>o.setButtonText("\u6E05\u7A7A\u6240\u6709\u7248\u672C").setWarning().onClick(async()=>{new le(this.app,"\u786E\u8BA4\u6E05\u7A7A\u6240\u6709\u7248\u672C",`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664\u6240\u6709\u6587\u4EF6\u7684\u6240\u6709\u7248\u672C\u5386\u53F2!

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500,\u8BF7\u8C28\u614E\u64CD\u4F5C!`,async()=>{await this.clearAllVersions()}).open()})),new w.Setting(e).setName("\u5BFC\u51FA\u7248\u672C\u6570\u636E").setDesc("\u5C06\u7248\u672C\u6587\u4EF6\u5939\u6253\u5305\u5BFC\u51FA").addButton(o=>o.setButtonText("\u521B\u5EFA\u5907\u4EFD").onClick(async()=>{new w.Notice("\u8BF7\u624B\u52A8\u590D\u5236 .versions \u6587\u4EF6\u5939\u8FDB\u884C\u5907\u4EFD")})),e.createEl("h3",{text:"\u{1F4D6} \u4F7F\u7528\u8BF4\u660E"});let s=e.createEl("div",{cls:"version-info-section"}),a=s.createEl("div",{cls:"feature-item"});a.createEl("strong",{text:"\u2728 \u65B0\u529F\u80FD:"});let r=a.createEl("ul");r.createEl("li",{text:"\u7248\u672C\u6807\u7B7E\u7CFB\u7EDF - \u4E3A\u91CD\u8981\u7248\u672C\u6DFB\u52A0\u6807\u7B7E\u8FDB\u884C\u5206\u7C7B"}),r.createEl("li",{text:"\u5FEB\u901F\u9884\u89C8 - \u65E0\u9700\u5B8C\u6574\u5BF9\u6BD4\u5373\u53EF\u67E5\u770B\u7248\u672C\u5185\u5BB9"}),r.createEl("li",{text:"\u7248\u672C\u5907\u6CE8 - \u4E3A\u7248\u672C\u6DFB\u52A0\u8BE6\u7EC6\u8BF4\u660E"}),r.createEl("li",{text:"\u661F\u6807\u6807\u8BB0 - \u6807\u8BB0\u91CD\u8981\u7248\u672C\u4FBF\u4E8E\u67E5\u627E"}),r.createEl("li",{text:"\u9AD8\u7EA7\u7B5B\u9009 - \u6309\u6807\u7B7E\u3001\u661F\u6807\u7B5B\u9009\u7248\u672C"}),r.createEl("li",{text:"\u589E\u5F3A\u5DEE\u5F02\u5BF9\u6BD4 - \u667A\u80FD\u884C\u5185\u9AD8\u4EAE\u3001\u667A\u80FD\u6298\u53E0\u3001\u952E\u76D8\u5BFC\u822A"});let l=s.createEl("div",{cls:"feature-item"});l.createEl("strong",{text:"\u{1F4A1} \u4F7F\u7528\u6280\u5DE7:"});let f=l.createEl("ul");f.createEl("li",{text:"\u53F3\u952E\u70B9\u51FB\u7248\u672C\u53EF\u67E5\u770B\u66F4\u591A\u64CD\u4F5C\u9009\u9879"}),f.createEl("li",{text:"\u70B9\u51FB\u6807\u7B7E\u53EF\u5FEB\u901F\u7B5B\u9009\u76F8\u5173\u7248\u672C"}),f.createEl("li",{text:"\u4F7F\u7528\u661F\u6807\u6807\u8BB0\u91CD\u8981\u7684\u91CC\u7A0B\u7891\u7248\u672C"}),f.createEl("li",{text:'\u5B9A\u671F\u8FD0\u884C"\u4F18\u5316\u5B58\u50A8"\u4EE5\u4FDD\u6301\u6700\u4F73\u6027\u80FD'}),f.createEl("li",{text:"\u589E\u91CF\u5B58\u50A8\u548C\u538B\u7F29\u53EF\u8282\u770190%\u4EE5\u4E0A\u7684\u7A7A\u95F4"}),f.createEl("li",{text:"\u5DEE\u5F02\u5BF9\u6BD4\u4E2D\u4F7F\u7528\u65B9\u5411\u952E \u2191/\u2193 \u5FEB\u901F\u5BFC\u822A"})}async clearAllVersions(){try{let e=this.app.vault.adapter,n=this.plugin.settings.versionFolder;if(await e.exists(n)){let s=await e.list(n),a=0;for(let r of s.files)r.endsWith(".json")&&(await e.remove(r),a++);this.plugin.versionCache.clear(),new w.Notice(`\u2705 \u5DF2\u6E05\u7A7A\u6240\u6709\u7248\u672C(\u5220\u9664 ${a} \u4E2A\u7248\u672C\u6587\u4EF6)`),this.plugin.refreshVersionHistoryView(),this.display()}}catch(e){console.error("\u6E05\u7A7A\u7248\u672C\u5931\u8D25:",e),new w.Notice("\u274C \u6E05\u7A7A\u5931\u8D25,\u8BF7\u67E5\u770B\u63A7\u5236\u53F0")}}};
/*! Bundled license information:

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
