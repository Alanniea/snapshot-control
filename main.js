/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var vt=Object.defineProperty;var Xn=Object.getOwnPropertyDescriptor;var Qn=Object.getOwnPropertyNames;var Kn=Object.prototype.hasOwnProperty;var Jn=(t,n)=>{for(var e in n)vt(t,e,{get:n[e],enumerable:!0})},es=(t,n,e,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of Qn(n))!Kn.call(t,s)&&s!==e&&vt(t,s,{get:()=>n[s],enumerable:!(i=Xn(n,s))||i.enumerable});return t};var ts=t=>es(vt({},"__esModule",{value:!0}),t);var Wr={};Jn(Wr,{default:()=>gt});module.exports=ts(Wr);var p=require("obsidian");var j=class{diff(n,e,i={}){let s;typeof i=="function"?(s=i,i={}):"callback"in i&&(s=i.callback);let a=this.castInput(n,i),r=this.castInput(e,i),l=this.removeEmpty(this.tokenize(a,i)),d=this.removeEmpty(this.tokenize(r,i));return this.diffWithOptionsObj(l,d,i,s)}diffWithOptionsObj(n,e,i,s){var a;let r=E=>{if(E=this.postProcess(E,i),s){setTimeout(function(){s(E)},0);return}else return E},l=e.length,d=n.length,o=1,c=l+d;i.maxEditLength!=null&&(c=Math.min(c,i.maxEditLength));let h=(a=i.timeout)!==null&&a!==void 0?a:1/0,u=Date.now()+h,f=[{oldPos:-1,lastComponent:void 0}],g=this.extractCommon(f[0],e,n,0,i);if(f[0].oldPos+1>=d&&g+1>=l)return r(this.buildValues(f[0].lastComponent,e,n));let _=-1/0,m=1/0,x=()=>{for(let E=Math.max(_,-o);E<=Math.min(m,o);E+=2){let b,w=f[E-1],C=f[E+1];w&&(f[E-1]=void 0);let V=!1;if(C){let S=C.oldPos-E;V=C&&0<=S&&S<l}let y=w&&w.oldPos+1<d;if(!V&&!y){f[E]=void 0;continue}if(!y||V&&w.oldPos<C.oldPos?b=this.addToPath(C,!0,!1,0,i):b=this.addToPath(w,!1,!0,1,i),g=this.extractCommon(b,e,n,E,i),b.oldPos+1>=d&&g+1>=l)return r(this.buildValues(b.lastComponent,e,n))||!0;f[E]=b,b.oldPos+1>=d&&(m=Math.min(m,E-1)),g+1>=l&&(_=Math.max(_,E+1))}o++};if(s)(function E(){setTimeout(function(){if(o>c||Date.now()>u)return s(void 0);x()||E()},0)})();else for(;o<=c&&Date.now()<=u;){let E=x();if(E)return E}}addToPath(n,e,i,s,a){let r=n.lastComponent;return r&&!a.oneChangePerToken&&r.added===e&&r.removed===i?{oldPos:n.oldPos+s,lastComponent:{count:r.count+1,added:e,removed:i,previousComponent:r.previousComponent}}:{oldPos:n.oldPos+s,lastComponent:{count:1,added:e,removed:i,previousComponent:r}}}extractCommon(n,e,i,s,a){let r=e.length,l=i.length,d=n.oldPos,o=d-s,c=0;for(;o+1<r&&d+1<l&&this.equals(i[d+1],e[o+1],a);)o++,d++,c++,a.oneChangePerToken&&(n.lastComponent={count:1,previousComponent:n.lastComponent,added:!1,removed:!1});return c&&!a.oneChangePerToken&&(n.lastComponent={count:c,previousComponent:n.lastComponent,added:!1,removed:!1}),n.oldPos=d,o}equals(n,e,i){return i.comparator?i.comparator(n,e):n===e||!!i.ignoreCase&&n.toLowerCase()===e.toLowerCase()}removeEmpty(n){let e=[];for(let i=0;i<n.length;i++)n[i]&&e.push(n[i]);return e}castInput(n,e){return n}tokenize(n,e){return Array.from(n)}join(n){return n.join("")}postProcess(n,e){return n}get useLongestToken(){return!1}buildValues(n,e,i){let s=[],a;for(;n;)s.push(n),a=n.previousComponent,delete n.previousComponent,n=a;s.reverse();let r=s.length,l=0,d=0,o=0;for(;l<r;l++){let c=s[l];if(c.removed)c.value=this.join(i.slice(o,o+c.count)),o+=c.count;else{if(!c.added&&this.useLongestToken){let h=e.slice(d,d+c.count);h=h.map(function(u,f){let g=i[o+f];return g.length>u.length?g:u}),c.value=this.join(h)}else c.value=this.join(e.slice(d,d+c.count));d+=c.count,c.added||(o+=c.count)}}return s}};var mt=class extends j{},vi=new mt;function we(t,n,e){return vi.diff(t,n,e)}function wt(t,n){let e;for(e=0;e<t.length&&e<n.length;e++)if(t[e]!=n[e])return t.slice(0,e);return t.slice(0,e)}function _t(t,n){let e;if(!t||!n||t[t.length-1]!=n[n.length-1])return"";for(e=0;e<t.length&&e<n.length;e++)if(t[t.length-(e+1)]!=n[n.length-(e+1)])return t.slice(-e);return t.slice(-e)}function Ke(t,n,e){if(t.slice(0,n.length)!=n)throw Error(`string ${JSON.stringify(t)} doesn't start with prefix ${JSON.stringify(n)}; this is a bug`);return e+t.slice(n.length)}function Je(t,n,e){if(!n)return t+e;if(t.slice(-n.length)!=n)throw Error(`string ${JSON.stringify(t)} doesn't end with suffix ${JSON.stringify(n)}; this is a bug`);return t.slice(0,-n.length)+e}function _e(t,n){return Ke(t,n,"")}function Ie(t,n){return Je(t,n,"")}function xt(t,n){return n.slice(0,is(t,n))}function is(t,n){let e=0;t.length>n.length&&(e=t.length-n.length);let i=n.length;t.length<n.length&&(i=t.length);let s=Array(i),a=0;s[0]=0;for(let r=1;r<i;r++){for(n[r]==n[a]?s[r]=s[a]:s[r]=a;a>0&&n[r]!=n[a];)a=s[a];n[r]==n[a]&&a++}a=0;for(let r=e;r<t.length;r++){for(;a>0&&t[r]!=n[a];)a=s[a];t[r]==n[a]&&a++}return a}function mi(t){return t.includes(`\r
`)&&!t.startsWith(`
`)&&!t.match(/[^\r]\n/)}function wi(t){return!t.includes(`\r
`)&&t.includes(`
`)}function xe(t){let n;for(n=t.length-1;n>=0&&t[n].match(/\s/);n--);return t.substring(n+1)}function K(t){let n=t.match(/^\s*/);return n?n[0]:""}var et="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",ns=new RegExp(`[${et}]+|\\s+|[^${et}]`,"ug"),bt=class extends j{equals(n,e,i){return i.ignoreCase&&(n=n.toLowerCase(),e=e.toLowerCase()),n.trim()===e.trim()}tokenize(n,e={}){let i;if(e.intlSegmenter){let r=e.intlSegmenter;if(r.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');i=Array.from(r.segment(n),l=>l.segment)}else i=n.match(ns)||[];let s=[],a=null;return i.forEach(r=>{/\s/.test(r)?a==null?s.push(r):s.push(s.pop()+r):a!=null&&/\s/.test(a)?s[s.length-1]==a?s.push(s.pop()+r):s.push(a+r):s.push(r),a=r}),s}join(n){return n.map((e,i)=>i==0?e:e.replace(/^\s+/,"")).join("")}postProcess(n,e){if(!n||e.oneChangePerToken)return n;let i=null,s=null,a=null;return n.forEach(r=>{r.added?s=r:r.removed?a=r:((s||a)&&_i(i,a,s,r),i=r,s=null,a=null)}),(s||a)&&_i(i,a,s,null),n}},ss=new bt;function _i(t,n,e,i){if(n&&e){let s=K(n.value),a=xe(n.value),r=K(e.value),l=xe(e.value);if(t){let d=wt(s,r);t.value=Je(t.value,r,d),n.value=_e(n.value,d),e.value=_e(e.value,d)}if(i){let d=_t(a,l);i.value=Ke(i.value,l,d),n.value=Ie(n.value,d),e.value=Ie(e.value,d)}}else if(e){if(t){let s=K(e.value);e.value=e.value.substring(s.length)}if(i){let s=K(i.value);i.value=i.value.substring(s.length)}}else if(t&&i){let s=K(i.value),a=K(n.value),r=xe(n.value),l=wt(s,a);n.value=_e(n.value,l);let d=_t(_e(s,l),r);n.value=Ie(n.value,d),i.value=Ke(i.value,s,d),t.value=Je(t.value,s,s.slice(0,s.length-d.length))}else if(i){let s=K(i.value),a=xe(n.value),r=xt(a,s);n.value=Ie(n.value,r)}else if(t){let s=xe(t.value),a=K(n.value),r=xt(s,a);n.value=_e(n.value,r)}}var Et=class extends j{tokenize(n){let e=new RegExp(`(\\r?\\n)|[${et}]+|[^\\S\\n\\r]+|[^${et}]`,"ug");return n.match(e)||[]}},xi=new Et;function Le(t,n,e){return xi.diff(t,n,e)}var yt=class extends j{constructor(){super(...arguments),this.tokenize=as}equals(n,e,i){return i.ignoreWhitespace?((!i.newlineIsToken||!n.includes(`
`))&&(n=n.trim()),(!i.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):i.ignoreNewlineAtEof&&!i.newlineIsToken&&(n.endsWith(`
`)&&(n=n.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),super.equals(n,e,i)}},bi=new yt;function M(t,n,e){return bi.diff(t,n,e)}function as(t,n){n.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));let e=[],i=t.split(/(\n|\r\n)/);i[i.length-1]||i.pop();for(let s=0;s<i.length;s++){let a=i[s];s%2&&!n.newlineIsToken?e[e.length-1]+=a:e.push(a)}return e}function St(t){return Array.isArray(t)?t.map(n=>St(n)):Object.assign(Object.assign({},t),{hunks:t.hunks.map(n=>Object.assign(Object.assign({},n),{lines:n.lines.map((e,i)=>{var s;return e.startsWith("\\")||e.endsWith("\r")||!((s=n.lines[i+1])===null||s===void 0)&&s.startsWith("\\")?e:e+"\r"})}))})}function Ct(t){return Array.isArray(t)?t.map(n=>Ct(n)):Object.assign(Object.assign({},t),{hunks:t.hunks.map(n=>Object.assign(Object.assign({},n),{lines:n.lines.map(e=>e.endsWith("\r")?e.substring(0,e.length-1):e)}))})}function Ei(t){return Array.isArray(t)||(t=[t]),!t.some(n=>n.hunks.some(e=>e.lines.some(i=>!i.startsWith("\\")&&i.endsWith("\r"))))}function yi(t){return Array.isArray(t)||(t=[t]),t.some(n=>n.hunks.some(e=>e.lines.some(i=>i.endsWith("\r"))))&&t.every(n=>n.hunks.every(e=>e.lines.every((i,s)=>{var a;return i.startsWith("\\")||i.endsWith("\r")||((a=e.lines[s+1])===null||a===void 0?void 0:a.startsWith("\\"))})))}function Si(t){let n=t.split(/\n/),e=[],i=0;function s(){let l={};for(e.push(l);i<n.length;){let d=n[i];if(/^(---|\+\+\+|@@)\s/.test(d))break;let o=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(d);o&&(l.index=o[1]),i++}for(a(l),a(l),l.hunks=[];i<n.length;){let d=n[i];if(/^(Index:\s|diff\s|---\s|\+\+\+\s|===================================================================)/.test(d))break;if(/^@@/.test(d))l.hunks.push(r());else{if(d)throw new Error("Unknown line "+(i+1)+" "+JSON.stringify(d));i++}}}function a(l){let d=/^(---|\+\+\+)\s+(.*)\r?$/.exec(n[i]);if(d){let o=d[2].split("	",2),c=(o[1]||"").trim(),h=o[0].replace(/\\\\/g,"\\");/^".*"$/.test(h)&&(h=h.substr(1,h.length-2)),d[1]==="---"?(l.oldFileName=h,l.oldHeader=c):(l.newFileName=h,l.newHeader=c),i++}}function r(){var l;let d=i,o=n[i++],c=o.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),h={oldStart:+c[1],oldLines:typeof c[2]=="undefined"?1:+c[2],newStart:+c[3],newLines:typeof c[4]=="undefined"?1:+c[4],lines:[]};h.oldLines===0&&(h.oldStart+=1),h.newLines===0&&(h.newStart+=1);let u=0,f=0;for(;i<n.length&&(f<h.oldLines||u<h.newLines||!((l=n[i])===null||l===void 0)&&l.startsWith("\\"));i++){let g=n[i].length==0&&i!=n.length-1?" ":n[i][0];if(g==="+"||g==="-"||g===" "||g==="\\")h.lines.push(n[i]),g==="+"?u++:g==="-"?f++:g===" "&&(u++,f++);else throw new Error(`Hunk at line ${d+1} contained invalid line ${n[i]}`)}if(!u&&h.newLines===1&&(h.newLines=0),!f&&h.oldLines===1&&(h.oldLines=0),u!==h.newLines)throw new Error("Added line count did not match for hunk at line "+(d+1));if(f!==h.oldLines)throw new Error("Removed line count did not match for hunk at line "+(d+1));return h}for(;i<n.length;)s();return e}function Ci(t,n,e){let i=!0,s=!1,a=!1,r=1;return function l(){if(i&&!a){if(s?r++:i=!1,t+r<=e)return t+r;a=!0}if(!s)return a||(i=!0),n<=t-r?t-r++:(s=!0,l())}}function kt(t,n,e={}){let i;if(typeof n=="string"?i=Si(n):Array.isArray(n)?i=n:i=[n],i.length>1)throw new Error("applyPatch only works with a single input.");return rs(t,i[0],e)}function rs(t,n,e={}){(e.autoConvertLineEndings||e.autoConvertLineEndings==null)&&(mi(t)&&Ei(n)?n=St(n):wi(t)&&yi(n)&&(n=Ct(n)));let i=t.split(`
`),s=n.hunks,a=e.compareLine||((g,_,m,x)=>_===x),r=e.fuzzFactor||0,l=0;if(r<0||!Number.isInteger(r))throw new Error("fuzzFactor must be a non-negative integer");if(!s.length)return t;let d="",o=!1,c=!1;for(let g=0;g<s[s.length-1].lines.length;g++){let _=s[s.length-1].lines[g];_[0]=="\\"&&(d[0]=="+"?o=!0:d[0]=="-"&&(c=!0)),d=_}if(o){if(c){if(!r&&i[i.length-1]=="")return!1}else if(i[i.length-1]=="")i.pop();else if(!r)return!1}else if(c){if(i[i.length-1]!="")i.push("");else if(!r)return!1}function h(g,_,m,x=0,E=!0,b=[],w=0){let C=0,V=!1;for(;x<g.length;x++){let y=g[x],S=y.length>0?y[0]:" ",k=y.length>0?y.substr(1):y;if(S==="-")if(a(_+1,i[_],S,k))_++,C=0;else return!m||i[_]==null?null:(b[w]=i[_],h(g,_+1,m-1,x,!1,b,w+1));if(S==="+"){if(!E)return null;b[w]=k,w++,C=0,V=!0}if(S===" ")if(C++,b[w]=i[_],a(_+1,i[_],S,k))w++,E=!0,V=!1,_++;else return V||!m?null:i[_]&&(h(g,_+1,m-1,x+1,!1,b,w+1)||h(g,_+1,m-1,x,!1,b,w+1))||h(g,_,m-1,x+1,!1,b,w)}return w-=C,_-=C,b.length=w,{patchedLines:b,oldLineLastI:_-1}}let u=[],f=0;for(let g=0;g<s.length;g++){let _=s[g],m,x=i.length-_.oldLines+r,E;for(let b=0;b<=r;b++){E=_.oldStart+f-1;let w=Ci(E,l,x);for(;E!==void 0&&(m=h(_.lines,E,b),!m);E=w());if(m)break}if(!m)return!1;for(let b=l;b<E;b++)u.push(i[b]);for(let b=0;b<m.patchedLines.length;b++){let w=m.patchedLines[b];u.push(w)}l=m.oldLineLastI+1,f=E+1-_.oldStart}for(let g=l;g<i.length;g++)u.push(i[g]);return u.join(`
`)}function Tt(t,n,e,i,s,a,r){let l;r?typeof r=="function"?l={callback:r}:l=r:l={},typeof l.context=="undefined"&&(l.context=4);let d=l.context;if(l.newlineIsToken)throw new Error("newlineIsToken may not be used with patch-generation functions, only with diffing functions");if(l.callback){let{callback:c}=l;M(e,i,Object.assign(Object.assign({},l),{callback:h=>{let u=o(h);c(u)}}))}else return o(M(e,i,l));function o(c){if(!c)return;c.push({value:"",lines:[]});function h(E){return E.map(function(b){return" "+b})}let u=[],f=0,g=0,_=[],m=1,x=1;for(let E=0;E<c.length;E++){let b=c[E],w=b.lines||os(b.value);if(b.lines=w,b.added||b.removed){if(!f){let C=c[E-1];f=m,g=x,C&&(_=d>0?h(C.lines.slice(-d)):[],f-=_.length,g-=_.length)}for(let C of w)_.push((b.added?"+":"-")+C);b.added?x+=w.length:m+=w.length}else{if(f)if(w.length<=d*2&&E<c.length-2)for(let C of h(w))_.push(C);else{let C=Math.min(w.length,d);for(let y of h(w.slice(0,C)))_.push(y);let V={oldStart:f,oldLines:m-f+C,newStart:g,newLines:x-g+C,lines:_};u.push(V),f=0,g=0,_=[]}m+=w.length,x+=w.length}}for(let E of u)for(let b=0;b<E.lines.length;b++)E.lines[b].endsWith(`
`)?E.lines[b]=E.lines[b].slice(0,-1):(E.lines.splice(b+1,0,"\\ No newline at end of file"),b++);return{oldFileName:t,newFileName:n,oldHeader:s,newHeader:a,hunks:u}}}function tt(t){if(Array.isArray(t))return t.map(tt).join(`
`);let n=[];t.oldFileName==t.newFileName&&n.push("Index: "+t.oldFileName),n.push("==================================================================="),n.push("--- "+t.oldFileName+(typeof t.oldHeader=="undefined"?"":"	"+t.oldHeader)),n.push("+++ "+t.newFileName+(typeof t.newHeader=="undefined"?"":"	"+t.newHeader));for(let e=0;e<t.hunks.length;e++){let i=t.hunks[e];i.oldLines===0&&(i.oldStart-=1),i.newLines===0&&(i.newStart-=1),n.push("@@ -"+i.oldStart+","+i.oldLines+" +"+i.newStart+","+i.newLines+" @@");for(let s of i.lines)n.push(s)}return n.join(`
`)+`
`}function ki(t,n,e,i,s,a,r){if(typeof r=="function"&&(r={callback:r}),r!=null&&r.callback){let{callback:l}=r;Tt(t,n,e,i,s,a,Object.assign(Object.assign({},r),{callback:d=>{l(d?tt(d):void 0)}}))}else{let l=Tt(t,n,e,i,s,a,r);return l?tt(l):void 0}}function Dt(t,n,e,i,s,a){return ki(t,t,n,e,i,s,a)}function os(t){let n=t.endsWith(`
`),e=t.split(`
`).map(i=>i+`
`);return n?e.pop():e.push(e.pop().slice(0,-1)),e}function ke(t){let n=t.length;for(;--n>=0;)t[n]=0}var cs=0,hn=1,ds=2,fs=3,hs=258,Kt=29,je=256,Ne=je+1+Kt,ye=30,Jt=19,un=2*Ne+1,de=15,Vt=16,us=7,ei=256,gn=16,pn=17,vn=18,Zt=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ot=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),gs=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),mn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ps=512,ee=new Array((Ne+2)*2);ke(ee);var ze=new Array(ye*2);ke(ze);var Re=new Array(ps);ke(Re);var Oe=new Array(hs-fs+1);ke(Oe);var ti=new Array(Kt);ke(ti);var lt=new Array(ye);ke(lt);function It(t,n,e,i,s){this.static_tree=t,this.extra_bits=n,this.extra_base=e,this.elems=i,this.max_length=s,this.has_stree=t&&t.length}var wn,_n,xn;function Lt(t,n){this.dyn_tree=t,this.max_code=0,this.stat_desc=n}var bn=t=>t<256?Re[t]:Re[256+(t>>>7)],Pe=(t,n)=>{t.pending_buf[t.pending++]=n&255,t.pending_buf[t.pending++]=n>>>8&255},$=(t,n,e)=>{t.bi_valid>Vt-e?(t.bi_buf|=n<<t.bi_valid&65535,Pe(t,t.bi_buf),t.bi_buf=n>>Vt-t.bi_valid,t.bi_valid+=e-Vt):(t.bi_buf|=n<<t.bi_valid&65535,t.bi_valid+=e)},q=(t,n,e)=>{$(t,e[n*2],e[n*2+1])},En=(t,n)=>{let e=0;do e|=t&1,t>>>=1,e<<=1;while(--n>0);return e>>>1},vs=t=>{t.bi_valid===16?(Pe(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},ms=(t,n)=>{let e=n.dyn_tree,i=n.max_code,s=n.stat_desc.static_tree,a=n.stat_desc.has_stree,r=n.stat_desc.extra_bits,l=n.stat_desc.extra_base,d=n.stat_desc.max_length,o,c,h,u,f,g,_=0;for(u=0;u<=de;u++)t.bl_count[u]=0;for(e[t.heap[t.heap_max]*2+1]=0,o=t.heap_max+1;o<un;o++)c=t.heap[o],u=e[e[c*2+1]*2+1]+1,u>d&&(u=d,_++),e[c*2+1]=u,!(c>i)&&(t.bl_count[u]++,f=0,c>=l&&(f=r[c-l]),g=e[c*2],t.opt_len+=g*(u+f),a&&(t.static_len+=g*(s[c*2+1]+f)));if(_!==0){do{for(u=d-1;t.bl_count[u]===0;)u--;t.bl_count[u]--,t.bl_count[u+1]+=2,t.bl_count[d]--,_-=2}while(_>0);for(u=d;u!==0;u--)for(c=t.bl_count[u];c!==0;)h=t.heap[--o],!(h>i)&&(e[h*2+1]!==u&&(t.opt_len+=(u-e[h*2+1])*e[h*2],e[h*2+1]=u),c--)}},yn=(t,n,e)=>{let i=new Array(de+1),s=0,a,r;for(a=1;a<=de;a++)s=s+e[a-1]<<1,i[a]=s;for(r=0;r<=n;r++){let l=t[r*2+1];l!==0&&(t[r*2]=En(i[l]++,l))}},ws=()=>{let t,n,e,i,s,a=new Array(de+1);for(e=0,i=0;i<Kt-1;i++)for(ti[i]=e,t=0;t<1<<Zt[i];t++)Oe[e++]=i;for(Oe[e-1]=i,s=0,i=0;i<16;i++)for(lt[i]=s,t=0;t<1<<ot[i];t++)Re[s++]=i;for(s>>=7;i<ye;i++)for(lt[i]=s<<7,t=0;t<1<<ot[i]-7;t++)Re[256+s++]=i;for(n=0;n<=de;n++)a[n]=0;for(t=0;t<=143;)ee[t*2+1]=8,t++,a[8]++;for(;t<=255;)ee[t*2+1]=9,t++,a[9]++;for(;t<=279;)ee[t*2+1]=7,t++,a[7]++;for(;t<=287;)ee[t*2+1]=8,t++,a[8]++;for(yn(ee,Ne+1,a),t=0;t<ye;t++)ze[t*2+1]=5,ze[t*2]=En(t,5);wn=new It(ee,Zt,je+1,Ne,de),_n=new It(ze,ot,0,ye,de),xn=new It(new Array(0),gs,0,Jt,us)},Sn=t=>{let n;for(n=0;n<Ne;n++)t.dyn_ltree[n*2]=0;for(n=0;n<ye;n++)t.dyn_dtree[n*2]=0;for(n=0;n<Jt;n++)t.bl_tree[n*2]=0;t.dyn_ltree[ei*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Cn=t=>{t.bi_valid>8?Pe(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Ti=(t,n,e,i)=>{let s=n*2,a=e*2;return t[s]<t[a]||t[s]===t[a]&&i[n]<=i[e]},Ft=(t,n,e)=>{let i=t.heap[e],s=e<<1;for(;s<=t.heap_len&&(s<t.heap_len&&Ti(n,t.heap[s+1],t.heap[s],t.depth)&&s++,!Ti(n,i,t.heap[s],t.depth));)t.heap[e]=t.heap[s],e=s,s<<=1;t.heap[e]=i},Di=(t,n,e)=>{let i,s,a=0,r,l;if(t.sym_next!==0)do i=t.pending_buf[t.sym_buf+a++]&255,i+=(t.pending_buf[t.sym_buf+a++]&255)<<8,s=t.pending_buf[t.sym_buf+a++],i===0?q(t,s,n):(r=Oe[s],q(t,r+je+1,n),l=Zt[r],l!==0&&(s-=ti[r],$(t,s,l)),i--,r=bn(i),q(t,r,e),l=ot[r],l!==0&&(i-=lt[r],$(t,i,l)));while(a<t.sym_next);q(t,ei,n)},Ut=(t,n)=>{let e=n.dyn_tree,i=n.stat_desc.static_tree,s=n.stat_desc.has_stree,a=n.stat_desc.elems,r,l,d=-1,o;for(t.heap_len=0,t.heap_max=un,r=0;r<a;r++)e[r*2]!==0?(t.heap[++t.heap_len]=d=r,t.depth[r]=0):e[r*2+1]=0;for(;t.heap_len<2;)o=t.heap[++t.heap_len]=d<2?++d:0,e[o*2]=1,t.depth[o]=0,t.opt_len--,s&&(t.static_len-=i[o*2+1]);for(n.max_code=d,r=t.heap_len>>1;r>=1;r--)Ft(t,e,r);o=a;do r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Ft(t,e,1),l=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=l,e[o*2]=e[r*2]+e[l*2],t.depth[o]=(t.depth[r]>=t.depth[l]?t.depth[r]:t.depth[l])+1,e[r*2+1]=e[l*2+1]=o,t.heap[1]=o++,Ft(t,e,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],ms(t,n),yn(e,d,t.bl_count)},Vi=(t,n,e)=>{let i,s=-1,a,r=n[0*2+1],l=0,d=7,o=4;for(r===0&&(d=138,o=3),n[(e+1)*2+1]=65535,i=0;i<=e;i++)a=r,r=n[(i+1)*2+1],!(++l<d&&a===r)&&(l<o?t.bl_tree[a*2]+=l:a!==0?(a!==s&&t.bl_tree[a*2]++,t.bl_tree[gn*2]++):l<=10?t.bl_tree[pn*2]++:t.bl_tree[vn*2]++,l=0,s=a,r===0?(d=138,o=3):a===r?(d=6,o=3):(d=7,o=4))},Ii=(t,n,e)=>{let i,s=-1,a,r=n[0*2+1],l=0,d=7,o=4;for(r===0&&(d=138,o=3),i=0;i<=e;i++)if(a=r,r=n[(i+1)*2+1],!(++l<d&&a===r)){if(l<o)do q(t,a,t.bl_tree);while(--l!==0);else a!==0?(a!==s&&(q(t,a,t.bl_tree),l--),q(t,gn,t.bl_tree),$(t,l-3,2)):l<=10?(q(t,pn,t.bl_tree),$(t,l-3,3)):(q(t,vn,t.bl_tree),$(t,l-11,7));l=0,s=a,r===0?(d=138,o=3):a===r?(d=6,o=3):(d=7,o=4)}},_s=t=>{let n;for(Vi(t,t.dyn_ltree,t.l_desc.max_code),Vi(t,t.dyn_dtree,t.d_desc.max_code),Ut(t,t.bl_desc),n=Jt-1;n>=3&&t.bl_tree[mn[n]*2+1]===0;n--);return t.opt_len+=3*(n+1)+5+5+4,n},xs=(t,n,e,i)=>{let s;for($(t,n-257,5),$(t,e-1,5),$(t,i-4,4),s=0;s<i;s++)$(t,t.bl_tree[mn[s]*2+1],3);Ii(t,t.dyn_ltree,n-1),Ii(t,t.dyn_dtree,e-1)},bs=t=>{let n=4093624447,e;for(e=0;e<=31;e++,n>>>=1)if(n&1&&t.dyn_ltree[e*2]!==0)return 0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return 1;for(e=32;e<je;e++)if(t.dyn_ltree[e*2]!==0)return 1;return 0},Li=!1,Es=t=>{Li||(ws(),Li=!0),t.l_desc=new Lt(t.dyn_ltree,wn),t.d_desc=new Lt(t.dyn_dtree,_n),t.bl_desc=new Lt(t.bl_tree,xn),t.bi_buf=0,t.bi_valid=0,Sn(t)},kn=(t,n,e,i)=>{$(t,(cs<<1)+(i?1:0),3),Cn(t),Pe(t,e),Pe(t,~e),e&&t.pending_buf.set(t.window.subarray(n,n+e),t.pending),t.pending+=e},ys=t=>{$(t,hn<<1,3),q(t,ei,ee),vs(t)},Ss=(t,n,e,i)=>{let s,a,r=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=bs(t)),Ut(t,t.l_desc),Ut(t,t.d_desc),r=_s(t),s=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=s&&(s=a)):s=a=e+5,e+4<=s&&n!==-1?kn(t,n,e,i):t.strategy===4||a===s?($(t,(hn<<1)+(i?1:0),3),Di(t,ee,ze)):($(t,(ds<<1)+(i?1:0),3),xs(t,t.l_desc.max_code+1,t.d_desc.max_code+1,r+1),Di(t,t.dyn_ltree,t.dyn_dtree)),Sn(t),i&&Cn(t)},Cs=(t,n,e)=>(t.pending_buf[t.sym_buf+t.sym_next++]=n,t.pending_buf[t.sym_buf+t.sym_next++]=n>>8,t.pending_buf[t.sym_buf+t.sym_next++]=e,n===0?t.dyn_ltree[e*2]++:(t.matches++,n--,t.dyn_ltree[(Oe[e]+je+1)*2]++,t.dyn_dtree[bn(n)*2]++),t.sym_next===t.sym_end),ks=Es,Ts=kn,Ds=Ss,Vs=Cs,Is=ys,Ls={_tr_init:ks,_tr_stored_block:Ts,_tr_flush_block:Ds,_tr_tally:Vs,_tr_align:Is},Fs=(t,n,e,i)=>{let s=t&65535|0,a=t>>>16&65535|0,r=0;for(;e!==0;){r=e>2e3?2e3:e,e-=r;do s=s+n[i++]|0,a=a+s|0;while(--r);s%=65521,a%=65521}return s|a<<16|0},He=Fs,As=()=>{let t,n=[];for(var e=0;e<256;e++){t=e;for(var i=0;i<8;i++)t=t&1?3988292384^t>>>1:t>>>1;n[e]=t}return n},Bs=new Uint32Array(As()),zs=(t,n,e,i)=>{let s=Bs,a=i+e;t^=-1;for(let r=i;r<a;r++)t=t>>>8^s[(t^n[r])&255];return t^-1},A=zs,ue={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Te={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Ms,_tr_stored_block:Wt,_tr_flush_block:$s,_tr_tally:ae,_tr_align:Ns}=Ls,{Z_NO_FLUSH:re,Z_PARTIAL_FLUSH:Rs,Z_FULL_FLUSH:Os,Z_FINISH:H,Z_BLOCK:Fi,Z_OK:B,Z_STREAM_END:Ai,Z_STREAM_ERROR:Y,Z_DATA_ERROR:Ps,Z_BUF_ERROR:At,Z_DEFAULT_COMPRESSION:Hs,Z_FILTERED:Zs,Z_HUFFMAN_ONLY:it,Z_RLE:Us,Z_FIXED:Ws,Z_DEFAULT_STRATEGY:js,Z_UNKNOWN:Gs,Z_DEFLATED:ft}=Te,qs=9,Ys=15,Xs=8,Qs=29,Ks=256,jt=Ks+1+Qs,Js=30,ea=19,ta=2*jt+1,ia=15,I=3,se=258,X=se+I+1,na=32,Se=42,ii=57,Gt=69,qt=73,Yt=91,Xt=103,fe=113,Ae=666,z=1,De=2,ge=3,Ve=4,sa=3,he=(t,n)=>(t.msg=ue[n],n),Bi=t=>t*2-(t>4?9:0),ne=t=>{let n=t.length;for(;--n>=0;)t[n]=0},aa=t=>{let n,e,i,s=t.w_size;n=t.hash_size,i=n;do e=t.head[--i],t.head[i]=e>=s?e-s:0;while(--n);n=s,i=n;do e=t.prev[--i],t.prev[i]=e>=s?e-s:0;while(--n)},ra=(t,n,e)=>(n<<t.hash_shift^e)&t.hash_mask,oe=ra,N=t=>{let n=t.state,e=n.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+e),t.next_out),t.next_out+=e,n.pending_out+=e,t.total_out+=e,t.avail_out-=e,n.pending-=e,n.pending===0&&(n.pending_out=0))},R=(t,n)=>{$s(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,n),t.block_start=t.strstart,N(t.strm)},L=(t,n)=>{t.pending_buf[t.pending++]=n},Fe=(t,n)=>{t.pending_buf[t.pending++]=n>>>8&255,t.pending_buf[t.pending++]=n&255},Qt=(t,n,e,i)=>{let s=t.avail_in;return s>i&&(s=i),s===0?0:(t.avail_in-=s,n.set(t.input.subarray(t.next_in,t.next_in+s),e),t.state.wrap===1?t.adler=He(t.adler,n,s,e):t.state.wrap===2&&(t.adler=A(t.adler,n,s,e)),t.next_in+=s,t.total_in+=s,s)},Tn=(t,n)=>{let e=t.max_chain_length,i=t.strstart,s,a,r=t.prev_length,l=t.nice_match,d=t.strstart>t.w_size-X?t.strstart-(t.w_size-X):0,o=t.window,c=t.w_mask,h=t.prev,u=t.strstart+se,f=o[i+r-1],g=o[i+r];t.prev_length>=t.good_match&&(e>>=2),l>t.lookahead&&(l=t.lookahead);do if(s=n,!(o[s+r]!==g||o[s+r-1]!==f||o[s]!==o[i]||o[++s]!==o[i+1])){i+=2,s++;do;while(o[++i]===o[++s]&&o[++i]===o[++s]&&o[++i]===o[++s]&&o[++i]===o[++s]&&o[++i]===o[++s]&&o[++i]===o[++s]&&o[++i]===o[++s]&&o[++i]===o[++s]&&i<u);if(a=se-(u-i),i=u-se,a>r){if(t.match_start=n,r=a,a>=l)break;f=o[i+r-1],g=o[i+r]}}while((n=h[n&c])>d&&--e!==0);return r<=t.lookahead?r:t.lookahead},Ce=t=>{let n=t.w_size,e,i,s;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=n+(n-X)&&(t.window.set(t.window.subarray(n,n+n-i),0),t.match_start-=n,t.strstart-=n,t.block_start-=n,t.insert>t.strstart&&(t.insert=t.strstart),aa(t),i+=n),t.strm.avail_in===0)break;if(e=Qt(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=e,t.lookahead+t.insert>=I)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=oe(t,t.ins_h,t.window[s+1]);t.insert&&(t.ins_h=oe(t,t.ins_h,t.window[s+I-1]),t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<I)););}while(t.lookahead<X&&t.strm.avail_in!==0)},Dn=(t,n)=>{let e=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,i,s,a,r=0,l=t.strm.avail_in;do{if(i=65535,a=t.bi_valid+42>>3,t.strm.avail_out<a||(a=t.strm.avail_out-a,s=t.strstart-t.block_start,i>s+t.strm.avail_in&&(i=s+t.strm.avail_in),i>a&&(i=a),i<e&&(i===0&&n!==H||n===re||i!==s+t.strm.avail_in)))break;r=n===H&&i===s+t.strm.avail_in?1:0,Wt(t,0,0,r),t.pending_buf[t.pending-4]=i,t.pending_buf[t.pending-3]=i>>8,t.pending_buf[t.pending-2]=~i,t.pending_buf[t.pending-1]=~i>>8,N(t.strm),s&&(s>i&&(s=i),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+s),t.strm.next_out),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s,t.block_start+=s,i-=s),i&&(Qt(t.strm,t.strm.output,t.strm.next_out,i),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i)}while(r===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),r?Ve:n!==re&&n!==H&&t.strm.avail_in===0&&t.strstart===t.block_start?De:(a=t.window_size-t.strstart,t.strm.avail_in>a&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,a+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),a>t.strm.avail_in&&(a=t.strm.avail_in),a&&(Qt(t.strm,t.window,t.strstart,a),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.high_water<t.strstart&&(t.high_water=t.strstart),a=t.bi_valid+42>>3,a=t.pending_buf_size-a>65535?65535:t.pending_buf_size-a,e=a>t.w_size?t.w_size:a,s=t.strstart-t.block_start,(s>=e||(s||n===H)&&n!==re&&t.strm.avail_in===0&&s<=a)&&(i=s>a?a:s,r=n===H&&t.strm.avail_in===0&&i===s?1:0,Wt(t,t.block_start,i,r),t.block_start+=i,N(t.strm)),r?ge:z)},Bt=(t,n)=>{let e,i;for(;;){if(t.lookahead<X){if(Ce(t),t.lookahead<X&&n===re)return z;if(t.lookahead===0)break}if(e=0,t.lookahead>=I&&(t.ins_h=oe(t,t.ins_h,t.window[t.strstart+I-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),e!==0&&t.strstart-e<=t.w_size-X&&(t.match_length=Tn(t,e)),t.match_length>=I)if(i=ae(t,t.strstart-t.match_start,t.match_length-I),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=I){t.match_length--;do t.strstart++,t.ins_h=oe(t,t.ins_h,t.window[t.strstart+I-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=oe(t,t.ins_h,t.window[t.strstart+1]);else i=ae(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(R(t,!1),t.strm.avail_out===0))return z}return t.insert=t.strstart<I-1?t.strstart:I-1,n===H?(R(t,!0),t.strm.avail_out===0?ge:Ve):t.sym_next&&(R(t,!1),t.strm.avail_out===0)?z:De},be=(t,n)=>{let e,i,s;for(;;){if(t.lookahead<X){if(Ce(t),t.lookahead<X&&n===re)return z;if(t.lookahead===0)break}if(e=0,t.lookahead>=I&&(t.ins_h=oe(t,t.ins_h,t.window[t.strstart+I-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=I-1,e!==0&&t.prev_length<t.max_lazy_match&&t.strstart-e<=t.w_size-X&&(t.match_length=Tn(t,e),t.match_length<=5&&(t.strategy===Zs||t.match_length===I&&t.strstart-t.match_start>4096)&&(t.match_length=I-1)),t.prev_length>=I&&t.match_length<=t.prev_length){s=t.strstart+t.lookahead-I,i=ae(t,t.strstart-1-t.prev_match,t.prev_length-I),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=s&&(t.ins_h=oe(t,t.ins_h,t.window[t.strstart+I-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=I-1,t.strstart++,i&&(R(t,!1),t.strm.avail_out===0))return z}else if(t.match_available){if(i=ae(t,0,t.window[t.strstart-1]),i&&R(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return z}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=ae(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<I-1?t.strstart:I-1,n===H?(R(t,!0),t.strm.avail_out===0?ge:Ve):t.sym_next&&(R(t,!1),t.strm.avail_out===0)?z:De},oa=(t,n)=>{let e,i,s,a,r=t.window;for(;;){if(t.lookahead<=se){if(Ce(t),t.lookahead<=se&&n===re)return z;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=I&&t.strstart>0&&(s=t.strstart-1,i=r[s],i===r[++s]&&i===r[++s]&&i===r[++s])){a=t.strstart+se;do;while(i===r[++s]&&i===r[++s]&&i===r[++s]&&i===r[++s]&&i===r[++s]&&i===r[++s]&&i===r[++s]&&i===r[++s]&&s<a);t.match_length=se-(a-s),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=I?(e=ae(t,1,t.match_length-I),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(e=ae(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),e&&(R(t,!1),t.strm.avail_out===0))return z}return t.insert=0,n===H?(R(t,!0),t.strm.avail_out===0?ge:Ve):t.sym_next&&(R(t,!1),t.strm.avail_out===0)?z:De},la=(t,n)=>{let e;for(;;){if(t.lookahead===0&&(Ce(t),t.lookahead===0)){if(n===re)return z;break}if(t.match_length=0,e=ae(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,e&&(R(t,!1),t.strm.avail_out===0))return z}return t.insert=0,n===H?(R(t,!0),t.strm.avail_out===0?ge:Ve):t.sym_next&&(R(t,!1),t.strm.avail_out===0)?z:De};function G(t,n,e,i,s){this.good_length=t,this.max_lazy=n,this.nice_length=e,this.max_chain=i,this.func=s}var Be=[new G(0,0,0,0,Dn),new G(4,4,8,4,Bt),new G(4,5,16,8,Bt),new G(4,6,32,32,Bt),new G(4,4,16,16,be),new G(8,16,32,32,be),new G(8,16,128,128,be),new G(8,32,128,256,be),new G(32,128,258,1024,be),new G(32,258,258,4096,be)],ca=t=>{t.window_size=2*t.w_size,ne(t.head),t.max_lazy_match=Be[t.level].max_lazy,t.good_match=Be[t.level].good_length,t.nice_match=Be[t.level].nice_length,t.max_chain_length=Be[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=I-1,t.match_available=0,t.ins_h=0};function da(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ft,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(ta*2),this.dyn_dtree=new Uint16Array((2*Js+1)*2),this.bl_tree=new Uint16Array((2*ea+1)*2),ne(this.dyn_ltree),ne(this.dyn_dtree),ne(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(ia+1),this.heap=new Uint16Array(2*jt+1),ne(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*jt+1),ne(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Ge=t=>{if(!t)return 1;let n=t.state;return!n||n.strm!==t||n.status!==Se&&n.status!==ii&&n.status!==Gt&&n.status!==qt&&n.status!==Yt&&n.status!==Xt&&n.status!==fe&&n.status!==Ae?1:0},Vn=t=>{if(Ge(t))return he(t,Y);t.total_in=t.total_out=0,t.data_type=Gs;let n=t.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap===2?ii:n.wrap?Se:fe,t.adler=n.wrap===2?0:1,n.last_flush=-2,Ms(n),B},In=t=>{let n=Vn(t);return n===B&&ca(t.state),n},fa=(t,n)=>Ge(t)||t.state.wrap!==2?Y:(t.state.gzhead=n,B),Ln=(t,n,e,i,s,a)=>{if(!t)return Y;let r=1;if(n===Hs&&(n=6),i<0?(r=0,i=-i):i>15&&(r=2,i-=16),s<1||s>qs||e!==ft||i<8||i>15||n<0||n>9||a<0||a>Ws||i===8&&r!==1)return he(t,Y);i===8&&(i=9);let l=new da;return t.state=l,l.strm=t,l.status=Se,l.wrap=r,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+I-1)/I),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=n,l.strategy=a,l.method=e,In(t)},ha=(t,n)=>Ln(t,n,ft,Ys,Xs,js),ua=(t,n)=>{if(Ge(t)||n>Fi||n<0)return t?he(t,Y):Y;let e=t.state;if(!t.output||t.avail_in!==0&&!t.input||e.status===Ae&&n!==H)return he(t,t.avail_out===0?At:Y);let i=e.last_flush;if(e.last_flush=n,e.pending!==0){if(N(t),t.avail_out===0)return e.last_flush=-1,B}else if(t.avail_in===0&&Bi(n)<=Bi(i)&&n!==H)return he(t,At);if(e.status===Ae&&t.avail_in!==0)return he(t,At);if(e.status===Se&&e.wrap===0&&(e.status=fe),e.status===Se){let s=ft+(e.w_bits-8<<4)<<8,a=-1;if(e.strategy>=it||e.level<2?a=0:e.level<6?a=1:e.level===6?a=2:a=3,s|=a<<6,e.strstart!==0&&(s|=na),s+=31-s%31,Fe(e,s),e.strstart!==0&&(Fe(e,t.adler>>>16),Fe(e,t.adler&65535)),t.adler=1,e.status=fe,N(t),e.pending!==0)return e.last_flush=-1,B}if(e.status===ii){if(t.adler=0,L(e,31),L(e,139),L(e,8),e.gzhead)L(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),L(e,e.gzhead.time&255),L(e,e.gzhead.time>>8&255),L(e,e.gzhead.time>>16&255),L(e,e.gzhead.time>>24&255),L(e,e.level===9?2:e.strategy>=it||e.level<2?4:0),L(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(L(e,e.gzhead.extra.length&255),L(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(t.adler=A(t.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=Gt;else if(L(e,0),L(e,0),L(e,0),L(e,0),L(e,0),L(e,e.level===9?2:e.strategy>=it||e.level<2?4:0),L(e,sa),e.status=fe,N(t),e.pending!==0)return e.last_flush=-1,B}if(e.status===Gt){if(e.gzhead.extra){let s=e.pending,a=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+a>e.pending_buf_size;){let l=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+l),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>s&&(t.adler=A(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex+=l,N(t),e.pending!==0)return e.last_flush=-1,B;s=0,a-=l}let r=new Uint8Array(e.gzhead.extra);e.pending_buf.set(r.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending+=a,e.gzhead.hcrc&&e.pending>s&&(t.adler=A(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=qt}if(e.status===qt){if(e.gzhead.name){let s=e.pending,a;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(t.adler=A(t.adler,e.pending_buf,e.pending-s,s)),N(t),e.pending!==0)return e.last_flush=-1,B;s=0}e.gzindex<e.gzhead.name.length?a=e.gzhead.name.charCodeAt(e.gzindex++)&255:a=0,L(e,a)}while(a!==0);e.gzhead.hcrc&&e.pending>s&&(t.adler=A(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=Yt}if(e.status===Yt){if(e.gzhead.comment){let s=e.pending,a;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(t.adler=A(t.adler,e.pending_buf,e.pending-s,s)),N(t),e.pending!==0)return e.last_flush=-1,B;s=0}e.gzindex<e.gzhead.comment.length?a=e.gzhead.comment.charCodeAt(e.gzindex++)&255:a=0,L(e,a)}while(a!==0);e.gzhead.hcrc&&e.pending>s&&(t.adler=A(t.adler,e.pending_buf,e.pending-s,s))}e.status=Xt}if(e.status===Xt){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(N(t),e.pending!==0))return e.last_flush=-1,B;L(e,t.adler&255),L(e,t.adler>>8&255),t.adler=0}if(e.status=fe,N(t),e.pending!==0)return e.last_flush=-1,B}if(t.avail_in!==0||e.lookahead!==0||n!==re&&e.status!==Ae){let s=e.level===0?Dn(e,n):e.strategy===it?la(e,n):e.strategy===Us?oa(e,n):Be[e.level].func(e,n);if((s===ge||s===Ve)&&(e.status=Ae),s===z||s===ge)return t.avail_out===0&&(e.last_flush=-1),B;if(s===De&&(n===Rs?Ns(e):n!==Fi&&(Wt(e,0,0,!1),n===Os&&(ne(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),N(t),t.avail_out===0))return e.last_flush=-1,B}return n!==H?B:e.wrap<=0?Ai:(e.wrap===2?(L(e,t.adler&255),L(e,t.adler>>8&255),L(e,t.adler>>16&255),L(e,t.adler>>24&255),L(e,t.total_in&255),L(e,t.total_in>>8&255),L(e,t.total_in>>16&255),L(e,t.total_in>>24&255)):(Fe(e,t.adler>>>16),Fe(e,t.adler&65535)),N(t),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?B:Ai)},ga=t=>{if(Ge(t))return Y;let n=t.state.status;return t.state=null,n===fe?he(t,Ps):B},pa=(t,n)=>{let e=n.length;if(Ge(t))return Y;let i=t.state,s=i.wrap;if(s===2||s===1&&i.status!==Se||i.lookahead)return Y;if(s===1&&(t.adler=He(t.adler,n,e,0)),i.wrap=0,e>=i.w_size){s===0&&(ne(i.head),i.strstart=0,i.block_start=0,i.insert=0);let d=new Uint8Array(i.w_size);d.set(n.subarray(e-i.w_size,e),0),n=d,e=i.w_size}let a=t.avail_in,r=t.next_in,l=t.input;for(t.avail_in=e,t.next_in=0,t.input=n,Ce(i);i.lookahead>=I;){let d=i.strstart,o=i.lookahead-(I-1);do i.ins_h=oe(i,i.ins_h,i.window[d+I-1]),i.prev[d&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=d,d++;while(--o);i.strstart=d,i.lookahead=I-1,Ce(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=I-1,i.match_available=0,t.next_in=r,t.input=l,t.avail_in=a,i.wrap=s,B},va=ha,ma=Ln,wa=In,_a=Vn,xa=fa,ba=ua,Ea=ga,ya=pa,Sa="pako deflate (from Nodeca project)",Me={deflateInit:va,deflateInit2:ma,deflateReset:wa,deflateResetKeep:_a,deflateSetHeader:xa,deflate:ba,deflateEnd:Ea,deflateSetDictionary:ya,deflateInfo:Sa},Ca=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),ka=function(t){let n=Array.prototype.slice.call(arguments,1);for(;n.length;){let e=n.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(let i in e)Ca(e,i)&&(t[i]=e[i])}}return t},Ta=t=>{let n=0;for(let i=0,s=t.length;i<s;i++)n+=t[i].length;let e=new Uint8Array(n);for(let i=0,s=0,a=t.length;i<a;i++){let r=t[i];e.set(r,s),s+=r.length}return e},ht={assign:ka,flattenChunks:Ta},Fn=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Fn=!1}var Ze=new Uint8Array(256);for(let t=0;t<256;t++)Ze[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Ze[254]=Ze[254]=1;var Da=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let n,e,i,s,a,r=t.length,l=0;for(s=0;s<r;s++)e=t.charCodeAt(s),(e&64512)===55296&&s+1<r&&(i=t.charCodeAt(s+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),l+=e<128?1:e<2048?2:e<65536?3:4;for(n=new Uint8Array(l),a=0,s=0;a<l;s++)e=t.charCodeAt(s),(e&64512)===55296&&s+1<r&&(i=t.charCodeAt(s+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),e<128?n[a++]=e:e<2048?(n[a++]=192|e>>>6,n[a++]=128|e&63):e<65536?(n[a++]=224|e>>>12,n[a++]=128|e>>>6&63,n[a++]=128|e&63):(n[a++]=240|e>>>18,n[a++]=128|e>>>12&63,n[a++]=128|e>>>6&63,n[a++]=128|e&63);return n},Va=(t,n)=>{if(n<65534&&t.subarray&&Fn)return String.fromCharCode.apply(null,t.length===n?t:t.subarray(0,n));let e="";for(let i=0;i<n;i++)e+=String.fromCharCode(t[i]);return e},Ia=(t,n)=>{let e=n||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,n));let i,s,a=new Array(e*2);for(s=0,i=0;i<e;){let r=t[i++];if(r<128){a[s++]=r;continue}let l=Ze[r];if(l>4){a[s++]=65533,i+=l-1;continue}for(r&=l===2?31:l===3?15:7;l>1&&i<e;)r=r<<6|t[i++]&63,l--;if(l>1){a[s++]=65533;continue}r<65536?a[s++]=r:(r-=65536,a[s++]=55296|r>>10&1023,a[s++]=56320|r&1023)}return Va(a,s)},La=(t,n)=>{n=n||t.length,n>t.length&&(n=t.length);let e=n-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?n:e+Ze[t[e]]>n?e:n},Ue={string2buf:Da,buf2string:Ia,utf8border:La};function Fa(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var An=Fa,Bn=Object.prototype.toString,{Z_NO_FLUSH:Aa,Z_SYNC_FLUSH:Ba,Z_FULL_FLUSH:za,Z_FINISH:Ma,Z_OK:ct,Z_STREAM_END:$a,Z_DEFAULT_COMPRESSION:Na,Z_DEFAULT_STRATEGY:Ra,Z_DEFLATED:Oa}=Te;function qe(t){this.options=ht.assign({level:Na,method:Oa,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ra},t||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new An,this.strm.avail_out=0;let e=Me.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(e!==ct)throw new Error(ue[e]);if(n.header&&Me.deflateSetHeader(this.strm,n.header),n.dictionary){let i;if(typeof n.dictionary=="string"?i=Ue.string2buf(n.dictionary):Bn.call(n.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(n.dictionary):i=n.dictionary,e=Me.deflateSetDictionary(this.strm,i),e!==ct)throw new Error(ue[e]);this._dict_set=!0}}qe.prototype.push=function(t,n){let e=this.strm,i=this.options.chunkSize,s,a;if(this.ended)return!1;for(n===~~n?a=n:a=n===!0?Ma:Aa,typeof t=="string"?e.input=Ue.string2buf(t):Bn.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),(a===Ba||a===za)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(s=Me.deflate(e,a),s===$a)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),s=Me.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===ct;if(e.avail_out===0){this.onData(e.output);continue}if(a>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};qe.prototype.onData=function(t){this.chunks.push(t)};qe.prototype.onEnd=function(t){t===ct&&(this.result=ht.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function ni(t,n){let e=new qe(n);if(e.push(t,!0),e.err)throw e.msg||ue[e.err];return e.result}function Pa(t,n){return n=n||{},n.raw=!0,ni(t,n)}function Ha(t,n){return n=n||{},n.gzip=!0,ni(t,n)}var Za=qe,Ua=ni,Wa=Pa,ja=Ha,Ga=Te,qa={Deflate:Za,deflate:Ua,deflateRaw:Wa,gzip:ja,constants:Ga},nt=16209,Ya=16191,Xa=function(n,e){let i,s,a,r,l,d,o,c,h,u,f,g,_,m,x,E,b,w,C,V,y,S,k,v,T=n.state;i=n.next_in,k=n.input,s=i+(n.avail_in-5),a=n.next_out,v=n.output,r=a-(e-n.avail_out),l=a+(n.avail_out-257),d=T.dmax,o=T.wsize,c=T.whave,h=T.wnext,u=T.window,f=T.hold,g=T.bits,_=T.lencode,m=T.distcode,x=(1<<T.lenbits)-1,E=(1<<T.distbits)-1;e:do{g<15&&(f+=k[i++]<<g,g+=8,f+=k[i++]<<g,g+=8),b=_[f&x];t:for(;;){if(w=b>>>24,f>>>=w,g-=w,w=b>>>16&255,w===0)v[a++]=b&65535;else if(w&16){C=b&65535,w&=15,w&&(g<w&&(f+=k[i++]<<g,g+=8),C+=f&(1<<w)-1,f>>>=w,g-=w),g<15&&(f+=k[i++]<<g,g+=8,f+=k[i++]<<g,g+=8),b=m[f&E];i:for(;;){if(w=b>>>24,f>>>=w,g-=w,w=b>>>16&255,w&16){if(V=b&65535,w&=15,g<w&&(f+=k[i++]<<g,g+=8,g<w&&(f+=k[i++]<<g,g+=8)),V+=f&(1<<w)-1,V>d){n.msg="invalid distance too far back",T.mode=nt;break e}if(f>>>=w,g-=w,w=a-r,V>w){if(w=V-w,w>c&&T.sane){n.msg="invalid distance too far back",T.mode=nt;break e}if(y=0,S=u,h===0){if(y+=o-w,w<C){C-=w;do v[a++]=u[y++];while(--w);y=a-V,S=v}}else if(h<w){if(y+=o+h-w,w-=h,w<C){C-=w;do v[a++]=u[y++];while(--w);if(y=0,h<C){w=h,C-=w;do v[a++]=u[y++];while(--w);y=a-V,S=v}}}else if(y+=h-w,w<C){C-=w;do v[a++]=u[y++];while(--w);y=a-V,S=v}for(;C>2;)v[a++]=S[y++],v[a++]=S[y++],v[a++]=S[y++],C-=3;C&&(v[a++]=S[y++],C>1&&(v[a++]=S[y++]))}else{y=a-V;do v[a++]=v[y++],v[a++]=v[y++],v[a++]=v[y++],C-=3;while(C>2);C&&(v[a++]=v[y++],C>1&&(v[a++]=v[y++]))}}else if(w&64){n.msg="invalid distance code",T.mode=nt;break e}else{b=m[(b&65535)+(f&(1<<w)-1)];continue i}break}}else if(w&64)if(w&32){T.mode=Ya;break e}else{n.msg="invalid literal/length code",T.mode=nt;break e}else{b=_[(b&65535)+(f&(1<<w)-1)];continue t}break}}while(i<s&&a<l);C=g>>3,i-=C,g-=C<<3,f&=(1<<g)-1,n.next_in=i,n.next_out=a,n.avail_in=i<s?5+(s-i):5-(i-s),n.avail_out=a<l?257+(l-a):257-(a-l),T.hold=f,T.bits=g},Ee=15,zi=852,Mi=592,$i=0,zt=1,Ni=2,Qa=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ka=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ja=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),er=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),tr=(t,n,e,i,s,a,r,l)=>{let d=l.bits,o=0,c=0,h=0,u=0,f=0,g=0,_=0,m=0,x=0,E=0,b,w,C,V,y,S=null,k,v=new Uint16Array(Ee+1),T=new Uint16Array(Ee+1),D=null,U,W,O;for(o=0;o<=Ee;o++)v[o]=0;for(c=0;c<i;c++)v[n[e+c]]++;for(f=d,u=Ee;u>=1&&v[u]===0;u--);if(f>u&&(f=u),u===0)return s[a++]=1<<24|64<<16|0,s[a++]=1<<24|64<<16|0,l.bits=1,0;for(h=1;h<u&&v[h]===0;h++);for(f<h&&(f=h),m=1,o=1;o<=Ee;o++)if(m<<=1,m-=v[o],m<0)return-1;if(m>0&&(t===$i||u!==1))return-1;for(T[1]=0,o=1;o<Ee;o++)T[o+1]=T[o]+v[o];for(c=0;c<i;c++)n[e+c]!==0&&(r[T[n[e+c]]++]=c);if(t===$i?(S=D=r,k=20):t===zt?(S=Qa,D=Ka,k=257):(S=Ja,D=er,k=0),E=0,c=0,o=h,y=a,g=f,_=0,C=-1,x=1<<f,V=x-1,t===zt&&x>zi||t===Ni&&x>Mi)return 1;for(;;){U=o-_,r[c]+1<k?(W=0,O=r[c]):r[c]>=k?(W=D[r[c]-k],O=S[r[c]-k]):(W=32+64,O=0),b=1<<o-_,w=1<<g,h=w;do w-=b,s[y+(E>>_)+w]=U<<24|W<<16|O|0;while(w!==0);for(b=1<<o-1;E&b;)b>>=1;if(b!==0?(E&=b-1,E+=b):E=0,c++,--v[o]===0){if(o===u)break;o=n[e+r[c]]}if(o>f&&(E&V)!==C){for(_===0&&(_=f),y+=h,g=o-_,m=1<<g;g+_<u&&(m-=v[g+_],!(m<=0));)g++,m<<=1;if(x+=1<<g,t===zt&&x>zi||t===Ni&&x>Mi)return 1;C=E&V,s[C]=f<<24|g<<16|y-a|0}}return E!==0&&(s[y+E]=o-_<<24|64<<16|0),l.bits=f,0},$e=tr,ir=0,zn=1,Mn=2,{Z_FINISH:Ri,Z_BLOCK:nr,Z_TREES:st,Z_OK:pe,Z_STREAM_END:sr,Z_NEED_DICT:ar,Z_STREAM_ERROR:Z,Z_DATA_ERROR:$n,Z_MEM_ERROR:Nn,Z_BUF_ERROR:rr,Z_DEFLATED:Oi}=Te,ut=16180,Pi=16181,Hi=16182,Zi=16183,Ui=16184,Wi=16185,ji=16186,Gi=16187,qi=16188,Yi=16189,dt=16190,J=16191,Mt=16192,Xi=16193,$t=16194,Qi=16195,Ki=16196,Ji=16197,en=16198,at=16199,rt=16200,tn=16201,nn=16202,sn=16203,an=16204,rn=16205,Nt=16206,on=16207,ln=16208,F=16209,Rn=16210,On=16211,or=852,lr=592,cr=15,dr=cr,cn=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function fr(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var ve=t=>{if(!t)return 1;let n=t.state;return!n||n.strm!==t||n.mode<ut||n.mode>On?1:0},Pn=t=>{if(ve(t))return Z;let n=t.state;return t.total_in=t.total_out=n.total=0,t.msg="",n.wrap&&(t.adler=n.wrap&1),n.mode=ut,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(or),n.distcode=n.distdyn=new Int32Array(lr),n.sane=1,n.back=-1,pe},Hn=t=>{if(ve(t))return Z;let n=t.state;return n.wsize=0,n.whave=0,n.wnext=0,Pn(t)},Zn=(t,n)=>{let e;if(ve(t))return Z;let i=t.state;return n<0?(e=0,n=-n):(e=(n>>4)+5,n<48&&(n&=15)),n&&(n<8||n>15)?Z:(i.window!==null&&i.wbits!==n&&(i.window=null),i.wrap=e,i.wbits=n,Hn(t))},Un=(t,n)=>{if(!t)return Z;let e=new fr;t.state=e,e.strm=t,e.window=null,e.mode=ut;let i=Zn(t,n);return i!==pe&&(t.state=null),i},hr=t=>Un(t,dr),dn=!0,Rt,Ot,ur=t=>{if(dn){Rt=new Int32Array(512),Ot=new Int32Array(32);let n=0;for(;n<144;)t.lens[n++]=8;for(;n<256;)t.lens[n++]=9;for(;n<280;)t.lens[n++]=7;for(;n<288;)t.lens[n++]=8;for($e(zn,t.lens,0,288,Rt,0,t.work,{bits:9}),n=0;n<32;)t.lens[n++]=5;$e(Mn,t.lens,0,32,Ot,0,t.work,{bits:5}),dn=!1}t.lencode=Rt,t.lenbits=9,t.distcode=Ot,t.distbits=5},Wn=(t,n,e,i)=>{let s,a=t.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(n.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(s=a.wsize-a.wnext,s>i&&(s=i),a.window.set(n.subarray(e-i,e-i+s),a.wnext),i-=s,i?(a.window.set(n.subarray(e-i,e),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0},gr=(t,n)=>{let e,i,s,a,r,l,d,o,c,h,u,f,g,_,m=0,x,E,b,w,C,V,y,S,k=new Uint8Array(4),v,T,D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ve(t)||!t.output||!t.input&&t.avail_in!==0)return Z;e=t.state,e.mode===J&&(e.mode=Mt),r=t.next_out,s=t.output,d=t.avail_out,a=t.next_in,i=t.input,l=t.avail_in,o=e.hold,c=e.bits,h=l,u=d,S=pe;e:for(;;)switch(e.mode){case ut:if(e.wrap===0){e.mode=Mt;break}for(;c<16;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}if(e.wrap&2&&o===35615){e.wbits===0&&(e.wbits=15),e.check=0,k[0]=o&255,k[1]=o>>>8&255,e.check=A(e.check,k,2,0),o=0,c=0,e.mode=Pi;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((o&255)<<8)+(o>>8))%31){t.msg="incorrect header check",e.mode=F;break}if((o&15)!==Oi){t.msg="unknown compression method",e.mode=F;break}if(o>>>=4,c-=4,y=(o&15)+8,e.wbits===0&&(e.wbits=y),y>15||y>e.wbits){t.msg="invalid window size",e.mode=F;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=o&512?Yi:J,o=0,c=0;break;case Pi:for(;c<16;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}if(e.flags=o,(e.flags&255)!==Oi){t.msg="unknown compression method",e.mode=F;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=F;break}e.head&&(e.head.text=o>>8&1),e.flags&512&&e.wrap&4&&(k[0]=o&255,k[1]=o>>>8&255,e.check=A(e.check,k,2,0)),o=0,c=0,e.mode=Hi;case Hi:for(;c<32;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}e.head&&(e.head.time=o),e.flags&512&&e.wrap&4&&(k[0]=o&255,k[1]=o>>>8&255,k[2]=o>>>16&255,k[3]=o>>>24&255,e.check=A(e.check,k,4,0)),o=0,c=0,e.mode=Zi;case Zi:for(;c<16;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}e.head&&(e.head.xflags=o&255,e.head.os=o>>8),e.flags&512&&e.wrap&4&&(k[0]=o&255,k[1]=o>>>8&255,e.check=A(e.check,k,2,0)),o=0,c=0,e.mode=Ui;case Ui:if(e.flags&1024){for(;c<16;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}e.length=o,e.head&&(e.head.extra_len=o),e.flags&512&&e.wrap&4&&(k[0]=o&255,k[1]=o>>>8&255,e.check=A(e.check,k,2,0)),o=0,c=0}else e.head&&(e.head.extra=null);e.mode=Wi;case Wi:if(e.flags&1024&&(f=e.length,f>l&&(f=l),f&&(e.head&&(y=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(i.subarray(a,a+f),y)),e.flags&512&&e.wrap&4&&(e.check=A(e.check,i,f,a)),l-=f,a+=f,e.length-=f),e.length))break e;e.length=0,e.mode=ji;case ji:if(e.flags&2048){if(l===0)break e;f=0;do y=i[a+f++],e.head&&y&&e.length<65536&&(e.head.name+=String.fromCharCode(y));while(y&&f<l);if(e.flags&512&&e.wrap&4&&(e.check=A(e.check,i,f,a)),l-=f,a+=f,y)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=Gi;case Gi:if(e.flags&4096){if(l===0)break e;f=0;do y=i[a+f++],e.head&&y&&e.length<65536&&(e.head.comment+=String.fromCharCode(y));while(y&&f<l);if(e.flags&512&&e.wrap&4&&(e.check=A(e.check,i,f,a)),l-=f,a+=f,y)break e}else e.head&&(e.head.comment=null);e.mode=qi;case qi:if(e.flags&512){for(;c<16;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}if(e.wrap&4&&o!==(e.check&65535)){t.msg="header crc mismatch",e.mode=F;break}o=0,c=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=J;break;case Yi:for(;c<32;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}t.adler=e.check=cn(o),o=0,c=0,e.mode=dt;case dt:if(e.havedict===0)return t.next_out=r,t.avail_out=d,t.next_in=a,t.avail_in=l,e.hold=o,e.bits=c,ar;t.adler=e.check=1,e.mode=J;case J:if(n===nr||n===st)break e;case Mt:if(e.last){o>>>=c&7,c-=c&7,e.mode=Nt;break}for(;c<3;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}switch(e.last=o&1,o>>>=1,c-=1,o&3){case 0:e.mode=Xi;break;case 1:if(ur(e),e.mode=at,n===st){o>>>=2,c-=2;break e}break;case 2:e.mode=Ki;break;case 3:t.msg="invalid block type",e.mode=F}o>>>=2,c-=2;break;case Xi:for(o>>>=c&7,c-=c&7;c<32;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}if((o&65535)!==(o>>>16^65535)){t.msg="invalid stored block lengths",e.mode=F;break}if(e.length=o&65535,o=0,c=0,e.mode=$t,n===st)break e;case $t:e.mode=Qi;case Qi:if(f=e.length,f){if(f>l&&(f=l),f>d&&(f=d),f===0)break e;s.set(i.subarray(a,a+f),r),l-=f,a+=f,d-=f,r+=f,e.length-=f;break}e.mode=J;break;case Ki:for(;c<14;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}if(e.nlen=(o&31)+257,o>>>=5,c-=5,e.ndist=(o&31)+1,o>>>=5,c-=5,e.ncode=(o&15)+4,o>>>=4,c-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=F;break}e.have=0,e.mode=Ji;case Ji:for(;e.have<e.ncode;){for(;c<3;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}e.lens[D[e.have++]]=o&7,o>>>=3,c-=3}for(;e.have<19;)e.lens[D[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,v={bits:e.lenbits},S=$e(ir,e.lens,0,19,e.lencode,0,e.work,v),e.lenbits=v.bits,S){t.msg="invalid code lengths set",e.mode=F;break}e.have=0,e.mode=en;case en:for(;e.have<e.nlen+e.ndist;){for(;m=e.lencode[o&(1<<e.lenbits)-1],x=m>>>24,E=m>>>16&255,b=m&65535,!(x<=c);){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}if(b<16)o>>>=x,c-=x,e.lens[e.have++]=b;else{if(b===16){for(T=x+2;c<T;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}if(o>>>=x,c-=x,e.have===0){t.msg="invalid bit length repeat",e.mode=F;break}y=e.lens[e.have-1],f=3+(o&3),o>>>=2,c-=2}else if(b===17){for(T=x+3;c<T;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}o>>>=x,c-=x,y=0,f=3+(o&7),o>>>=3,c-=3}else{for(T=x+7;c<T;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}o>>>=x,c-=x,y=0,f=11+(o&127),o>>>=7,c-=7}if(e.have+f>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=F;break}for(;f--;)e.lens[e.have++]=y}}if(e.mode===F)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=F;break}if(e.lenbits=9,v={bits:e.lenbits},S=$e(zn,e.lens,0,e.nlen,e.lencode,0,e.work,v),e.lenbits=v.bits,S){t.msg="invalid literal/lengths set",e.mode=F;break}if(e.distbits=6,e.distcode=e.distdyn,v={bits:e.distbits},S=$e(Mn,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,v),e.distbits=v.bits,S){t.msg="invalid distances set",e.mode=F;break}if(e.mode=at,n===st)break e;case at:e.mode=rt;case rt:if(l>=6&&d>=258){t.next_out=r,t.avail_out=d,t.next_in=a,t.avail_in=l,e.hold=o,e.bits=c,Xa(t,u),r=t.next_out,s=t.output,d=t.avail_out,a=t.next_in,i=t.input,l=t.avail_in,o=e.hold,c=e.bits,e.mode===J&&(e.back=-1);break}for(e.back=0;m=e.lencode[o&(1<<e.lenbits)-1],x=m>>>24,E=m>>>16&255,b=m&65535,!(x<=c);){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}if(E&&!(E&240)){for(w=x,C=E,V=b;m=e.lencode[V+((o&(1<<w+C)-1)>>w)],x=m>>>24,E=m>>>16&255,b=m&65535,!(w+x<=c);){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}o>>>=w,c-=w,e.back+=w}if(o>>>=x,c-=x,e.back+=x,e.length=b,E===0){e.mode=rn;break}if(E&32){e.back=-1,e.mode=J;break}if(E&64){t.msg="invalid literal/length code",e.mode=F;break}e.extra=E&15,e.mode=tn;case tn:if(e.extra){for(T=e.extra;c<T;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}e.length+=o&(1<<e.extra)-1,o>>>=e.extra,c-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=nn;case nn:for(;m=e.distcode[o&(1<<e.distbits)-1],x=m>>>24,E=m>>>16&255,b=m&65535,!(x<=c);){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}if(!(E&240)){for(w=x,C=E,V=b;m=e.distcode[V+((o&(1<<w+C)-1)>>w)],x=m>>>24,E=m>>>16&255,b=m&65535,!(w+x<=c);){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}o>>>=w,c-=w,e.back+=w}if(o>>>=x,c-=x,e.back+=x,E&64){t.msg="invalid distance code",e.mode=F;break}e.offset=b,e.extra=E&15,e.mode=sn;case sn:if(e.extra){for(T=e.extra;c<T;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}e.offset+=o&(1<<e.extra)-1,o>>>=e.extra,c-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=F;break}e.mode=an;case an:if(d===0)break e;if(f=u-d,e.offset>f){if(f=e.offset-f,f>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=F;break}f>e.wnext?(f-=e.wnext,g=e.wsize-f):g=e.wnext-f,f>e.length&&(f=e.length),_=e.window}else _=s,g=r-e.offset,f=e.length;f>d&&(f=d),d-=f,e.length-=f;do s[r++]=_[g++];while(--f);e.length===0&&(e.mode=rt);break;case rn:if(d===0)break e;s[r++]=e.length,d--,e.mode=rt;break;case Nt:if(e.wrap){for(;c<32;){if(l===0)break e;l--,o|=i[a++]<<c,c+=8}if(u-=d,t.total_out+=u,e.total+=u,e.wrap&4&&u&&(t.adler=e.check=e.flags?A(e.check,s,u,r-u):He(e.check,s,u,r-u)),u=d,e.wrap&4&&(e.flags?o:cn(o))!==e.check){t.msg="incorrect data check",e.mode=F;break}o=0,c=0}e.mode=on;case on:if(e.wrap&&e.flags){for(;c<32;){if(l===0)break e;l--,o+=i[a++]<<c,c+=8}if(e.wrap&4&&o!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=F;break}o=0,c=0}e.mode=ln;case ln:S=sr;break e;case F:S=$n;break e;case Rn:return Nn;case On:default:return Z}return t.next_out=r,t.avail_out=d,t.next_in=a,t.avail_in=l,e.hold=o,e.bits=c,(e.wsize||u!==t.avail_out&&e.mode<F&&(e.mode<Nt||n!==Ri))&&Wn(t,t.output,t.next_out,u-t.avail_out),h-=t.avail_in,u-=t.avail_out,t.total_in+=h,t.total_out+=u,e.total+=u,e.wrap&4&&u&&(t.adler=e.check=e.flags?A(e.check,s,u,t.next_out-u):He(e.check,s,u,t.next_out-u)),t.data_type=e.bits+(e.last?64:0)+(e.mode===J?128:0)+(e.mode===at||e.mode===$t?256:0),(h===0&&u===0||n===Ri)&&S===pe&&(S=rr),S},pr=t=>{if(ve(t))return Z;let n=t.state;return n.window&&(n.window=null),t.state=null,pe},vr=(t,n)=>{if(ve(t))return Z;let e=t.state;return e.wrap&2?(e.head=n,n.done=!1,pe):Z},mr=(t,n)=>{let e=n.length,i,s,a;return ve(t)||(i=t.state,i.wrap!==0&&i.mode!==dt)?Z:i.mode===dt&&(s=1,s=He(s,n,e,0),s!==i.check)?$n:(a=Wn(t,n,e,e),a?(i.mode=Rn,Nn):(i.havedict=1,pe))},wr=Hn,_r=Zn,xr=Pn,br=hr,Er=Un,yr=gr,Sr=pr,Cr=vr,kr=mr,Tr="pako inflate (from Nodeca project)",te={inflateReset:wr,inflateReset2:_r,inflateResetKeep:xr,inflateInit:br,inflateInit2:Er,inflate:yr,inflateEnd:Sr,inflateGetHeader:Cr,inflateSetDictionary:kr,inflateInfo:Tr};function Dr(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Vr=Dr,jn=Object.prototype.toString,{Z_NO_FLUSH:Ir,Z_FINISH:Lr,Z_OK:We,Z_STREAM_END:Pt,Z_NEED_DICT:Ht,Z_STREAM_ERROR:Fr,Z_DATA_ERROR:fn,Z_MEM_ERROR:Ar}=Te;function Ye(t){this.options=ht.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});let n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),n.windowBits>=0&&n.windowBits<16&&!(t&&t.windowBits)&&(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(n.windowBits&15||(n.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new An,this.strm.avail_out=0;let e=te.inflateInit2(this.strm,n.windowBits);if(e!==We)throw new Error(ue[e]);if(this.header=new Vr,te.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=Ue.string2buf(n.dictionary):jn.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(e=te.inflateSetDictionary(this.strm,n.dictionary),e!==We)))throw new Error(ue[e])}Ye.prototype.push=function(t,n){let e=this.strm,i=this.options.chunkSize,s=this.options.dictionary,a,r,l;if(this.ended)return!1;for(n===~~n?r=n:r=n===!0?Lr:Ir,jn.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),a=te.inflate(e,r),a===Ht&&s&&(a=te.inflateSetDictionary(e,s),a===We?a=te.inflate(e,r):a===fn&&(a=Ht));e.avail_in>0&&a===Pt&&e.state.wrap>0&&t[e.next_in]!==0;)te.inflateReset(e),a=te.inflate(e,r);switch(a){case Fr:case fn:case Ht:case Ar:return this.onEnd(a),this.ended=!0,!1}if(l=e.avail_out,e.next_out&&(e.avail_out===0||a===Pt))if(this.options.to==="string"){let d=Ue.utf8border(e.output,e.next_out),o=e.next_out-d,c=Ue.buf2string(e.output,d);e.next_out=o,e.avail_out=i-o,o&&e.output.set(e.output.subarray(d,d+o),0),this.onData(c)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(a===We&&l===0)){if(a===Pt)return a=te.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Ye.prototype.onData=function(t){this.chunks.push(t)};Ye.prototype.onEnd=function(t){t===We&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ht.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function si(t,n){let e=new Ye(n);if(e.push(t),e.err)throw e.msg||ue[e.err];return e.result}function Br(t,n){return n=n||{},n.raw=!0,si(t,n)}var zr=Ye,Mr=si,$r=Br,Nr=si,Rr=Te,Or={Inflate:zr,inflate:Mr,inflateRaw:$r,ungzip:Nr,constants:Rr},{Deflate:So,deflate:Co,deflateRaw:ko,gzip:Pr}=qa,{Inflate:To,inflate:Do,inflateRaw:Vo,ungzip:Hr}=Or;var Gn=Pr;var ai=Hr;var Ur={versionFolder:".versions",autoSave:!0,autoSaveInterval:5,autoClear:!0,maxVersions:50,enableMaxVersions:!0,maxDays:30,enableMaxDays:!1,useRelativeTime:!1,diffGranularity:"char",diffViewMode:"unified",enableDeduplication:!0,showNotifications:!0,excludedFolders:[],enableCompression:!0,enableIncrementalStorage:!0,versionsPerPage:20,rebuildBaseInterval:10,autoSaveOnModify:!0,autoSaveDelay:180,autoSaveMinChanges:10,autoSaveOnInterval:!1,autoSaveOnFileSwitch:!0,autoSaveOnFocusLost:!1,enableQuickPreview:!0,enableVersionTags:!0,defaultTags:["\u91CD\u8981","\u91CC\u7A0B\u7891","\u53D1\u5E03","\u5907\u4EFD","\u8349\u7A3F"],showVersionStats:!0,enableStatusBarDiff:!0,showLastSaveTimeInStatusBar:!0},gt=class extends p.Plugin{constructor(){super(...arguments);this.autoSaveTimer=null;this.lastModifiedTime=new Map;this.pendingSaves=new Map;this.versionCache=new Map;this.previousActiveFile=null;this.globalTimeUpdater=null}async onload(){await this.loadSettings(),this.statusBarItem=this.addStatusBarItem(),this.updateStatusBar(),this.settings.enableStatusBarDiff&&(this.statusBarItem.addClass("version-control-statusbar-clickable"),this.statusBarItem.addEventListener("click",()=>{this.quickDiffFromStatusBar()})),this.registerView("version-history",e=>new Xe(e,this)),this.addRibbonIcon("history","\u7248\u672C\u5386\u53F2",()=>{this.activateVersionHistoryView()}),this.addCommand({id:"create-version",name:"\u521B\u5EFA\u7248\u672C\u5FEB\u7167",callback:()=>this.createManualVersion()}),this.addCommand({id:"show-version-history",name:"\u663E\u793A\u7248\u672C\u5386\u53F2",callback:()=>this.activateVersionHistoryView()}),this.addCommand({id:"create-full-snapshot",name:"\u521B\u5EFA\u5168\u5E93\u7248\u672C",callback:()=>this.createFullSnapshot()}),this.addCommand({id:"compare-with-version",name:"\u4E0E\u5386\u53F2\u7248\u672C\u5BF9\u6BD4",callback:()=>this.quickCompare()}),this.addCommand({id:"restore-last-version",name:"\u6062\u590D\u5230\u4E0A\u4E00\u7248\u672C",callback:()=>this.restoreLastVersion()}),this.addCommand({id:"optimize-storage",name:"\u4F18\u5316\u5B58\u50A8\u7A7A\u95F4",callback:()=>this.optimizeAllVersionFiles()}),this.addCommand({id:"quick-preview-version",name:"\u5FEB\u901F\u9884\u89C8\u4E0A\u4E00\u7248\u672C",callback:()=>this.quickPreviewLastVersion()}),this.addCommand({id:"star-current-version",name:"\u6807\u8BB0\u5F53\u524D\u7248\u672C\u4E3A\u91CD\u8981",callback:()=>this.starLastVersion()}),this.addSettingTab(new fi(this.app,this)),this.registerEvent(this.app.vault.on("modify",e=>{e instanceof p.TFile&&this.settings.autoSave&&this.settings.autoSaveOnModify&&this.scheduleAutoSave(e)})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.settings.autoSave&&this.settings.autoSaveOnFileSwitch&&this.handleFileSwitch(),this.updateStatusBar()})),this.settings.autoSaveOnFocusLost&&this.registerDomEvent(window,"blur",()=>{this.settings.autoSave&&this.saveCurrentFileOnFocusLost()}),this.settings.autoSave&&this.settings.autoSaveOnInterval&&this.startAutoSave(),await this.ensureVersionFolder(),this.globalTimeUpdater=window.setInterval(()=>{this.updateAllRelativeTimes()},6e4),this.settings.showNotifications&&new p.Notice("\u2705 \u7248\u672C\u63A7\u5236\u63D2\u4EF6\u5DF2\u542F\u52A8")}onunload(){this.autoSaveTimer&&window.clearInterval(this.autoSaveTimer),this.globalTimeUpdater&&window.clearInterval(this.globalTimeUpdater),this.pendingSaves.forEach(e=>clearTimeout(e)),this.pendingSaves.clear(),this.versionCache.clear()}async loadSettings(){this.settings=Object.assign({},Ur,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.updateStatusBar()}updateAllRelativeTimes(){this.app.workspace.getActiveFile()&&(this.settings.useRelativeTime||this.settings.showLastSaveTimeInStatusBar)&&(this.updateStatusBar(),this.app.workspace.getLeavesOfType("version-history").forEach(s=>{s.view instanceof Xe&&s.view.updateRelativeTimes()}))}async updateStatusBar(){if(!this.settings.autoSave){this.statusBarItem.setText("\u23F8 \u7248\u672C\u63A7\u5236: \u5DF2\u6682\u505C"),this.statusBarItem.title="\u81EA\u52A8\u4FDD\u5B58\u5DF2\u6682\u505C";return}let e=this.app.workspace.getActiveFile();if(!this.settings.showLastSaveTimeInStatusBar||!e){this.statusBarItem.setText("\u23F1 \u7248\u672C\u63A7\u5236: \u5DF2\u542F\u7528"),this.statusBarItem.title="\u70B9\u51FB\u53EF\u5FEB\u901F\u5BF9\u6BD4\u5F53\u524D\u6587\u4EF6\u4E0E\u6700\u65B0\u7248\u672C";return}let i=this.lastModifiedTime.get(e.path);if(!i){let s=await this.getAllVersions(e.path);s.length>0&&(i=s[0].timestamp,this.lastModifiedTime.set(e.path,i))}if(i){let s=this.getRelativeTime(i);this.statusBarItem.setText(`\u4E0A\u6B21\u4FDD\u5B58: ${s}`),this.statusBarItem.title=`\u4E0A\u6B21\u4FDD\u5B58\u4E8E ${new Date(i).toLocaleString("zh-CN")}. \u70B9\u51FB\u53EF\u5FEB\u901F\u5BF9\u6BD4\u3002`}else this.statusBarItem.setText("\u23F1 \u7248\u672C\u63A7\u5236: \u5DF2\u542F\u7528"),this.statusBarItem.title="\u5F53\u524D\u6587\u4EF6\u65E0\u5386\u53F2\u7248\u672C\u3002\u70B9\u51FB\u53EF\u5FEB\u901F\u5BF9\u6BD4\u3002"}async quickDiffFromStatusBar(){if(!this.settings.enableStatusBarDiff)return;let e=this.app.workspace.getActiveFile();if(!e){new p.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new p.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u5BF9\u6BD4");return}let s=i[0];new ie(this.app,this,e,s.id).open()}async ensureVersionFolder(){let e=this.app.vault.adapter,i=this.settings.versionFolder;try{await e.exists(i)||await e.mkdir(i)}catch(s){console.error("\u521B\u5EFA\u7248\u672C\u6587\u4EF6\u5939\u5931\u8D25:",s),new p.Notice("\u26A0\uFE0F \u65E0\u6CD5\u521B\u5EFA\u7248\u672C\u6587\u4EF6\u5939,\u8BF7\u68C0\u67E5\u6743\u9650")}}async activateVersionHistoryView(){let{workspace:e}=this.app,i=e.getLeavesOfType("version-history")[0];if(!i){let s=e.getRightLeaf(!1);if(!s){new p.Notice("\u65E0\u6CD5\u6253\u5F00\u7248\u672C\u5386\u53F2\u89C6\u56FE");return}i=s,await i.setViewState({type:"version-history",active:!0})}e.revealLeaf(i)}startAutoSave(){this.autoSaveTimer&&window.clearInterval(this.autoSaveTimer),this.settings.autoSaveOnInterval&&(this.autoSaveTimer=window.setInterval(()=>{this.autoSaveCurrentFile()},this.settings.autoSaveInterval*60*1e3))}scheduleAutoSave(e){if(this.isExcluded(e.path))return;let i=this.pendingSaves.get(e.path);i&&clearTimeout(i);let s=setTimeout(()=>{this.autoSaveFile(e),this.pendingSaves.delete(e.path)},this.settings.autoSaveDelay*1e3);this.pendingSaves.set(e.path,s)}async autoSaveFile(e){try{let i=await this.app.vault.read(e),s=await this.getAllVersions(e.path),a="";if(s.length>0){let l=s[0],d=this.hashContent(i);if(l.hash===d)return;a=await this.getVersionContent(e.path,l.id)}if(i===a||this.countChanges(a,i)<this.settings.autoSaveMinChanges)return;await this.createVersion(e,"[Auto Save]",!1)}catch(i){console.error("\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25:",i)}}countChanges(e,i){let s=we(e,i),a=0;for(let r of s)(r.added||r.removed)&&(a+=r.value.length);return a}async handleFileSwitch(){let e=this.app.workspace.getActiveFile();if(this.previousActiveFile&&this.previousActiveFile!==e)if(this.app.vault.getAbstractFileByPath(this.previousActiveFile.path)){let s=this.pendingSaves.get(this.previousActiveFile.path);if(s){clearTimeout(s),this.pendingSaves.delete(this.previousActiveFile.path);try{await this.autoSaveFile(this.previousActiveFile)}catch(a){console.error("\u5207\u6362\u6587\u4EF6\u65F6\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25:",a)}}}else this.pendingSaves.delete(this.previousActiveFile.path),this.lastModifiedTime.delete(this.previousActiveFile.path);this.previousActiveFile=e}async saveCurrentFileOnFocusLost(){let e=this.app.workspace.getActiveFile();if(!e||this.isExcluded(e.path)||!this.app.vault.getAbstractFileByPath(e.path))return;let s=this.pendingSaves.get(e.path);s&&(clearTimeout(s),this.pendingSaves.delete(e.path));try{await this.autoSaveFile(e)}catch(a){console.error("\u5931\u53BB\u7126\u70B9\u65F6\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25:",a)}}async autoSaveCurrentFile(){let e=this.app.workspace.getActiveFile();!e||this.isExcluded(e.path)||await this.autoSaveFile(e)}isExcluded(e){return this.settings.excludedFolders.some(i=>e.startsWith(i))}async createManualVersion(){let e=this.app.workspace.getActiveFile();if(!e){new p.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}new li(this.app,this.settings,async(i,s)=>{await this.createVersion(e,i,!0,s)}).open()}async createVersion(e,i,s=!1,a=[]){try{let r=await this.app.vault.read(e),l=Date.now(),d=`${l}-${Math.random().toString(36).substring(2,9)}`,o=this.hashContent(r),c=await this.loadVersionFile(e.path);if(this.settings.enableDeduplication){let g=c.versions[0];if(g&&g.hash===o){s&&this.settings.showNotifications&&new p.Notice("\u2139\uFE0F \u5185\u5BB9\u672A\u53D8\u5316,\u8DF3\u8FC7\u521B\u5EFA\u7248\u672C");return}}let h,u=0,f=0;if(c.versions.length>0){let g=await this.getVersionContent(e.path,c.versions[0].id);M(g,r).forEach(m=>{m.added&&(u+=m.count||0),m.removed&&(f+=m.count||0)})}else u=r.split(`
`).length;if(this.settings.enableIncrementalStorage&&c.versions.length>0)if(c.baseVersion===void 0||c.baseVersion===null||c.versions.length%this.settings.rebuildBaseInterval===0)h={id:d,timestamp:l,message:i,content:r,size:r.length,hash:o,tags:a.length>0?a:void 0,starred:!1,addedLines:u,removedLines:f},c.baseVersion=r;else{let m=c.baseVersion||await this.reconstructLatestFullContent(c),x=this.createDiff(m,r);h={id:d,timestamp:l,message:i,diff:x,baseVersionId:c.versions[0].id,size:x.length,hash:o,tags:a.length>0?a:void 0,starred:!1,addedLines:u,removedLines:f}}else h={id:d,timestamp:l,message:i,content:r,size:r.length,hash:o,tags:a.length>0?a:void 0,starred:!1,addedLines:u,removedLines:f},this.settings.enableIncrementalStorage&&(c.baseVersion=r);c.versions.unshift(h),c.lastModified=l,this.settings.autoClear&&this.cleanupVersionsInMemory(c),this.buildVersionIndex(c),await this.saveVersionFile(e.path,c),this.versionCache.set(e.path,c),this.refreshVersionHistoryView(),this.lastModifiedTime.set(e.path,l),this.updateStatusBar(),s&&this.settings.showNotifications&&new p.Notice(`\u2705 \u7248\u672C\u5DF2\u521B\u5EFA: ${i}`)}catch(r){console.error("\u521B\u5EFA\u7248\u672C\u5931\u8D25:",r),new p.Notice("\u274C \u521B\u5EFA\u7248\u672C\u5931\u8D25,\u8BF7\u67E5\u770B\u63A7\u5236\u53F0")}}async reconstructLatestFullContent(e){return e.versions.length===0?"":this.getVersionContent(e.filePath,e.versions[0].id)}createDiff(e,i){return Dt("file",e,i,"","")}applyDiff(e,i){try{let s=kt(e,i);return s===!1?(console.error("\u5E94\u7528\u5DEE\u5F02\u8865\u4E01\u5931\u8D25 (applyPatch returned false). \u8FD4\u56DE\u57FA\u7840\u5185\u5BB9\u3002"),new p.Notice("\u5E94\u7528\u5DEE\u5F02\u8865\u4E01\u5931\u8D25\uFF0C\u7248\u672C\u5185\u5BB9\u53EF\u80FD\u4E0D\u5B8C\u6574\u3002"),e):s}catch(s){return console.error("\u5E94\u7528\u5DEE\u5F02\u65F6\u6355\u83B7\u5230\u5F02\u5E38:",s),e}}buildVersionIndex(e){let i=new Map;e.versions.forEach((s,a)=>{i.set(s.id,a)}),e.versionIndex=i}hashContent(e){let i=0;for(let s=0;s<e.length;s++){let a=e.charCodeAt(s);i=(i<<5)-i+a,i=i&i}return i.toString(36)}cleanupVersionsInMemory(e){let i=e.versions,s=i.filter(l=>l.starred),a=i.filter(l=>!l.starred);if(this.settings.enableMaxVersions){let l=Math.max(this.settings.maxVersions-s.length,10);a=a.slice(0,l)}if(this.settings.enableMaxDays){let l=Date.now()-this.settings.maxDays*24*60*60*1e3;a=a.filter(d=>d.timestamp>=l)}i=[...s,...a].sort((l,d)=>d.timestamp-l.timestamp);let r=e.versions.length-i.length;return e.versions=i,r}async loadVersionFile(e){if(this.versionCache.has(e))return this.versionCache.get(e);let i=this.getVersionFilePath(e),s=this.app.vault.adapter;try{if(await s.exists(i)){let r;if(this.settings.enableCompression)try{let d=await s.readBinary(i);r=ai(new Uint8Array(d),{to:"string"})}catch(d){r=await s.read(i)}else r=await s.read(i);let l=JSON.parse(r);return l.versionIndex||this.buildVersionIndex(l),this.versionCache.set(e,l),l}}catch(r){console.error("\u52A0\u8F7D\u7248\u672C\u6587\u4EF6\u5931\u8D25:",r)}let a={filePath:e,versions:[],lastModified:Date.now()};return this.versionCache.set(e,a),a}async saveVersionFile(e,i){let s=this.getVersionFilePath(e),a=this.app.vault.adapter;try{let r={filePath:i.filePath,versions:i.versions,lastModified:i.lastModified};i.baseVersion!==void 0&&(r.baseVersion=i.baseVersion);let l=JSON.stringify(r,null,2);if(this.settings.enableCompression){let d=Gn(l);await a.writeBinary(s,d.buffer)}else await a.write(s,l)}catch(r){throw console.error("\u4FDD\u5B58\u7248\u672C\u6587\u4EF6\u5931\u8D25:",r),r}}getVersionFilePath(e){let i=this.sanitizeFileName(e);return`${this.settings.versionFolder}/${i}.json`}async getVersions(e,i=0){try{let s=await this.loadVersionFile(e);if(this.settings.versionsPerPage>0){let a=i*this.settings.versionsPerPage,r=a+this.settings.versionsPerPage;return s.versions.slice(a,r)}return s.versions}catch(s){return console.error("\u83B7\u53D6\u7248\u672C\u5217\u8868\u5931\u8D25:",s),[]}}async getAllVersions(e){try{return(await this.loadVersionFile(e)).versions}catch(i){return console.error("\u83B7\u53D6\u7248\u672C\u5217\u8868\u5931\u8D25:",i),[]}}async getVersionContent(e,i){var s;try{let a=await this.loadVersionFile(e),r=(s=a.versionIndex)==null?void 0:s.get(i),l=r!==void 0?a.versions[r]:a.versions.find(d=>d.id===i);if(!l)throw new Error(`\u7248\u672C ${i} \u4E0D\u5B58\u5728`);if(l.content!==void 0&&l.content!==null)return l.content;if(l.diff){if(a.baseVersion!==void 0&&a.baseVersion!==null)try{return this.applyDiff(a.baseVersion,l.diff)}catch(d){console.warn("\u4ECE\u57FA\u51C6\u7248\u672C\u5E94\u7528\u5DEE\u5F02\u5931\u8D25\uFF0C\u5C1D\u8BD5\u4F7F\u7528 baseVersionId:",d)}if(l.baseVersionId)try{let d=await this.getVersionContent(e,l.baseVersionId);return this.applyDiff(d,l.diff)}catch(d){console.error("\u4ECE baseVersionId \u5E94\u7528\u5DEE\u5F02\u5931\u8D25:",d)}}throw new Error(`\u65E0\u6CD5\u83B7\u53D6\u7248\u672C ${i} \u7684\u5185\u5BB9\uFF1A\u7F3A\u5C11 content \u548C\u6709\u6548\u7684 diff`)}catch(a){throw console.error("\u8BFB\u53D6\u7248\u672C\u5185\u5BB9\u5931\u8D25:",a),new Error(`\u65E0\u6CD5\u8BFB\u53D6\u7248\u672C\u5185\u5BB9: ${a.message}`)}}async verifyVersionFileIntegrity(e){try{let i=await this.loadVersionFile(e);if(!i.versions||!Array.isArray(i.versions))return console.error("\u7248\u672C\u6587\u4EF6\u7ED3\u6784\u65E0\u6548"),!1;if(this.settings.enableIncrementalStorage){let s=!1;for(let a of i.versions)if(a.content!==void 0&&(s=!0),a.diff&&!a.content&&!a.baseVersionId&&!i.baseVersion)return console.error(`\u7248\u672C ${a.id} \u7F3A\u5C11\u57FA\u51C6\u5F15\u7528`),!1;!s&&i.versions.length>0&&console.warn("\u8B66\u544A\uFF1A\u6CA1\u6709\u627E\u5230\u5B8C\u6574\u7248\u672C\uFF0C\u53EF\u80FD\u5BFC\u81F4\u6062\u590D\u5931\u8D25")}return!0}catch(i){return console.error("\u9A8C\u8BC1\u7248\u672C\u6587\u4EF6\u5B8C\u6574\u6027\u5931\u8D25:",i),!1}}async updateVersionTags(e,i,s){var a;try{let r=await this.loadVersionFile(e),l=(a=r.versionIndex)==null?void 0:a.get(i);l!==void 0&&(r.versions[l].tags=s.length>0?s:void 0,await this.saveVersionFile(e,r),this.versionCache.set(e,r),this.refreshVersionHistoryView())}catch(r){console.error("\u66F4\u65B0\u7248\u672C\u6807\u7B7E\u5931\u8D25:",r)}}async updateVersionNote(e,i,s){var a;try{let r=await this.loadVersionFile(e),l=(a=r.versionIndex)==null?void 0:a.get(i);l!==void 0&&(r.versions[l].note=s.trim()||void 0,await this.saveVersionFile(e,r),this.versionCache.set(e,r),this.refreshVersionHistoryView())}catch(r){console.error("\u66F4\u65B0\u7248\u672C\u5907\u6CE8\u5931\u8D25:",r)}}async toggleVersionStar(e,i){var s;try{let a=await this.loadVersionFile(e),r=(s=a.versionIndex)==null?void 0:s.get(i);r!==void 0&&(a.versions[r].starred=!a.versions[r].starred,await this.saveVersionFile(e,a),this.versionCache.set(e,a),this.refreshVersionHistoryView())}catch(a){console.error("\u5207\u6362\u661F\u6807\u5931\u8D25:",a)}}async starLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new p.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new p.Notice("\u6CA1\u6709\u53EF\u6807\u8BB0\u7684\u7248\u672C");return}await this.toggleVersionStar(e.path,i[0].id),new p.Notice("\u2B50 \u5DF2\u6807\u8BB0/\u53D6\u6D88\u6807\u8BB0")}async quickPreviewLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new p.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new p.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u9884\u89C8");return}new pt(this.app,this,e,i[0].id).open()}async deleteVersion(e,i){try{let s=await this.loadVersionFile(e);if(s.versions.some(r=>r.baseVersionId===i)){new p.Notice("\u274C \u65E0\u6CD5\u5220\u9664\u6B64\u7248\u672C\uFF0C\u56E0\u4E3A\u5B83\u88AB\u5176\u4ED6\u589E\u91CF\u7248\u672C\u6240\u4F9D\u8D56\u3002",7e3);return}s.versions=s.versions.filter(r=>r.id!==i),s.lastModified=Date.now(),this.buildVersionIndex(s),await this.saveVersionFile(e,s),this.versionCache.set(e,s),this.refreshVersionHistoryView()}catch(s){console.error("\u5220\u9664\u7248\u672C\u5931\u8D25:",s)}}async deleteVersions(e,i){try{let s=await this.loadVersionFile(e),a=new Set(i),r=s.versions.filter(d=>!a.has(d.id));if(r.some(d=>d.baseVersionId&&a.has(d.baseVersionId))){new p.Notice("\u274C \u6279\u91CF\u5220\u9664\u5931\u8D25\uFF1A\u9009\u4E2D\u7684\u7248\u672C\u4E2D\u5305\u542B\u5176\u4ED6\u7248\u672C\u7684\u4F9D\u8D56\u9879\u3002",7e3);return}s.versions=r,s.lastModified=Date.now(),this.buildVersionIndex(s),await this.saveVersionFile(e,s),this.versionCache.set(e,s),this.refreshVersionHistoryView()}catch(s){console.error("\u6279\u91CF\u5220\u9664\u7248\u672C\u5931\u8D25:",s)}}async restoreVersion(e,i){try{await this.createVersion(e,"[Before Restore]",!1);let s=await this.getVersionContent(e.path,i);await this.app.vault.modify(e,s),this.settings.showNotifications&&new p.Notice("\u2705 \u7248\u672C\u5DF2\u6062\u590D"),this.refreshVersionHistoryView()}catch(s){console.error("\u6062\u590D\u7248\u672C\u5931\u8D25:",s),new p.Notice("\u274C \u6062\u590D\u7248\u672C\u5931\u8D25")}}async restoreLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new p.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new p.Notice("\u6CA1\u6709\u53EF\u6062\u590D\u7684\u7248\u672C");return}let s=i[0];new le(this.app,"\u6062\u590D\u5230\u4E0A\u4E00\u7248\u672C",`\u786E\u5B9A\u8981\u6062\u590D\u5230\u7248\u672C: ${this.formatTime(s.timestamp)}?

\u5F53\u524D\u672A\u4FDD\u5B58\u7684\u4FEE\u6539\u5C06\u4F1A\u4E22\u5931,\u63D2\u4EF6\u4F1A\u5728\u6062\u590D\u524D\u81EA\u52A8\u521B\u5EFA\u5907\u4EFD\u7248\u672C\u3002`,async()=>{await this.restoreVersion(e,s.id)}).open()}async quickCompare(){let e=this.app.workspace.getActiveFile();if(!e){new p.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new p.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u5BF9\u6BD4");return}let s=i[0];new ie(this.app,this,e,s.id).open()}async createFullSnapshot(){let e=this.app.vault.getMarkdownFiles(),i=0,s=0,a=new p.Notice("\u6B63\u5728\u521B\u5EFA\u5168\u5E93\u7248\u672C...",0);for(let r of e){if(this.isExcluded(r.path)){s++;continue}try{await this.createVersion(r,"[Full Snapshot]",!1),i++}catch(l){console.error(`\u521B\u5EFA\u7248\u672C\u5931\u8D25: ${r.path}`,l)}}a.hide(),this.settings.showNotifications&&new p.Notice(`\u2705 \u5168\u5E93\u7248\u672C\u5DF2\u521B\u5EFA
\u6210\u529F: ${i} \u4E2A\u6587\u4EF6${s>0?`
\u8DF3\u8FC7: ${s} \u4E2A\u6587\u4EF6`:""}`)}async optimizeAllVersionFiles(){var i,s;let e=new p.Notice("\u6B63\u5728\u4F18\u5316\u5B58\u50A8...",0);try{let a=this.app.vault.adapter,r=this.settings.versionFolder;if(!await a.exists(r)){e.hide(),new p.Notice("\u7248\u672C\u6587\u4EF6\u5939\u4E0D\u5B58\u5728");return}let l=await a.list(r),d=0,o=0;for(let c of l.files)if(c.endsWith(".json"))try{let h=((i=await a.stat(c))==null?void 0:i.size)||0,u=c.replace(this.settings.versionFolder+"/","").replace(".json",""),f=await this.loadVersionFile(u);this.buildVersionIndex(f),await this.saveVersionFile(f.filePath,f);let g=((s=await a.stat(c))==null?void 0:s.size)||0;o+=h-g,d++}catch(h){console.error("\u4F18\u5316\u6587\u4EF6\u5931\u8D25:",c,h)}e.hide(),new p.Notice(`\u2705 \u4F18\u5316\u5B8C\u6210
\u5904\u7406: ${d} \u4E2A\u6587\u4EF6
\u8282\u7701: ${this.formatFileSize(o)}`)}catch(a){e.hide(),console.error("\u4F18\u5316\u5931\u8D25:",a),new p.Notice("\u274C \u4F18\u5316\u5931\u8D25")}}async getStorageStats(){let e=this.app.vault.adapter,i=this.settings.versionFolder;try{if(!await e.exists(i))return{totalSize:0,versionCount:0,fileCount:0,compressionRatio:0,starredCount:0,taggedCount:0};let s=await e.list(i),a=0,r=0,l=0,d=0,o=0,c=0;for(let u of s.files)if(u.endsWith(".json"))try{let f=await e.stat(u),g=(f==null?void 0:f.size)||0;a+=g;let _;if(this.settings.enableCompression)try{let m=await e.readBinary(u),x=ai(new Uint8Array(m),{to:"string"});_=JSON.parse(x)}catch(m){let x=await e.read(u);_=JSON.parse(x)}else{let m=await e.read(u);_=JSON.parse(m)}_.versions&&Array.isArray(_.versions)&&(r+=_.versions.length,_.versions.forEach(m=>{m.content?d+=m.content.length:m.diff&&(d+=m.diff.length),m.starred&&o++,m.tags&&m.tags.length>0&&c++}),l++)}catch(f){console.error("\u8BFB\u53D6\u7248\u672C\u6587\u4EF6\u5931\u8D25:",u,f)}let h=d>0?(1-a/d)*100:0;return{totalSize:a,versionCount:r,fileCount:l,compressionRatio:h,starredCount:o,taggedCount:c}}catch(s){return console.error("\u83B7\u53D6\u5B58\u50A8\u7EDF\u8BA1\u5931\u8D25:",s),{totalSize:0,versionCount:0,fileCount:0,compressionRatio:0,starredCount:0,taggedCount:0}}}async exportVersions(e){try{let i=await this.loadVersionFile(e),s=`${this.settings.versionFolder}/export_${this.sanitizeFileName(e)}_${Date.now()}.json`;await this.app.vault.adapter.write(s,JSON.stringify(i,null,2)),new p.Notice(`\u2705 \u7248\u672C\u5DF2\u5BFC\u51FA\u5230: ${s}`)}catch(i){console.error("\u5BFC\u51FA\u7248\u672C\u5931\u8D25:",i),new p.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}async exportVersionAsFile(e,i){try{let s=await this.getVersionContent(e,i),r=`${e.replace(/\.[^/.]+$/,"")}_v${i.substring(0,8)}.md`;await this.app.vault.create(r,s),new p.Notice(`\u2705 \u7248\u672C\u5DF2\u5BFC\u51FA\u4E3A: ${r}`)}catch(s){console.error("\u5BFC\u51FA\u7248\u672C\u4E3A\u6587\u4EF6\u5931\u8D25:",s),new p.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}sanitizeFileName(e){return e.replace(/[\/\\:*?"<>|]/g,"_")}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`}formatTime(e){return this.settings.useRelativeTime?this.getRelativeTime(e):new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}getRelativeTime(e){let i=Date.now()-e,s=Math.floor(i/1e3),a=Math.floor(s/60),r=Math.floor(a/60),l=Math.floor(r/24),d=Math.floor(l/30),o=Math.floor(l/365);return o>0?`${o} \u5E74\u524D`:d>0?`${d} \u4E2A\u6708\u524D`:l>0?`${l} \u5929\u524D`:r>0?`${r} \u5C0F\u65F6\u524D`:a>0?`${a} \u5206\u949F\u524D`:s<10?"\u521A\u521A":`${s} \u79D2\u524D`}refreshVersionHistoryView(){this.app.workspace.getLeavesOfType("version-history").forEach(i=>{i.view instanceof Xe&&i.view.refresh()})}},pt=class extends p.Modal{constructor(e,i,s,a){super(e);this.isRenderedView=!0;this.plugin=i,this.file=s,this.versionId=a}async onOpen(){let{contentEl:e}=this;e.addClass("quick-preview-modal");try{this.versionContent=await this.plugin.getVersionContent(this.file.path,this.versionId);let s=(await this.plugin.getAllVersions(this.file.path)).find(g=>g.id===this.versionId),a=e.createEl("div",{cls:"preview-header"});if(a.createEl("h2",{text:"\u{1F4C4} \u5FEB\u901F\u9884\u89C8"}),s){let g=a.createEl("div",{cls:"preview-info"});g.createEl("span",{text:`\u23F0 ${this.plugin.formatTime(s.timestamp)}`,cls:"preview-time"}),g.createEl("span",{text:`\u{1F4AC} ${s.message}`,cls:"preview-message"}),g.createEl("span",{text:`\u{1F4E6} ${this.plugin.formatFileSize(s.size)}`,cls:"preview-size"})}let r=e.createEl("div",{cls:"preview-toolbar"});this.toggleButton=r.createEl("button",{text:"\u{1F453} \u5207\u6362\u539F\u59CB\u6587\u672C"}),this.toggleButton.addEventListener("click",()=>{this.isRenderedView=!this.isRenderedView,this.renderContent()}),r.createEl("button",{text:"\u{1F4CB} \u590D\u5236\u5185\u5BB9",cls:"mod-cta"}).addEventListener("click",()=>{navigator.clipboard.writeText(this.versionContent).then(()=>{new p.Notice("\u2705 \u5185\u5BB9\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(()=>{new p.Notice("\u274C \u590D\u5236\u5931\u8D25")})}),r.createEl("button",{text:"\u21A9\uFE0F \u6062\u590D\u6B64\u7248\u672C"}).addEventListener("click",async()=>{this.close(),await this.plugin.restoreVersion(this.file,this.versionId)}),r.createEl("button",{text:"\u{1F500} \u8BE6\u7EC6\u5BF9\u6BD4"}).addEventListener("click",()=>{this.close(),new ie(this.app,this.plugin,this.file,this.versionId).open()}),r.createEl("button",{text:"\u{1F4BE} \u5BFC\u51FA\u6587\u4EF6"}).addEventListener("click",async()=>{await this.plugin.exportVersionAsFile(this.file.path,this.versionId)}),this.contentContainer=e.createEl("div",{cls:"preview-content-container"}),this.renderContent();let h=e.createEl("div",{cls:"preview-stats-bar"}),u=this.versionContent.split(`
`);h.createEl("span",{text:`\u{1F4DD} ${u.length} \u884C`}),h.createEl("span",{text:`\u{1F524} ${this.versionContent.length} \u5B57\u7B26`});let f=this.versionContent.split(/\s+/).filter(g=>g.length>0).length;h.createEl("span",{text:`\u{1F4C4} ${f} \u8BCD`})}catch(i){e.createEl("p",{text:"\u274C \u52A0\u8F7D\u9884\u89C8\u5931\u8D25"}),console.error("\u9884\u89C8\u52A0\u8F7D\u5931\u8D25:",i)}}async renderContent(){if(this.contentContainer.empty(),this.isRenderedView){this.toggleButton.setText("\u{1F453} \u5207\u6362\u539F\u59CB\u6587\u672C");let e=this.contentContainer.createEl("div",{cls:"preview-rendered-content"});await p.MarkdownRenderer.renderMarkdown(this.versionContent,e,this.file.path,this.plugin)}else{this.toggleButton.setText("\u{1F4D6} \u5207\u6362\u6E32\u67D3\u89C6\u56FE");let e=this.contentContainer.createEl("div",{cls:"preview-raw-container"}),i=this.versionContent.split(`
`),s=e.createEl("div",{cls:"preview-line-numbers"});i.forEach((r,l)=>{s.createEl("div",{text:String(l+1),cls:"line-number"})}),e.createEl("pre").createEl("code",{text:this.versionContent})}}onClose(){let{contentEl:e}=this;e.empty()}},Xe=class extends p.ItemView{constructor(e,i){super(e);this.selectedVersions=new Set;this.currentFile=null;this.searchQuery="";this.currentPage=0;this.totalVersions=0;this.filterTag=null;this.showStarredOnly=!1;this.plugin=i}getViewType(){return"version-history"}getDisplayText(){return"\u7248\u672C\u5386\u53F2"}getIcon(){return"history"}async onOpen(){this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.currentPage=0,this.refresh()})),await this.refresh()}async onClose(){}updateRelativeTimes(){if(!this.plugin.settings.useRelativeTime)return;let e=this.containerEl.children[1];if(!e)return;e.findAll(".version-time").forEach(s=>{let a=s.dataset.timestamp;if(a){let r=parseInt(a,10);s.textContent=this.plugin.getRelativeTime(r)}})}getRelativeDateGroup(e){let i=new Date,s=new Date(e),a=new Date(i.getFullYear(),i.getMonth(),i.getDate()),r=new Date(i.getFullYear(),i.getMonth(),i.getDate()-1),l=new Date(s.getFullYear(),s.getMonth(),s.getDate());return l.getTime()===a.getTime()?"\u4ECA\u5929":l.getTime()===r.getTime()?"\u6628\u5929":i.getFullYear()===s.getFullYear()&&i.getMonth()===s.getMonth()?"\u672C\u6708":i.getFullYear()===s.getFullYear()?`${s.getMonth()+1}\u6708`:`${s.getFullYear()}\u5E74`}async calculateDiffStatsForVersion(e,i){var r;let s=(r=e.versionIndex)==null?void 0:r.get(i);if(s===void 0)return;let a=e.versions[s];if(!(typeof a.addedLines=="number"&&typeof a.removedLines=="number"))try{let l=await this.plugin.getVersionContent(e.filePath,a.id),d=e.versions[s+1],o=0,c=0;if(d){let h=await this.plugin.getVersionContent(e.filePath,d.id);M(h,l).forEach(f=>{f.added&&(o+=f.count||0),f.removed&&(c+=f.count||0)})}else o=l.split(`
`).length;a.addedLines=o,a.removedLines=c}catch(l){console.error(`\u8BA1\u7B97\u7248\u672C ${a.id} \u7684\u5DEE\u5F02\u7EDF\u8BA1\u5931\u8D25:`,l),a.addedLines=0,a.removedLines=0}}async refresh(){let e=this.containerEl.children[1];e.empty(),e.addClass("version-history-view");let i=this.app.workspace.getActiveFile();if(this.currentFile=i,!i){this.renderEmptyState(e,"\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6");return}let s=e.createEl("div",{cls:"version-header"}),a=s.createEl("div",{cls:"version-title"});a.createEl("h3",{text:i.basename}),a.createEl("span",{text:i.path,cls:"version-file-path"});let r=s.createEl("div",{cls:"version-file-stats"});try{let v=await this.app.vault.read(i),T=await this.app.vault.adapter.stat(i.path);r.createEl("span",{text:`\u{1F4C4} \u5927\u5C0F: ${this.plugin.formatFileSize(v.length)}`,cls:"file-stat-item"}),T&&r.createEl("span",{text:`\u{1F4C5} \u4FEE\u6539: ${new Date(T.mtime).toLocaleString("zh-CN")}`,cls:"file-stat-item"})}catch(v){console.error("\u83B7\u53D6\u6587\u4EF6\u4FE1\u606F\u5931\u8D25:",v)}let l=s.createEl("div",{cls:"version-header-actions"}),d=l.createEl("input",{type:"text",placeholder:"\u641C\u7D22\u7248\u672C...",cls:"version-search"});d.value=this.searchQuery,d.addEventListener("input",v=>{this.searchQuery=v.target.value,this.currentPage=0,this.refresh()}),l.createEl("button",{text:this.showStarredOnly?"\u5DF2\u7B5B\u9009\u661F\u6807":"\u7B5B\u9009\u661F\u6807",cls:this.showStarredOnly?"mod-cta":"",attr:{title:"\u4EC5\u663E\u793A\u661F\u6807\u7248\u672C"}}).addEventListener("click",()=>{this.showStarredOnly=!this.showStarredOnly,this.currentPage=0,this.refresh()}),l.createEl("button",{text:"\u5237\u65B0",attr:{title:"\u624B\u52A8\u5237\u65B0\u7248\u672C\u5217\u8868"}}).addEventListener("click",()=>{new p.Notice("\u6B63\u5728\u5237\u65B0..."),this.plugin.versionCache.delete(i.path),this.refresh()}),l.createEl("button",{text:"+ \u521B\u5EFA",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),l.createEl("button",{text:"\u66F4\u591A",attr:{title:"\u66F4\u591A\u64CD\u4F5C"}}).addEventListener("click",v=>{let T=new p.Menu;T.addItem(D=>D.setTitle("\u{1F4CA} \u67E5\u770B\u7EDF\u8BA1").setIcon("bar-chart").onClick(()=>{this.showDetailedStats()})),T.addItem(D=>D.setTitle("\u{1F4E5} \u5BFC\u51FA\u7248\u672C\u6570\u636E").setIcon("download").onClick(()=>{this.plugin.exportVersions(i.path)})),T.addItem(D=>D.setTitle("\u{1F4C2} \u521B\u5EFA\u5168\u5E93\u7248\u672C").setIcon("folder").onClick(()=>{this.plugin.createFullSnapshot()})),T.addItem(D=>D.setTitle("\u{1F5D1}\uFE0F \u6E05\u7406\u65E7\u7248\u672C").setIcon("trash").onClick(async()=>{await this.cleanupOldVersions(i)})),T.showAtMouseEvent(v)});let f=await this.plugin.loadVersionFile(i.path),g=f.versions;if(this.totalVersions=g.length,this.totalVersions===0){this.renderEmptyState(e,"\u6682\u65E0\u7248\u672C\u5386\u53F2");return}if(g.length>0)try{let v=await this.app.vault.read(i),T=g[0],D=await this.plugin.getVersionContent(i.path,T.id);if(v!==D){let U=M(D,v),W=0,O=0;U.forEach(P=>{P.added&&(W+=P.count||0),P.removed&&(O+=P.count||0)});let ce=e.createEl("div",{cls:"version-diff-banner"});ce.createEl("span",{text:"\u26A0\uFE0F \u6587\u4EF6\u5DF2\u4FEE\u6539"}),ce.createEl("span",{text:`+${W} -${O}`,cls:"diff-stats"}),ce.createEl("button",{text:"\u{1F4BE} \u7ACB\u5373\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),ce.createEl("button",{text:"\u{1F441}\uFE0F \u67E5\u770B\u5DEE\u5F02"}).addEventListener("click",()=>{new ie(this.app,this.plugin,i,T.id).open()})}}catch(v){console.error("\u68C0\u67E5\u6587\u4EF6\u5DEE\u5F02\u5931\u8D25:",v)}let _=g;if(this.showStarredOnly&&(_=_.filter(v=>v.starred)),this.filterTag&&(_=_.filter(v=>v.tags&&v.tags.includes(this.filterTag))),this.searchQuery&&(_=_.filter(v=>v.message.toLowerCase().includes(this.searchQuery.toLowerCase())||this.plugin.formatTime(v.timestamp).toLowerCase().includes(this.searchQuery.toLowerCase())||v.tags&&v.tags.some(T=>T.toLowerCase().includes(this.searchQuery.toLowerCase())))),_.length===0){this.renderEmptyState(e,"\u672A\u627E\u5230\u5339\u914D\u7684\u7248\u672C");return}let m=this.plugin.settings.versionsPerPage>0?this.plugin.settings.versionsPerPage:_.length,x=Math.ceil(_.length/m),E=this.currentPage*m,b=Math.min(E+m,_.length),w=_.slice(E,b),C=!1,V=w.filter(v=>typeof v.addedLines!="number"||typeof v.removedLines!="number").map(v=>(C=!0,this.calculateDiffStatsForVersion(f,v.id)));if(V.length>0&&await Promise.all(V),C&&await this.plugin.saveVersionFile(i.path,f),this.selectedVersions.size>0){let v=e.createEl("div",{cls:"version-toolbar"});v.createEl("span",{text:`\u5DF2\u9009\u62E9 ${this.selectedVersions.size} \u4E2A\u7248\u672C`}),v.createEl("button",{text:"\u6E05\u7A7A\u9009\u62E9"}).addEventListener("click",()=>{this.selectedVersions.clear(),this.refresh()}),v.createEl("button",{text:"\u6279\u91CF\u5220\u9664",cls:"mod-warning"}).addEventListener("click",()=>this.batchDelete(i))}let y=e.createEl("div",{cls:"version-list"}),S={};w.forEach(v=>{let T=this.getRelativeDateGroup(v.timestamp);S[T]||(S[T]=[]),S[T].push(v)});for(let v in S){y.createEl("h4",{text:v,cls:"version-group-header"});let T=S[v];for(let D of T){let U=y.createEl("div",{cls:"version-item"});D.starred&&U.addClass("version-starred");let W=U.createEl("input",{type:"checkbox",cls:"version-checkbox"});W.checked=this.selectedVersions.has(D.id),W.addEventListener("change",()=>{W.checked?this.selectedVersions.add(D.id):this.selectedVersions.delete(D.id),this.refresh()});let O=U.createEl("div",{cls:"version-info"}),ce=O.createEl("div",{cls:"version-time-row"});ce.createEl("span",{text:D.starred?"\u2B50":"\u2606",cls:"version-star-btn"}).addEventListener("click",async()=>{await this.plugin.toggleVersionStar(i.path,D.id)});let hi=ce.createEl("span",{text:this.plugin.formatTime(D.timestamp),cls:"version-time"});hi.dataset.timestamp=String(D.timestamp);let P=O.createEl("div",{cls:"version-message-row"});D.message.includes("[Auto Save]")?P.createEl("span",{text:"\u81EA\u52A8\u4FDD\u5B58",cls:"version-tag version-tag-auto"}):D.message.includes("[Full Snapshot]")?P.createEl("span",{text:"\u5168\u5E93\u7248\u672C",cls:"version-tag version-tag-snapshot"}):D.message.includes("[Before Restore]")&&P.createEl("span",{text:"\u6062\u590D\u524D\u5907\u4EFD",cls:"version-tag version-tag-backup"}),D.diff?P.createEl("span",{text:"\u589E\u91CF",cls:"version-tag version-tag-incremental"}):D.content&&P.createEl("span",{text:"\u5B8C\u6574",cls:"version-tag version-tag-full"}),D.tags&&D.tags.length>0&&D.tags.forEach(Q=>{P.createEl("span",{text:Q,cls:"version-tag version-tag-custom"}).addEventListener("click",()=>{this.filterTag=Q,this.currentPage=0,this.refresh()})}),P.createEl("span",{text:D.message.replace(/\[.*?\]/g,"").trim()||"\u65E0\u63CF\u8FF0",cls:"version-message"}),D.note&&O.createEl("div",{text:`\u{1F4DD} ${D.note}`,cls:"version-note"});let ui=O.createEl("div",{cls:"version-stats-row"});ui.createEl("span",{text:this.plugin.formatFileSize(D.size),cls:"version-size"});let me=ui.createEl("div",{cls:"version-diff-stats"});if(typeof D.addedLines=="number"&&typeof D.removedLines=="number"){let Q=D.addedLines+D.removedLines;if(Q>0){let gi=D.addedLines/Q*100,Yn=D.removedLines/Q*100,pi=me.createEl("div",{cls:"diff-stats-bar"});D.addedLines>0&&pi.createEl("div",{cls:"diff-stats-added",attr:{style:`width: ${gi}%`}}),D.removedLines>0&&pi.createEl("div",{cls:"diff-stats-removed",attr:{style:`width: ${Yn}%`}}),me.createEl("span",{text:`+${D.addedLines}`,cls:"diff-stats-text-added"}),me.createEl("span",{text:`-${D.removedLines}`,cls:"diff-stats-text-removed"}),me.title=`\u65B0\u589E ${D.addedLines} \u884C, \u5220\u9664 ${D.removedLines} \u884C`}else me.setText("\u65E0\u4EE3\u7801\u53D8\u66F4")}else me.setText("\u8BA1\u7B97\u4E2D...");let Qe=U.createEl("div",{cls:"version-actions"});this.plugin.settings.enableQuickPreview&&Qe.createEl("button",{text:"\u9884\u89C8",cls:"version-btn",attr:{title:"\u5FEB\u901F\u9884\u89C8"}}).addEventListener("click",()=>{new pt(this.app,this.plugin,i,D.id).open()}),Qe.createEl("button",{text:"\u6062\u590D",cls:"version-btn"}).addEventListener("click",()=>{this.confirmRestore(i,D.id)}),Qe.createEl("button",{text:"\u6BD4\u8F83",cls:"version-btn"}).addEventListener("click",()=>{this.showDiffModal(i,D.id)}),Qe.createEl("button",{text:"\u66F4\u591A",cls:"version-btn"}).addEventListener("click",Q=>{this.showVersionContextMenu(Q,i,D)})}}if(x>1){let v=e.createEl("div",{cls:"version-pagination"}),T=v.createEl("button",{text:"\u2190 \u4E0A\u4E00\u9875",cls:"version-pagination-btn"});T.disabled=this.currentPage===0,T.addEventListener("click",()=>{this.currentPage>0&&(this.currentPage--,this.refresh())}),v.createEl("span",{text:`\u7B2C ${this.currentPage+1} / ${x} \u9875`,cls:"version-pagination-info"});let D=v.createEl("button",{text:"\u4E0B\u4E00\u9875 \u2192",cls:"version-pagination-btn"});D.disabled=this.currentPage>=x-1,D.addEventListener("click",()=>{this.currentPage<x-1&&(this.currentPage++,this.refresh())})}let k=e.createEl("div",{cls:"version-footer"});k.createEl("span",{text:`\u5171 ${this.totalVersions} \u4E2A\u7248\u672C`}),(this.searchQuery||this.showStarredOnly||this.filterTag)&&k.createEl("span",{text:` \xB7 \u663E\u793A ${_.length} \u4E2A\u7ED3\u679C`}),k.createEl("span",{text:` \xB7 \u663E\u793A ${E+1}-${b}`})}showVersionContextMenu(e,i,s){let a=new p.Menu;a.addItem(r=>r.setTitle("\u4E0E\u5F53\u524D\u6587\u4EF6\u5BF9\u6BD4").setIcon("file-diff").onClick(()=>{this.showDiffModal(i,s.id)})),a.addItem(r=>r.setTitle("\u4E0E\u53E6\u4E00\u4E2A\u7248\u672C\u5BF9\u6BD4").setIcon("files").onClick(()=>{this.selectVersionForCompare(i,s.id)})),a.addSeparator(),a.addItem(r=>r.setTitle(s.starred?"\u53D6\u6D88\u661F\u6807":"\u6DFB\u52A0\u661F\u6807").setIcon("star").onClick(async()=>{await this.plugin.toggleVersionStar(i.path,s.id)})),this.plugin.settings.enableVersionTags&&a.addItem(r=>r.setTitle("\u7F16\u8F91\u6807\u7B7E").setIcon("tag").onClick(()=>{new ri(this.app,this.plugin,i.path,s.id,s.tags||[]).open()})),a.addItem(r=>r.setTitle("\u6DFB\u52A0/\u7F16\u8F91\u5907\u6CE8").setIcon("edit").onClick(()=>{new oi(this.app,this.plugin,i.path,s.id,s.note||"").open()})),a.addSeparator(),a.addItem(r=>r.setTitle("\u5BFC\u51FA\u4E3A\u6587\u4EF6").setIcon("download").onClick(async()=>{await this.plugin.exportVersionAsFile(i.path,s.id)})),a.addItem(r=>r.setTitle("\u5220\u9664\u7248\u672C").setIcon("trash").onClick(async()=>{new le(this.app,"\u786E\u8BA4\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u6B64\u7248\u672C\u5417?

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500!`,async()=>{await this.plugin.deleteVersion(i.path,s.id)}).open()})),a.showAtMouseEvent(e)}async showDetailedStats(){let e=this.currentFile;if(!e)return;let i=await this.plugin.getAllVersions(e.path),s=i.filter(c=>c.starred).length,a=i.filter(c=>c.tags&&c.tags.length>0).length,r=i.reduce((c,h)=>c+h.size,0),l=i.filter(c=>c.message.includes("[Auto Save]")).length,d=i.length-l,o="";if(i.length>1){let c=i[i.length-1].timestamp,h=i[0].timestamp,u=Math.floor((h-c)/(1e3*60*60*24));o=u>0?`${u} \u5929`:"\u4E0D\u8DB31\u5929"}else i.length===1&&(o="\u4EC5\u4E00\u4E2A\u7248\u672C");new p.Notice(`\u{1F4CA} ${e.basename} \u7EDF\u8BA1

\u603B\u7248\u672C\u6570: ${i.length}
\u2B50 \u661F\u6807: ${s}
\u{1F3F7}\uFE0F \u5DF2\u6807\u7B7E: ${a}
\u{1F916} \u81EA\u52A8: ${l}
\u270B \u624B\u52A8: ${d}
\u{1F4E6} \u603B\u5927\u5C0F: ${this.plugin.formatFileSize(r)}
\u{1F4C5} \u65F6\u95F4\u8DE8\u5EA6: ${o}`,8e3)}async cleanupOldVersions(e){new le(this.app,"\u6E05\u7406\u65E7\u7248\u672C",`\u6839\u636E\u8BBE\u7F6E\u7684\u6E05\u7406\u89C4\u5219\u5220\u9664\u65E7\u7248\u672C\u3002
\u661F\u6807\u7248\u672C\u5C06\u88AB\u4FDD\u7559\u3002

\u662F\u5426\u7EE7\u7EED?`,async()=>{let i=await this.plugin.loadVersionFile(e.path),s=i.versions.length,a=this.plugin.cleanupVersionsInMemory(i);a>0?(await this.plugin.saveVersionFile(e.path,i),this.plugin.versionCache.set(e.path,i),new p.Notice(`\u2705 \u5DF2\u6E05\u7406 ${a} \u4E2A\u65E7\u7248\u672C`),this.refresh()):new p.Notice("\u2139\uFE0F \u6CA1\u6709\u9700\u8981\u6E05\u7406\u7684\u7248\u672C")}).open()}renderEmptyState(e,i){let s=e.createEl("div",{cls:"version-history-empty"});s.createEl("div",{text:"\u{1F4CB}",cls:"version-empty-icon"}),s.createEl("div",{text:i}),this.currentFile&&i==="\u6682\u65E0\u7248\u672C\u5386\u53F2"&&s.createEl("button",{text:"\u521B\u5EFA\u7B2C\u4E00\u4E2A\u7248\u672C",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),(this.filterTag||this.showStarredOnly||this.searchQuery)&&s.createEl("button",{text:"\u6E05\u9664\u7B5B\u9009/\u641C\u7D22",cls:"mod-cta"}).addEventListener("click",()=>{this.filterTag=null,this.showStarredOnly=!1,this.searchQuery="",this.currentPage=0,this.refresh()})}confirmRestore(e,i){new le(this.app,"\u786E\u8BA4\u6062\u590D\u7248\u672C",`\u5F53\u524D\u672A\u4FDD\u5B58\u7684\u4FEE\u6539\u5C06\u4F1A\u4E22\u5931,\u63D2\u4EF6\u4F1A\u5728\u6062\u590D\u524D\u81EA\u52A8\u521B\u5EFA\u5907\u4EFD\u7248\u672C\u3002

\u662F\u5426\u7EE7\u7EED?`,async()=>{await this.plugin.restoreVersion(e,i)}).open()}async batchDelete(e){new le(this.app,"\u786E\u8BA4\u6279\u91CF\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684 ${this.selectedVersions.size} \u4E2A\u7248\u672C\u5417?

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500!`,async()=>{let i=Array.from(this.selectedVersions);await this.plugin.deleteVersions(e.path,i),this.selectedVersions.clear()}).open()}showDiffModal(e,i){new ie(this.app,this.plugin,e,i).open()}selectVersionForCompare(e,i){new di(this.app,this.plugin,e,i,s=>{new ie(this.app,this.plugin,e,i,s).open()}).open()}},ri=class extends p.Modal{constructor(e,i,s,a,r){super(e);this.selectedTags=new Set;this.plugin=i,this.filePath=s,this.versionId=a,this.currentTags=r,this.selectedTags=new Set(r)}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"\u7F16\u8F91\u7248\u672C\u6807\u7B7E"});let i=e.createEl("div",{cls:"tag-edit-container"}),s=i.createEl("div",{cls:"tag-section"});s.createEl("h3",{text:"\u5E38\u7528\u6807\u7B7E"});let a=s.createEl("div",{cls:"tag-list"});this.plugin.settings.defaultTags.forEach(_=>{let m=a.createEl("span",{text:_,cls:this.selectedTags.has(_)?"tag-item tag-selected":"tag-item"});m.addEventListener("click",()=>{this.selectedTags.has(_)?(this.selectedTags.delete(_),m.removeClass("tag-selected")):(this.selectedTags.add(_),m.addClass("tag-selected"))})});let r=i.createEl("div",{cls:"tag-section"});r.createEl("h3",{text:"\u81EA\u5B9A\u4E49\u6807\u7B7E"});let l=r.createEl("div",{cls:"tag-input-container"}),d=l.createEl("input",{type:"text",placeholder:"\u8F93\u5165\u65B0\u6807\u7B7E..."});d.style.width="100%";let o=l.createEl("button",{text:"\u6DFB\u52A0",cls:"mod-cta"});o.addEventListener("click",()=>{let _=d.value.trim();_&&!this.selectedTags.has(_)&&(this.selectedTags.add(_),this.renderSelectedTags(h),d.value="")}),d.addEventListener("keydown",_=>{_.key==="Enter"&&o.click()});let c=i.createEl("div",{cls:"tag-section"});c.createEl("h3",{text:"\u5DF2\u9009\u6807\u7B7E"});let h=c.createEl("div",{cls:"tag-list"});this.renderSelectedTags(h);let u=e.createEl("div",{cls:"modal-button-container"});u.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),u.createEl("button",{text:"\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",async()=>{await this.plugin.updateVersionTags(this.filePath,this.versionId,Array.from(this.selectedTags)),new p.Notice("\u2705 \u6807\u7B7E\u5DF2\u66F4\u65B0"),this.close()})}renderSelectedTags(e){e.empty(),this.selectedTags.forEach(i=>{e.createEl("span",{text:i,cls:"tag-item tag-removable"}).createEl("span",{text:"\xD7",cls:"tag-remove"}).addEventListener("click",()=>{this.selectedTags.delete(i),this.renderSelectedTags(e)})})}onClose(){let{contentEl:e}=this;e.empty()}},oi=class extends p.Modal{constructor(e,i,s,a,r){super(e);this.plugin=i,this.filePath=s,this.versionId=a,this.currentNote=r}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"\u7F16\u8F91\u7248\u672C\u5907\u6CE8"});let i=e.createEl("textarea",{placeholder:"\u4E3A\u6B64\u7248\u672C\u6DFB\u52A0\u8BE6\u7EC6\u5907\u6CE8..."});i.value=this.currentNote,i.style.width="100%",i.style.minHeight="150px";let s=e.createEl("div",{cls:"modal-button-container"});s.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),s.createEl("button",{text:"\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",async()=>{await this.plugin.updateVersionNote(this.filePath,this.versionId,i.value.trim()),new p.Notice("\u2705 \u5907\u6CE8\u5DF2\u66F4\u65B0"),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}},li=class extends p.Modal{constructor(e,i,s){super(e);this.result="";this.tags=[];this.settings=i,this.onSubmit=s}onOpen(){let{contentEl:e}=this;if(e.createEl("h2",{text:"\u521B\u5EFA\u7248\u672C"}),new p.Setting(e).setName("\u63D0\u4EA4\u4FE1\u606F").setDesc("\u63CF\u8FF0\u6B64\u7248\u672C\u7684\u66F4\u6539\u5185\u5BB9").addText(r=>{this.inputEl=r,r.setPlaceholder("\u4F8B\u5982:\u6DFB\u52A0\u65B0\u7AE0\u8282\u3001\u4FEE\u590D\u9519\u8BEF\u7B49...").onChange(l=>{this.result=l}),r.inputEl.style.width="100%",r.inputEl.focus()}),this.settings.enableVersionTags&&this.settings.defaultTags.length>0){let r=e.createEl("div",{cls:"tag-section"});r.createEl("h3",{text:"\u6DFB\u52A0\u6807\u7B7E (\u53EF\u9009)"});let l=r.createEl("div",{cls:"tag-list"});this.settings.defaultTags.forEach(d=>{let o=l.createEl("span",{text:d,cls:"tag-item"});o.addEventListener("click",()=>{o.hasClass("tag-selected")?(o.removeClass("tag-selected"),this.tags=this.tags.filter(c=>c!==d)):(o.addClass("tag-selected"),this.tags.push(d))})})}let i=e.createEl("div",{cls:"modal-button-container"});i.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),i.createEl("button",{text:"\u521B\u5EFA",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.onSubmit(this.result||"[Manual Save]",this.tags)}),this.inputEl.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),this.close(),this.onSubmit(this.result||"[Manual Save]",this.tags))})}onClose(){let{contentEl:e}=this;e.empty()}},le=class extends p.Modal{constructor(e,i,s,a){super(e);this.title=i,this.message=s,this.onConfirm=a}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:this.title});let i=e.createEl("p",{cls:"confirm-message"});i.style.whiteSpace="pre-line",i.textContent=this.message;let s=e.createEl("div",{cls:"modal-button-container"});s.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),s.createEl("button",{text:"\u786E\u8BA4",cls:"mod-warning"}).addEventListener("click",()=>{this.close(),this.onConfirm()})}onClose(){let{contentEl:e}=this;e.empty()}},ie=class extends p.Modal{constructor(e,i,s,a,r){super(e);this.currentDiffIndex=0;this.totalDiffs=0;this.diffElements=[];this.collapsedSections=new Set;this.ignoreWhitespace=!1;this.showLineNumbers=!0;this.wrapLines=!0;this.leftContent="";this.rightContent="";this.showOnlyChanges=!0;this.enableMoveDetection=!0;this.showWhitespace=!1;this.currentView="text";this.isRenderedViewBuilt=!1;this.isStructuredViewBuilt=!1;this.allVersions=[];this.plugin=i,this.file=s,this.versionId=a,this.secondVersionId=r||"current",this.currentGranularity=this.plugin.settings.diffGranularity}processDiffForMoves(e){let i=e.map(l=>({...l,type:l.added?"added":l.removed?"removed":"context"})),s=new Map,a=new Map;i.forEach((l,d)=>{if(l.removed){let o=l.value.trim();s.has(o)||s.set(o,[]),s.get(o).push(d)}else if(l.added){let o=l.value.trim();a.has(o)||a.set(o,[]),a.get(o).push(d)}});let r=0;for(let[l,d]of s.entries())if(a.has(l)){let o=a.get(l),c=Math.min(d.length,o.length);for(let h=0;h<c;h++){let u=d.shift(),f=o.shift();i[u].type="moved-from",i[u].moveId=r,i[f].type="moved-to",i[f].moveId=r,r++}}return i}visualizeWhitespace(e){return e.replace(/\t/g,"\u2192   ").replace(/ /g,"\xB7")}async onOpen(){let{contentEl:e}=this;e.addClass("diff-modal"),e.createEl("h2",{text:"\u{1F4CA} \u7248\u672C\u5DEE\u5F02\u5BF9\u6BD4"});let i=e.createEl("div"),s=e.createEl("div",{cls:"diff-main-container"});this.textDiffContainer=s.createEl("div",{cls:"diff-container"}),this.renderedDiffContainer=s.createEl("div",{cls:"rendered-diff-container",attr:{style:"display: none;"}}),this.structuredDiffContainer=s.createEl("div",{cls:"structured-diff-container",attr:{style:"display: none;"}});try{this.allVersions=await this.plugin.getAllVersions(this.file.path)}catch(y){new p.Notice("\u274C \u52A0\u8F7D\u7248\u672C\u5217\u8868\u5931\u8D25"),this.close();return}this.renderVersionSelectors(i),this.infoBannerContainer=i.createEl("div",{cls:"diff-info-banner-compact"});let a=i.createEl("div",{cls:"diff-toolbar-redesigned"}),r=a.createEl("div",{cls:"diff-view-switcher"}),l=r.createEl("button",{text:"\u6587\u672C",cls:"active"}),d=r.createEl("button",{text:"\u6E32\u67D3"}),o=r.createEl("button",{text:"\u7ED3\u6784"}),c=a.createEl("div",{cls:"diff-toolbar-group"}),h=c.createEl("button",{text:"\xAB",attr:{"aria-label":"\u7B2C\u4E00\u4E2A\u5DEE\u5F02"}}),u=c.createEl("button",{text:"\u2039",attr:{"aria-label":"\u4E0A\u4E00\u4E2A\u5DEE\u5F02 (\u2191)"}}),f=c.createEl("span",{cls:"diff-stats"}),g=c.createEl("button",{text:"\u203A",attr:{"aria-label":"\u4E0B\u4E00\u4E2A\u5DEE\u5F02 (\u2193)"}}),_=c.createEl("button",{text:"\xBB",attr:{"aria-label":"\u6700\u540E\u4E00\u4E2A\u5DEE\u5F02"}}),m=a.createEl("div");m.style.flexGrow="1";let x=a.createEl("div",{cls:"diff-toolbar-group"});x.createEl("button",{text:"\u64CD\u4F5C ...",attr:{"aria-label":"\u66F4\u591A\u64CD\u4F5C"}}).addEventListener("click",y=>{let S=new p.Menu;S.addItem(k=>k.setTitle("\u{1F50D} \u641C\u7D22").setIcon("search").onClick(()=>this.showSearchBox())),S.addItem(k=>k.setTitle("\u{1F4CB} \u590D\u5236\u5DEE\u5F02").setIcon("copy").onClick(()=>this.copyDiffToClipboard())),S.addItem(k=>k.setTitle("\u{1F4BE} \u5BFC\u51FA\u62A5\u544A").setIcon("download").onClick(()=>this.exportDiffReport())),S.addItem(k=>k.setTitle("\u{1F4CA} \u67E5\u770B\u7EDF\u8BA1").setIcon("bar-chart").onClick(()=>this.showDetailedStats())),S.showAtMouseEvent(y)});let b=a.createEl("div",{cls:"diff-toolbar-group"});b.createEl("button",{text:"\u8BBE\u7F6E \u2699\uFE0F",attr:{"aria-label":"\u89C6\u56FE\u8BBE\u7F6E"}}).addEventListener("click",y=>{let S=new p.Menu;S.addItem(v=>v.setTitle("\u5DEE\u5F02\u7C92\u5EA6").setDisabled(!0)),S.addItem(v=>v.setTitle("\u5B57\u7B26").setChecked(this.currentGranularity==="char").onClick(()=>this.updateGranularity("char"))),S.addItem(v=>v.setTitle("\u5355\u8BCD").setChecked(this.currentGranularity==="word").onClick(()=>this.updateGranularity("word"))),S.addItem(v=>v.setTitle("\u884C").setChecked(this.currentGranularity==="line").onClick(()=>this.updateGranularity("line"))),S.addSeparator(),S.addItem(v=>v.setTitle("\u89C6\u56FE\u6A21\u5F0F").setDisabled(!0));let k=this.containerEl.querySelector('.diff-select[aria-label="\u89C6\u56FE\u6A21\u5F0F"]');S.addItem(v=>v.setTitle("\u7EDF\u4E00\u89C6\u56FE").setChecked(k.value==="unified").onClick(()=>{k.value="unified",k.dispatchEvent(new Event("change"))})),S.addItem(v=>v.setTitle("\u5DE6\u53F3\u5206\u680F").setChecked(k.value==="split").onClick(()=>{k.value="split",k.dispatchEvent(new Event("change"))})),S.addSeparator(),S.addItem(v=>v.setTitle("\u81EA\u52A8\u6362\u884C").setChecked(this.wrapLines).onClick(()=>{this.wrapLines=!this.wrapLines,this.renderTextDiff()})),S.addItem(v=>v.setTitle("\u663E\u793A\u884C\u53F7").setChecked(this.showLineNumbers).onClick(()=>{this.showLineNumbers=!this.showLineNumbers,this.renderTextDiff()})),S.addItem(v=>v.setTitle("\u5FFD\u7565\u7A7A\u767D").setChecked(this.ignoreWhitespace).onClick(()=>{this.ignoreWhitespace=!this.ignoreWhitespace,this.renderTextDiff()})),S.addItem(v=>v.setTitle("\u663E\u793A\u7A7A\u767D").setChecked(this.showWhitespace).onClick(()=>{this.showWhitespace=!this.showWhitespace,this.renderTextDiff()})),S.addItem(v=>v.setTitle("\u68C0\u6D4B\u79FB\u52A8").setChecked(this.enableMoveDetection).onClick(()=>{this.enableMoveDetection=!this.enableMoveDetection,this.renderTextDiff()})),S.addItem(v=>v.setTitle("\u4EC5\u663E\u793A\u53D8\u66F4").setChecked(this.showOnlyChanges).onClick(()=>{this.showOnlyChanges=!this.showOnlyChanges,this.renderTextDiff()})),S.addSeparator(),S.addItem(v=>v.setTitle("\u5C55\u5F00\u6240\u6709").setIcon("chevrons-down-up").onClick(()=>{this.collapsedSections.clear(),this.renderTextDiff()})),S.addItem(v=>v.setTitle("\u6298\u53E0\u6240\u6709").setIcon("chevrons-up-down").onClick(()=>{this.textDiffContainer.querySelectorAll(".diff-collapse-btn").forEach((D,U)=>this.collapsedSections.add(U)),this.renderTextDiff()})),S.showAtMouseEvent(y)});let C=i.createEl("select",{cls:"diff-select",attr:{"aria-label":"\u89C6\u56FE\u6A21\u5F0F",style:"display: none;"}});C.createEl("option",{text:"\u7EDF\u4E00\u89C6\u56FE",value:"unified"}),C.createEl("option",{text:"\u5DE6\u53F3\u5206\u680F",value:"split"}),C.value=this.plugin.settings.diffViewMode,C.addEventListener("change",()=>{this.collapsedSections.clear(),this.renderTextDiff()});let V=y=>{this.currentView=y,l.toggleClass("active",y==="text"),d.toggleClass("active",y==="rendered"),o.toggleClass("active",y==="structured"),this.textDiffContainer.style.display=y==="text"?"":"none",this.renderedDiffContainer.style.display=y==="rendered"?"":"none",this.structuredDiffContainer.style.display=y==="structured"?"":"none";let S=y==="text";[c,x,b].forEach(k=>k.style.display=S?"flex":"none"),y==="rendered"&&!this.isRenderedViewBuilt&&(this.renderRenderedView(),this.isRenderedViewBuilt=!0),y==="structured"&&!this.isStructuredViewBuilt&&(this.renderStructuredDiff(),this.isStructuredViewBuilt=!0)};l.addEventListener("click",()=>V("text")),d.addEventListener("click",()=>V("rendered")),o.addEventListener("click",()=>V("structured")),u.addEventListener("click",()=>this.navigateDiff(-1)),g.addEventListener("click",()=>this.navigateDiff(1)),h.addEventListener("click",()=>this.navigateDiff("first")),_.addEventListener("click",()=>this.navigateDiff("last")),this.scope.register([],"ArrowUp",()=>(this.currentView==="text"&&!u.disabled&&u.click(),!1)),this.scope.register([],"ArrowDown",()=>(this.currentView==="text"&&!g.disabled&&g.click(),!1)),this.scope.register(["Mod"],"f",y=>(this.currentView==="text"&&(y.preventDefault(),this.showSearchBox()),!1)),this.textDiffContainer.addEventListener("mouseover",y=>{let k=y.target.closest("[data-move-id]");if(k){let v=k.dataset.moveId;this.textDiffContainer.querySelectorAll(`[data-move-id="${v}"]`).forEach(T=>T.addClass("diff-move-highlight"))}}),this.textDiffContainer.addEventListener("mouseout",y=>{let k=y.target.closest("[data-move-id]");if(k){let v=k.dataset.moveId;this.textDiffContainer.querySelectorAll(`[data-move-id="${v}"]`).forEach(T=>T.removeClass("diff-move-highlight"))}}),await this.updateDiffView()}updateGranularity(e){this.currentGranularity=e,this.collapsedSections.clear(),this.renderTextDiff()}navigateDiff(e){if(this.totalDiffs!==0){if(e==="first")this.currentDiffIndex=0;else if(e==="last")this.currentDiffIndex=this.totalDiffs-1;else{let i=this.currentDiffIndex+e;i>=0&&i<this.totalDiffs&&(this.currentDiffIndex=i)}this.updateNavState(),this.scrollToDiff()}}updateNavState(){let e=this.containerEl.querySelector(".diff-stats"),i=this.containerEl.querySelectorAll(".diff-toolbar-group button"),[s,a,,r,l]=Array.from(i);this.totalDiffs>0?(e.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`),a.disabled=this.currentDiffIndex===0,s.disabled=this.currentDiffIndex===0,r.disabled=this.currentDiffIndex>=this.totalDiffs-1,l.disabled=this.currentDiffIndex>=this.totalDiffs-1):(e.setText(this.leftContent===this.rightContent?"\u2705":"0/0"),[s,a,r,l].forEach(d=>d.disabled=!0))}renderLineDiff(e,i){let s=1,a=1,r=0,l=(d,o,c,h,u)=>{if(this.showOnlyChanges&&o==="context"){(h==="left"||h==="both")&&s++,(h==="right"||h==="both")&&a++;return}let f=e.createEl("div",{cls:`diff-line diff-${o}`});o!=="context"&&(f.dataset.diffIndex=String(r++),this.diffElements.push(f)),u!==void 0&&(f.dataset.moveId=String(u));let g=f.createEl("div",{cls:"line-number-container"});this.showLineNumbers&&g.createEl("span",{cls:"line-number",text:c!==null?String(c):""}),g.createEl("span",{text:"\u{1F4DC}",cls:"diff-line-history-btn",attr:{"aria-label":"\u67E5\u770B\u884C\u5386\u53F2"}}).addEventListener("click",()=>this.showLineHistory(d)),(this.versionId==="current"&&h==="left"||this.secondVersionId==="current"&&h==="right")&&(o==="added"&&this.secondVersionId==="current"?g.createEl("span",{text:"-",cls:"diff-line-action-btn",attr:{"aria-label":"\u64A4\u9500\u6B64\u66F4\u6539"}}).addEventListener("click",()=>this.revertChanges(d,a-1)):o==="removed"&&this.secondVersionId==="current"&&g.createEl("span",{text:"+",cls:"diff-line-action-btn",attr:{"aria-label":"\u5E94\u7528\u6B64\u66F4\u6539"}}).addEventListener("click",()=>this.applyChanges(d,a)));let m=" ";o==="added"?m="+":o==="removed"?m="-":o==="moved-from"?m="\u2BAB":o==="moved-to"&&(m="\u2BAA"),f.createEl("span",{cls:"diff-marker",text:m});let x=f.createEl("span",{cls:"line-content",text:this.showWhitespace?this.visualizeWhitespace(d):d});d.trim()===""&&(x.innerHTML="&nbsp;")};for(let d=0;d<i.length;d++){let o=i[d],c=o.value.replace(/\n$/,"").split(`
`);for(let h of c)o.added?(l(h,"added",a,"right"),a++):o.removed?(l(h,"removed",s,"left"),s++):o.type==="moved-from"?(l(h,"moved-from",s,"left",o.moveId),s++):o.type==="moved-to"?(l(h,"moved-to",a,"right",o.moveId),a++):(l(h,"context",a,"both"),s++,a++)}}async applyChanges(e,i){if(this.secondVersionId==="current")try{let a=(await this.app.vault.read(this.file)).split(`
`);a.splice(i,0,e),await this.app.vault.modify(this.file,a.join(`
`)),new p.Notice("\u2705 \u5DF2\u5E94\u7528\u66F4\u6539"),await this.updateDiffView()}catch(s){new p.Notice("\u274C \u5E94\u7528\u66F4\u6539\u5931\u8D25"),console.error(s)}}async revertChanges(e,i){if(this.secondVersionId==="current")try{let a=(await this.app.vault.read(this.file)).split(`
`);if(a[i]===e)a.splice(i,1);else{let r=a.indexOf(e);if(r>-1)a.splice(r,1);else throw new Error("\u65E0\u6CD5\u627E\u5230\u8981\u64A4\u9500\u7684\u884C\u3002")}await this.app.vault.modify(this.file,a.join(`
`)),new p.Notice("\u2705 \u5DF2\u64A4\u9500\u66F4\u6539"),await this.updateDiffView()}catch(s){new p.Notice(`\u274C \u64A4\u9500\u66F4\u6539\u5931\u8D25: ${s.message}`),console.error(s)}}async showLineHistory(e){let i=new p.Notice("\u6B63\u5728\u641C\u7D22\u884C\u5386\u53F2...",0);try{let s=await this.findVersionsContainingLine(e);i.hide(),s.length>0?new ci(this.app,this.plugin,this.file,e,s).open():new p.Notice("\u672A\u5728\u5386\u53F2\u7248\u672C\u4E2D\u627E\u5230\u8BE5\u884C\u5185\u5BB9\u3002")}catch(s){i.hide(),new p.Notice("\u274C \u641C\u7D22\u884C\u5386\u53F2\u5931\u8D25"),console.error(s)}}async findVersionsContainingLine(e){let i=[],s=await this.plugin.getAllVersions(this.file.path);for(let a of s)try{(await this.plugin.getVersionContent(this.file.path,a.id)).includes(e)&&i.push(a)}catch(r){console.warn(`\u65E0\u6CD5\u83B7\u53D6\u7248\u672C ${a.id} \u7684\u5185\u5BB9`)}return i}renderVersionSelectors(e){let i=e.createEl("div",{cls:"diff-version-selector-container"}),s=i.createEl("div",{cls:"diff-version-selector"});s.createEl("span",{text:"\u7248\u672C A:",cls:"diff-selector-label"}),s.createEl("button",{text:"\u52A0\u8F7D\u4E2D...",cls:"diff-selector-btn",attr:{id:"diff-left-version-btn"}}).addEventListener("click",o=>{this.showVersionSelectionMenu(o,"left")}),i.createEl("button",{text:"\u2194\uFE0F",cls:"diff-swap-btn",attr:{title:"\u4EA4\u6362\u5BF9\u6BD4\u7248\u672C"}}).addEventListener("click",async()=>{[this.versionId,this.secondVersionId]=[this.secondVersionId,this.versionId],await this.updateDiffView()});let l=i.createEl("div",{cls:"diff-version-selector"});l.createEl("span",{text:"\u7248\u672C B:",cls:"diff-selector-label"}),l.createEl("button",{text:"\u52A0\u8F7D\u4E2D...",cls:"diff-selector-btn",attr:{id:"diff-right-version-btn"}}).addEventListener("click",o=>{this.showVersionSelectionMenu(o,"right")})}showVersionSelectionMenu(e,i){let s=new p.Menu;s.addItem(a=>a.setTitle("\u{1F4C4} \u5F53\u524D\u6587\u4EF6").setIcon("file-text").onClick(()=>{this.handleVersionChange(i,"current")})),this.allVersions.length===0?(s.addSeparator(),s.addItem(a=>a.setTitle("\u6682\u65E0\u5386\u53F2\u7248\u672C").setDisabled(!0))):(s.addSeparator(),this.allVersions.forEach(a=>{s.addItem(r=>r.setTitle(`${this.plugin.formatTime(a.timestamp)} - ${a.message}`).setIcon("history").onClick(()=>{this.handleVersionChange(i,a.id)}))})),s.showAtMouseEvent(e)}async handleVersionChange(e,i){let s=this.versionId,a=this.secondVersionId;if(e==="left"){if(i===s)return;i===a?[this.versionId,this.secondVersionId]=[this.secondVersionId,this.versionId]:this.versionId=i}else{if(i===a)return;i===s?[this.versionId,this.secondVersionId]=[this.secondVersionId,this.versionId]:this.secondVersionId=i}await this.updateDiffView()}async updateDiffView(){let e=new p.Notice("\u6B63\u5728\u52A0\u8F7D\u65B0\u7248\u672C...",0);try{this.versionId==="current"?this.leftContent=await this.app.vault.read(this.file):this.leftContent=await this.plugin.getVersionContent(this.file.path,this.versionId),this.secondVersionId==="current"?this.rightContent=await this.app.vault.read(this.file):this.rightContent=await this.plugin.getVersionContent(this.file.path,this.secondVersionId),this.updateSelectorButtonLabels(),this.isRenderedViewBuilt=!1,this.isStructuredViewBuilt=!1,this.currentView==="text"?this.renderTextDiff():this.currentView==="rendered"?(this.renderRenderedView(),this.isRenderedViewBuilt=!0):this.currentView==="structured"&&(this.renderStructuredDiff(),this.isStructuredViewBuilt=!0)}catch(i){console.error("\u52A0\u8F7D\u5DEE\u5F02\u5931\u8D25:",i),new p.Notice("\u274C \u52A0\u8F7D\u7248\u672C\u5185\u5BB9\u5931\u8D25")}finally{e.hide()}}updateSelectorButtonLabels(){let e=this.containerEl.querySelector("#diff-left-version-btn"),i=this.containerEl.querySelector("#diff-right-version-btn");if(e)if(this.versionId==="current")e.setText("\u{1F4C4} \u5F53\u524D\u6587\u4EF6");else{let s=this.allVersions.find(a=>a.id===this.versionId);e.setText(s?`\u{1F552} ${this.plugin.formatTime(s.timestamp)}`:"\u672A\u77E5\u7248\u672C")}if(i)if(this.secondVersionId==="current")i.setText("\u{1F4C4} \u5F53\u524D\u6587\u4EF6");else{let s=this.allVersions.find(a=>a.id===this.secondVersionId);i.setText(s?`\u{1F552} ${this.plugin.formatTime(s.timestamp)}`:"\u672A\u77E5\u7248\u672C")}}async renderRenderedView(){this.renderedDiffContainer.empty();let e=this.renderedDiffContainer.createEl("div",{cls:"rendered-diff-panel"}),i=this.renderedDiffContainer.createEl("div",{cls:"rendered-diff-panel"}),s=this.allVersions.find(u=>u.id===this.versionId),a=this.allVersions.find(u=>u.id===this.secondVersionId),r=this.versionId==="current"?"\u5F53\u524D\u6587\u4EF6":s?`\u7248\u672C A: ${this.plugin.formatTime(s.timestamp)}`:"\u7248\u672C A",l=this.secondVersionId==="current"?"\u5F53\u524D\u6587\u4EF6":a?`\u7248\u672C B: ${this.plugin.formatTime(a.timestamp)}`:"\u7248\u672C B";e.createEl("h3",{text:r}),i.createEl("h3",{text:l});let d=e.createEl("div",{cls:"rendered-diff-content"}),o=i.createEl("div",{cls:"rendered-diff-content"});await p.MarkdownRenderer.renderMarkdown(this.leftContent,d,this.file.path,this.plugin),await p.MarkdownRenderer.renderMarkdown(this.rightContent,o,this.file.path,this.plugin);let c=!1,h=(u,f)=>{c||(c=!0,f.scrollTop=u.scrollTop,setTimeout(()=>{c=!1},50))};d.addEventListener("scroll",()=>h(d,o)),o.addEventListener("scroll",()=>h(o,d))}renderTextDiff(){let e=this.textDiffContainer;e.empty(),this.diffElements=[],this.currentDiffIndex=0,this.totalDiffs=0;let i=this.leftContent,s=this.rightContent;if(this.ignoreWhitespace&&(i=this.leftContent.replace(/\s+/g," ").trim(),s=this.rightContent.replace(/\s+/g," ").trim()),!i&&!s){e.createEl("div",{text:"\u4E24\u4E2A\u7248\u672C\u90FD\u662F\u7A7A\u6587\u4EF6",cls:"diff-empty-notice"});return}if(e.toggleClass("show-whitespace-active",this.showWhitespace),this.containerEl.querySelector('.diff-select[aria-label="\u89C6\u56FE\u6A21\u5F0F"]').value==="unified")e.removeClass("diff-split"),this.renderUnifiedDiff(e,i,s,this.currentGranularity);else{e.addClass("diff-split");let r=this.containerEl.querySelector("#diff-left-version-btn"),l=this.containerEl.querySelector("#diff-right-version-btn");this.renderSplitDiff(e,i,s,this.currentGranularity,r.textContent||"\u7248\u672C A",l.textContent||"\u7248\u672C B")}this.wrapLines?e.addClass("diff-wrap-lines"):e.removeClass("diff-wrap-lines"),this.totalDiffs=this.diffElements.length,this.updateNavState(),this.totalDiffs>0&&setTimeout(()=>this.scrollToDiff(),100),this.updateCompactDiffInfo(),this.plugin.refreshVersionHistoryView()}updateCompactDiffInfo(){let e=this.infoBannerContainer;if(!e)return;e.empty();let i=this.leftContent,s=this.rightContent;this.ignoreWhitespace&&(i=this.leftContent.replace(/\s+/g," ").trim(),s=this.rightContent.replace(/\s+/g," ").trim());let a=M(i,s),r=0,l=0;for(let h of a)h.added?r+=h.count||0:h.removed&&(l+=h.count||0);let d=this.leftContent.split(`
`).length,o=r+l,c=d>0?(o/d*100).toFixed(1):"0";e.createEl("span",{text:`\u{1F4CA} \u603B\u884C\u6570: ${d}`,cls:"diff-info-item"}),e.createEl("span",{text:`+${r}`,cls:"diff-info-added"}),e.createEl("span",{text:`-${l}`,cls:"diff-info-removed"}),e.createEl("span",{text:`~${o}`,cls:"diff-info-changed"}),e.createEl("span",{text:`\u53D8\u5316\u7387: ${c}%`,cls:"diff-info-percent"}),e.addClass("diff-info-updated"),setTimeout(()=>{e.removeClass("diff-info-updated")},500)}showDetailedStats(){let e=M(this.leftContent,this.rightContent),i=0,s=0,a=0,r=0;for(let c of e)c.added?(i+=(c.value.match(/\n/g)||[]).length,a+=c.value.length):c.removed&&(s+=(c.value.match(/\n/g)||[]).length,r+=c.value.length);let l=this.leftContent.split(`
`).length,d=this.rightContent.split(`
`).length,o=this.calculateSimilarity(this.leftContent,this.rightContent);new p.Notice(`\u{1F4CA} \u8BE6\u7EC6\u7EDF\u8BA1

\u5DE6\u4FA7\u7248\u672C: ${l} \u884C, ${this.leftContent.length} \u5B57\u7B26
\u53F3\u4FA7\u7248\u672C: ${d} \u884C, ${this.rightContent.length} \u5B57\u7B26

\u65B0\u589E: ${i} \u884C, ${a} \u5B57\u7B26
\u5220\u9664: ${s} \u884C, ${r} \u5B57\u7B26
\u76F8\u4F3C\u5EA6: ${o.toFixed(1)}%
\u5DEE\u5F02\u5757: ${this.totalDiffs} \u4E2A`,1e4)}calculateSimilarity(e,i){let s=e.length,a=i.length,r=Math.max(s,a);if(r===0)return 100;let l=0,d=Math.min(s,a);for(let o=0;o<d;o++)e[o]===i[o]&&l++;return l/r*100}showSearchBox(){let e=this.containerEl.createEl("div",{cls:"diff-search-container"}),i=e.createEl("input",{type:"text",placeholder:"\u641C\u7D22\u5DEE\u5F02\u5185\u5BB9...",cls:"diff-search-input"}),s=e.createEl("span",{cls:"diff-search-results"}),a=e.createEl("button",{text:"\xD7",cls:"diff-search-close"}),r=[],l=0;i.addEventListener("input",()=>{let o=i.value.toLowerCase();if(r.forEach(c=>c.removeClass("diff-search-match")),r=[],l=0,o.length<2){s.setText("");return}this.diffElements.forEach(c=>{var u;(((u=c.textContent)==null?void 0:u.toLowerCase())||"").includes(o)&&(c.addClass("diff-search-match"),r.push(c))}),r.length>0?(s.setText(`${l+1} / ${r.length}`),r[0].addClass("diff-search-current"),r[0].scrollIntoView({behavior:"smooth",block:"center"})):s.setText("\u65E0\u7ED3\u679C")}),i.addEventListener("keydown",o=>{o.key==="Enter"?(o.preventDefault(),r.length>0&&(r[l].removeClass("diff-search-current"),l=(l+1)%r.length,r[l].addClass("diff-search-current"),r[l].scrollIntoView({behavior:"smooth",block:"center"}),s.setText(`${l+1} / ${r.length}`))):o.key==="Escape"&&e.remove()}),a.addEventListener("click",()=>{r.forEach(o=>{o.removeClass("diff-search-match"),o.removeClass("diff-search-current")}),e.remove()});let d=this.containerEl.querySelector(".diff-toolbar-redesigned");d&&d.insertAdjacentElement("afterend",e),i.focus()}async exportDiffReport(){try{let e=M(this.leftContent,this.rightContent),i=`# \u7248\u672C\u5DEE\u5F02\u62A5\u544A

`;i+=`**\u6587\u4EF6**: ${this.file.path}
`,i+=`**\u751F\u6210\u65F6\u95F4**: ${new Date().toLocaleString("zh-CN")}

`;let s=await this.plugin.getAllVersions(this.file.path),a=s.find(c=>c.id===this.versionId);if(a?i+=`**\u5BF9\u6BD4\u7248\u672C**: ${this.plugin.formatTime(a.timestamp)}
`:this.versionId==="current"&&(i+=`**\u5BF9\u6BD4\u7248\u672C**: \u5F53\u524D\u6587\u4EF6
`),this.secondVersionId){let c=s.find(h=>h.id===this.secondVersionId);c?i+=`**\u76EE\u6807\u7248\u672C**: ${this.plugin.formatTime(c.timestamp)}
`:this.secondVersionId==="current"&&(i+=`**\u76EE\u6807\u7248\u672C**: \u5F53\u524D\u6587\u4EF6
`)}i+=`
## \u7EDF\u8BA1\u4FE1\u606F

`;let r=0,l=0,d=0;for(let c of e){let h=c.value.split(`
`).length-1;c.added?r+=h:c.removed?l+=h:d+=h}i+=`- \u65B0\u589E\u884C\u6570: ${r}
`,i+=`- \u5220\u9664\u884C\u6570: ${l}
`,i+=`- \u672A\u53D8\u5316\u884C\u6570: ${d}
`,i+=`- \u603B\u884C\u6570: ${r+l+d}

`,i+=`## \u5DEE\u5F02\u5185\u5BB9

`,i+="```diff\n";for(let c of e){let h=c.added?"+":c.removed?"-":" ",u=c.value.split(`
`);u.forEach((f,g)=>{g<u.length-1&&(i+=`${h} ${f}
`)})}i+="```\n";let o=`diff_report_${Date.now()}.md`;await this.app.vault.create(o,i),new p.Notice(`\u2705 \u5DEE\u5F02\u62A5\u544A\u5DF2\u5BFC\u51FA: ${o}`)}catch(e){console.error("\u5BFC\u51FA\u5DEE\u5F02\u62A5\u544A\u5931\u8D25:",e),new p.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}renderUnifiedDiff(e,i,s,a){if(a==="line"){let r=M(i,s),l=this.enableMoveDetection?this.processDiffForMoves(r):r.map(d=>({...d,type:d.added?"added":d.removed?"removed":"context"}));this.renderLineDiff(e,l)}else{let r=a==="word"?Le(i,s):we(i,s);this.renderInlineDiff(e,r)}}renderInlineDiff(e,i){let s=1,a=!1,r=document.createDocumentFragment(),l=()=>{if(!(this.showOnlyChanges&&!a)){let d=e.createEl("div",{cls:"diff-line diff-context"});a&&(this.diffElements.push(d),d.dataset.diffIndex=String(this.diffElements.length-1)),this.showLineNumbers&&d.createEl("span",{cls:"line-number",text:String(s)}),d.createEl("span",{cls:"line-content"}).appendChild(r)}r=document.createDocumentFragment(),s++,a=!1};for(let d of i){let o=this.showWhitespace?this.visualizeWhitespace(d.value):d.value,c=d.added?"diff-char-added":d.removed?"diff-char-removed":"";c&&(a=!0);let h=o.split(`
`);h.forEach((u,f)=>{u&&(c?r.append(createEl("span",{text:u,cls:c})):r.append(document.createTextNode(u))),f<h.length-1&&l()})}r.hasChildNodes()&&l()}renderSplitDiff(e,i,s,a,r,l){let d=e.createEl("div",{cls:"diff-panel"}),o=e.createEl("div",{cls:"diff-panel"});d.createEl("h3",{text:r}),o.createEl("h3",{text:l});let c=d.createEl("div",{cls:"diff-content"}),h=o.createEl("div",{cls:"diff-content"});this.renderSplitViewAdvanced(c,h,i,s,a)}renderSplitViewAdvanced(e,i,s,a,r){let l=M(s,a),d=1,o=1,c=0,h=(f,g)=>{let _=document.createDocumentFragment();return g.forEach(m=>{let x=m.added?"diff-char-added":m.removed?"diff-char-removed":"",E=this.showWhitespace?this.visualizeWhitespace(m.value):m.value;x?_.append(createEl("span",{text:E,cls:x})):_.append(document.createTextNode(E))}),_},u=(f,g,_,m)=>{let x=f.createEl("div",{cls:`diff-line diff-${_}`});_!=="context"&&_!=="placeholder"&&(x.dataset.diffIndex=String(c++),this.diffElements.push(x)),this.showLineNumbers&&x.createEl("span",{cls:"line-number",text:m?String(m):""});let E=x.createEl("span",{cls:"line-content"});typeof g=="string"?E.setText(this.showWhitespace?this.visualizeWhitespace(g):g):E.appendChild(g)};for(let f=0;f<l.length;f++){let g=l[f],_=l[f+1];if(g.removed&&_&&_.added){let m=g.value.replace(/\n$/,"").split(`
`),x=_.value.replace(/\n$/,"").split(`
`),E=Math.max(m.length,x.length);for(let b=0;b<E;b++){let w=m[b],C=x[b];if(w!==void 0&&C!==void 0){let V=r==="word"?Le(w,C):we(w,C),y=h(w,V.filter(k=>!k.added)),S=h(C,V.filter(k=>!k.removed));u(e,y,"modified",d++),u(i,S,"modified",o++)}else w!==void 0?(u(e,w,"removed",d++),u(i,"","placeholder",null)):C!==void 0&&(u(e,"","placeholder",null),u(i,C,"added",o++))}f++}else if(g.added){let m=g.value.replace(/\n$/,"").split(`
`);for(let x of m)u(e,"","placeholder",null),u(i,x,"added",o++)}else if(g.removed){let m=g.value.replace(/\n$/,"").split(`
`);for(let x of m)u(e,x,"removed",d++),u(i,"","placeholder",null)}else if(this.showOnlyChanges){let m=(g.value.match(/\n/g)||[]).length+(g.value.length>0?1:0);d+=m,o+=m}else{let m=g.value.replace(/\n$/,"").split(`
`);for(let x of m)u(e,x,"context",d++),u(i,x,"context",o++)}}}scrollToDiff(){if(this.diffElements.length===0||this.currentDiffIndex>=this.diffElements.length)return;let e=this.diffElements[this.currentDiffIndex];this.diffElements.forEach(i=>i.removeClass("diff-current")),e.addClass("diff-current"),e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}copyDiffToClipboard(){let e=this.containerEl.querySelector(".diff-container");e&&navigator.clipboard.writeText(e.textContent||"").then(()=>{new p.Notice("\u2705 \u5DEE\u5F02\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(()=>{new p.Notice("\u274C \u590D\u5236\u5931\u8D25")})}renderStructuredDiff(){let e=this.structuredDiffContainer;e.empty();let i=this.parseMarkdownSections(this.leftContent),s=this.parseMarkdownSections(this.rightContent),a=this.compareSections(i,s);if(a.length===0){e.createEl("div",{text:"\u2705 \u5185\u5BB9\u76F8\u540C",cls:"diff-empty-notice"});return}for(let r of a){let l=e.createEl("details",{cls:`structured-section structured-${r.type}`}),d=l.createEl("summary"),o="",c="",h=!1;switch(r.type){case"added":o="\u65B0\u589E",c=r.section.heading,h=!0;break;case"removed":o="\u5220\u9664",c=r.section.heading,h=!0;break;case"modified":o="\u4FEE\u6539",c=r.right.heading,h=!0;break;case"unchanged":o="\u672A\u53D8",c=r.right.heading;break}d.createEl("span",{text:o,cls:`diff-badge diff-badge-${r.type}`}),d.createEl("span",{text:c,cls:"section-heading"}),l.open=h;let u=l.createEl("div",{cls:"section-content"});if(r.type==="modified"){let f=this.currentGranularity==="line"?r.diff:this.currentGranularity==="word"?Le(r.left.content,r.right.content):we(r.left.content,r.right.content);this.currentGranularity==="line"?this.renderLineDiff(u,f):this.renderInlineDiff(u,f)}else r.type==="added"?u.createEl("pre",{text:r.section.content}):r.type==="removed"&&u.createEl("pre",{text:r.section.content})}}parseMarkdownSections(e){let i=[],s=/^(#+)\s+(.*)/,a=e.split(`
`),r=null,l=[],d=0;for(let o of a){let c=o.match(s);c?(r?(r.content=l.join(`
`).trim(),i.push(r)):l.length>0&&l.join("").trim()!==""&&i.push({heading:"\uFF08\u6587\u6863\u5F00\u5934\uFF09",level:0,content:l.join(`
`).trim(),originalIndex:d++}),l=[],r={heading:c[2],level:c[1].length,content:"",originalIndex:d++}):l.push(o)}return r?(r.content=l.join(`
`).trim(),i.push(r)):l.length>0&&l.join("").trim()!==""&&i.push({heading:i.length>0?"\uFF08\u6587\u6863\u672B\u5C3E\uFF09":"\uFF08\u5168\u6587\uFF09",level:0,content:l.join(`
`).trim(),originalIndex:d++}),i}compareSections(e,i){let s=[],a=new Map(e.map(l=>[l.heading,l])),r=new Set;for(let l of i){let d=a.get(l.heading);if(d){if(d.content.trim()===l.content.trim())s.push({type:"unchanged",left:d,right:l});else{let o=M(d.content,l.content),c=this.processDiffForMoves(o);s.push({type:"modified",left:d,right:l,diff:c})}r.add(l.heading)}else s.push({type:"added",section:l})}for(let l of e)r.has(l.heading)||s.push({type:"removed",section:l});return s.sort((l,d)=>{let o=c=>c.type==="added"?c.section.originalIndex:c.type==="modified"||c.type==="unchanged"?c.right.originalIndex:1/0;return o(l)-o(d)})}onClose(){let{contentEl:e}=this;e.empty()}},ci=class extends p.Modal{constructor(e,i,s,a,r){super(e);this.plugin=i,this.file=s,this.lineText=a,this.versions=r}onOpen(){let{contentEl:e}=this;e.addClass("line-history-modal"),e.createEl("h2",{text:"\u884C\u5386\u53F2"}),e.createEl("p",{text:"\u4EE5\u4E0B\u7248\u672C\u4E2D\u5305\u542B\u4E86\u8FD9\u884C\u5185\u5BB9:"}),e.createEl("pre",{text:this.lineText});let i=e.createEl("div",{cls:"version-select-list"});if(this.versions.length===0){i.createEl("div",{text:"\u6CA1\u6709\u627E\u5230\u5339\u914D\u7684\u5386\u53F2\u7248\u672C\u3002",cls:"version-select-empty"});return}for(let s of this.versions){let a=i.createEl("div",{cls:"version-select-item"}),r=a.createEl("div",{cls:"version-info"});r.createEl("div",{text:this.plugin.formatTime(s.timestamp),cls:"version-time"}),r.createEl("div",{text:s.message,cls:"version-message"}),a.createEl("button",{text:"\u5BF9\u6BD4"}).addEventListener("click",()=>{this.close(),new ie(this.app,this.plugin,this.file,s.id).open()})}}onClose(){this.contentEl.empty()}},di=class extends p.Modal{constructor(e,i,s,a,r){super(e);this.searchQuery="";this.plugin=i,this.file=s,this.firstVersionId=a,this.onSelect=r}async onOpen(){let{contentEl:e}=this;e.addClass("version-select-modal"),e.createEl("h2",{text:"\u9009\u62E9\u5BF9\u6BD4\u7248\u672C"}),e.createEl("p",{text:"\u9009\u62E9\u8981\u4E0E\u4E4B\u5BF9\u6BD4\u7684\u7248\u672C",cls:"version-select-hint"}),e.createEl("div",{cls:"version-search-container"}).createEl("input",{type:"text",placeholder:"\u641C\u7D22\u7248\u672C...",cls:"version-search-input"}).addEventListener("input",r=>{this.searchQuery=r.target.value,this.renderVersionList()});let a=e.createEl("div",{cls:"version-select-list"});this.renderVersionList()}async renderVersionList(){let e=this.containerEl.querySelector(".version-select-list");if(!e)return;e.empty();let s=(await this.plugin.getAllVersions(this.file.path)).filter(a=>{if(a.id===this.firstVersionId)return!1;if(!this.searchQuery)return!0;let r=this.searchQuery.toLowerCase();return a.message.toLowerCase().includes(r)||this.plugin.formatTime(a.timestamp).toLowerCase().includes(r)});if(s.length===0){e.createEl("div",{text:this.searchQuery?`\u672A\u627E\u5230\u5339\u914D "${this.searchQuery}" \u7684\u7248\u672C`:"\u6CA1\u6709\u5176\u4ED6\u7248\u672C",cls:"version-select-empty"});return}for(let a of s){let r=e.createEl("div",{cls:"version-select-item"}),l=r.createEl("div",{cls:"version-info"});l.createEl("div",{text:this.plugin.formatTime(a.timestamp),cls:"version-time"}),l.createEl("div",{text:a.message,cls:"version-message"}),l.createEl("div",{text:this.plugin.formatFileSize(a.size),cls:"version-size"}),r.createEl("button",{text:"\u9009\u62E9"}).addEventListener("click",()=>{this.close(),this.onSelect(a.id)})}}onClose(){let{contentEl:e}=this;e.empty()}},fi=class extends p.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i}async display(){let{containerEl:e}=this;if(e.empty(),e.createEl("h2",{text:"\u7248\u672C\u63A7\u5236\u8BBE\u7F6E"}),this.plugin.settings.showVersionStats){let o=await this.plugin.getStorageStats(),c=e.createEl("div",{cls:"version-stats"});c.createEl("h3",{text:"\u{1F4CA} \u5B58\u50A8\u7EDF\u8BA1"});let h=c.createEl("div",{cls:"stats-grid"});h.createEl("div",{text:`\u603B\u5927\u5C0F: ${this.plugin.formatFileSize(o.totalSize)}`}),h.createEl("div",{text:`\u7248\u672C\u6570\u91CF: ${o.versionCount}`}),h.createEl("div",{text:`\u6587\u4EF6\u6570\u91CF: ${o.fileCount}`}),h.createEl("div",{text:`\u661F\u6807\u7248\u672C: ${o.starredCount}`}),h.createEl("div",{text:`\u6807\u7B7E\u7248\u672C: ${o.taggedCount}`}),(this.plugin.settings.enableCompression||this.plugin.settings.enableIncrementalStorage)&&h.createEl("div",{text:`\u538B\u7F29\u7387: ${o.compressionRatio.toFixed(1)}%`}),c.createEl("button",{text:"\u{1F504} \u5237\u65B0\u7EDF\u8BA1"}).addEventListener("click",()=>{this.display()})}e.createEl("h3",{text:"\u2699\uFE0F \u57FA\u7840\u8BBE\u7F6E"}),new p.Setting(e).setName("\u5728\u72B6\u6001\u680F\u663E\u793A\u4E0A\u6B21\u4FDD\u5B58\u65F6\u95F4").setDesc("\u5F00\u542F\u540E\uFF0C\u72B6\u6001\u680F\u5C06\u663E\u793A\u76F8\u5BF9\u7684\u4E0A\u6B21\u4FDD\u5B58\u65F6\u95F4\uFF1B\u5173\u95ED\u5219\u663E\u793A\u901A\u7528\u72B6\u6001\u3002").addToggle(o=>o.setValue(this.plugin.settings.showLastSaveTimeInStatusBar).onChange(async c=>{this.plugin.settings.showLastSaveTimeInStatusBar=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u542F\u7528\u72B6\u6001\u680F\u5FEB\u901F\u5BF9\u6BD4").setDesc("\u70B9\u51FB\u72B6\u6001\u680F\u53EF\u5FEB\u901F\u5BF9\u6BD4\u5F53\u524D\u6587\u4EF6\u4E0E\u6700\u65B0\u7248\u672C").addToggle(o=>o.setValue(this.plugin.settings.enableStatusBarDiff).onChange(async c=>{this.plugin.settings.enableStatusBarDiff=c,await this.plugin.saveSettings(),c?this.plugin.statusBarItem.addClass("version-control-statusbar-clickable"):this.plugin.statusBarItem.removeClass("version-control-statusbar-clickable")})),new p.Setting(e).setName("\u7248\u672C\u5B58\u50A8\u8DEF\u5F84").setDesc("\u6307\u5B9A\u7248\u672C\u6570\u636E\u7684\u5B58\u50A8\u4F4D\u7F6E(\u76F8\u5BF9\u4E8E\u5E93\u6839\u76EE\u5F55)").addText(o=>o.setPlaceholder(".versions").setValue(this.plugin.settings.versionFolder).onChange(async c=>{this.plugin.settings.versionFolder=c||".versions",await this.plugin.saveSettings(),await this.plugin.ensureVersionFolder()})),new p.Setting(e).setName("\u663E\u793A\u901A\u77E5").setDesc("\u5728\u521B\u5EFA\u3001\u6062\u590D\u7248\u672C\u65F6\u663E\u793A\u63D0\u793A\u6D88\u606F").addToggle(o=>o.setValue(this.plugin.settings.showNotifications).onChange(async c=>{this.plugin.settings.showNotifications=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u663E\u793A\u7EDF\u8BA1\u4FE1\u606F").setDesc("\u5728\u8BBE\u7F6E\u9875\u9762\u663E\u793A\u7248\u672C\u7EDF\u8BA1").addToggle(o=>o.setValue(this.plugin.settings.showVersionStats).onChange(async c=>{this.plugin.settings.showVersionStats=c,await this.plugin.saveSettings(),this.display()})),e.createEl("h3",{text:"\u{1F3F7}\uFE0F \u7248\u672C\u6807\u7B7E\u4E0E\u5907\u6CE8"}),new p.Setting(e).setName("\u542F\u7528\u7248\u672C\u6807\u7B7E").setDesc("\u4E3A\u7248\u672C\u6DFB\u52A0\u6807\u7B7E\u4EE5\u4FBF\u5206\u7C7B\u548C\u7B5B\u9009").addToggle(o=>o.setValue(this.plugin.settings.enableVersionTags).onChange(async c=>{this.plugin.settings.enableVersionTags=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u9ED8\u8BA4\u6807\u7B7E\u5217\u8868").setDesc("\u9884\u8BBE\u7684\u5E38\u7528\u6807\u7B7E(\u6BCF\u884C\u4E00\u4E2A)").addTextArea(o=>{o.setValue(this.plugin.settings.defaultTags.join(`
`)).setPlaceholder(`\u91CD\u8981
\u91CC\u7A0B\u7891
\u53D1\u5E03
\u5907\u4EFD
\u8349\u7A3F`).onChange(async c=>{this.plugin.settings.defaultTags=c.split(`
`).map(h=>h.trim()).filter(h=>h.length>0),await this.plugin.saveSettings()}),o.inputEl.rows=4,o.inputEl.style.width="100%"}),new p.Setting(e).setName("\u542F\u7528\u5FEB\u901F\u9884\u89C8").setDesc("\u5728\u7248\u672C\u5386\u53F2\u4E2D\u663E\u793A\u5FEB\u901F\u9884\u89C8\u6309\u94AE").addToggle(o=>o.setValue(this.plugin.settings.enableQuickPreview).onChange(async c=>{this.plugin.settings.enableQuickPreview=c,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView()})),e.createEl("h3",{text:"\u{1F916} \u81EA\u52A8\u4FDD\u5B58"}),new p.Setting(e).setName("\u542F\u7528\u81EA\u52A8\u4FDD\u5B58").setDesc("\u81EA\u52A8\u521B\u5EFA\u7248\u672C\u5FEB\u7167").addToggle(o=>o.setValue(this.plugin.settings.autoSave).onChange(async c=>{this.plugin.settings.autoSave=c,await this.plugin.saveSettings(),c&&this.plugin.settings.autoSaveOnInterval?this.plugin.startAutoSave():this.plugin.autoSaveTimer&&window.clearInterval(this.plugin.autoSaveTimer)}));let i=e.createEl("div",{cls:"setting-item-description"});i.innerHTML="\u9009\u62E9\u4EE5\u4E0B\u4E00\u79CD\u6216\u591A\u79CD\u81EA\u52A8\u4FDD\u5B58\u89E6\u53D1\u65B9\u5F0F:",i.style.marginBottom="10px",i.style.color="var(--text-muted)",new p.Setting(e).setName("\u270F\uFE0F \u4FEE\u6539\u65F6\u81EA\u52A8\u4FDD\u5B58").setDesc("\u6587\u4EF6\u4FEE\u6539\u540E\u5EF6\u8FDF\u4FDD\u5B58(\u63A8\u8350)").addToggle(o=>o.setValue(this.plugin.settings.autoSaveOnModify).onChange(async c=>{this.plugin.settings.autoSaveOnModify=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u4FDD\u5B58\u5EF6\u8FDF (\u79D2)").setDesc("\u4FEE\u6539\u540E\u7B49\u5F85\u591A\u4E45\u624D\u4FDD\u5B58,\u907F\u514D\u9891\u7E41\u521B\u5EFA\u7248\u672C").addSlider(o=>o.setLimits(30,600,30).setValue(this.plugin.settings.autoSaveDelay).setDynamicTooltip().onChange(async c=>{this.plugin.settings.autoSaveDelay=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u6700\u5C0F\u53D8\u5316\u5B57\u7B26\u6570").setDesc("\u53EA\u6709\u53D8\u5316\u8D85\u8FC7\u6B64\u5B57\u7B26\u6570\u65F6\u624D\u4FDD\u5B58\u7248\u672C").addSlider(o=>o.setLimits(0,100,5).setValue(this.plugin.settings.autoSaveMinChanges).setDynamicTooltip().onChange(async c=>{this.plugin.settings.autoSaveMinChanges=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u23F0 \u5B9A\u65F6\u81EA\u52A8\u4FDD\u5B58").setDesc("\u6309\u56FA\u5B9A\u65F6\u95F4\u95F4\u9694\u4FDD\u5B58").addToggle(o=>o.setValue(this.plugin.settings.autoSaveOnInterval).onChange(async c=>{this.plugin.settings.autoSaveOnInterval=c,await this.plugin.saveSettings(),c&&this.plugin.settings.autoSave?this.plugin.startAutoSave():this.plugin.autoSaveTimer&&(window.clearInterval(this.plugin.autoSaveTimer),this.plugin.autoSaveTimer=null)})),new p.Setting(e).setName("\u5B9A\u65F6\u95F4\u9694 (\u5206\u949F)").setDesc("\u6BCF\u9694\u591A\u4E45\u81EA\u52A8\u68C0\u67E5\u5E76\u4FDD\u5B58").addText(o=>o.setPlaceholder("5").setValue(String(this.plugin.settings.autoSaveInterval)).onChange(async c=>{let h=parseInt(c);!isNaN(h)&&h>0&&(this.plugin.settings.autoSaveInterval=h,await this.plugin.saveSettings(),this.plugin.settings.autoSave&&this.plugin.settings.autoSaveOnInterval&&this.plugin.startAutoSave())})),new p.Setting(e).setName("\u{1F4C4} \u5207\u6362\u6587\u4EF6\u65F6\u4FDD\u5B58").setDesc("\u5207\u6362\u5230\u5176\u4ED6\u6587\u4EF6\u65F6\u81EA\u52A8\u4FDD\u5B58\u5F53\u524D\u6587\u4EF6").addToggle(o=>o.setValue(this.plugin.settings.autoSaveOnFileSwitch).onChange(async c=>{this.plugin.settings.autoSaveOnFileSwitch=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u{1F441}\uFE0F \u5931\u53BB\u7126\u70B9\u65F6\u4FDD\u5B58").setDesc("\u7A97\u53E3\u5931\u53BB\u7126\u70B9\u65F6\u81EA\u52A8\u4FDD\u5B58(\u5207\u6362\u5E94\u7528\u65F6)").addToggle(o=>o.setValue(this.plugin.settings.autoSaveOnFocusLost).onChange(async c=>{this.plugin.settings.autoSaveOnFocusLost=c,await this.plugin.saveSettings(),c&&new p.Notice("\u5931\u53BB\u7126\u70B9\u4FDD\u5B58\u5C06\u5728\u91CD\u542F Obsidian \u540E\u751F\u6548")})),new p.Setting(e).setName("\u542F\u7528\u53BB\u91CD").setDesc("\u8DF3\u8FC7\u5185\u5BB9\u76F8\u540C\u7684\u7248\u672C\u521B\u5EFA,\u8282\u7701\u5B58\u50A8\u7A7A\u95F4").addToggle(o=>o.setValue(this.plugin.settings.enableDeduplication).onChange(async c=>{this.plugin.settings.enableDeduplication=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u6392\u9664\u7684\u6587\u4EF6\u5939").setDesc("\u4E0D\u5BF9\u8FD9\u4E9B\u6587\u4EF6\u5939\u4E2D\u7684\u6587\u4EF6\u521B\u5EFA\u7248\u672C(\u6BCF\u884C\u4E00\u4E2A\u8DEF\u5F84)").addTextArea(o=>{o.setValue(this.plugin.settings.excludedFolders.join(`
`)).setPlaceholder(`\u4F8B\u5982:
templates/
.trash/`).onChange(async c=>{this.plugin.settings.excludedFolders=c.split(`
`).map(h=>h.trim()).filter(h=>h.length>0),await this.plugin.saveSettings()}),o.inputEl.rows=4,o.inputEl.style.width="100%"}),e.createEl("h3",{text:"\u{1F4BE} \u5B58\u50A8\u4F18\u5316"}),new p.Setting(e).setName("\u542F\u7528\u538B\u7F29").setDesc("\u4F7F\u7528 gzip \u538B\u7F29\u7248\u672C\u6587\u4EF6,\u663E\u8457\u51CF\u5C11\u5B58\u50A8\u7A7A\u95F4\u5360\u7528").addToggle(o=>o.setValue(this.plugin.settings.enableCompression).onChange(async c=>{this.plugin.settings.enableCompression=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u542F\u7528\u589E\u91CF\u5B58\u50A8").setDesc("\u53EA\u4FDD\u5B58\u7248\u672C\u95F4\u7684\u5DEE\u5F02,\u5927\u5E45\u964D\u4F4E\u5B58\u50A8\u7A7A\u95F4\u4F7F\u7528").addToggle(o=>o.setValue(this.plugin.settings.enableIncrementalStorage).onChange(async c=>{this.plugin.settings.enableIncrementalStorage=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u57FA\u51C6\u7248\u672C\u95F4\u9694").setDesc("\u6BCFN\u4E2A\u7248\u672C\u521B\u5EFA\u4E00\u6B21\u5B8C\u6574\u5FEB\u7167(\u5EFA\u8BAE10-20),\u7528\u4E8E\u589E\u91CF\u5B58\u50A8\u7684\u57FA\u51C6").addText(o=>o.setPlaceholder("10").setValue(String(this.plugin.settings.rebuildBaseInterval)).onChange(async c=>{let h=parseInt(c);!isNaN(h)&&h>0&&(this.plugin.settings.rebuildBaseInterval=h,await this.plugin.saveSettings())})),new p.Setting(e).setName("\u6BCF\u9875\u663E\u793A\u7248\u672C\u6570").setDesc("\u7248\u672C\u5386\u53F2\u89C6\u56FE\u4E2D\u6BCF\u9875\u663E\u793A\u7684\u7248\u672C\u6570\u91CF(0=\u4E0D\u5206\u9875)").addText(o=>o.setPlaceholder("20").setValue(String(this.plugin.settings.versionsPerPage)).onChange(async c=>{let h=parseInt(c);!isNaN(h)&&h>=0&&(this.plugin.settings.versionsPerPage=h,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView())})),new p.Setting(e).setName("\u4F18\u5316\u5B58\u50A8").setDesc("\u91CD\u65B0\u538B\u7F29\u548C\u4F18\u5316\u6240\u6709\u7248\u672C\u6587\u4EF6").addButton(o=>o.setButtonText("\u7ACB\u5373\u4F18\u5316").onClick(async()=>{await this.plugin.optimizeAllVersionFiles(),this.display()})),e.createEl("h3",{text:"\u{1F5D1}\uFE0F \u81EA\u52A8\u6E05\u7406"}),new p.Setting(e).setName("\u542F\u7528\u81EA\u52A8\u6E05\u7406").setDesc("\u81EA\u52A8\u5220\u9664\u65E7\u7248\u672C\u4EE5\u8282\u7701\u7A7A\u95F4").addToggle(o=>o.setValue(this.plugin.settings.autoClear).onChange(async c=>{this.plugin.settings.autoClear=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u6309\u6570\u91CF\u6E05\u7406").setDesc("\u4FDD\u7559\u6307\u5B9A\u6570\u91CF\u7684\u6700\u65B0\u7248\u672C").addToggle(o=>o.setValue(this.plugin.settings.enableMaxVersions).onChange(async c=>{this.plugin.settings.enableMaxVersions=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u6700\u5927\u7248\u672C\u6570").setDesc("\u6BCF\u4E2A\u6587\u4EF6\u6700\u591A\u4FDD\u7559\u7684\u7248\u672C\u6570\u91CF").addText(o=>o.setPlaceholder("50").setValue(String(this.plugin.settings.maxVersions)).onChange(async c=>{let h=parseInt(c);!isNaN(h)&&h>0&&(this.plugin.settings.maxVersions=h,await this.plugin.saveSettings())})),new p.Setting(e).setName("\u6309\u5929\u6570\u6E05\u7406").setDesc("\u81EA\u52A8\u5220\u9664\u8D85\u8FC7\u6307\u5B9A\u5929\u6570\u7684\u7248\u672C").addToggle(o=>o.setValue(this.plugin.settings.enableMaxDays).onChange(async c=>{this.plugin.settings.enableMaxDays=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u6700\u5927\u4FDD\u7559\u5929\u6570").setDesc("\u5220\u9664\u8D85\u8FC7\u6B64\u5929\u6570\u7684\u65E7\u7248\u672C").addText(o=>o.setPlaceholder("30").setValue(String(this.plugin.settings.maxDays)).onChange(async c=>{let h=parseInt(c);!isNaN(h)&&h>0&&(this.plugin.settings.maxDays=h,await this.plugin.saveSettings())})),e.createEl("h3",{text:"\u{1F3A8} \u663E\u793A\u8BBE\u7F6E"}),new p.Setting(e).setName("\u4F7F\u7528\u76F8\u5BF9\u65F6\u95F4").setDesc('\u663E\u793A"3\u5C0F\u65F6\u524D"\u800C\u4E0D\u662F\u5177\u4F53\u65F6\u95F4').addToggle(o=>o.setValue(this.plugin.settings.useRelativeTime).onChange(async c=>{this.plugin.settings.useRelativeTime=c,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView()})),e.createEl("h3",{text:"\u{1F500} \u5DEE\u5F02\u5BF9\u6BD4\u8BBE\u7F6E"}),new p.Setting(e).setName("\u5DEE\u5F02\u7C92\u5EA6").setDesc("\u9009\u62E9\u5DEE\u5F02\u8BA1\u7B97\u7684\u7CBE\u7EC6\u7A0B\u5EA6").addDropdown(o=>o.addOption("char","\u5B57\u7B26\u7EA7 - \u6700\u7CBE\u786E,\u663E\u793A\u6BCF\u4E2A\u5B57\u7B26\u7684\u53D8\u5316").addOption("word","\u5355\u8BCD\u7EA7 - \u6309\u5355\u8BCD\u663E\u793A\u5DEE\u5F02").addOption("line","\u884C\u7EA7 - [\u63A8\u8350] \u6309\u884C\u663E\u793A\u5DEE\u5F02,\u5E76\u9AD8\u4EAE\u884C\u5185\u5355\u8BCD/\u5B57\u7B26\u53D8\u5316").setValue(this.plugin.settings.diffGranularity).onChange(async c=>{this.plugin.settings.diffGranularity=c,await this.plugin.saveSettings()})),new p.Setting(e).setName("\u9ED8\u8BA4\u89C6\u56FE\u6A21\u5F0F").setDesc("\u9009\u62E9\u5DEE\u5F02\u5BF9\u6BD4\u7684\u9ED8\u8BA4\u663E\u793A\u65B9\u5F0F").addDropdown(o=>o.addOption("unified","\u7EDF\u4E00\u89C6\u56FE - \u4E0A\u4E0B\u5BF9\u6BD4").addOption("split","\u5DE6\u53F3\u5206\u680F - \u5E76\u6392\u663E\u793A").setValue(this.plugin.settings.diffViewMode).onChange(async c=>{this.plugin.settings.diffViewMode=c,await this.plugin.saveSettings()})),e.createEl("h3",{text:"\u{1F6E0}\uFE0F \u7EF4\u62A4\u64CD\u4F5C"}),new p.Setting(e).setName("\u6E05\u7406\u6240\u6709\u7248\u672C").setDesc("\u5220\u9664\u6240\u6709\u7248\u672C\u6570\u636E(\u8C28\u614E\u64CD\u4F5C)").addButton(o=>o.setButtonText("\u6E05\u7A7A\u6240\u6709\u7248\u672C").setWarning().onClick(async()=>{new le(this.app,"\u786E\u8BA4\u6E05\u7A7A\u6240\u6709\u7248\u672C",`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664\u6240\u6709\u6587\u4EF6\u7684\u6240\u6709\u7248\u672C\u5386\u53F2!

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500,\u8BF7\u8C28\u614E\u64CD\u4F5C!`,async()=>{await this.clearAllVersions()}).open()})),new p.Setting(e).setName("\u5BFC\u51FA\u7248\u672C\u6570\u636E").setDesc("\u5C06\u7248\u672C\u6587\u4EF6\u5939\u6253\u5305\u5BFC\u51FA").addButton(o=>o.setButtonText("\u521B\u5EFA\u5907\u4EFD").onClick(async()=>{new p.Notice("\u8BF7\u624B\u52A8\u590D\u5236 .versions \u6587\u4EF6\u5939\u8FDB\u884C\u5907\u4EFD")})),e.createEl("h3",{text:"\u{1F4D6} \u4F7F\u7528\u8BF4\u660E"});let s=e.createEl("div",{cls:"version-info-section"}),a=s.createEl("div",{cls:"feature-item"});a.createEl("strong",{text:"\u2728 \u65B0\u529F\u80FD:"});let r=a.createEl("ul");r.createEl("li",{text:"\u7248\u672C\u6807\u7B7E\u7CFB\u7EDF - \u4E3A\u91CD\u8981\u7248\u672C\u6DFB\u52A0\u6807\u7B7E\u8FDB\u884C\u5206\u7C7B"}),r.createEl("li",{text:"\u5FEB\u901F\u9884\u89C8 - \u65E0\u9700\u5B8C\u6574\u5BF9\u6BD4\u5373\u53EF\u67E5\u770B\u7248\u672C\u5185\u5BB9"}),r.createEl("li",{text:"\u7248\u672C\u5907\u6CE8 - \u4E3A\u7248\u672C\u6DFB\u52A0\u8BE6\u7EC6\u8BF4\u660E"}),r.createEl("li",{text:"\u661F\u6807\u6807\u8BB0 - \u6807\u8BB0\u91CD\u8981\u7248\u672C\u4FBF\u4E8E\u67E5\u627E"}),r.createEl("li",{text:"\u9AD8\u7EA7\u7B5B\u9009 - \u6309\u6807\u7B7E\u3001\u661F\u6807\u7B5B\u9009\u7248\u672C"}),r.createEl("li",{text:"\u589E\u5F3A\u5DEE\u5F02\u5BF9\u6BD4 - \u667A\u80FD\u884C\u5185\u9AD8\u4EAE\u3001\u667A\u80FD\u6298\u53E0\u3001\u952E\u76D8\u5BFC\u822A"});let l=s.createEl("div",{cls:"feature-item"});l.createEl("strong",{text:"\u{1F4A1} \u4F7F\u7528\u6280\u5DE7:"});let d=l.createEl("ul");d.createEl("li",{text:"\u53F3\u952E\u70B9\u51FB\u7248\u672C\u53EF\u67E5\u770B\u66F4\u591A\u64CD\u4F5C\u9009\u9879"}),d.createEl("li",{text:"\u70B9\u51FB\u6807\u7B7E\u53EF\u5FEB\u901F\u7B5B\u9009\u76F8\u5173\u7248\u672C"}),d.createEl("li",{text:"\u4F7F\u7528\u661F\u6807\u6807\u8BB0\u91CD\u8981\u7684\u91CC\u7A0B\u7891\u7248\u672C"}),d.createEl("li",{text:'\u5B9A\u671F\u8FD0\u884C"\u4F18\u5316\u5B58\u50A8"\u4EE5\u4FDD\u6301\u6700\u4F73\u6027\u80FD'}),d.createEl("li",{text:"\u589E\u91CF\u5B58\u50A8\u548C\u538B\u7F29\u53EF\u8282\u770190%\u4EE5\u4E0A\u7684\u7A7A\u95F4"}),d.createEl("li",{text:"\u5DEE\u5F02\u5BF9\u6BD4\u4E2D\u4F7F\u7528\u65B9\u5411\u952E \u2191/\u2193 \u5FEB\u901F\u5BFC\u822A"})}async clearAllVersions(){try{let e=this.app.vault.adapter,i=this.plugin.settings.versionFolder;await e.exists(i)&&(await e.rmdir(i,!0),await this.plugin.ensureVersionFolder(),this.plugin.versionCache.clear(),new p.Notice("\u2705 \u5DF2\u6E05\u7A7A\u6240\u6709\u7248\u672C"),this.plugin.refreshVersionHistoryView(),this.display())}catch(e){console.error("\u6E05\u7A7A\u7248\u672C\u5931\u8D25:",e),new p.Notice("\u274C \u6E05\u7A7A\u5931\u8D25,\u8BF7\u67E5\u770B\u63A7\u5236\u53F0")}}};
/*! Bundled license information:

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
