/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ht=Object.defineProperty;var Tn=Object.getOwnPropertyDescriptor;var Dn=Object.getOwnPropertyNames;var Vn=Object.prototype.hasOwnProperty;var In=(t,n)=>{for(var e in n)ht(t,e,{get:n[e],enumerable:!0})},An=(t,n,e,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of Dn(n))!Vn.call(t,s)&&s!==e&&ht(t,s,{get:()=>n[s],enumerable:!(i=Tn(n,s))||i.enumerable});return t};var Fn=t=>An(ht({},"__esModule",{value:!0}),t);var mr={};In(mr,{default:()=>ot});module.exports=Fn(mr);var _=require("obsidian");var B=class{diff(n,e,i={}){let s;typeof i=="function"?(s=i,i={}):"callback"in i&&(s=i.callback);let a=this.castInput(n,i),r=this.castInput(e,i),o=this.removeEmpty(this.tokenize(a,i)),d=this.removeEmpty(this.tokenize(r,i));return this.diffWithOptionsObj(o,d,i,s)}diffWithOptionsObj(n,e,i,s){var a;let r=m=>{if(m=this.postProcess(m,i),s){setTimeout(function(){s(m)},0);return}else return m},o=e.length,d=n.length,l=1,c=o+d;i.maxEditLength!=null&&(c=Math.min(c,i.maxEditLength));let u=(a=i.timeout)!==null&&a!==void 0?a:1/0,h=Date.now()+u,f=[{oldPos:-1,lastComponent:void 0}],p=this.extractCommon(f[0],e,n,0,i);if(f[0].oldPos+1>=d&&p+1>=o)return r(this.buildValues(f[0].lastComponent,e,n));let E=-1/0,v=1/0,w=()=>{for(let m=Math.max(E,-l);m<=Math.min(v,l);m+=2){let b,g=f[m-1],y=f[m+1];g&&(f[m-1]=void 0);let V=!1;if(y){let D=y.oldPos-m;V=y&&0<=D&&D<o}let x=g&&g.oldPos+1<d;if(!V&&!x){f[m]=void 0;continue}if(!x||V&&g.oldPos<y.oldPos?b=this.addToPath(y,!0,!1,0,i):b=this.addToPath(g,!1,!0,1,i),p=this.extractCommon(b,e,n,m,i),b.oldPos+1>=d&&p+1>=o)return r(this.buildValues(b.lastComponent,e,n))||!0;f[m]=b,b.oldPos+1>=d&&(v=Math.min(v,m-1)),p+1>=o&&(E=Math.max(E,m+1))}l++};if(s)(function m(){setTimeout(function(){if(l>c||Date.now()>h)return s(void 0);w()||m()},0)})();else for(;l<=c&&Date.now()<=h;){let m=w();if(m)return m}}addToPath(n,e,i,s,a){let r=n.lastComponent;return r&&!a.oneChangePerToken&&r.added===e&&r.removed===i?{oldPos:n.oldPos+s,lastComponent:{count:r.count+1,added:e,removed:i,previousComponent:r.previousComponent}}:{oldPos:n.oldPos+s,lastComponent:{count:1,added:e,removed:i,previousComponent:r}}}extractCommon(n,e,i,s,a){let r=e.length,o=i.length,d=n.oldPos,l=d-s,c=0;for(;l+1<r&&d+1<o&&this.equals(i[d+1],e[l+1],a);)l++,d++,c++,a.oneChangePerToken&&(n.lastComponent={count:1,previousComponent:n.lastComponent,added:!1,removed:!1});return c&&!a.oneChangePerToken&&(n.lastComponent={count:c,previousComponent:n.lastComponent,added:!1,removed:!1}),n.oldPos=d,l}equals(n,e,i){return i.comparator?i.comparator(n,e):n===e||!!i.ignoreCase&&n.toLowerCase()===e.toLowerCase()}removeEmpty(n){let e=[];for(let i=0;i<n.length;i++)n[i]&&e.push(n[i]);return e}castInput(n,e){return n}tokenize(n,e){return Array.from(n)}join(n){return n.join("")}postProcess(n,e){return n}get useLongestToken(){return!1}buildValues(n,e,i){let s=[],a;for(;n;)s.push(n),a=n.previousComponent,delete n.previousComponent,n=a;s.reverse();let r=s.length,o=0,d=0,l=0;for(;o<r;o++){let c=s[o];if(c.removed)c.value=this.join(i.slice(l,l+c.count)),l+=c.count;else{if(!c.added&&this.useLongestToken){let u=e.slice(d,d+c.count);u=u.map(function(h,f){let p=i[l+f];return p.length>h.length?p:h}),c.value=this.join(u)}else c.value=this.join(e.slice(d,d+c.count));d+=c.count,c.added||(l+=c.count)}}return s}};var ft=class extends B{},ei=new ft;function He(t,n,e){return ei.diff(t,n,e)}function dt(t,n){let e;for(e=0;e<t.length&&e<n.length;e++)if(t[e]!=n[e])return t.slice(0,e);return t.slice(0,e)}function ut(t,n){let e;if(!t||!n||t[t.length-1]!=n[n.length-1])return"";for(e=0;e<t.length&&e<n.length;e++)if(t[t.length-(e+1)]!=n[n.length-(e+1)])return t.slice(-e);return t.slice(-e)}function We(t,n,e){if(t.slice(0,n.length)!=n)throw Error(`string ${JSON.stringify(t)} doesn't start with prefix ${JSON.stringify(n)}; this is a bug`);return e+t.slice(n.length)}function je(t,n,e){if(!n)return t+e;if(t.slice(-n.length)!=n)throw Error(`string ${JSON.stringify(t)} doesn't end with suffix ${JSON.stringify(n)}; this is a bug`);return t.slice(0,-n.length)+e}function he(t,n){return We(t,n,"")}function Se(t,n){return je(t,n,"")}function gt(t,n){return n.slice(0,zn(t,n))}function zn(t,n){let e=0;t.length>n.length&&(e=t.length-n.length);let i=n.length;t.length<n.length&&(i=t.length);let s=Array(i),a=0;s[0]=0;for(let r=1;r<i;r++){for(n[r]==n[a]?s[r]=s[a]:s[r]=a;a>0&&n[r]!=n[a];)a=s[a];n[r]==n[a]&&a++}a=0;for(let r=e;r<t.length;r++){for(;a>0&&t[r]!=n[a];)a=s[a];t[r]==n[a]&&a++}return a}function fe(t){let n;for(n=t.length-1;n>=0&&t[n].match(/\s/);n--);return t.substring(n+1)}function j(t){let n=t.match(/^\s*/);return n?n[0]:""}var Ge="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",Ln=new RegExp(`[${Ge}]+|\\s+|[^${Ge}]`,"ug"),pt=class extends B{equals(n,e,i){return i.ignoreCase&&(n=n.toLowerCase(),e=e.toLowerCase()),n.trim()===e.trim()}tokenize(n,e={}){let i;if(e.intlSegmenter){let r=e.intlSegmenter;if(r.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');i=Array.from(r.segment(n),o=>o.segment)}else i=n.match(Ln)||[];let s=[],a=null;return i.forEach(r=>{/\s/.test(r)?a==null?s.push(r):s.push(s.pop()+r):a!=null&&/\s/.test(a)?s[s.length-1]==a?s.push(s.pop()+r):s.push(a+r):s.push(r),a=r}),s}join(n){return n.map((e,i)=>i==0?e:e.replace(/^\s+/,"")).join("")}postProcess(n,e){if(!n||e.oneChangePerToken)return n;let i=null,s=null,a=null;return n.forEach(r=>{r.added?s=r:r.removed?a=r:((s||a)&&ti(i,a,s,r),i=r,s=null,a=null)}),(s||a)&&ti(i,a,s,null),n}},ii=new pt;function Xe(t,n,e){return(e==null?void 0:e.ignoreWhitespace)!=null&&!e.ignoreWhitespace?si(t,n,e):ii.diff(t,n,e)}function ti(t,n,e,i){if(n&&e){let s=j(n.value),a=fe(n.value),r=j(e.value),o=fe(e.value);if(t){let d=dt(s,r);t.value=je(t.value,r,d),n.value=he(n.value,d),e.value=he(e.value,d)}if(i){let d=ut(a,o);i.value=We(i.value,o,d),n.value=Se(n.value,d),e.value=Se(e.value,d)}}else if(e){if(t){let s=j(e.value);e.value=e.value.substring(s.length)}if(i){let s=j(i.value);i.value=i.value.substring(s.length)}}else if(t&&i){let s=j(i.value),a=j(n.value),r=fe(n.value),o=dt(s,a);n.value=he(n.value,o);let d=ut(he(s,o),r);n.value=Se(n.value,d),i.value=We(i.value,s,d),t.value=je(t.value,s,s.slice(0,s.length-d.length))}else if(i){let s=j(i.value),a=fe(n.value),r=gt(a,s);n.value=Se(n.value,r)}else if(t){let s=fe(t.value),a=j(n.value),r=gt(s,a);n.value=he(n.value,r)}}var _t=class extends B{tokenize(n){let e=new RegExp(`(\\r?\\n)|[${Ge}]+|[^\\S\\n\\r]+|[^${Ge}]`,"ug");return n.match(e)||[]}},ni=new _t;function si(t,n,e){return ni.diff(t,n,e)}var vt=class extends B{constructor(){super(...arguments),this.tokenize=Nn}equals(n,e,i){return i.ignoreWhitespace?((!i.newlineIsToken||!n.includes(`
`))&&(n=n.trim()),(!i.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):i.ignoreNewlineAtEof&&!i.newlineIsToken&&(n.endsWith(`
`)&&(n=n.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),super.equals(n,e,i)}},ai=new vt;function ke(t,n,e){return ai.diff(t,n,e)}function Nn(t,n){n.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));let e=[],i=t.split(/(\n|\r\n)/);i[i.length-1]||i.pop();for(let s=0;s<i.length;s++){let a=i[s];s%2&&!n.newlineIsToken?e[e.length-1]+=a:e.push(a)}return e}function ve(t){let n=t.length;for(;--n>=0;)t[n]=0}var Rn=0,Hi=1,Mn=2,$n=3,Pn=258,Bt=29,Pe=256,Fe=Pe+1+Bt,ge=30,Zt=19,Wi=2*Fe+1,ie=15,wt=16,Bn=7,Ut=256,ji=16,Gi=17,Xi=18,Ft=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),et=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Zn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Yi=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Un=512,X=new Array((Fe+2)*2);ve(X);var Ve=new Array(ge*2);ve(Ve);var ze=new Array(Un);ve(ze);var Le=new Array(Pn-$n+1);ve(Le);var Ht=new Array(Bt);ve(Ht);var tt=new Array(ge);ve(tt);function mt(t,n,e,i,s){this.static_tree=t,this.extra_bits=n,this.extra_base=e,this.elems=i,this.max_length=s,this.has_stree=t&&t.length}var Qi,Ji,Ki;function xt(t,n){this.dyn_tree=t,this.max_code=0,this.stat_desc=n}var qi=t=>t<256?ze[t]:ze[256+(t>>>7)],Ne=(t,n)=>{t.pending_buf[t.pending++]=n&255,t.pending_buf[t.pending++]=n>>>8&255},N=(t,n,e)=>{t.bi_valid>wt-e?(t.bi_buf|=n<<t.bi_valid&65535,Ne(t,t.bi_buf),t.bi_buf=n>>wt-t.bi_valid,t.bi_valid+=e-wt):(t.bi_buf|=n<<t.bi_valid&65535,t.bi_valid+=e)},U=(t,n,e)=>{N(t,e[n*2],e[n*2+1])},en=(t,n)=>{let e=0;do e|=t&1,t>>>=1,e<<=1;while(--n>0);return e>>>1},Hn=t=>{t.bi_valid===16?(Ne(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},Wn=(t,n)=>{let e=n.dyn_tree,i=n.max_code,s=n.stat_desc.static_tree,a=n.stat_desc.has_stree,r=n.stat_desc.extra_bits,o=n.stat_desc.extra_base,d=n.stat_desc.max_length,l,c,u,h,f,p,E=0;for(h=0;h<=ie;h++)t.bl_count[h]=0;for(e[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<Wi;l++)c=t.heap[l],h=e[e[c*2+1]*2+1]+1,h>d&&(h=d,E++),e[c*2+1]=h,!(c>i)&&(t.bl_count[h]++,f=0,c>=o&&(f=r[c-o]),p=e[c*2],t.opt_len+=p*(h+f),a&&(t.static_len+=p*(s[c*2+1]+f)));if(E!==0){do{for(h=d-1;t.bl_count[h]===0;)h--;t.bl_count[h]--,t.bl_count[h+1]+=2,t.bl_count[d]--,E-=2}while(E>0);for(h=d;h!==0;h--)for(c=t.bl_count[h];c!==0;)u=t.heap[--l],!(u>i)&&(e[u*2+1]!==h&&(t.opt_len+=(h-e[u*2+1])*e[u*2],e[u*2+1]=h),c--)}},tn=(t,n,e)=>{let i=new Array(ie+1),s=0,a,r;for(a=1;a<=ie;a++)s=s+e[a-1]<<1,i[a]=s;for(r=0;r<=n;r++){let o=t[r*2+1];o!==0&&(t[r*2]=en(i[o]++,o))}},jn=()=>{let t,n,e,i,s,a=new Array(ie+1);for(e=0,i=0;i<Bt-1;i++)for(Ht[i]=e,t=0;t<1<<Ft[i];t++)Le[e++]=i;for(Le[e-1]=i,s=0,i=0;i<16;i++)for(tt[i]=s,t=0;t<1<<et[i];t++)ze[s++]=i;for(s>>=7;i<ge;i++)for(tt[i]=s<<7,t=0;t<1<<et[i]-7;t++)ze[256+s++]=i;for(n=0;n<=ie;n++)a[n]=0;for(t=0;t<=143;)X[t*2+1]=8,t++,a[8]++;for(;t<=255;)X[t*2+1]=9,t++,a[9]++;for(;t<=279;)X[t*2+1]=7,t++,a[7]++;for(;t<=287;)X[t*2+1]=8,t++,a[8]++;for(tn(X,Fe+1,a),t=0;t<ge;t++)Ve[t*2+1]=5,Ve[t*2]=en(t,5);Qi=new mt(X,Ft,Pe+1,Fe,ie),Ji=new mt(Ve,et,0,ge,ie),Ki=new mt(new Array(0),Zn,0,Zt,Bn)},nn=t=>{let n;for(n=0;n<Fe;n++)t.dyn_ltree[n*2]=0;for(n=0;n<ge;n++)t.dyn_dtree[n*2]=0;for(n=0;n<Zt;n++)t.bl_tree[n*2]=0;t.dyn_ltree[Ut*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},sn=t=>{t.bi_valid>8?Ne(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},ri=(t,n,e,i)=>{let s=n*2,a=e*2;return t[s]<t[a]||t[s]===t[a]&&i[n]<=i[e]},bt=(t,n,e)=>{let i=t.heap[e],s=e<<1;for(;s<=t.heap_len&&(s<t.heap_len&&ri(n,t.heap[s+1],t.heap[s],t.depth)&&s++,!ri(n,i,t.heap[s],t.depth));)t.heap[e]=t.heap[s],e=s,s<<=1;t.heap[e]=i},oi=(t,n,e)=>{let i,s,a=0,r,o;if(t.sym_next!==0)do i=t.pending_buf[t.sym_buf+a++]&255,i+=(t.pending_buf[t.sym_buf+a++]&255)<<8,s=t.pending_buf[t.sym_buf+a++],i===0?U(t,s,n):(r=Le[s],U(t,r+Pe+1,n),o=Ft[r],o!==0&&(s-=Ht[r],N(t,s,o)),i--,r=qi(i),U(t,r,e),o=et[r],o!==0&&(i-=tt[r],N(t,i,o)));while(a<t.sym_next);U(t,Ut,n)},zt=(t,n)=>{let e=n.dyn_tree,i=n.stat_desc.static_tree,s=n.stat_desc.has_stree,a=n.stat_desc.elems,r,o,d=-1,l;for(t.heap_len=0,t.heap_max=Wi,r=0;r<a;r++)e[r*2]!==0?(t.heap[++t.heap_len]=d=r,t.depth[r]=0):e[r*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=d<2?++d:0,e[l*2]=1,t.depth[l]=0,t.opt_len--,s&&(t.static_len-=i[l*2+1]);for(n.max_code=d,r=t.heap_len>>1;r>=1;r--)bt(t,e,r);l=a;do r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],bt(t,e,1),o=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=o,e[l*2]=e[r*2]+e[o*2],t.depth[l]=(t.depth[r]>=t.depth[o]?t.depth[r]:t.depth[o])+1,e[r*2+1]=e[o*2+1]=l,t.heap[1]=l++,bt(t,e,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],Wn(t,n),tn(e,d,t.bl_count)},li=(t,n,e)=>{let i,s=-1,a,r=n[0*2+1],o=0,d=7,l=4;for(r===0&&(d=138,l=3),n[(e+1)*2+1]=65535,i=0;i<=e;i++)a=r,r=n[(i+1)*2+1],!(++o<d&&a===r)&&(o<l?t.bl_tree[a*2]+=o:a!==0?(a!==s&&t.bl_tree[a*2]++,t.bl_tree[ji*2]++):o<=10?t.bl_tree[Gi*2]++:t.bl_tree[Xi*2]++,o=0,s=a,r===0?(d=138,l=3):a===r?(d=6,l=3):(d=7,l=4))},ci=(t,n,e)=>{let i,s=-1,a,r=n[0*2+1],o=0,d=7,l=4;for(r===0&&(d=138,l=3),i=0;i<=e;i++)if(a=r,r=n[(i+1)*2+1],!(++o<d&&a===r)){if(o<l)do U(t,a,t.bl_tree);while(--o!==0);else a!==0?(a!==s&&(U(t,a,t.bl_tree),o--),U(t,ji,t.bl_tree),N(t,o-3,2)):o<=10?(U(t,Gi,t.bl_tree),N(t,o-3,3)):(U(t,Xi,t.bl_tree),N(t,o-11,7));o=0,s=a,r===0?(d=138,l=3):a===r?(d=6,l=3):(d=7,l=4)}},Gn=t=>{let n;for(li(t,t.dyn_ltree,t.l_desc.max_code),li(t,t.dyn_dtree,t.d_desc.max_code),zt(t,t.bl_desc),n=Zt-1;n>=3&&t.bl_tree[Yi[n]*2+1]===0;n--);return t.opt_len+=3*(n+1)+5+5+4,n},Xn=(t,n,e,i)=>{let s;for(N(t,n-257,5),N(t,e-1,5),N(t,i-4,4),s=0;s<i;s++)N(t,t.bl_tree[Yi[s]*2+1],3);ci(t,t.dyn_ltree,n-1),ci(t,t.dyn_dtree,e-1)},Yn=t=>{let n=4093624447,e;for(e=0;e<=31;e++,n>>>=1)if(n&1&&t.dyn_ltree[e*2]!==0)return 0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return 1;for(e=32;e<Pe;e++)if(t.dyn_ltree[e*2]!==0)return 1;return 0},hi=!1,Qn=t=>{hi||(jn(),hi=!0),t.l_desc=new xt(t.dyn_ltree,Qi),t.d_desc=new xt(t.dyn_dtree,Ji),t.bl_desc=new xt(t.bl_tree,Ki),t.bi_buf=0,t.bi_valid=0,nn(t)},an=(t,n,e,i)=>{N(t,(Rn<<1)+(i?1:0),3),sn(t),Ne(t,e),Ne(t,~e),e&&t.pending_buf.set(t.window.subarray(n,n+e),t.pending),t.pending+=e},Jn=t=>{N(t,Hi<<1,3),U(t,Ut,X),Hn(t)},Kn=(t,n,e,i)=>{let s,a,r=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=Yn(t)),zt(t,t.l_desc),zt(t,t.d_desc),r=Gn(t),s=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=s&&(s=a)):s=a=e+5,e+4<=s&&n!==-1?an(t,n,e,i):t.strategy===4||a===s?(N(t,(Hi<<1)+(i?1:0),3),oi(t,X,Ve)):(N(t,(Mn<<1)+(i?1:0),3),Xn(t,t.l_desc.max_code+1,t.d_desc.max_code+1,r+1),oi(t,t.dyn_ltree,t.dyn_dtree)),nn(t),i&&sn(t)},qn=(t,n,e)=>(t.pending_buf[t.sym_buf+t.sym_next++]=n,t.pending_buf[t.sym_buf+t.sym_next++]=n>>8,t.pending_buf[t.sym_buf+t.sym_next++]=e,n===0?t.dyn_ltree[e*2]++:(t.matches++,n--,t.dyn_ltree[(Le[e]+Pe+1)*2]++,t.dyn_dtree[qi(n)*2]++),t.sym_next===t.sym_end),es=Qn,ts=an,is=Kn,ns=qn,ss=Jn,as={_tr_init:es,_tr_stored_block:ts,_tr_flush_block:is,_tr_tally:ns,_tr_align:ss},rs=(t,n,e,i)=>{let s=t&65535|0,a=t>>>16&65535|0,r=0;for(;e!==0;){r=e>2e3?2e3:e,e-=r;do s=s+n[i++]|0,a=a+s|0;while(--r);s%=65521,a%=65521}return s|a<<16|0},Oe=rs,os=()=>{let t,n=[];for(var e=0;e<256;e++){t=e;for(var i=0;i<8;i++)t=t&1?3988292384^t>>>1:t>>>1;n[e]=t}return n},ls=new Uint32Array(os()),cs=(t,n,e,i)=>{let s=ls,a=i+e;t^=-1;for(let r=i;r<a;r++)t=t>>>8^s[(t^n[r])&255];return t^-1},F=cs,ae={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},we={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:hs,_tr_stored_block:Lt,_tr_flush_block:fs,_tr_tally:q,_tr_align:ds}=as,{Z_NO_FLUSH:ee,Z_PARTIAL_FLUSH:us,Z_FULL_FLUSH:gs,Z_FINISH:$,Z_BLOCK:fi,Z_OK:z,Z_STREAM_END:di,Z_STREAM_ERROR:H,Z_DATA_ERROR:ps,Z_BUF_ERROR:Et,Z_DEFAULT_COMPRESSION:_s,Z_FILTERED:vs,Z_HUFFMAN_ONLY:Ye,Z_RLE:ws,Z_FIXED:ms,Z_DEFAULT_STRATEGY:xs,Z_UNKNOWN:bs,Z_DEFLATED:st}=we,Es=9,ys=15,Ss=8,ks=29,Cs=256,Nt=Cs+1+ks,Ts=30,Ds=19,Vs=2*Nt+1,Is=15,T=3,K=258,W=K+T+1,As=32,pe=42,Wt=57,Ot=69,Rt=73,Mt=91,$t=103,ne=113,Te=666,L=1,me=2,re=3,xe=4,Fs=3,se=(t,n)=>(t.msg=ae[n],n),ui=t=>t*2-(t>4?9:0),J=t=>{let n=t.length;for(;--n>=0;)t[n]=0},zs=t=>{let n,e,i,s=t.w_size;n=t.hash_size,i=n;do e=t.head[--i],t.head[i]=e>=s?e-s:0;while(--n);n=s,i=n;do e=t.prev[--i],t.prev[i]=e>=s?e-s:0;while(--n)},Ls=(t,n,e)=>(n<<t.hash_shift^e)&t.hash_mask,te=Ls,R=t=>{let n=t.state,e=n.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+e),t.next_out),t.next_out+=e,n.pending_out+=e,t.total_out+=e,t.avail_out-=e,n.pending-=e,n.pending===0&&(n.pending_out=0))},M=(t,n)=>{fs(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,n),t.block_start=t.strstart,R(t.strm)},I=(t,n)=>{t.pending_buf[t.pending++]=n},Ce=(t,n)=>{t.pending_buf[t.pending++]=n>>>8&255,t.pending_buf[t.pending++]=n&255},Pt=(t,n,e,i)=>{let s=t.avail_in;return s>i&&(s=i),s===0?0:(t.avail_in-=s,n.set(t.input.subarray(t.next_in,t.next_in+s),e),t.state.wrap===1?t.adler=Oe(t.adler,n,s,e):t.state.wrap===2&&(t.adler=F(t.adler,n,s,e)),t.next_in+=s,t.total_in+=s,s)},rn=(t,n)=>{let e=t.max_chain_length,i=t.strstart,s,a,r=t.prev_length,o=t.nice_match,d=t.strstart>t.w_size-W?t.strstart-(t.w_size-W):0,l=t.window,c=t.w_mask,u=t.prev,h=t.strstart+K,f=l[i+r-1],p=l[i+r];t.prev_length>=t.good_match&&(e>>=2),o>t.lookahead&&(o=t.lookahead);do if(s=n,!(l[s+r]!==p||l[s+r-1]!==f||l[s]!==l[i]||l[++s]!==l[i+1])){i+=2,s++;do;while(l[++i]===l[++s]&&l[++i]===l[++s]&&l[++i]===l[++s]&&l[++i]===l[++s]&&l[++i]===l[++s]&&l[++i]===l[++s]&&l[++i]===l[++s]&&l[++i]===l[++s]&&i<h);if(a=K-(h-i),i=h-K,a>r){if(t.match_start=n,r=a,a>=o)break;f=l[i+r-1],p=l[i+r]}}while((n=u[n&c])>d&&--e!==0);return r<=t.lookahead?r:t.lookahead},_e=t=>{let n=t.w_size,e,i,s;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=n+(n-W)&&(t.window.set(t.window.subarray(n,n+n-i),0),t.match_start-=n,t.strstart-=n,t.block_start-=n,t.insert>t.strstart&&(t.insert=t.strstart),zs(t),i+=n),t.strm.avail_in===0)break;if(e=Pt(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=e,t.lookahead+t.insert>=T)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=te(t,t.ins_h,t.window[s+1]);t.insert&&(t.ins_h=te(t,t.ins_h,t.window[s+T-1]),t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<T)););}while(t.lookahead<W&&t.strm.avail_in!==0)},on=(t,n)=>{let e=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,i,s,a,r=0,o=t.strm.avail_in;do{if(i=65535,a=t.bi_valid+42>>3,t.strm.avail_out<a||(a=t.strm.avail_out-a,s=t.strstart-t.block_start,i>s+t.strm.avail_in&&(i=s+t.strm.avail_in),i>a&&(i=a),i<e&&(i===0&&n!==$||n===ee||i!==s+t.strm.avail_in)))break;r=n===$&&i===s+t.strm.avail_in?1:0,Lt(t,0,0,r),t.pending_buf[t.pending-4]=i,t.pending_buf[t.pending-3]=i>>8,t.pending_buf[t.pending-2]=~i,t.pending_buf[t.pending-1]=~i>>8,R(t.strm),s&&(s>i&&(s=i),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+s),t.strm.next_out),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s,t.block_start+=s,i-=s),i&&(Pt(t.strm,t.strm.output,t.strm.next_out,i),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i)}while(r===0);return o-=t.strm.avail_in,o&&(o>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=o&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-o,t.strm.next_in),t.strstart),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),r?xe:n!==ee&&n!==$&&t.strm.avail_in===0&&t.strstart===t.block_start?me:(a=t.window_size-t.strstart,t.strm.avail_in>a&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,a+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),a>t.strm.avail_in&&(a=t.strm.avail_in),a&&(Pt(t.strm,t.window,t.strstart,a),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.high_water<t.strstart&&(t.high_water=t.strstart),a=t.bi_valid+42>>3,a=t.pending_buf_size-a>65535?65535:t.pending_buf_size-a,e=a>t.w_size?t.w_size:a,s=t.strstart-t.block_start,(s>=e||(s||n===$)&&n!==ee&&t.strm.avail_in===0&&s<=a)&&(i=s>a?a:s,r=n===$&&t.strm.avail_in===0&&i===s?1:0,Lt(t,t.block_start,i,r),t.block_start+=i,R(t.strm)),r?re:L)},yt=(t,n)=>{let e,i;for(;;){if(t.lookahead<W){if(_e(t),t.lookahead<W&&n===ee)return L;if(t.lookahead===0)break}if(e=0,t.lookahead>=T&&(t.ins_h=te(t,t.ins_h,t.window[t.strstart+T-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),e!==0&&t.strstart-e<=t.w_size-W&&(t.match_length=rn(t,e)),t.match_length>=T)if(i=q(t,t.strstart-t.match_start,t.match_length-T),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=T){t.match_length--;do t.strstart++,t.ins_h=te(t,t.ins_h,t.window[t.strstart+T-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=te(t,t.ins_h,t.window[t.strstart+1]);else i=q(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(M(t,!1),t.strm.avail_out===0))return L}return t.insert=t.strstart<T-1?t.strstart:T-1,n===$?(M(t,!0),t.strm.avail_out===0?re:xe):t.sym_next&&(M(t,!1),t.strm.avail_out===0)?L:me},de=(t,n)=>{let e,i,s;for(;;){if(t.lookahead<W){if(_e(t),t.lookahead<W&&n===ee)return L;if(t.lookahead===0)break}if(e=0,t.lookahead>=T&&(t.ins_h=te(t,t.ins_h,t.window[t.strstart+T-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=T-1,e!==0&&t.prev_length<t.max_lazy_match&&t.strstart-e<=t.w_size-W&&(t.match_length=rn(t,e),t.match_length<=5&&(t.strategy===vs||t.match_length===T&&t.strstart-t.match_start>4096)&&(t.match_length=T-1)),t.prev_length>=T&&t.match_length<=t.prev_length){s=t.strstart+t.lookahead-T,i=q(t,t.strstart-1-t.prev_match,t.prev_length-T),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=s&&(t.ins_h=te(t,t.ins_h,t.window[t.strstart+T-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=T-1,t.strstart++,i&&(M(t,!1),t.strm.avail_out===0))return L}else if(t.match_available){if(i=q(t,0,t.window[t.strstart-1]),i&&M(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return L}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=q(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<T-1?t.strstart:T-1,n===$?(M(t,!0),t.strm.avail_out===0?re:xe):t.sym_next&&(M(t,!1),t.strm.avail_out===0)?L:me},Ns=(t,n)=>{let e,i,s,a,r=t.window;for(;;){if(t.lookahead<=K){if(_e(t),t.lookahead<=K&&n===ee)return L;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=T&&t.strstart>0&&(s=t.strstart-1,i=r[s],i===r[++s]&&i===r[++s]&&i===r[++s])){a=t.strstart+K;do;while(i===r[++s]&&i===r[++s]&&i===r[++s]&&i===r[++s]&&i===r[++s]&&i===r[++s]&&i===r[++s]&&i===r[++s]&&s<a);t.match_length=K-(a-s),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=T?(e=q(t,1,t.match_length-T),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(e=q(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),e&&(M(t,!1),t.strm.avail_out===0))return L}return t.insert=0,n===$?(M(t,!0),t.strm.avail_out===0?re:xe):t.sym_next&&(M(t,!1),t.strm.avail_out===0)?L:me},Os=(t,n)=>{let e;for(;;){if(t.lookahead===0&&(_e(t),t.lookahead===0)){if(n===ee)return L;break}if(t.match_length=0,e=q(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,e&&(M(t,!1),t.strm.avail_out===0))return L}return t.insert=0,n===$?(M(t,!0),t.strm.avail_out===0?re:xe):t.sym_next&&(M(t,!1),t.strm.avail_out===0)?L:me};function Z(t,n,e,i,s){this.good_length=t,this.max_lazy=n,this.nice_length=e,this.max_chain=i,this.func=s}var De=[new Z(0,0,0,0,on),new Z(4,4,8,4,yt),new Z(4,5,16,8,yt),new Z(4,6,32,32,yt),new Z(4,4,16,16,de),new Z(8,16,32,32,de),new Z(8,16,128,128,de),new Z(8,32,128,256,de),new Z(32,128,258,1024,de),new Z(32,258,258,4096,de)],Rs=t=>{t.window_size=2*t.w_size,J(t.head),t.max_lazy_match=De[t.level].max_lazy,t.good_match=De[t.level].good_length,t.nice_match=De[t.level].nice_length,t.max_chain_length=De[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=T-1,t.match_available=0,t.ins_h=0};function Ms(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=st,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Vs*2),this.dyn_dtree=new Uint16Array((2*Ts+1)*2),this.bl_tree=new Uint16Array((2*Ds+1)*2),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Is+1),this.heap=new Uint16Array(2*Nt+1),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Nt+1),J(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Be=t=>{if(!t)return 1;let n=t.state;return!n||n.strm!==t||n.status!==pe&&n.status!==Wt&&n.status!==Ot&&n.status!==Rt&&n.status!==Mt&&n.status!==$t&&n.status!==ne&&n.status!==Te?1:0},ln=t=>{if(Be(t))return se(t,H);t.total_in=t.total_out=0,t.data_type=bs;let n=t.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap===2?Wt:n.wrap?pe:ne,t.adler=n.wrap===2?0:1,n.last_flush=-2,hs(n),z},cn=t=>{let n=ln(t);return n===z&&Rs(t.state),n},$s=(t,n)=>Be(t)||t.state.wrap!==2?H:(t.state.gzhead=n,z),hn=(t,n,e,i,s,a)=>{if(!t)return H;let r=1;if(n===_s&&(n=6),i<0?(r=0,i=-i):i>15&&(r=2,i-=16),s<1||s>Es||e!==st||i<8||i>15||n<0||n>9||a<0||a>ms||i===8&&r!==1)return se(t,H);i===8&&(i=9);let o=new Ms;return t.state=o,o.strm=t,o.status=pe,o.wrap=r,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+T-1)/T),o.window=new Uint8Array(o.w_size*2),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=(o.lit_bufsize-1)*3,o.level=n,o.strategy=a,o.method=e,cn(t)},Ps=(t,n)=>hn(t,n,st,ys,Ss,xs),Bs=(t,n)=>{if(Be(t)||n>fi||n<0)return t?se(t,H):H;let e=t.state;if(!t.output||t.avail_in!==0&&!t.input||e.status===Te&&n!==$)return se(t,t.avail_out===0?Et:H);let i=e.last_flush;if(e.last_flush=n,e.pending!==0){if(R(t),t.avail_out===0)return e.last_flush=-1,z}else if(t.avail_in===0&&ui(n)<=ui(i)&&n!==$)return se(t,Et);if(e.status===Te&&t.avail_in!==0)return se(t,Et);if(e.status===pe&&e.wrap===0&&(e.status=ne),e.status===pe){let s=st+(e.w_bits-8<<4)<<8,a=-1;if(e.strategy>=Ye||e.level<2?a=0:e.level<6?a=1:e.level===6?a=2:a=3,s|=a<<6,e.strstart!==0&&(s|=As),s+=31-s%31,Ce(e,s),e.strstart!==0&&(Ce(e,t.adler>>>16),Ce(e,t.adler&65535)),t.adler=1,e.status=ne,R(t),e.pending!==0)return e.last_flush=-1,z}if(e.status===Wt){if(t.adler=0,I(e,31),I(e,139),I(e,8),e.gzhead)I(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),I(e,e.gzhead.time&255),I(e,e.gzhead.time>>8&255),I(e,e.gzhead.time>>16&255),I(e,e.gzhead.time>>24&255),I(e,e.level===9?2:e.strategy>=Ye||e.level<2?4:0),I(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(I(e,e.gzhead.extra.length&255),I(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(t.adler=F(t.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=Ot;else if(I(e,0),I(e,0),I(e,0),I(e,0),I(e,0),I(e,e.level===9?2:e.strategy>=Ye||e.level<2?4:0),I(e,Fs),e.status=ne,R(t),e.pending!==0)return e.last_flush=-1,z}if(e.status===Ot){if(e.gzhead.extra){let s=e.pending,a=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+a>e.pending_buf_size;){let o=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+o),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>s&&(t.adler=F(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex+=o,R(t),e.pending!==0)return e.last_flush=-1,z;s=0,a-=o}let r=new Uint8Array(e.gzhead.extra);e.pending_buf.set(r.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending+=a,e.gzhead.hcrc&&e.pending>s&&(t.adler=F(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=Rt}if(e.status===Rt){if(e.gzhead.name){let s=e.pending,a;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(t.adler=F(t.adler,e.pending_buf,e.pending-s,s)),R(t),e.pending!==0)return e.last_flush=-1,z;s=0}e.gzindex<e.gzhead.name.length?a=e.gzhead.name.charCodeAt(e.gzindex++)&255:a=0,I(e,a)}while(a!==0);e.gzhead.hcrc&&e.pending>s&&(t.adler=F(t.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=Mt}if(e.status===Mt){if(e.gzhead.comment){let s=e.pending,a;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(t.adler=F(t.adler,e.pending_buf,e.pending-s,s)),R(t),e.pending!==0)return e.last_flush=-1,z;s=0}e.gzindex<e.gzhead.comment.length?a=e.gzhead.comment.charCodeAt(e.gzindex++)&255:a=0,I(e,a)}while(a!==0);e.gzhead.hcrc&&e.pending>s&&(t.adler=F(t.adler,e.pending_buf,e.pending-s,s))}e.status=$t}if(e.status===$t){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(R(t),e.pending!==0))return e.last_flush=-1,z;I(e,t.adler&255),I(e,t.adler>>8&255),t.adler=0}if(e.status=ne,R(t),e.pending!==0)return e.last_flush=-1,z}if(t.avail_in!==0||e.lookahead!==0||n!==ee&&e.status!==Te){let s=e.level===0?on(e,n):e.strategy===Ye?Os(e,n):e.strategy===ws?Ns(e,n):De[e.level].func(e,n);if((s===re||s===xe)&&(e.status=Te),s===L||s===re)return t.avail_out===0&&(e.last_flush=-1),z;if(s===me&&(n===us?ds(e):n!==fi&&(Lt(e,0,0,!1),n===gs&&(J(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),R(t),t.avail_out===0))return e.last_flush=-1,z}return n!==$?z:e.wrap<=0?di:(e.wrap===2?(I(e,t.adler&255),I(e,t.adler>>8&255),I(e,t.adler>>16&255),I(e,t.adler>>24&255),I(e,t.total_in&255),I(e,t.total_in>>8&255),I(e,t.total_in>>16&255),I(e,t.total_in>>24&255)):(Ce(e,t.adler>>>16),Ce(e,t.adler&65535)),R(t),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?z:di)},Zs=t=>{if(Be(t))return H;let n=t.state.status;return t.state=null,n===ne?se(t,ps):z},Us=(t,n)=>{let e=n.length;if(Be(t))return H;let i=t.state,s=i.wrap;if(s===2||s===1&&i.status!==pe||i.lookahead)return H;if(s===1&&(t.adler=Oe(t.adler,n,e,0)),i.wrap=0,e>=i.w_size){s===0&&(J(i.head),i.strstart=0,i.block_start=0,i.insert=0);let d=new Uint8Array(i.w_size);d.set(n.subarray(e-i.w_size,e),0),n=d,e=i.w_size}let a=t.avail_in,r=t.next_in,o=t.input;for(t.avail_in=e,t.next_in=0,t.input=n,_e(i);i.lookahead>=T;){let d=i.strstart,l=i.lookahead-(T-1);do i.ins_h=te(i,i.ins_h,i.window[d+T-1]),i.prev[d&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=d,d++;while(--l);i.strstart=d,i.lookahead=T-1,_e(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=T-1,i.match_available=0,t.next_in=r,t.input=o,t.avail_in=a,i.wrap=s,z},Hs=Ps,Ws=hn,js=cn,Gs=ln,Xs=$s,Ys=Bs,Qs=Zs,Js=Us,Ks="pako deflate (from Nodeca project)",Ie={deflateInit:Hs,deflateInit2:Ws,deflateReset:js,deflateResetKeep:Gs,deflateSetHeader:Xs,deflate:Ys,deflateEnd:Qs,deflateSetDictionary:Js,deflateInfo:Ks},qs=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),ea=function(t){let n=Array.prototype.slice.call(arguments,1);for(;n.length;){let e=n.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(let i in e)qs(e,i)&&(t[i]=e[i])}}return t},ta=t=>{let n=0;for(let i=0,s=t.length;i<s;i++)n+=t[i].length;let e=new Uint8Array(n);for(let i=0,s=0,a=t.length;i<a;i++){let r=t[i];e.set(r,s),s+=r.length}return e},at={assign:ea,flattenChunks:ta},fn=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){fn=!1}var Re=new Uint8Array(256);for(let t=0;t<256;t++)Re[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Re[254]=Re[254]=1;var ia=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let n,e,i,s,a,r=t.length,o=0;for(s=0;s<r;s++)e=t.charCodeAt(s),(e&64512)===55296&&s+1<r&&(i=t.charCodeAt(s+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),o+=e<128?1:e<2048?2:e<65536?3:4;for(n=new Uint8Array(o),a=0,s=0;a<o;s++)e=t.charCodeAt(s),(e&64512)===55296&&s+1<r&&(i=t.charCodeAt(s+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),e<128?n[a++]=e:e<2048?(n[a++]=192|e>>>6,n[a++]=128|e&63):e<65536?(n[a++]=224|e>>>12,n[a++]=128|e>>>6&63,n[a++]=128|e&63):(n[a++]=240|e>>>18,n[a++]=128|e>>>12&63,n[a++]=128|e>>>6&63,n[a++]=128|e&63);return n},na=(t,n)=>{if(n<65534&&t.subarray&&fn)return String.fromCharCode.apply(null,t.length===n?t:t.subarray(0,n));let e="";for(let i=0;i<n;i++)e+=String.fromCharCode(t[i]);return e},sa=(t,n)=>{let e=n||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,n));let i,s,a=new Array(e*2);for(s=0,i=0;i<e;){let r=t[i++];if(r<128){a[s++]=r;continue}let o=Re[r];if(o>4){a[s++]=65533,i+=o-1;continue}for(r&=o===2?31:o===3?15:7;o>1&&i<e;)r=r<<6|t[i++]&63,o--;if(o>1){a[s++]=65533;continue}r<65536?a[s++]=r:(r-=65536,a[s++]=55296|r>>10&1023,a[s++]=56320|r&1023)}return na(a,s)},aa=(t,n)=>{n=n||t.length,n>t.length&&(n=t.length);let e=n-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?n:e+Re[t[e]]>n?e:n},Me={string2buf:ia,buf2string:sa,utf8border:aa};function ra(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var dn=ra,un=Object.prototype.toString,{Z_NO_FLUSH:oa,Z_SYNC_FLUSH:la,Z_FULL_FLUSH:ca,Z_FINISH:ha,Z_OK:it,Z_STREAM_END:fa,Z_DEFAULT_COMPRESSION:da,Z_DEFAULT_STRATEGY:ua,Z_DEFLATED:ga}=we;function Ze(t){this.options=at.assign({level:da,method:ga,chunkSize:16384,windowBits:15,memLevel:8,strategy:ua},t||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dn,this.strm.avail_out=0;let e=Ie.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(e!==it)throw new Error(ae[e]);if(n.header&&Ie.deflateSetHeader(this.strm,n.header),n.dictionary){let i;if(typeof n.dictionary=="string"?i=Me.string2buf(n.dictionary):un.call(n.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(n.dictionary):i=n.dictionary,e=Ie.deflateSetDictionary(this.strm,i),e!==it)throw new Error(ae[e]);this._dict_set=!0}}Ze.prototype.push=function(t,n){let e=this.strm,i=this.options.chunkSize,s,a;if(this.ended)return!1;for(n===~~n?a=n:a=n===!0?ha:oa,typeof t=="string"?e.input=Me.string2buf(t):un.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),(a===la||a===ca)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(s=Ie.deflate(e,a),s===fa)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),s=Ie.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===it;if(e.avail_out===0){this.onData(e.output);continue}if(a>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};Ze.prototype.onData=function(t){this.chunks.push(t)};Ze.prototype.onEnd=function(t){t===it&&(this.result=at.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function jt(t,n){let e=new Ze(n);if(e.push(t,!0),e.err)throw e.msg||ae[e.err];return e.result}function pa(t,n){return n=n||{},n.raw=!0,jt(t,n)}function _a(t,n){return n=n||{},n.gzip=!0,jt(t,n)}var va=Ze,wa=jt,ma=pa,xa=_a,ba=we,Ea={Deflate:va,deflate:wa,deflateRaw:ma,gzip:xa,constants:ba},Qe=16209,ya=16191,Sa=function(n,e){let i,s,a,r,o,d,l,c,u,h,f,p,E,v,w,m,b,g,y,V,x,D,C,S,k=n.state;i=n.next_in,C=n.input,s=i+(n.avail_in-5),a=n.next_out,S=n.output,r=a-(e-n.avail_out),o=a+(n.avail_out-257),d=k.dmax,l=k.wsize,c=k.whave,u=k.wnext,h=k.window,f=k.hold,p=k.bits,E=k.lencode,v=k.distcode,w=(1<<k.lenbits)-1,m=(1<<k.distbits)-1;e:do{p<15&&(f+=C[i++]<<p,p+=8,f+=C[i++]<<p,p+=8),b=E[f&w];t:for(;;){if(g=b>>>24,f>>>=g,p-=g,g=b>>>16&255,g===0)S[a++]=b&65535;else if(g&16){y=b&65535,g&=15,g&&(p<g&&(f+=C[i++]<<p,p+=8),y+=f&(1<<g)-1,f>>>=g,p-=g),p<15&&(f+=C[i++]<<p,p+=8,f+=C[i++]<<p,p+=8),b=v[f&m];i:for(;;){if(g=b>>>24,f>>>=g,p-=g,g=b>>>16&255,g&16){if(V=b&65535,g&=15,p<g&&(f+=C[i++]<<p,p+=8,p<g&&(f+=C[i++]<<p,p+=8)),V+=f&(1<<g)-1,V>d){n.msg="invalid distance too far back",k.mode=Qe;break e}if(f>>>=g,p-=g,g=a-r,V>g){if(g=V-g,g>c&&k.sane){n.msg="invalid distance too far back",k.mode=Qe;break e}if(x=0,D=h,u===0){if(x+=l-g,g<y){y-=g;do S[a++]=h[x++];while(--g);x=a-V,D=S}}else if(u<g){if(x+=l+u-g,g-=u,g<y){y-=g;do S[a++]=h[x++];while(--g);if(x=0,u<y){g=u,y-=g;do S[a++]=h[x++];while(--g);x=a-V,D=S}}}else if(x+=u-g,g<y){y-=g;do S[a++]=h[x++];while(--g);x=a-V,D=S}for(;y>2;)S[a++]=D[x++],S[a++]=D[x++],S[a++]=D[x++],y-=3;y&&(S[a++]=D[x++],y>1&&(S[a++]=D[x++]))}else{x=a-V;do S[a++]=S[x++],S[a++]=S[x++],S[a++]=S[x++],y-=3;while(y>2);y&&(S[a++]=S[x++],y>1&&(S[a++]=S[x++]))}}else if(g&64){n.msg="invalid distance code",k.mode=Qe;break e}else{b=v[(b&65535)+(f&(1<<g)-1)];continue i}break}}else if(g&64)if(g&32){k.mode=ya;break e}else{n.msg="invalid literal/length code",k.mode=Qe;break e}else{b=E[(b&65535)+(f&(1<<g)-1)];continue t}break}}while(i<s&&a<o);y=p>>3,i-=y,p-=y<<3,f&=(1<<p)-1,n.next_in=i,n.next_out=a,n.avail_in=i<s?5+(s-i):5-(i-s),n.avail_out=a<o?257+(o-a):257-(a-o),k.hold=f,k.bits=p},ue=15,gi=852,pi=592,_i=0,St=1,vi=2,ka=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ca=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ta=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Da=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Va=(t,n,e,i,s,a,r,o)=>{let d=o.bits,l=0,c=0,u=0,h=0,f=0,p=0,E=0,v=0,w=0,m=0,b,g,y,V,x,D=null,C,S=new Uint16Array(ue+1),k=new Uint16Array(ue+1),Q=null,Ee,ye,O;for(l=0;l<=ue;l++)S[l]=0;for(c=0;c<i;c++)S[n[e+c]]++;for(f=d,h=ue;h>=1&&S[h]===0;h--);if(f>h&&(f=h),h===0)return s[a++]=1<<24|64<<16|0,s[a++]=1<<24|64<<16|0,o.bits=1,0;for(u=1;u<h&&S[u]===0;u++);for(f<u&&(f=u),v=1,l=1;l<=ue;l++)if(v<<=1,v-=S[l],v<0)return-1;if(v>0&&(t===_i||h!==1))return-1;for(k[1]=0,l=1;l<ue;l++)k[l+1]=k[l]+S[l];for(c=0;c<i;c++)n[e+c]!==0&&(r[k[n[e+c]]++]=c);if(t===_i?(D=Q=r,C=20):t===St?(D=ka,Q=Ca,C=257):(D=Ta,Q=Da,C=0),m=0,c=0,l=u,x=a,p=f,E=0,y=-1,w=1<<f,V=w-1,t===St&&w>gi||t===vi&&w>pi)return 1;for(;;){Ee=l-E,r[c]+1<C?(ye=0,O=r[c]):r[c]>=C?(ye=Q[r[c]-C],O=D[r[c]-C]):(ye=32+64,O=0),b=1<<l-E,g=1<<p,u=g;do g-=b,s[x+(m>>E)+g]=Ee<<24|ye<<16|O|0;while(g!==0);for(b=1<<l-1;m&b;)b>>=1;if(b!==0?(m&=b-1,m+=b):m=0,c++,--S[l]===0){if(l===h)break;l=n[e+r[c]]}if(l>f&&(m&V)!==y){for(E===0&&(E=f),x+=u,p=l-E,v=1<<p;p+E<h&&(v-=S[p+E],!(v<=0));)p++,v<<=1;if(w+=1<<p,t===St&&w>gi||t===vi&&w>pi)return 1;y=m&V,s[y]=f<<24|p<<16|x-a|0}}return m!==0&&(s[x+m]=l-E<<24|64<<16|0),o.bits=f,0},Ae=Va,Ia=0,gn=1,pn=2,{Z_FINISH:wi,Z_BLOCK:Aa,Z_TREES:Je,Z_OK:oe,Z_STREAM_END:Fa,Z_NEED_DICT:za,Z_STREAM_ERROR:P,Z_DATA_ERROR:_n,Z_MEM_ERROR:vn,Z_BUF_ERROR:La,Z_DEFLATED:mi}=we,rt=16180,xi=16181,bi=16182,Ei=16183,yi=16184,Si=16185,ki=16186,Ci=16187,Ti=16188,Di=16189,nt=16190,G=16191,kt=16192,Vi=16193,Ct=16194,Ii=16195,Ai=16196,Fi=16197,zi=16198,Ke=16199,qe=16200,Li=16201,Ni=16202,Oi=16203,Ri=16204,Mi=16205,Tt=16206,$i=16207,Pi=16208,A=16209,wn=16210,mn=16211,Na=852,Oa=592,Ra=15,Ma=Ra,Bi=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function $a(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var le=t=>{if(!t)return 1;let n=t.state;return!n||n.strm!==t||n.mode<rt||n.mode>mn?1:0},xn=t=>{if(le(t))return P;let n=t.state;return t.total_in=t.total_out=n.total=0,t.msg="",n.wrap&&(t.adler=n.wrap&1),n.mode=rt,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(Na),n.distcode=n.distdyn=new Int32Array(Oa),n.sane=1,n.back=-1,oe},bn=t=>{if(le(t))return P;let n=t.state;return n.wsize=0,n.whave=0,n.wnext=0,xn(t)},En=(t,n)=>{let e;if(le(t))return P;let i=t.state;return n<0?(e=0,n=-n):(e=(n>>4)+5,n<48&&(n&=15)),n&&(n<8||n>15)?P:(i.window!==null&&i.wbits!==n&&(i.window=null),i.wrap=e,i.wbits=n,bn(t))},yn=(t,n)=>{if(!t)return P;let e=new $a;t.state=e,e.strm=t,e.window=null,e.mode=rt;let i=En(t,n);return i!==oe&&(t.state=null),i},Pa=t=>yn(t,Ma),Zi=!0,Dt,Vt,Ba=t=>{if(Zi){Dt=new Int32Array(512),Vt=new Int32Array(32);let n=0;for(;n<144;)t.lens[n++]=8;for(;n<256;)t.lens[n++]=9;for(;n<280;)t.lens[n++]=7;for(;n<288;)t.lens[n++]=8;for(Ae(gn,t.lens,0,288,Dt,0,t.work,{bits:9}),n=0;n<32;)t.lens[n++]=5;Ae(pn,t.lens,0,32,Vt,0,t.work,{bits:5}),Zi=!1}t.lencode=Dt,t.lenbits=9,t.distcode=Vt,t.distbits=5},Sn=(t,n,e,i)=>{let s,a=t.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(n.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(s=a.wsize-a.wnext,s>i&&(s=i),a.window.set(n.subarray(e-i,e-i+s),a.wnext),i-=s,i?(a.window.set(n.subarray(e-i,e),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0},Za=(t,n)=>{let e,i,s,a,r,o,d,l,c,u,h,f,p,E,v=0,w,m,b,g,y,V,x,D,C=new Uint8Array(4),S,k,Q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(le(t)||!t.output||!t.input&&t.avail_in!==0)return P;e=t.state,e.mode===G&&(e.mode=kt),r=t.next_out,s=t.output,d=t.avail_out,a=t.next_in,i=t.input,o=t.avail_in,l=e.hold,c=e.bits,u=o,h=d,D=oe;e:for(;;)switch(e.mode){case rt:if(e.wrap===0){e.mode=kt;break}for(;c<16;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(e.wrap&2&&l===35615){e.wbits===0&&(e.wbits=15),e.check=0,C[0]=l&255,C[1]=l>>>8&255,e.check=F(e.check,C,2,0),l=0,c=0,e.mode=xi;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",e.mode=A;break}if((l&15)!==mi){t.msg="unknown compression method",e.mode=A;break}if(l>>>=4,c-=4,x=(l&15)+8,e.wbits===0&&(e.wbits=x),x>15||x>e.wbits){t.msg="invalid window size",e.mode=A;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=l&512?Di:G,l=0,c=0;break;case xi:for(;c<16;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(e.flags=l,(e.flags&255)!==mi){t.msg="unknown compression method",e.mode=A;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=A;break}e.head&&(e.head.text=l>>8&1),e.flags&512&&e.wrap&4&&(C[0]=l&255,C[1]=l>>>8&255,e.check=F(e.check,C,2,0)),l=0,c=0,e.mode=bi;case bi:for(;c<32;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}e.head&&(e.head.time=l),e.flags&512&&e.wrap&4&&(C[0]=l&255,C[1]=l>>>8&255,C[2]=l>>>16&255,C[3]=l>>>24&255,e.check=F(e.check,C,4,0)),l=0,c=0,e.mode=Ei;case Ei:for(;c<16;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}e.head&&(e.head.xflags=l&255,e.head.os=l>>8),e.flags&512&&e.wrap&4&&(C[0]=l&255,C[1]=l>>>8&255,e.check=F(e.check,C,2,0)),l=0,c=0,e.mode=yi;case yi:if(e.flags&1024){for(;c<16;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}e.length=l,e.head&&(e.head.extra_len=l),e.flags&512&&e.wrap&4&&(C[0]=l&255,C[1]=l>>>8&255,e.check=F(e.check,C,2,0)),l=0,c=0}else e.head&&(e.head.extra=null);e.mode=Si;case Si:if(e.flags&1024&&(f=e.length,f>o&&(f=o),f&&(e.head&&(x=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(i.subarray(a,a+f),x)),e.flags&512&&e.wrap&4&&(e.check=F(e.check,i,f,a)),o-=f,a+=f,e.length-=f),e.length))break e;e.length=0,e.mode=ki;case ki:if(e.flags&2048){if(o===0)break e;f=0;do x=i[a+f++],e.head&&x&&e.length<65536&&(e.head.name+=String.fromCharCode(x));while(x&&f<o);if(e.flags&512&&e.wrap&4&&(e.check=F(e.check,i,f,a)),o-=f,a+=f,x)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=Ci;case Ci:if(e.flags&4096){if(o===0)break e;f=0;do x=i[a+f++],e.head&&x&&e.length<65536&&(e.head.comment+=String.fromCharCode(x));while(x&&f<o);if(e.flags&512&&e.wrap&4&&(e.check=F(e.check,i,f,a)),o-=f,a+=f,x)break e}else e.head&&(e.head.comment=null);e.mode=Ti;case Ti:if(e.flags&512){for(;c<16;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(e.wrap&4&&l!==(e.check&65535)){t.msg="header crc mismatch",e.mode=A;break}l=0,c=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=G;break;case Di:for(;c<32;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}t.adler=e.check=Bi(l),l=0,c=0,e.mode=nt;case nt:if(e.havedict===0)return t.next_out=r,t.avail_out=d,t.next_in=a,t.avail_in=o,e.hold=l,e.bits=c,za;t.adler=e.check=1,e.mode=G;case G:if(n===Aa||n===Je)break e;case kt:if(e.last){l>>>=c&7,c-=c&7,e.mode=Tt;break}for(;c<3;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}switch(e.last=l&1,l>>>=1,c-=1,l&3){case 0:e.mode=Vi;break;case 1:if(Ba(e),e.mode=Ke,n===Je){l>>>=2,c-=2;break e}break;case 2:e.mode=Ai;break;case 3:t.msg="invalid block type",e.mode=A}l>>>=2,c-=2;break;case Vi:for(l>>>=c&7,c-=c&7;c<32;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if((l&65535)!==(l>>>16^65535)){t.msg="invalid stored block lengths",e.mode=A;break}if(e.length=l&65535,l=0,c=0,e.mode=Ct,n===Je)break e;case Ct:e.mode=Ii;case Ii:if(f=e.length,f){if(f>o&&(f=o),f>d&&(f=d),f===0)break e;s.set(i.subarray(a,a+f),r),o-=f,a+=f,d-=f,r+=f,e.length-=f;break}e.mode=G;break;case Ai:for(;c<14;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(e.nlen=(l&31)+257,l>>>=5,c-=5,e.ndist=(l&31)+1,l>>>=5,c-=5,e.ncode=(l&15)+4,l>>>=4,c-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=A;break}e.have=0,e.mode=Fi;case Fi:for(;e.have<e.ncode;){for(;c<3;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}e.lens[Q[e.have++]]=l&7,l>>>=3,c-=3}for(;e.have<19;)e.lens[Q[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,S={bits:e.lenbits},D=Ae(Ia,e.lens,0,19,e.lencode,0,e.work,S),e.lenbits=S.bits,D){t.msg="invalid code lengths set",e.mode=A;break}e.have=0,e.mode=zi;case zi:for(;e.have<e.nlen+e.ndist;){for(;v=e.lencode[l&(1<<e.lenbits)-1],w=v>>>24,m=v>>>16&255,b=v&65535,!(w<=c);){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(b<16)l>>>=w,c-=w,e.lens[e.have++]=b;else{if(b===16){for(k=w+2;c<k;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(l>>>=w,c-=w,e.have===0){t.msg="invalid bit length repeat",e.mode=A;break}x=e.lens[e.have-1],f=3+(l&3),l>>>=2,c-=2}else if(b===17){for(k=w+3;c<k;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}l>>>=w,c-=w,x=0,f=3+(l&7),l>>>=3,c-=3}else{for(k=w+7;c<k;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}l>>>=w,c-=w,x=0,f=11+(l&127),l>>>=7,c-=7}if(e.have+f>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=A;break}for(;f--;)e.lens[e.have++]=x}}if(e.mode===A)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=A;break}if(e.lenbits=9,S={bits:e.lenbits},D=Ae(gn,e.lens,0,e.nlen,e.lencode,0,e.work,S),e.lenbits=S.bits,D){t.msg="invalid literal/lengths set",e.mode=A;break}if(e.distbits=6,e.distcode=e.distdyn,S={bits:e.distbits},D=Ae(pn,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,S),e.distbits=S.bits,D){t.msg="invalid distances set",e.mode=A;break}if(e.mode=Ke,n===Je)break e;case Ke:e.mode=qe;case qe:if(o>=6&&d>=258){t.next_out=r,t.avail_out=d,t.next_in=a,t.avail_in=o,e.hold=l,e.bits=c,Sa(t,h),r=t.next_out,s=t.output,d=t.avail_out,a=t.next_in,i=t.input,o=t.avail_in,l=e.hold,c=e.bits,e.mode===G&&(e.back=-1);break}for(e.back=0;v=e.lencode[l&(1<<e.lenbits)-1],w=v>>>24,m=v>>>16&255,b=v&65535,!(w<=c);){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(m&&!(m&240)){for(g=w,y=m,V=b;v=e.lencode[V+((l&(1<<g+y)-1)>>g)],w=v>>>24,m=v>>>16&255,b=v&65535,!(g+w<=c);){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}l>>>=g,c-=g,e.back+=g}if(l>>>=w,c-=w,e.back+=w,e.length=b,m===0){e.mode=Mi;break}if(m&32){e.back=-1,e.mode=G;break}if(m&64){t.msg="invalid literal/length code",e.mode=A;break}e.extra=m&15,e.mode=Li;case Li:if(e.extra){for(k=e.extra;c<k;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}e.length+=l&(1<<e.extra)-1,l>>>=e.extra,c-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=Ni;case Ni:for(;v=e.distcode[l&(1<<e.distbits)-1],w=v>>>24,m=v>>>16&255,b=v&65535,!(w<=c);){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(!(m&240)){for(g=w,y=m,V=b;v=e.distcode[V+((l&(1<<g+y)-1)>>g)],w=v>>>24,m=v>>>16&255,b=v&65535,!(g+w<=c);){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}l>>>=g,c-=g,e.back+=g}if(l>>>=w,c-=w,e.back+=w,m&64){t.msg="invalid distance code",e.mode=A;break}e.offset=b,e.extra=m&15,e.mode=Oi;case Oi:if(e.extra){for(k=e.extra;c<k;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}e.offset+=l&(1<<e.extra)-1,l>>>=e.extra,c-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=A;break}e.mode=Ri;case Ri:if(d===0)break e;if(f=h-d,e.offset>f){if(f=e.offset-f,f>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=A;break}f>e.wnext?(f-=e.wnext,p=e.wsize-f):p=e.wnext-f,f>e.length&&(f=e.length),E=e.window}else E=s,p=r-e.offset,f=e.length;f>d&&(f=d),d-=f,e.length-=f;do s[r++]=E[p++];while(--f);e.length===0&&(e.mode=qe);break;case Mi:if(d===0)break e;s[r++]=e.length,d--,e.mode=qe;break;case Tt:if(e.wrap){for(;c<32;){if(o===0)break e;o--,l|=i[a++]<<c,c+=8}if(h-=d,t.total_out+=h,e.total+=h,e.wrap&4&&h&&(t.adler=e.check=e.flags?F(e.check,s,h,r-h):Oe(e.check,s,h,r-h)),h=d,e.wrap&4&&(e.flags?l:Bi(l))!==e.check){t.msg="incorrect data check",e.mode=A;break}l=0,c=0}e.mode=$i;case $i:if(e.wrap&&e.flags){for(;c<32;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(e.wrap&4&&l!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=A;break}l=0,c=0}e.mode=Pi;case Pi:D=Fa;break e;case A:D=_n;break e;case wn:return vn;case mn:default:return P}return t.next_out=r,t.avail_out=d,t.next_in=a,t.avail_in=o,e.hold=l,e.bits=c,(e.wsize||h!==t.avail_out&&e.mode<A&&(e.mode<Tt||n!==wi))&&Sn(t,t.output,t.next_out,h-t.avail_out),u-=t.avail_in,h-=t.avail_out,t.total_in+=u,t.total_out+=h,e.total+=h,e.wrap&4&&h&&(t.adler=e.check=e.flags?F(e.check,s,h,t.next_out-h):Oe(e.check,s,h,t.next_out-h)),t.data_type=e.bits+(e.last?64:0)+(e.mode===G?128:0)+(e.mode===Ke||e.mode===Ct?256:0),(u===0&&h===0||n===wi)&&D===oe&&(D=La),D},Ua=t=>{if(le(t))return P;let n=t.state;return n.window&&(n.window=null),t.state=null,oe},Ha=(t,n)=>{if(le(t))return P;let e=t.state;return e.wrap&2?(e.head=n,n.done=!1,oe):P},Wa=(t,n)=>{let e=n.length,i,s,a;return le(t)||(i=t.state,i.wrap!==0&&i.mode!==nt)?P:i.mode===nt&&(s=1,s=Oe(s,n,e,0),s!==i.check)?_n:(a=Sn(t,n,e,e),a?(i.mode=wn,vn):(i.havedict=1,oe))},ja=bn,Ga=En,Xa=xn,Ya=Pa,Qa=yn,Ja=Za,Ka=Ua,qa=Ha,er=Wa,tr="pako inflate (from Nodeca project)",Y={inflateReset:ja,inflateReset2:Ga,inflateResetKeep:Xa,inflateInit:Ya,inflateInit2:Qa,inflate:Ja,inflateEnd:Ka,inflateGetHeader:qa,inflateSetDictionary:er,inflateInfo:tr};function ir(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var nr=ir,kn=Object.prototype.toString,{Z_NO_FLUSH:sr,Z_FINISH:ar,Z_OK:$e,Z_STREAM_END:It,Z_NEED_DICT:At,Z_STREAM_ERROR:rr,Z_DATA_ERROR:Ui,Z_MEM_ERROR:or}=we;function Ue(t){this.options=at.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});let n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),n.windowBits>=0&&n.windowBits<16&&!(t&&t.windowBits)&&(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(n.windowBits&15||(n.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dn,this.strm.avail_out=0;let e=Y.inflateInit2(this.strm,n.windowBits);if(e!==$e)throw new Error(ae[e]);if(this.header=new nr,Y.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=Me.string2buf(n.dictionary):kn.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(e=Y.inflateSetDictionary(this.strm,n.dictionary),e!==$e)))throw new Error(ae[e])}Ue.prototype.push=function(t,n){let e=this.strm,i=this.options.chunkSize,s=this.options.dictionary,a,r,o;if(this.ended)return!1;for(n===~~n?r=n:r=n===!0?ar:sr,kn.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),a=Y.inflate(e,r),a===At&&s&&(a=Y.inflateSetDictionary(e,s),a===$e?a=Y.inflate(e,r):a===Ui&&(a=At));e.avail_in>0&&a===It&&e.state.wrap>0&&t[e.next_in]!==0;)Y.inflateReset(e),a=Y.inflate(e,r);switch(a){case rr:case Ui:case At:case or:return this.onEnd(a),this.ended=!0,!1}if(o=e.avail_out,e.next_out&&(e.avail_out===0||a===It))if(this.options.to==="string"){let d=Me.utf8border(e.output,e.next_out),l=e.next_out-d,c=Me.buf2string(e.output,d);e.next_out=l,e.avail_out=i-l,l&&e.output.set(e.output.subarray(d,d+l),0),this.onData(c)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(a===$e&&o===0)){if(a===It)return a=Y.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Ue.prototype.onData=function(t){this.chunks.push(t)};Ue.prototype.onEnd=function(t){t===$e&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=at.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Gt(t,n){let e=new Ue(n);if(e.push(t),e.err)throw e.msg||ae[e.err];return e.result}function lr(t,n){return n=n||{},n.raw=!0,Gt(t,n)}var cr=Ue,hr=Gt,fr=lr,dr=Gt,ur=we,gr={Inflate:cr,inflate:hr,inflateRaw:fr,ungzip:dr,constants:ur},{Deflate:Nr,deflate:Or,deflateRaw:Rr,gzip:pr}=Ea,{Inflate:Mr,inflate:$r,inflateRaw:Pr,ungzip:_r}=gr;var Cn=pr;var Xt=_r;var wr={versionFolder:".versions",autoSave:!0,autoSaveInterval:5,autoClear:!0,maxVersions:50,enableMaxVersions:!0,maxDays:30,enableMaxDays:!1,useRelativeTime:!1,diffGranularity:"char",diffViewMode:"unified",enableDeduplication:!0,showNotifications:!0,excludedFolders:[],enableCompression:!0,enableIncrementalStorage:!0,versionsPerPage:20,rebuildBaseInterval:10,autoSaveOnModify:!0,autoSaveDelay:3,autoSaveMinChanges:10,autoSaveOnInterval:!1,autoSaveOnFileSwitch:!0,autoSaveOnFocusLost:!1,enableQuickPreview:!0,enableVersionTags:!0,defaultTags:["\u91CD\u8981","\u91CC\u7A0B\u7891","\u53D1\u5E03","\u5907\u4EFD","\u8349\u7A3F"],showVersionStats:!0},ot=class extends _.Plugin{constructor(){super(...arguments);this.autoSaveTimer=null;this.lastSavedContent=new Map;this.lastModifiedTime=new Map;this.pendingSaves=new Map;this.versionCache=new Map;this.previousActiveFile=null}async onload(){await this.loadSettings(),this.statusBarItem=this.addStatusBarItem(),this.updateStatusBar(),this.registerView("version-history",e=>new ct(e,this)),this.addRibbonIcon("history","\u7248\u672C\u5386\u53F2",()=>{this.activateVersionHistoryView()}),this.addCommand({id:"create-version",name:"\u521B\u5EFA\u7248\u672C\u5FEB\u7167",hotkeys:[{modifiers:["Ctrl","Shift"],key:"s"}],callback:()=>this.createManualVersion()}),this.addCommand({id:"show-version-history",name:"\u663E\u793A\u7248\u672C\u5386\u53F2",hotkeys:[{modifiers:["Ctrl","Shift"],key:"h"}],callback:()=>this.activateVersionHistoryView()}),this.addCommand({id:"create-full-snapshot",name:"\u521B\u5EFA\u5168\u5E93\u7248\u672C",callback:()=>this.createFullSnapshot()}),this.addCommand({id:"compare-with-version",name:"\u4E0E\u5386\u53F2\u7248\u672C\u5BF9\u6BD4",hotkeys:[{modifiers:["Ctrl","Shift"],key:"d"}],callback:()=>this.quickCompare()}),this.addCommand({id:"restore-last-version",name:"\u6062\u590D\u5230\u4E0A\u4E00\u7248\u672C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"z"}],callback:()=>this.restoreLastVersion()}),this.addCommand({id:"optimize-storage",name:"\u4F18\u5316\u5B58\u50A8\u7A7A\u95F4",callback:()=>this.optimizeAllVersionFiles()}),this.addCommand({id:"quick-preview-version",name:"\u5FEB\u901F\u9884\u89C8\u4E0A\u4E00\u7248\u672C",hotkeys:[{modifiers:["Ctrl","Shift"],key:"p"}],callback:()=>this.quickPreviewLastVersion()}),this.addCommand({id:"star-current-version",name:"\u6807\u8BB0\u5F53\u524D\u7248\u672C\u4E3A\u91CD\u8981",callback:()=>this.starLastVersion()}),this.addSettingTab(new qt(this.app,this)),this.registerEvent(this.app.vault.on("modify",e=>{e instanceof _.TFile&&this.settings.autoSave&&this.settings.autoSaveOnModify&&this.scheduleAutoSave(e)})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.settings.autoSave&&this.settings.autoSaveOnFileSwitch&&this.handleFileSwitch()})),this.settings.autoSaveOnFocusLost&&this.registerDomEvent(window,"blur",()=>{this.settings.autoSave&&this.saveCurrentFileOnFocusLost()}),this.settings.autoSave&&this.settings.autoSaveOnInterval&&this.startAutoSave(),await this.ensureVersionFolder(),this.settings.showNotifications&&new _.Notice("\u2705 \u7248\u672C\u63A7\u5236\u63D2\u4EF6\u5DF2\u542F\u52A8")}onunload(){this.autoSaveTimer&&clearInterval(this.autoSaveTimer),this.pendingSaves.forEach(e=>clearTimeout(e)),this.pendingSaves.clear(),this.versionCache.clear()}async loadSettings(){this.settings=Object.assign({},wr,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.updateStatusBar()}updateStatusBar(){if(!this.settings.autoSave){this.statusBarItem.setText("\u23F8 \u7248\u672C\u63A7\u5236: \u5DF2\u6682\u505C");return}let e=[];this.settings.autoSaveOnModify&&e.push("\u4FEE\u6539"),this.settings.autoSaveOnInterval&&e.push(`${this.settings.autoSaveInterval}\u5206\u949F`),this.settings.autoSaveOnFileSwitch&&e.push("\u5207\u6362"),this.settings.autoSaveOnFocusLost&&e.push("\u5931\u7126"),e.length>0?this.statusBarItem.setText(`\u23F1 \u7248\u672C\u63A7\u5236: ${e.join(" | ")}`):this.statusBarItem.setText("\u23F1 \u7248\u672C\u63A7\u5236: \u5DF2\u542F\u7528")}async ensureVersionFolder(){let e=this.app.vault.adapter,i=this.settings.versionFolder;try{await e.exists(i)||await e.mkdir(i)}catch(s){console.error("\u521B\u5EFA\u7248\u672C\u6587\u4EF6\u5939\u5931\u8D25:",s),new _.Notice("\u26A0\uFE0F \u65E0\u6CD5\u521B\u5EFA\u7248\u672C\u6587\u4EF6\u5939,\u8BF7\u68C0\u67E5\u6743\u9650")}}async activateVersionHistoryView(){let{workspace:e}=this.app,i=e.getLeavesOfType("version-history")[0];if(!i){let s=e.getRightLeaf(!1);if(!s){new _.Notice("\u65E0\u6CD5\u6253\u5F00\u7248\u672C\u5386\u53F2\u89C6\u56FE");return}i=s,await i.setViewState({type:"version-history",active:!0})}e.revealLeaf(i)}startAutoSave(){this.autoSaveTimer&&clearInterval(this.autoSaveTimer),this.settings.autoSaveOnInterval&&(this.autoSaveTimer=setInterval(()=>{this.autoSaveCurrentFile()},this.settings.autoSaveInterval*60*1e3))}scheduleAutoSave(e){if(this.isExcluded(e.path))return;let i=this.pendingSaves.get(e.path);i&&clearTimeout(i);let s=setTimeout(()=>{this.autoSaveFile(e),this.pendingSaves.delete(e.path)},this.settings.autoSaveDelay*1e3);this.pendingSaves.set(e.path,s)}async autoSaveFile(e){try{let i=await this.app.vault.read(e),s=this.lastSavedContent.get(e.path);if(s&&this.countChanges(s,i)<this.settings.autoSaveMinChanges)return;i!==s&&(await this.createVersion(e,"[Auto Save]",!1),this.lastSavedContent.set(e.path,i),this.lastModifiedTime.set(e.path,Date.now()),this.updateStatusBarWithLastSave())}catch(i){console.error("\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25:",i)}}countChanges(e,i){let s=0,a=Math.max(e.length,i.length);for(let r=0;r<a;r++)e[r]!==i[r]&&s++;return s}async handleFileSwitch(){let e=this.app.workspace.getActiveFile();if(this.previousActiveFile&&this.previousActiveFile!==e){let i=this.pendingSaves.get(this.previousActiveFile.path);i&&(clearTimeout(i),this.pendingSaves.delete(this.previousActiveFile.path),await this.autoSaveFile(this.previousActiveFile))}this.previousActiveFile=e}async saveCurrentFileOnFocusLost(){let e=this.app.workspace.getActiveFile();if(!e||this.isExcluded(e.path))return;let i=this.pendingSaves.get(e.path);i&&(clearTimeout(i),this.pendingSaves.delete(e.path)),await this.autoSaveFile(e)}updateStatusBarWithLastSave(){let e=this.app.workspace.getActiveFile();if(!e)return;let i=this.lastModifiedTime.get(e.path);if(i){let s=Date.now()-i,a=Math.floor(s/1e3);if(a<60)this.statusBarItem.title=`\u6700\u8FD1\u4FDD\u5B58: ${a}\u79D2\u524D`;else{let r=Math.floor(a/60);this.statusBarItem.title=`\u6700\u8FD1\u4FDD\u5B58: ${r}\u5206\u949F\u524D`}}}async autoSaveCurrentFile(){let e=this.app.workspace.getActiveFile();!e||this.isExcluded(e.path)||await this.autoSaveFile(e)}isExcluded(e){return this.settings.excludedFolders.some(i=>e.startsWith(i))}async createManualVersion(){let e=this.app.workspace.getActiveFile();if(!e){new _.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}new Jt(this.app,this.settings,async(i,s)=>{await this.createVersion(e,i,!0,s),this.settings.showNotifications&&new _.Notice("\u2705 \u7248\u672C\u5DF2\u521B\u5EFA")}).open()}async createVersion(e,i,s=!1,a=[]){try{let r=await this.app.vault.read(e),o=Date.now(),d=`${o}`,l=this.hashContent(r),c=await this.loadVersionFile(e.path);if(this.settings.enableDeduplication&&c.versions.find(f=>f.hash===l)){s&&this.settings.showNotifications&&new _.Notice("\u2139\uFE0F \u5185\u5BB9\u672A\u53D8\u5316,\u8DF3\u8FC7\u521B\u5EFA\u7248\u672C");return}let u;if(this.settings.enableIncrementalStorage&&c.versions.length>0)if(c.versions.length%this.settings.rebuildBaseInterval===0)u={id:d,timestamp:o,message:i,content:r,size:r.length,hash:l,tags:a.length>0?a:void 0,starred:!1},c.baseVersion=r;else{let f=c.baseVersion||c.versions[0].content||"",p=this.createDiff(f,r);u={id:d,timestamp:o,message:i,diff:p,baseVersionId:c.versions[0].id,size:p.length,hash:l,tags:a.length>0?a:void 0,starred:!1}}else u={id:d,timestamp:o,message:i,content:r,size:r.length,hash:l,tags:a.length>0?a:void 0,starred:!1},this.settings.enableIncrementalStorage&&(c.baseVersion=r);c.versions.unshift(u),c.lastModified=o,this.settings.autoClear&&this.cleanupVersionsInMemory(c),this.buildVersionIndex(c),await this.saveVersionFile(e.path,c),this.versionCache.set(e.path,c),this.refreshVersionHistoryView(),s&&this.settings.showNotifications&&new _.Notice(`\u2705 \u7248\u672C\u5DF2\u521B\u5EFA: ${i}`)}catch(r){console.error("\u521B\u5EFA\u7248\u672C\u5931\u8D25:",r),new _.Notice("\u274C \u521B\u5EFA\u7248\u672C\u5931\u8D25,\u8BF7\u67E5\u770B\u63A7\u5236\u53F0")}}createDiff(e,i){let s=ke(e,i);return JSON.stringify(s)}applyDiff(e,i){try{let s=JSON.parse(i),a="";for(let r of s)r.removed||(a+=r.value);return a}catch(s){return console.error("\u5E94\u7528\u5DEE\u5F02\u5931\u8D25:",s),e}}buildVersionIndex(e){let i=new Map;e.versions.forEach((s,a)=>{i.set(s.id,a)}),e.versionIndex=i}hashContent(e){let i=0;for(let s=0;s<e.length;s++){let a=e.charCodeAt(s);i=(i<<5)-i+a,i=i&i}return i.toString(36)}cleanupVersionsInMemory(e){let i=e.versions;if(this.settings.enableMaxVersions&&(i=i.slice(0,this.settings.maxVersions)),this.settings.enableMaxDays){let a=Date.now()-this.settings.maxDays*24*60*60*1e3;i=i.filter(r=>r.timestamp>=a)}let s=e.versions.length-i.length;return e.versions=i,s}async loadVersionFile(e){if(this.versionCache.has(e))return this.versionCache.get(e);let i=this.getVersionFilePath(e),s=this.app.vault.adapter;try{if(await s.exists(i)){let r=await s.readBinary(i),o;if(this.settings.enableCompression)try{o=Xt(new Uint8Array(r),{to:"string"})}catch(l){o=await s.read(i)}else o=await s.read(i);let d=JSON.parse(o);return d.versionIndex||this.buildVersionIndex(d),this.versionCache.set(e,d),d}}catch(r){console.error("\u52A0\u8F7D\u7248\u672C\u6587\u4EF6\u5931\u8D25:",r)}let a={filePath:e,versions:[],lastModified:Date.now()};return this.versionCache.set(e,a),a}async saveVersionFile(e,i){let s=this.getVersionFilePath(e),a=this.app.vault.adapter;try{let r={...i,versionIndex:void 0},o=JSON.stringify(r,null,2);if(this.settings.enableCompression){let d=Cn(o);await a.writeBinary(s,d.buffer)}else await a.write(s,o)}catch(r){throw console.error("\u4FDD\u5B58\u7248\u672C\u6587\u4EF6\u5931\u8D25:",r),r}}getVersionFilePath(e){let i=this.sanitizeFileName(e);return`${this.settings.versionFolder}/${i}.json`}async getVersions(e,i=0){try{let s=await this.loadVersionFile(e);if(this.settings.versionsPerPage>0){let a=i*this.settings.versionsPerPage,r=a+this.settings.versionsPerPage;return s.versions.slice(a,r)}return s.versions}catch(s){return console.error("\u83B7\u53D6\u7248\u672C\u5217\u8868\u5931\u8D25:",s),[]}}async getAllVersions(e){try{return(await this.loadVersionFile(e)).versions}catch(i){return console.error("\u83B7\u53D6\u7248\u672C\u5217\u8868\u5931\u8D25:",i),[]}}async getVersionContent(e,i){var s;try{let a=await this.loadVersionFile(e),r=(s=a.versionIndex)==null?void 0:s.get(i),o=r!==void 0?a.versions[r]:a.versions.find(d=>d.id===i);if(!o)throw new Error("\u7248\u672C\u4E0D\u5B58\u5728");if(o.content)return o.content;if(o.diff&&a.baseVersion)return this.applyDiff(a.baseVersion,o.diff);throw new Error("\u65E0\u6CD5\u83B7\u53D6\u7248\u672C\u5185\u5BB9")}catch(a){throw console.error("\u8BFB\u53D6\u7248\u672C\u5185\u5BB9\u5931\u8D25:",a),new Error("\u65E0\u6CD5\u8BFB\u53D6\u7248\u672C\u5185\u5BB9")}}async updateVersionTags(e,i,s){var a;try{let r=await this.loadVersionFile(e),o=(a=r.versionIndex)==null?void 0:a.get(i);o!==void 0&&(r.versions[o].tags=s,await this.saveVersionFile(e,r),this.versionCache.set(e,r),this.refreshVersionHistoryView())}catch(r){console.error("\u66F4\u65B0\u7248\u672C\u6807\u7B7E\u5931\u8D25:",r)}}async updateVersionNote(e,i,s){var a;try{let r=await this.loadVersionFile(e),o=(a=r.versionIndex)==null?void 0:a.get(i);o!==void 0&&(r.versions[o].note=s,await this.saveVersionFile(e,r),this.versionCache.set(e,r),this.refreshVersionHistoryView())}catch(r){console.error("\u66F4\u65B0\u7248\u672C\u5907\u6CE8\u5931\u8D25:",r)}}async toggleVersionStar(e,i){var s;try{let a=await this.loadVersionFile(e),r=(s=a.versionIndex)==null?void 0:s.get(i);r!==void 0&&(a.versions[r].starred=!a.versions[r].starred,await this.saveVersionFile(e,a),this.versionCache.set(e,a),this.refreshVersionHistoryView())}catch(a){console.error("\u5207\u6362\u661F\u6807\u5931\u8D25:",a)}}async starLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new _.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new _.Notice("\u6CA1\u6709\u53EF\u6807\u8BB0\u7684\u7248\u672C");return}await this.toggleVersionStar(e.path,i[0].id),new _.Notice("\u2B50 \u5DF2\u6807\u8BB0/\u53D6\u6D88\u6807\u8BB0")}async quickPreviewLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new _.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new _.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u9884\u89C8");return}new lt(this.app,this,e,i[0].id).open()}async deleteVersion(e,i){try{let s=await this.loadVersionFile(e);s.versions=s.versions.filter(a=>a.id!==i),s.lastModified=Date.now(),this.buildVersionIndex(s),await this.saveVersionFile(e,s),this.versionCache.set(e,s)}catch(s){console.error("\u5220\u9664\u7248\u672C\u5931\u8D25:",s)}}async deleteVersions(e,i){try{let s=await this.loadVersionFile(e),a=new Set(i);s.versions=s.versions.filter(r=>!a.has(r.id)),s.lastModified=Date.now(),this.buildVersionIndex(s),await this.saveVersionFile(e,s),this.versionCache.set(e,s)}catch(s){console.error("\u6279\u91CF\u5220\u9664\u7248\u672C\u5931\u8D25:",s)}}async restoreVersion(e,i){try{await this.createVersion(e,"[Before Restore]",!1);let s=await this.getVersionContent(e.path,i);await this.app.vault.modify(e,s),this.settings.showNotifications&&new _.Notice("\u2705 \u7248\u672C\u5DF2\u6062\u590D"),this.refreshVersionHistoryView()}catch(s){console.error("\u6062\u590D\u7248\u672C\u5931\u8D25:",s),new _.Notice("\u274C \u6062\u590D\u7248\u672C\u5931\u8D25")}}async restoreLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new _.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new _.Notice("\u6CA1\u6709\u53EF\u6062\u590D\u7684\u7248\u672C");return}let s=i[0];new ce(this.app,"\u6062\u590D\u5230\u4E0A\u4E00\u7248\u672C",`\u786E\u5B9A\u8981\u6062\u590D\u5230\u7248\u672C: ${this.formatTime(s.timestamp)}?

\u5F53\u524D\u672A\u4FDD\u5B58\u7684\u4FEE\u6539\u5C06\u4F1A\u4E22\u5931,\u63D2\u4EF6\u4F1A\u5728\u6062\u590D\u524D\u81EA\u52A8\u521B\u5EFA\u5907\u4EFD\u7248\u672C\u3002`,async()=>{await this.restoreVersion(e,s.id)}).open()}async quickCompare(){let e=this.app.workspace.getActiveFile();if(!e){new _.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new _.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u5BF9\u6BD4");return}let s=i[0];new be(this.app,this,e,s.id).open()}async createFullSnapshot(){let e=this.app.vault.getMarkdownFiles(),i=0,s=0,a=new _.Notice("\u6B63\u5728\u521B\u5EFA\u5168\u5E93\u7248\u672C...",0);for(let r of e){if(this.isExcluded(r.path)){s++;continue}try{await this.createVersion(r,"[Full Snapshot]",!1),i++}catch(o){console.error(`\u521B\u5EFA\u7248\u672C\u5931\u8D25: ${r.path}`,o)}}a.hide(),this.settings.showNotifications&&new _.Notice(`\u2705 \u5168\u5E93\u7248\u672C\u5DF2\u521B\u5EFA
\u6210\u529F: ${i} \u4E2A\u6587\u4EF6${s>0?`
\u8DF3\u8FC7: ${s} \u4E2A\u6587\u4EF6`:""}`)}async optimizeAllVersionFiles(){var i,s;let e=new _.Notice("\u6B63\u5728\u4F18\u5316\u5B58\u50A8...",0);try{let a=this.app.vault.adapter,r=this.settings.versionFolder;if(!await a.exists(r)){e.hide(),new _.Notice("\u7248\u672C\u6587\u4EF6\u5939\u4E0D\u5B58\u5728");return}let o=await a.list(r),d=0,l=0;for(let c of o.files)if(c.endsWith(".json"))try{let u=((i=await a.stat(c))==null?void 0:i.size)||0,h=await a.read(c),f=JSON.parse(h);this.buildVersionIndex(f),await this.saveVersionFile(f.filePath,f);let p=((s=await a.stat(c))==null?void 0:s.size)||0;l+=u-p,d++}catch(u){console.error("\u4F18\u5316\u6587\u4EF6\u5931\u8D25:",c,u)}e.hide(),new _.Notice(`\u2705 \u4F18\u5316\u5B8C\u6210
\u5904\u7406: ${d} \u4E2A\u6587\u4EF6
\u8282\u7701: ${this.formatFileSize(l)}`)}catch(a){e.hide(),console.error("\u4F18\u5316\u5931\u8D25:",a),new _.Notice("\u274C \u4F18\u5316\u5931\u8D25")}}async getStorageStats(){let e=this.app.vault.adapter,i=this.settings.versionFolder;try{if(!await e.exists(i))return{totalSize:0,versionCount:0,fileCount:0,compressionRatio:0,starredCount:0,taggedCount:0};let s=await e.list(i),a=0,r=0,o=0,d=0,l=0,c=0;for(let h of s.files)if(h.endsWith(".json"))try{let f=await e.stat(h),p=(f==null?void 0:f.size)||0;a+=p;let E;if(this.settings.enableCompression)try{let v=await e.readBinary(h),w=Xt(new Uint8Array(v),{to:"string"});E=JSON.parse(w)}catch(v){let w=await e.read(h);E=JSON.parse(w)}else{let v=await e.read(h);E=JSON.parse(v)}E.versions&&Array.isArray(E.versions)&&(r+=E.versions.length,E.versions.forEach(v=>{v.content?d+=v.content.length:v.diff&&(d+=v.diff.length),v.starred&&l++,v.tags&&v.tags.length>0&&c++}),o++)}catch(f){console.error("\u8BFB\u53D6\u7248\u672C\u6587\u4EF6\u5931\u8D25:",h,f)}let u=d>0?(1-a/d)*100:0;return{totalSize:a,versionCount:r,fileCount:o,compressionRatio:u,starredCount:l,taggedCount:c}}catch(s){return console.error("\u83B7\u53D6\u5B58\u50A8\u7EDF\u8BA1\u5931\u8D25:",s),{totalSize:0,versionCount:0,fileCount:0,compressionRatio:0,starredCount:0,taggedCount:0}}}async exportVersions(e){try{let i=await this.loadVersionFile(e),s=`${this.settings.versionFolder}/export_${Date.now()}.json`;await this.app.vault.adapter.write(s,JSON.stringify(i,null,2)),new _.Notice(`\u2705 \u7248\u672C\u5DF2\u5BFC\u51FA\u5230: ${s}`)}catch(i){console.error("\u5BFC\u51FA\u7248\u672C\u5931\u8D25:",i),new _.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}async exportVersionAsFile(e,i){try{let s=await this.getVersionContent(e,i),r=`${e.replace(/\.[^/.]+$/,"")}_v${i}.md`;await this.app.vault.create(r,s),new _.Notice(`\u2705 \u7248\u672C\u5DF2\u5BFC\u51FA\u4E3A: ${r}`)}catch(s){console.error("\u5BFC\u51FA\u7248\u672C\u4E3A\u6587\u4EF6\u5931\u8D25:",s),new _.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}sanitizeFileName(e){return e.replace(/[\/\\:*?"<>|]/g,"_")}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`}formatTime(e){return this.settings.useRelativeTime?this.getRelativeTime(e):new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}getRelativeTime(e){let i=Date.now()-e,s=Math.floor(i/1e3),a=Math.floor(s/60),r=Math.floor(a/60),o=Math.floor(r/24),d=Math.floor(o/30),l=Math.floor(o/365);return l>0?`${l} \u5E74\u524D`:d>0?`${d} \u4E2A\u6708\u524D`:o>0?`${o} \u5929\u524D`:r>0?`${r} \u5C0F\u65F6\u524D`:a>0?`${a} \u5206\u949F\u524D`:`${s} \u79D2\u524D`}refreshVersionHistoryView(){this.app.workspace.getLeavesOfType("version-history").forEach(i=>{i.view instanceof ct&&i.view.refresh()})}},lt=class extends _.Modal{constructor(e,i,s,a){super(e);this.plugin=i,this.file=s,this.versionId=a}async onOpen(){let{contentEl:e}=this;e.addClass("quick-preview-modal");try{let i=await this.plugin.getVersionContent(this.file.path,this.versionId),a=(await this.plugin.getAllVersions(this.file.path)).find(f=>f.id===this.versionId),r=e.createEl("div",{cls:"preview-header"});if(r.createEl("h2",{text:"\u5FEB\u901F\u9884\u89C8"}),a){let f=r.createEl("div",{cls:"preview-info"});f.createEl("span",{text:this.plugin.formatTime(a.timestamp)}),f.createEl("span",{text:a.message})}let o=e.createEl("div",{cls:"preview-toolbar"});o.createEl("button",{text:"\u6062\u590D\u6B64\u7248\u672C",cls:"mod-cta"}).addEventListener("click",async()=>{this.close(),await this.plugin.restoreVersion(this.file,this.versionId)}),o.createEl("button",{text:"\u8BE6\u7EC6\u5BF9\u6BD4"}).addEventListener("click",()=>{this.close(),new be(this.app,this.plugin,this.file,this.versionId).open()}),o.createEl("button",{text:"\u5BFC\u51FA\u4E3A\u6587\u4EF6"}).addEventListener("click",async()=>{await this.plugin.exportVersionAsFile(this.file.path,this.versionId)}),e.createEl("div",{cls:"preview-content"}).createEl("pre").createEl("code",{text:i})}catch(i){e.createEl("p",{text:"\u52A0\u8F7D\u9884\u89C8\u5931\u8D25"})}}onClose(){let{contentEl:e}=this;e.empty()}},ct=class extends _.ItemView{constructor(e,i){super(e);this.selectedVersions=new Set;this.currentFile=null;this.searchQuery="";this.currentPage=0;this.totalVersions=0;this.filterTag=null;this.showStarredOnly=!1;this.plugin=i}getViewType(){return"version-history"}getDisplayText(){return"\u7248\u672C\u5386\u53F2"}getIcon(){return"history"}async onOpen(){this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.currentPage=0,this.refresh()})),await this.refresh()}async refresh(){let e=this.containerEl.children[1];e.empty(),e.addClass("version-history-view");let i=this.app.workspace.getActiveFile();if(this.currentFile=i,!i){this.renderEmptyState(e,"\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6");return}let s=e.createEl("div",{cls:"version-header"}),a=s.createEl("div",{cls:"version-title"});a.createEl("h3",{text:i.basename}),a.createEl("span",{text:i.path,cls:"version-file-path"});let r=s.createEl("div",{cls:"version-header-actions"}),o=r.createEl("input",{type:"text",placeholder:"\u641C\u7D22\u7248\u672C...",cls:"version-search"});o.value=this.searchQuery,o.addEventListener("input",g=>{this.searchQuery=g.target.value,this.currentPage=0,this.refresh()}),r.createEl("button",{text:this.showStarredOnly?"\u2B50 \u5DF2\u7B5B\u9009":"\u2B50 \u661F\u6807",cls:this.showStarredOnly?"mod-cta":""}).addEventListener("click",()=>{this.showStarredOnly=!this.showStarredOnly,this.currentPage=0,this.refresh()}),r.createEl("button",{text:"\u521B\u5EFA\u7248\u672C",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),r.createEl("button",{text:"..."}).addEventListener("click",g=>{let y=new _.Menu;y.addItem(V=>V.setTitle("\u5BFC\u51FA\u7248\u672C\u6570\u636E").setIcon("download").onClick(()=>{this.plugin.exportVersions(i.path)})),y.addItem(V=>V.setTitle("\u67E5\u770B\u7EDF\u8BA1\u4FE1\u606F").setIcon("bar-chart").onClick(()=>{this.showStats()})),y.showAtMouseEvent(g)});let u=await this.plugin.getAllVersions(i.path);if(this.totalVersions=u.length,this.totalVersions===0){this.renderEmptyState(e,"\u6682\u65E0\u7248\u672C\u5386\u53F2");return}let h=u;if(this.showStarredOnly&&(h=h.filter(g=>g.starred)),this.filterTag&&(h=h.filter(g=>g.tags&&g.tags.includes(this.filterTag))),this.searchQuery&&(h=h.filter(g=>g.message.toLowerCase().includes(this.searchQuery.toLowerCase())||this.plugin.formatTime(g.timestamp).toLowerCase().includes(this.searchQuery.toLowerCase())||g.tags&&g.tags.some(y=>y.toLowerCase().includes(this.searchQuery.toLowerCase())))),h.length===0){this.renderEmptyState(e,"\u672A\u627E\u5230\u5339\u914D\u7684\u7248\u672C");return}let f=this.plugin.settings.versionsPerPage,p=Math.ceil(h.length/f),E=this.currentPage*f,v=Math.min(E+f,h.length),w=h.slice(E,v);if(this.selectedVersions.size>0){let g=e.createEl("div",{cls:"version-toolbar"});g.createEl("span",{text:`\u5DF2\u9009\u62E9 ${this.selectedVersions.size} \u4E2A\u7248\u672C`}),g.createEl("button",{text:"\u6E05\u7A7A\u9009\u62E9"}).addEventListener("click",()=>{this.selectedVersions.clear(),this.refresh()}),g.createEl("button",{text:"\u6279\u91CF\u5220\u9664",cls:"mod-warning"}).addEventListener("click",()=>this.batchDelete(i))}let m=e.createEl("div",{cls:"version-list"});for(let g of w){let y=m.createEl("div",{cls:"version-item"});g.starred&&y.addClass("version-starred");let V=y.createEl("input",{type:"checkbox",cls:"version-checkbox"});V.checked=this.selectedVersions.has(g.id),V.addEventListener("change",()=>{V.checked?this.selectedVersions.add(g.id):this.selectedVersions.delete(g.id),this.refresh()});let x=m.createEl("div",{cls:"version-info"}),D=x.createEl("div",{cls:"version-time-row"});D.createEl("span",{text:g.starred?"\u2B50":"\u2606",cls:"version-star-btn"}).addEventListener("click",async()=>{await this.plugin.toggleVersionStar(i.path,g.id)}),D.createEl("span",{text:this.plugin.formatTime(g.timestamp),cls:"version-time"});let S=x.createEl("div",{cls:"version-message-row"});g.message.includes("[Auto Save]")?S.createEl("span",{text:"\u81EA\u52A8\u4FDD\u5B58",cls:"version-tag version-tag-auto"}):g.message.includes("[Full Snapshot]")?S.createEl("span",{text:"\u5168\u5E93\u7248\u672C",cls:"version-tag version-tag-snapshot"}):g.message.includes("[Before Restore]")&&S.createEl("span",{text:"\u6062\u590D\u524D\u5907\u4EFD",cls:"version-tag version-tag-backup"}),g.diff?S.createEl("span",{text:"\u589E\u91CF",cls:"version-tag version-tag-incremental"}):g.content&&S.createEl("span",{text:"\u5B8C\u6574",cls:"version-tag version-tag-full"}),g.tags&&g.tags.length>0&&g.tags.forEach(O=>{S.createEl("span",{text:O,cls:"version-tag version-tag-custom"}).addEventListener("click",()=>{this.filterTag=O,this.currentPage=0,this.refresh()})}),S.createEl("span",{text:g.message.replace(/\[.*?\]/g,"").trim()||"\u65E0\u63CF\u8FF0",cls:"version-message"}),g.note&&x.createEl("div",{text:`\u{1F4DD} ${g.note}`,cls:"version-note"}),x.createEl("div",{text:this.plugin.formatFileSize(g.size),cls:"version-size"});let k=y.createEl("div",{cls:"version-actions"});this.plugin.settings.enableQuickPreview&&k.createEl("button",{text:"\u{1F441}",cls:"version-btn",attr:{title:"\u5FEB\u901F\u9884\u89C8"}}).addEventListener("click",()=>{new lt(this.app,this.plugin,i,g.id).open()}),k.createEl("button",{text:"\u6062\u590D",cls:"version-btn"}).addEventListener("click",()=>{this.confirmRestore(i,g.id)});let Ee=k.createEl("button",{text:"\u6BD4\u8F83",cls:"version-btn"});Ee.addEventListener("click",()=>{this.showDiffModal(i,g.id)}),Ee.addEventListener("contextmenu",O=>{O.preventDefault(),this.showVersionContextMenu(O,i,g)}),k.createEl("button",{text:"\u22EE",cls:"version-btn"}).addEventListener("click",O=>{this.showVersionContextMenu(O,i,g)})}if(p>1){let g=e.createEl("div",{cls:"version-pagination"}),y=g.createEl("button",{text:"\u2190 \u4E0A\u4E00\u9875",cls:"version-pagination-btn"});y.disabled=this.currentPage===0,y.addEventListener("click",()=>{this.currentPage>0&&(this.currentPage--,this.refresh())});let V=g.createEl("span",{text:`\u7B2C ${this.currentPage+1} / ${p} \u9875`,cls:"version-pagination-info"}),x=g.createEl("button",{text:"\u4E0B\u4E00\u9875 \u2192",cls:"version-pagination-btn"});x.disabled=this.currentPage>=p-1,x.addEventListener("click",()=>{this.currentPage<p-1&&(this.currentPage++,this.refresh())})}let b=e.createEl("div",{cls:"version-footer"});b.createEl("span",{text:`\u5171 ${this.totalVersions} \u4E2A\u7248\u672C`}),(this.searchQuery||this.showStarredOnly||this.filterTag)&&b.createEl("span",{text:` \xB7 \u663E\u793A ${h.length} \u4E2A\u7ED3\u679C`}),b.createEl("span",{text:` \xB7 \u663E\u793A ${E+1}-${v}`})}showVersionContextMenu(e,i,s){let a=new _.Menu;a.addItem(r=>r.setTitle("\u4E0E\u5F53\u524D\u6587\u4EF6\u5BF9\u6BD4").setIcon("file-diff").onClick(()=>{this.showDiffModal(i,s.id)})),a.addItem(r=>r.setTitle("\u9009\u62E9\u53E6\u4E00\u4E2A\u7248\u672C\u5BF9\u6BD4").setIcon("files").onClick(()=>{this.selectVersionForCompare(i,s.id)})),a.addSeparator(),a.addItem(r=>r.setTitle(s.starred?"\u53D6\u6D88\u661F\u6807":"\u6DFB\u52A0\u661F\u6807").setIcon("star").onClick(async()=>{await this.plugin.toggleVersionStar(i.path,s.id)})),this.plugin.settings.enableVersionTags&&a.addItem(r=>r.setTitle("\u7F16\u8F91\u6807\u7B7E").setIcon("tag").onClick(()=>{new Yt(this.app,this.plugin,i.path,s.id,s.tags||[]).open()})),a.addItem(r=>r.setTitle("\u6DFB\u52A0/\u7F16\u8F91\u5907\u6CE8").setIcon("edit").onClick(()=>{new Qt(this.app,this.plugin,i.path,s.id,s.note||"").open()})),a.addSeparator(),a.addItem(r=>r.setTitle("\u5BFC\u51FA\u4E3A\u6587\u4EF6").setIcon("download").onClick(async()=>{await this.plugin.exportVersionAsFile(i.path,s.id)})),a.addItem(r=>r.setTitle("\u5220\u9664\u7248\u672C").setIcon("trash").onClick(async()=>{new ce(this.app,"\u786E\u8BA4\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u6B64\u7248\u672C\u5417?

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500!`,async()=>{await this.plugin.deleteVersion(i.path,s.id),this.plugin.settings.showNotifications&&new _.Notice("\u2705 \u7248\u672C\u5DF2\u5220\u9664"),this.refresh()}).open()})),a.showAtMouseEvent(e)}async showStats(){let e=this.currentFile;if(!e)return;let i=await this.plugin.getAllVersions(e.path),s=i.filter(o=>o.starred).length,a=i.filter(o=>o.tags&&o.tags.length>0).length,r=i.reduce((o,d)=>o+d.size,0);new _.Notice(`\u{1F4CA} \u7EDF\u8BA1\u4FE1\u606F
\u603B\u7248\u672C\u6570: ${i.length}
\u661F\u6807\u7248\u672C: ${s}
\u5DF2\u6807\u7B7E\u7248\u672C: ${a}
\u603B\u5927\u5C0F: ${this.plugin.formatFileSize(r)}`,5e3)}renderEmptyState(e,i){let s=e.createEl("div",{cls:"version-history-empty"});s.createEl("div",{text:"\u{1F4CB}",cls:"version-empty-icon"}),s.createEl("div",{text:i}),this.currentFile&&i==="\u6682\u65E0\u7248\u672C\u5386\u53F2"&&s.createEl("button",{text:"\u521B\u5EFA\u7B2C\u4E00\u4E2A\u7248\u672C",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),(this.filterTag||this.showStarredOnly)&&s.createEl("button",{text:"\u6E05\u9664\u7B5B\u9009",cls:"mod-cta"}).addEventListener("click",()=>{this.filterTag=null,this.showStarredOnly=!1,this.currentPage=0,this.refresh()})}confirmRestore(e,i){new ce(this.app,"\u786E\u8BA4\u6062\u590D\u7248\u672C",`\u5F53\u524D\u672A\u4FDD\u5B58\u7684\u4FEE\u6539\u5C06\u4F1A\u4E22\u5931,\u63D2\u4EF6\u4F1A\u5728\u6062\u590D\u524D\u81EA\u52A8\u521B\u5EFA\u5907\u4EFD\u7248\u672C\u3002

\u662F\u5426\u7EE7\u7EED?`,async()=>{await this.plugin.restoreVersion(e,i)}).open()}async batchDelete(e){new ce(this.app,"\u786E\u8BA4\u6279\u91CF\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684 ${this.selectedVersions.size} \u4E2A\u7248\u672C\u5417?

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500!`,async()=>{let i=Array.from(this.selectedVersions);await this.plugin.deleteVersions(e.path,i),this.selectedVersions.clear(),this.plugin.settings.showNotifications&&new _.Notice("\u2705 \u5DF2\u5220\u9664\u9009\u4E2D\u7248\u672C"),this.refresh()}).open()}showDiffModal(e,i){new be(this.app,this.plugin,e,i).open()}selectVersionForCompare(e,i){new Kt(this.app,this.plugin,e,i,s=>{new be(this.app,this.plugin,e,i,s).open()}).open()}},Yt=class extends _.Modal{constructor(e,i,s,a,r){super(e);this.selectedTags=new Set;this.plugin=i,this.filePath=s,this.versionId=a,this.currentTags=r,this.selectedTags=new Set(r)}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"\u7F16\u8F91\u7248\u672C\u6807\u7B7E"});let i=e.createEl("div",{cls:"tag-edit-container"}),s=i.createEl("div",{cls:"tag-section"});s.createEl("h3",{text:"\u5E38\u7528\u6807\u7B7E"});let a=s.createEl("div",{cls:"tag-list"});this.plugin.settings.defaultTags.forEach(p=>{let E=a.createEl("span",{text:p,cls:this.selectedTags.has(p)?"tag-item tag-selected":"tag-item"});E.addEventListener("click",()=>{this.selectedTags.has(p)?(this.selectedTags.delete(p),E.removeClass("tag-selected")):(this.selectedTags.add(p),E.addClass("tag-selected"))})});let r=i.createEl("div",{cls:"tag-section"});r.createEl("h3",{text:"\u81EA\u5B9A\u4E49\u6807\u7B7E"});let o=r.createEl("input",{type:"text",placeholder:"\u8F93\u5165\u65B0\u6807\u7B7E..."});o.style.width="100%";let d=r.createEl("button",{text:"\u6DFB\u52A0",cls:"mod-cta"});d.addEventListener("click",()=>{let p=o.value.trim();p&&!this.selectedTags.has(p)&&(this.selectedTags.add(p),this.renderSelectedTags(c),o.value="")}),o.addEventListener("keydown",p=>{p.key==="Enter"&&d.click()});let l=i.createEl("div",{cls:"tag-section"});l.createEl("h3",{text:"\u5DF2\u9009\u6807\u7B7E"});let c=l.createEl("div",{cls:"tag-list"});this.renderSelectedTags(c);let u=e.createEl("div",{cls:"modal-button-container"});u.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),u.createEl("button",{text:"\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",async()=>{await this.plugin.updateVersionTags(this.filePath,this.versionId,Array.from(this.selectedTags)),new _.Notice("\u2705 \u6807\u7B7E\u5DF2\u66F4\u65B0"),this.close()})}renderSelectedTags(e){e.empty(),this.selectedTags.forEach(i=>{e.createEl("span",{text:i,cls:"tag-item tag-removable"}).createEl("span",{text:"\xD7",cls:"tag-remove"}).addEventListener("click",()=>{this.selectedTags.delete(i),this.renderSelectedTags(e)})})}onClose(){let{contentEl:e}=this;e.empty()}},Qt=class extends _.Modal{constructor(e,i,s,a,r){super(e);this.plugin=i,this.filePath=s,this.versionId=a,this.currentNote=r}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"\u7F16\u8F91\u7248\u672C\u5907\u6CE8"});let i=e.createEl("textarea",{placeholder:"\u4E3A\u6B64\u7248\u672C\u6DFB\u52A0\u8BE6\u7EC6\u5907\u6CE8..."});i.value=this.currentNote,i.style.width="100%",i.style.minHeight="150px";let s=e.createEl("div",{cls:"modal-button-container"});s.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),s.createEl("button",{text:"\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",async()=>{await this.plugin.updateVersionNote(this.filePath,this.versionId,i.value.trim()),new _.Notice("\u2705 \u5907\u6CE8\u5DF2\u66F4\u65B0"),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}},Jt=class extends _.Modal{constructor(e,i,s){super(e);this.result="";this.tags=[];this.settings=i,this.onSubmit=s}onOpen(){let{contentEl:e}=this;if(e.createEl("h2",{text:"\u521B\u5EFA\u7248\u672C"}),new _.Setting(e).setName("\u63D0\u4EA4\u4FE1\u606F").setDesc("\u63CF\u8FF0\u6B64\u7248\u672C\u7684\u66F4\u6539\u5185\u5BB9").addText(r=>{this.inputEl=r,r.setPlaceholder("\u4F8B\u5982:\u6DFB\u52A0\u65B0\u7AE0\u8282\u3001\u4FEE\u590D\u9519\u8BEF\u7B49...").onChange(o=>{this.result=o}),r.inputEl.style.width="100%",r.inputEl.focus()}),this.settings.enableVersionTags&&this.settings.defaultTags.length>0){let r=e.createEl("div",{cls:"tag-section"});r.createEl("h3",{text:"\u6DFB\u52A0\u6807\u7B7E (\u53EF\u9009)"});let o=r.createEl("div",{cls:"tag-list"});this.settings.defaultTags.forEach(d=>{let l=o.createEl("span",{text:d,cls:"tag-item"});l.addEventListener("click",()=>{l.hasClass("tag-selected")?(l.removeClass("tag-selected"),this.tags=this.tags.filter(c=>c!==d)):(l.addClass("tag-selected"),this.tags.push(d))})})}let i=e.createEl("div",{cls:"modal-button-container"});i.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),i.createEl("button",{text:"\u521B\u5EFA",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.onSubmit(this.result||"[Manual Save]",this.tags)}),this.inputEl.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),this.close(),this.onSubmit(this.result||"[Manual Save]",this.tags))})}onClose(){let{contentEl:e}=this;e.empty()}},ce=class extends _.Modal{constructor(e,i,s,a){super(e);this.title=i,this.message=s,this.onConfirm=a}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:this.title});let i=e.createEl("p",{cls:"confirm-message"});i.style.whiteSpace="pre-line",i.textContent=this.message;let s=e.createEl("div",{cls:"modal-button-container"});s.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),s.createEl("button",{text:"\u786E\u8BA4",cls:"mod-warning"}).addEventListener("click",()=>{this.close(),this.onConfirm()})}onClose(){let{contentEl:e}=this;e.empty()}},be=class extends _.Modal{constructor(e,i,s,a,r){super(e);this.currentDiffIndex=0;this.totalDiffs=0;this.diffElements=[];this.plugin=i,this.file=s,this.versionId=a,this.secondVersionId=r}async onOpen(){let{contentEl:e}=this;e.addClass("diff-modal"),e.createEl("h2",{text:"\u7248\u672C\u5DEE\u5F02\u5BF9\u6BD4"});let i=e.createEl("div",{cls:"diff-toolbar"}),s=i.createEl("button",{text:"\u2B06 \u4E0A\u4E00\u4E2A\u5DEE\u5F02"}),a=i.createEl("button",{text:"\u2B07 \u4E0B\u4E00\u4E2A\u5DEE\u5F02"}),r=i.createEl("span",{cls:"diff-stats"}),o=i.createEl("select");o.createEl("option",{text:"\u5B57\u7B26\u7EA7",value:"char"}),o.createEl("option",{text:"\u5355\u8BCD\u7EA7",value:"word"}),o.createEl("option",{text:"\u884C\u7EA7",value:"line"}),o.value=this.plugin.settings.diffGranularity;let d=i.createEl("select");d.createEl("option",{text:"\u7EDF\u4E00\u89C6\u56FE",value:"unified"}),d.createEl("option",{text:"\u5DE6\u53F3\u5206\u680F",value:"split"}),d.value=this.plugin.settings.diffViewMode,i.createEl("button",{text:"\u{1F4CB} \u590D\u5236\u5DEE\u5F02"}).addEventListener("click",()=>{this.copyDiffToClipboard()});let c,u,h,f;try{if(this.secondVersionId){c=await this.plugin.getVersionContent(this.file.path,this.versionId),u=await this.plugin.getVersionContent(this.file.path,this.secondVersionId);let v=await this.plugin.getAllVersions(this.file.path),w=v.find(b=>b.id===this.versionId),m=v.find(b=>b.id===this.secondVersionId);h=w?`\u7248\u672C A: ${this.plugin.formatTime(w.timestamp)}`:"\u7248\u672C A",f=m?`\u7248\u672C B: ${this.plugin.formatTime(m.timestamp)}`:"\u7248\u672C B"}else{c=await this.plugin.getVersionContent(this.file.path,this.versionId),u=await this.app.vault.read(this.file);let w=(await this.plugin.getAllVersions(this.file.path)).find(m=>m.id===this.versionId);h=w?`\u5386\u53F2\u7248\u672C: ${this.plugin.formatTime(w.timestamp)}`:"\u5386\u53F2\u7248\u672C",f="\u5F53\u524D\u6587\u4EF6"}}catch(v){new _.Notice("\u274C \u52A0\u8F7D\u7248\u672C\u5185\u5BB9\u5931\u8D25"),this.close();return}let p=e.createEl("div",{cls:"diff-container"}),E=()=>{p.empty(),this.diffElements=[],this.currentDiffIndex=0;let v=o.value;d.value==="unified"?this.renderUnifiedDiff(p,c,u,v):this.renderSplitDiff(p,c,u,v,h,f),this.totalDiffs>0?(r.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`),s.disabled=!1,a.disabled=!1):(r.setText("\u65E0\u5DEE\u5F02"),s.disabled=!0,a.disabled=!0)};o.addEventListener("change",()=>{E()}),d.addEventListener("change",()=>{E()}),s.addEventListener("click",()=>{this.currentDiffIndex>0&&(this.currentDiffIndex--,this.scrollToDiff(),r.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`))}),a.addEventListener("click",()=>{this.currentDiffIndex<this.totalDiffs-1&&(this.currentDiffIndex++,this.scrollToDiff(),r.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`))}),E()}renderUnifiedDiff(e,i,s,a){let r;if(a==="char"?r=He(i,s):a==="word"?r=Xe(i,s):r=ke(i,s),this.totalDiffs=r.filter(o=>o.added||o.removed).length,a==="line"){let o=1,d=0;for(let l of r){let c=l.value.split(`
`);c[c.length-1]===""&&c.pop();for(let u of c){let h=e.createEl("div",{cls:"diff-line"});(l.added||l.removed)&&(h.dataset.diffIndex=String(d),this.diffElements.push(h)),l.added?(h.addClass("diff-added"),h.createEl("span",{cls:"line-number",text:String(o)}),h.createEl("span",{text:`+ ${u}`}),o++,d++):l.removed?(h.addClass("diff-removed"),h.createEl("span",{cls:"line-number",text:""}),h.createEl("span",{text:`- ${u}`}),d++):(h.createEl("span",{cls:"line-number",text:String(o)}),h.createEl("span",{text:`  ${u}`}),o++)}}}else{let o=e.createEl("div",{cls:"diff-line-inline-wrapper"});for(let d of r){let l=o.createEl("span");l.textContent=d.value,d.added?(l.addClass("diff-char-added"),this.diffElements.push(l)):d.removed&&(l.addClass("diff-char-removed"),this.diffElements.push(l))}}this.totalDiffs>0&&setTimeout(()=>this.scrollToDiff(),100)}renderSplitDiff(e,i,s,a,r,o){e.addClass("diff-split");let d=e.createEl("div",{cls:"diff-panel"}),l=e.createEl("div",{cls:"diff-panel"});d.createEl("h3",{text:r}),l.createEl("h3",{text:o});let c=d.createEl("div",{cls:"diff-content"}),u=l.createEl("div",{cls:"diff-content"}),h;if(a==="char"?h=He(i,s):a==="word"?h=Xe(i,s):h=ke(i,s),this.totalDiffs=h.filter(p=>p.added||p.removed).length,a==="line"){let p=1,E=1,v=0;for(let w of h){let m=w.value.split(`
`);m[m.length-1]===""&&m.pop();for(let b of m)if(w.removed){let g=c.createEl("div",{cls:"diff-line diff-removed"});g.dataset.diffIndex=String(v),g.createEl("span",{cls:"line-number",text:String(p)}),g.createEl("span",{text:b}),this.diffElements.push(g),p++,v++}else if(w.added){let g=u.createEl("div",{cls:"diff-line diff-added"});g.dataset.diffIndex=String(v),g.createEl("span",{cls:"line-number",text:String(E)}),g.createEl("span",{text:b}),this.diffElements.push(g),E++,v++}else{let g=c.createEl("div",{cls:"diff-line"});g.createEl("span",{cls:"line-number",text:String(p)}),g.createEl("span",{text:b});let y=u.createEl("div",{cls:"diff-line"});y.createEl("span",{cls:"line-number",text:String(E)}),y.createEl("span",{text:b}),p++,E++}}}else{let p=c.createEl("div",{cls:"diff-line-inline-wrapper"}),E=u.createEl("div",{cls:"diff-line-inline-wrapper"});for(let v of h)if(v.removed){let w=p.createEl("span",{text:v.value});w.addClass("diff-char-removed"),this.diffElements.push(w)}else if(v.added){let w=E.createEl("span",{text:v.value});w.addClass("diff-char-added"),this.diffElements.push(w)}else p.createEl("span",{text:v.value}),E.createEl("span",{text:v.value})}let f=!1;c.addEventListener("scroll",()=>{f||(f=!0,u.scrollTop=c.scrollTop,setTimeout(()=>{f=!1},50))}),u.addEventListener("scroll",()=>{f||(f=!0,c.scrollTop=u.scrollTop,setTimeout(()=>{f=!1},50))})}scrollToDiff(){if(this.diffElements.length===0||this.currentDiffIndex>=this.diffElements.length)return;let e=this.diffElements[this.currentDiffIndex];e.scrollIntoView({behavior:"smooth",block:"center"}),this.diffElements.forEach(i=>i.removeClass("diff-current")),e.addClass("diff-current")}copyDiffToClipboard(){let e=this.containerEl.querySelector(".diff-container");if(!e)return;let i=e.textContent||"";navigator.clipboard.writeText(i).then(()=>{new _.Notice("\u2705 \u5DEE\u5F02\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(()=>{new _.Notice("\u274C \u590D\u5236\u5931\u8D25")})}onClose(){let{contentEl:e}=this;e.empty()}},Kt=class extends _.Modal{constructor(e,i,s,a,r){super(e);this.searchQuery="";this.plugin=i,this.file=s,this.firstVersionId=a,this.onSelect=r}async onOpen(){let{contentEl:e}=this;e.addClass("version-select-modal"),e.createEl("h2",{text:"\u9009\u62E9\u5BF9\u6BD4\u7248\u672C"}),e.createEl("p",{text:"\u9009\u62E9\u8981\u4E0E\u4E4B\u5BF9\u6BD4\u7684\u7248\u672C",cls:"version-select-hint"}),e.createEl("div",{cls:"version-search-container"}).createEl("input",{type:"text",placeholder:"\u641C\u7D22\u7248\u672C...",cls:"version-search-input"}).addEventListener("input",r=>{this.searchQuery=r.target.value,this.renderVersionList()});let a=e.createEl("div",{cls:"version-select-list"});this.renderVersionList()}async renderVersionList(){let e=this.containerEl.querySelector(".version-select-list");if(!e)return;e.empty();let s=(await this.plugin.getAllVersions(this.file.path)).filter(a=>{if(a.id===this.firstVersionId)return!1;if(!this.searchQuery)return!0;let r=this.searchQuery.toLowerCase();return a.message.toLowerCase().includes(r)||this.plugin.formatTime(a.timestamp).toLowerCase().includes(r)});if(s.length===0){e.createEl("div",{text:this.searchQuery?`\u672A\u627E\u5230\u5339\u914D "${this.searchQuery}" \u7684\u7248\u672C`:"\u6CA1\u6709\u5176\u4ED6\u7248\u672C",cls:"version-select-empty"});return}for(let a of s){let r=e.createEl("div",{cls:"version-select-item"}),o=r.createEl("div",{cls:"version-info"});o.createEl("div",{text:this.plugin.formatTime(a.timestamp),cls:"version-time"}),o.createEl("div",{text:a.message,cls:"version-message"}),o.createEl("div",{text:this.plugin.formatFileSize(a.size),cls:"version-size"}),r.createEl("button",{text:"\u9009\u62E9"}).addEventListener("click",()=>{this.close(),this.onSelect(a.id)})}}onClose(){let{contentEl:e}=this;e.empty()}},qt=class extends _.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i}async display(){let{containerEl:e}=this;if(e.empty(),e.createEl("h2",{text:"\u7248\u672C\u63A7\u5236\u8BBE\u7F6E"}),this.plugin.settings.showVersionStats){let u=await this.plugin.getStorageStats(),h=e.createEl("div",{cls:"version-stats"});h.createEl("h3",{text:"\u{1F4CA} \u5B58\u50A8\u7EDF\u8BA1"});let f=h.createEl("div",{cls:"stats-grid"});f.createEl("div",{text:`\u603B\u5927\u5C0F: ${this.plugin.formatFileSize(u.totalSize)}`}),f.createEl("div",{text:`\u7248\u672C\u6570\u91CF: ${u.versionCount}`}),f.createEl("div",{text:`\u6587\u4EF6\u6570\u91CF: ${u.fileCount}`}),f.createEl("div",{text:`\u661F\u6807\u7248\u672C: ${u.starredCount}`}),f.createEl("div",{text:`\u6807\u7B7E\u7248\u672C: ${u.taggedCount}`}),(this.plugin.settings.enableCompression||this.plugin.settings.enableIncrementalStorage)&&f.createEl("div",{text:`\u538B\u7F29\u7387: ${u.compressionRatio.toFixed(1)}%`}),h.createEl("button",{text:"\u{1F504} \u5237\u65B0\u7EDF\u8BA1"}).addEventListener("click",()=>{this.display()})}e.createEl("h3",{text:"\u2699\uFE0F \u57FA\u7840\u8BBE\u7F6E"}),new _.Setting(e).setName("\u7248\u672C\u5B58\u50A8\u8DEF\u5F84").setDesc("\u6307\u5B9A\u7248\u672C\u6570\u636E\u7684\u5B58\u50A8\u4F4D\u7F6E(\u76F8\u5BF9\u4E8E\u5E93\u6839\u76EE\u5F55)").addText(u=>u.setPlaceholder(".versions").setValue(this.plugin.settings.versionFolder).onChange(async h=>{this.plugin.settings.versionFolder=h||".versions",await this.plugin.saveSettings(),await this.plugin.ensureVersionFolder()})),new _.Setting(e).setName("\u663E\u793A\u901A\u77E5").setDesc("\u5728\u521B\u5EFA\u3001\u6062\u590D\u7248\u672C\u65F6\u663E\u793A\u63D0\u793A\u6D88\u606F").addToggle(u=>u.setValue(this.plugin.settings.showNotifications).onChange(async h=>{this.plugin.settings.showNotifications=h,await this.plugin.saveSettings()})),new _.Setting(e).setName("\u663E\u793A\u7EDF\u8BA1\u4FE1\u606F").setDesc("\u5728\u8BBE\u7F6E\u9875\u9762\u663E\u793A\u7248\u672C\u7EDF\u8BA1").addToggle(u=>u.setValue(this.plugin.settings.showVersionStats).onChange(async h=>{this.plugin.settings.showVersionStats=h,await this.plugin.saveSettings(),this.display()})),e.createEl("h3",{text:"\u{1F3F7}\uFE0F \u7248\u672C\u6807\u7B7E\u4E0E\u5907\u6CE8"}),new _.Setting(e).setName("\u542F\u7528\u7248\u672C\u6807\u7B7E").setDesc("\u4E3A\u7248\u672C\u6DFB\u52A0\u6807\u7B7E\u4EE5\u4FBF\u5206\u7C7B\u548C\u7B5B\u9009").addToggle(u=>u.setValue(this.plugin.settings.enableVersionTags).onChange(async h=>{this.plugin.settings.enableVersionTags=h,await this.plugin.saveSettings()})),new _.Setting(e).setName("\u9ED8\u8BA4\u6807\u7B7E\u5217\u8868").setDesc("\u9884\u8BBE\u7684\u5E38\u7528\u6807\u7B7E(\u6BCF\u884C\u4E00\u4E2A)").addTextArea(u=>{u.setValue(this.plugin.settings.defaultTags.join(`
`)).setPlaceholder(`\u91CD\u8981
\u91CC\u7A0B\u7891
\u53D1\u5E03
\u5907\u4EFD
\u8349\u7A3F`).onChange(async h=>{this.plugin.settings.defaultTags=h.split(`
`).map(f=>f.trim()).filter(f=>f.length>0),await this.plugin.saveSettings()}),u.inputEl.rows=4,u.inputEl.style.width="100%"}),new _.Setting(e).setName("\u542F\u7528\u5FEB\u901F\u9884\u89C8").setDesc("\u5728\u7248\u672C\u5386\u53F2\u4E2D\u663E\u793A\u5FEB\u901F\u9884\u89C8\u6309\u94AE").addToggle(u=>u.setValue(this.plugin.settings.enableQuickPreview).onChange(async h=>{this.plugin.settings.enableQuickPreview=h,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView()})),e.createEl("h3",{text:"\u{1F916} \u81EA\u52A8\u4FDD\u5B58"}),new _.Setting(e).setName("\u542F\u7528\u81EA\u52A8\u4FDD\u5B58").setDesc("\u81EA\u52A8\u521B\u5EFA\u7248\u672C\u5FEB\u7167").addToggle(u=>u.setValue(this.plugin.settings.autoSave).onChange(async h=>{this.plugin.settings.autoSave=h,await this.plugin.saveSettings(),h&&this.plugin.settings.autoSaveOnInterval?this.plugin.startAutoSave():this.plugin.autoSaveTimer&&clearInterval(this.plugin.autoSaveTimer)}));let i=e.createEl("div",{cls:"setting-item-description"});i.innerHTML="\u9009\u62E9\u4EE5\u4E0B\u4E00\u79CD\u6216\u591A\u79CD\u81EA\u52A8\u4FDD\u5B58\u89E6\u53D1\u65B9\u5F0F:",i.style.marginBottom="10px",i.style.color="var(--text-muted)",new _.Setting(e).setName("\u270F\uFE0F \u4FEE\u6539\u65F6\u81EA\u52A8\u4FDD\u5B58").setDesc("\u6587\u4EF6\u4FEE\u6539\u540E\u5EF6\u8FDF\u4FDD\u5B58(\u63A8\u8350)").addToggle(u=>u.setValue(this.plugin.settings.autoSaveOnModify).onChange(async h=>{this.plugin.settings.autoSaveOnModify=h,await this.plugin.saveSettings()})),new _.Setting(e).setName("\u4FDD\u5B58\u5EF6\u8FDF (\u79D2)").setDesc("\u4FEE\u6539\u540E\u7B49\u5F85\u591A\u4E45\u624D\u4FDD\u5B58,\u907F\u514D\u9891\u7E41\u521B\u5EFA\u7248\u672C").addSlider(u=>u.setLimits(1,30,1).setValue(this.plugin.settings.autoSaveDelay).setDynamicTooltip().onChange(async h=>{this.plugin.settings.autoSaveDelay=h,await this.plugin.saveSettings()})),new _.Setting(e).setName("\u6700\u5C0F\u53D8\u5316\u5B57\u7B26\u6570").setDesc("\u53EA\u6709\u53D8\u5316\u8D85\u8FC7\u6B64\u5B57\u7B26\u6570\u65F6\u624D\u4FDD\u5B58\u7248\u672C").addSlider(u=>u.setLimits(0,100,5).setValue(this.plugin.settings.autoSaveMinChanges).setDynamicTooltip().onChange(async h=>{this.plugin.settings.autoSaveMinChanges=h,await this.plugin.saveSettings()})),new _.Setting(e).setName("\u23F0 \u5B9A\u65F6\u81EA\u52A8\u4FDD\u5B58").setDesc("\u6309\u56FA\u5B9A\u65F6\u95F4\u95F4\u9694\u4FDD\u5B58").addToggle(u=>u.setValue(this.plugin.settings.autoSaveOnInterval).onChange(async h=>{this.plugin.settings.autoSaveOnInterval=h,await this.plugin.saveSettings(),h&&this.plugin.settings.autoSave?this.plugin.startAutoSave():this.plugin.autoSaveTimer&&(clearInterval(this.plugin.autoSaveTimer),this.plugin.autoSaveTimer=null)})),new _.Setting(e).setName("\u5B9A\u65F6\u95F4\u9694 (\u5206\u949F)").setDesc("\u6BCF\u9694\u591A\u4E45\u81EA\u52A8\u68C0\u67E5\u5E76\u4FDD\u5B58").addText(u=>u.setPlaceholder("5").setValue(String(this.plugin.settings.autoSaveInterval)).onChange(async h=>{let f=parseInt(h);!isNaN(f)&&f>0&&(this.plugin.settings.autoSaveInterval=f,await this.plugin.saveSettings(),this.plugin.settings.autoSave&&this.plugin.settings.autoSaveOnInterval&&this.plugin.startAutoSave())})),new _.Setting(e).setName("\u{1F504} \u5207\u6362\u6587\u4EF6\u65F6\u4FDD\u5B58").setDesc("\u5207\u6362\u5230\u5176\u4ED6\u6587\u4EF6\u65F6\u81EA\u52A8\u4FDD\u5B58\u5F53\u524D\u6587\u4EF6").addToggle(u=>u.setValue(this.plugin.settings.autoSaveOnFileSwitch).onChange(async h=>{this.plugin.settings.autoSaveOnFileSwitch=h,await this.plugin.saveSettings()})),new _.Setting(e).setName("\u{1F441}\uFE0F \u5931\u53BB\u7126\u70B9\u65F6\u4FDD\u5B58").setDesc("\u7A97\u53E3\u5931\u53BB\u7126\u70B9\u65F6\u81EA\u52A8\u4FDD\u5B58(\u5207\u6362\u5E94\u7528\u65F6)").addToggle(u=>u.setValue(this.plugin.settings.autoSaveOnFocusLost).onChange(async h=>{this.plugin.settings.autoSaveOnFocusLost=h,await this.plugin.saveSettings(),h&&new _.Notice("\u5931\u53BB\u7126\u70B9\u4FDD\u5B58\u5C06\u5728\u91CD\u542F Obsidian \u540E\u751F\u6548")})),new _.Setting(e).setName("\u542F\u7528\u53BB\u91CD").setDesc("\u8DF3\u8FC7\u5185\u5BB9\u76F8\u540C\u7684\u7248\u672C\u521B\u5EFA,\u8282\u7701\u5B58\u50A8\u7A7A\u95F4").addToggle(u=>u.setValue(this.plugin.settings.enableDeduplication).onChange(async h=>{this.plugin.settings.enableDeduplication=h,await this.plugin.saveSettings()})),new _.Setting(e).setName("\u6392\u9664\u7684\u6587\u4EF6\u5939").setDesc("\u4E0D\u5BF9\u8FD9\u4E9B\u6587\u4EF6\u5939\u4E2D\u7684\u6587\u4EF6\u521B\u5EFA\u7248\u672C(\u6BCF\u884C\u4E00\u4E2A\u8DEF\u5F84)").addTextArea(u=>{u.setValue(this.plugin.settings.excludedFolders.join(`
`)).setPlaceholder(`\u4F8B\u5982:
templates/
.trash/`).onChange(async h=>{this.plugin.settings.excludedFolders=h.split(`
`).map(f=>f.trim()).filter(f=>f.length>0),await this.plugin.saveSettings()}),u.inputEl.rows=4,u.inputEl.style.width="100%"}),e.createEl("h3",{text:"\u{1F4BE} \u5B58\u50A8\u4F18\u5316"}),new _.Setting(e).setName("\u542F\u7528\u538B\u7F29").setDesc("\u4F7F\u7528 gzip \u538B\u7F29\u7248\u672C\u6587\u4EF6,\u663E\u8457\u51CF\u5C11\u5B58\u50A8\u7A7A\u95F4\u5360\u7528").addToggle(u=>u.setValue(this.plugin.settings.enableCompression).onChange(async h=>{this.plugin.settings.enableCompression=h,await this.plugin.saveSettings()})),new _.Setting(e).setName("\u542F\u7528\u589E\u91CF\u5B58\u50A8").setDesc("\u53EA\u4FDD\u5B58\u7248\u672C\u95F4\u7684\u5DEE\u5F02,\u5927\u5E45\u964D\u4F4E\u5B58\u50A8\u7A7A\u95F4\u4F7F\u7528").addToggle(u=>u.setValue(this.plugin.settings.enableIncrementalStorage).onChange(async h=>{this.plugin.settings.enableIncrementalStorage=h,await this.plugin.saveSettings()})),new _.Setting(e).setName("\u57FA\u51C6\u7248\u672C\u95F4\u9694").setDesc("\u6BCFN\u4E2A\u7248\u672C\u521B\u5EFA\u4E00\u6B21\u5B8C\u6574\u5FEB\u7167(\u5EFA\u8BAE10-20),\u7528\u4E8E\u589E\u91CF\u5B58\u50A8\u7684\u57FA\u51C6").addText(u=>u.setPlaceholder("10").setValue(String(this.plugin.settings.rebuildBaseInterval)).onChange(async h=>{let f=parseInt(h);!isNaN(f)&&f>0&&(this.plugin.settings.rebuildBaseInterval=f,await this.plugin.saveSettings())})),new _.Setting(e).setName("\u6BCF\u9875\u663E\u793A\u7248\u672C\u6570").setDesc("\u7248\u672C\u5386\u53F2\u89C6\u56FE\u4E2D\u6BCF\u9875\u663E\u793A\u7684\u7248\u672C\u6570\u91CF(0=\u4E0D\u5206\u9875)").addText(u=>u.setPlaceholder("20").setValue(String(this.plugin.settings.versionsPerPage)).onChange(async h=>{let f=parseInt(h);!isNaN(f)&&f>=0&&(this.plugin.settings.versionsPerPage=f,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView())})),new _.Setting(e).setName("\u4F18\u5316\u5B58\u50A8").setDesc("\u91CD\u65B0\u538B\u7F29\u548C\u4F18\u5316\u6240\u6709\u7248\u672C\u6587\u4EF6").addButton(u=>u.setButtonText("\u7ACB\u5373\u4F18\u5316").onClick(async()=>{await this.plugin.optimizeAllVersionFiles(),this.display()})),e.createEl("h3",{text:"\u{1F5D1}\uFE0F \u81EA\u52A8\u6E05\u7406"}),new _.Setting(e).setName("\u542F\u7528\u81EA\u52A8\u6E05\u7406").setDesc("\u81EA\u52A8\u5220\u9664\u65E7\u7248\u672C\u4EE5\u8282\u7701\u7A7A\u95F4").addToggle(u=>u.setValue(this.plugin.settings.autoClear).onChange(async h=>{this.plugin.settings.autoClear=h,await this.plugin.saveSettings()})),new _.Setting(e).setName("\u6309\u6570\u91CF\u6E05\u7406").setDesc("\u4FDD\u7559\u6307\u5B9A\u6570\u91CF\u7684\u6700\u65B0\u7248\u672C").addToggle(u=>u.setValue(this.plugin.settings.enableMaxVersions).onChange(async h=>{this.plugin.settings.enableMaxVersions=h,await this.plugin.saveSettings()})),new _.Setting(e).setName("\u6700\u5927\u7248\u672C\u6570").setDesc("\u6BCF\u4E2A\u6587\u4EF6\u6700\u591A\u4FDD\u7559\u7684\u7248\u672C\u6570\u91CF").addText(u=>u.setPlaceholder("50").setValue(String(this.plugin.settings.maxVersions)).onChange(async h=>{let f=parseInt(h);!isNaN(f)&&f>0&&(this.plugin.settings.maxVersions=f,await this.plugin.saveSettings())})),new _.Setting(e).setName("\u6309\u5929\u6570\u6E05\u7406").setDesc("\u81EA\u52A8\u5220\u9664\u8D85\u8FC7\u6307\u5B9A\u5929\u6570\u7684\u7248\u672C").addToggle(u=>u.setValue(this.plugin.settings.enableMaxDays).onChange(async h=>{this.plugin.settings.enableMaxDays=h,await this.plugin.saveSettings()})),new _.Setting(e).setName("\u6700\u5927\u4FDD\u7559\u5929\u6570").setDesc("\u5220\u9664\u8D85\u8FC7\u6B64\u5929\u6570\u7684\u65E7\u7248\u672C").addText(u=>u.setPlaceholder("30").setValue(String(this.plugin.settings.maxDays)).onChange(async h=>{let f=parseInt(h);!isNaN(f)&&f>0&&(this.plugin.settings.maxDays=f,await this.plugin.saveSettings())})),e.createEl("h3",{text:"\u{1F3A8} \u663E\u793A\u8BBE\u7F6E"}),new _.Setting(e).setName("\u4F7F\u7528\u76F8\u5BF9\u65F6\u95F4").setDesc('\u663E\u793A"3\u5C0F\u65F6\u524D"\u800C\u4E0D\u662F\u5177\u4F53\u65F6\u95F4').addToggle(u=>u.setValue(this.plugin.settings.useRelativeTime).onChange(async h=>{this.plugin.settings.useRelativeTime=h,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView()})),e.createEl("h3",{text:"\u{1F500} \u5DEE\u5F02\u5BF9\u6BD4\u8BBE\u7F6E"}),new _.Setting(e).setName("\u5DEE\u5F02\u7C92\u5EA6").setDesc("\u9009\u62E9\u5DEE\u5F02\u8BA1\u7B97\u7684\u7CBE\u7EC6\u7A0B\u5EA6").addDropdown(u=>u.addOption("char","\u5B57\u7B26\u7EA7 - \u6700\u7CBE\u786E,\u663E\u793A\u6BCF\u4E2A\u5B57\u7B26\u7684\u53D8\u5316").addOption("word","\u5355\u8BCD\u7EA7 - \u6309\u5355\u8BCD\u663E\u793A\u5DEE\u5F02").addOption("line","\u884C\u7EA7 - \u6309\u884C\u663E\u793A\u5DEE\u5F02").setValue(this.plugin.settings.diffGranularity).onChange(async h=>{this.plugin.settings.diffGranularity=h,await this.plugin.saveSettings()})),new _.Setting(e).setName("\u9ED8\u8BA4\u89C6\u56FE\u6A21\u5F0F").setDesc("\u9009\u62E9\u5DEE\u5F02\u5BF9\u6BD4\u7684\u9ED8\u8BA4\u663E\u793A\u65B9\u5F0F").addDropdown(u=>u.addOption("unified","\u7EDF\u4E00\u89C6\u56FE - \u4E0A\u4E0B\u5BF9\u6BD4").addOption("split","\u5DE6\u53F3\u5206\u680F - \u5E76\u6392\u663E\u793A").setValue(this.plugin.settings.diffViewMode).onChange(async h=>{this.plugin.settings.diffViewMode=h,await this.plugin.saveSettings()})),e.createEl("h3",{text:"\u{1F6E0}\uFE0F \u7EF4\u62A4\u64CD\u4F5C"}),new _.Setting(e).setName("\u6E05\u7406\u6240\u6709\u7248\u672C").setDesc("\u5220\u9664\u6240\u6709\u7248\u672C\u6570\u636E(\u8C28\u614E\u64CD\u4F5C)").addButton(u=>u.setButtonText("\u6E05\u7A7A\u6240\u6709\u7248\u672C").setWarning().onClick(async()=>{new ce(this.app,"\u786E\u8BA4\u6E05\u7A7A\u6240\u6709\u7248\u672C",`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664\u6240\u6709\u6587\u4EF6\u7684\u6240\u6709\u7248\u672C\u5386\u53F2!

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500,\u8BF7\u8C28\u614E\u64CD\u4F5C!`,async()=>{await this.clearAllVersions()}).open()})),new _.Setting(e).setName("\u5BFC\u51FA\u7248\u672C\u6570\u636E").setDesc("\u5C06\u7248\u672C\u6587\u4EF6\u5939\u6253\u5305\u5BFC\u51FA").addButton(u=>u.setButtonText("\u521B\u5EFA\u5907\u4EFD").onClick(async()=>{new _.Notice("\u8BF7\u624B\u52A8\u590D\u5236 .versions \u6587\u4EF6\u5939\u8FDB\u884C\u5907\u4EFD")})),e.createEl("h3",{text:"\u{1F4D6} \u4F7F\u7528\u8BF4\u660E"});let s=e.createEl("div",{cls:"version-info-section"}),a=s.createEl("div",{cls:"feature-item"});a.createEl("strong",{text:"\u2728 \u65B0\u529F\u80FD:"});let r=a.createEl("ul");r.createEl("li",{text:"\u7248\u672C\u6807\u7B7E\u7CFB\u7EDF - \u4E3A\u91CD\u8981\u7248\u672C\u6DFB\u52A0\u6807\u7B7E\u8FDB\u884C\u5206\u7C7B"}),r.createEl("li",{text:"\u5FEB\u901F\u9884\u89C8 - \u65E0\u9700\u5B8C\u6574\u5BF9\u6BD4\u5373\u53EF\u67E5\u770B\u7248\u672C\u5185\u5BB9"}),r.createEl("li",{text:"\u7248\u672C\u5907\u6CE8 - \u4E3A\u7248\u672C\u6DFB\u52A0\u8BE6\u7EC6\u8BF4\u660E"}),r.createEl("li",{text:"\u661F\u6807\u6807\u8BB0 - \u6807\u8BB0\u91CD\u8981\u7248\u672C\u4FBF\u4E8E\u67E5\u627E"}),r.createEl("li",{text:"\u9AD8\u7EA7\u7B5B\u9009 - \u6309\u6807\u7B7E\u3001\u661F\u6807\u7B5B\u9009\u7248\u672C"});let o=s.createEl("div",{cls:"feature-item"});o.createEl("strong",{text:"\u2328\uFE0F \u5FEB\u6377\u952E:"});let d=o.createEl("ul");d.createEl("li",{text:"Ctrl+Shift+S - \u521B\u5EFA\u7248\u672C\u5FEB\u7167"}),d.createEl("li",{text:"Ctrl+Shift+H - \u663E\u793A\u7248\u672C\u5386\u53F2"}),d.createEl("li",{text:"Ctrl+Shift+D - \u4E0E\u5386\u53F2\u7248\u672C\u5BF9\u6BD4"}),d.createEl("li",{text:"Ctrl+Shift+Z - \u6062\u590D\u5230\u4E0A\u4E00\u7248\u672C"}),d.createEl("li",{text:"Ctrl+Shift+P - \u5FEB\u901F\u9884\u89C8\u4E0A\u4E00\u7248\u672C"});let l=s.createEl("div",{cls:"feature-item"});l.createEl("strong",{text:"\u{1F4A1} \u4F7F\u7528\u6280\u5DE7:"});let c=l.createEl("ul");c.createEl("li",{text:"\u53F3\u952E\u70B9\u51FB\u7248\u672C\u53EF\u67E5\u770B\u66F4\u591A\u64CD\u4F5C\u9009\u9879"}),c.createEl("li",{text:"\u70B9\u51FB\u6807\u7B7E\u53EF\u5FEB\u901F\u7B5B\u9009\u76F8\u5173\u7248\u672C"}),c.createEl("li",{text:"\u4F7F\u7528\u661F\u6807\u6807\u8BB0\u91CD\u8981\u7684\u91CC\u7A0B\u7891\u7248\u672C"}),c.createEl("li",{text:'\u5B9A\u671F\u8FD0\u884C"\u4F18\u5316\u5B58\u50A8"\u4EE5\u4FDD\u6301\u6700\u4F73\u6027\u80FD'}),c.createEl("li",{text:"\u589E\u91CF\u5B58\u50A8\u548C\u538B\u7F29\u53EF\u8282\u770190%\u4EE5\u4E0A\u7684\u7A7A\u95F4"})}async clearAllVersions(){try{let e=this.app.vault.adapter,i=this.plugin.settings.versionFolder;if(await e.exists(i)){let s=await e.list(i),a=0;for(let r of s.files)r.endsWith(".json")&&(await e.remove(r),a++);this.plugin.versionCache.clear(),new _.Notice(`\u2705 \u5DF2\u6E05\u7A7A\u6240\u6709\u7248\u672C(\u5220\u9664 ${a} \u4E2A\u7248\u672C\u6587\u4EF6)`),this.plugin.refreshVersionHistoryView(),this.display()}}catch(e){console.error("\u6E05\u7A7A\u7248\u672C\u5931\u8D25:",e),new _.Notice("\u274C \u6E05\u7A7A\u5931\u8D25,\u8BF7\u67E5\u770B\u63A7\u5236\u53F0")}}};
/*! Bundled license information:

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
