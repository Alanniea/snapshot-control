/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var bt=Object.defineProperty;var ns=Object.getOwnPropertyDescriptor;var ss=Object.getOwnPropertyNames;var as=Object.prototype.hasOwnProperty;var rs=(t,s)=>{for(var e in s)bt(t,e,{get:s[e],enumerable:!0})},os=(t,s,e,i)=>{if(s&&typeof s=="object"||typeof s=="function")for(let n of ss(s))!as.call(t,n)&&n!==e&&bt(t,n,{get:()=>s[n],enumerable:!(i=ns(s,n))||i.enumerable});return t};var ls=t=>os(bt({},"__esModule",{value:!0}),t);var Jr={};rs(Jr,{default:()=>_t});module.exports=ls(Jr);var b=require("obsidian");var H=class{diff(s,e,i={}){let n;typeof i=="function"?(n=i,i={}):"callback"in i&&(n=i.callback);let a=this.castInput(s,i),r=this.castInput(e,i),o=this.removeEmpty(this.tokenize(a,i)),d=this.removeEmpty(this.tokenize(r,i));return this.diffWithOptionsObj(o,d,i,n)}diffWithOptionsObj(s,e,i,n){var a;let r=_=>{if(_=this.postProcess(_,i),n){setTimeout(function(){n(_)},0);return}else return _},o=e.length,d=s.length,l=1,c=o+d;i.maxEditLength!=null&&(c=Math.min(c,i.maxEditLength));let f=(a=i.timeout)!==null&&a!==void 0?a:1/0,p=Date.now()+f,h=[{oldPos:-1,lastComponent:void 0}],u=this.extractCommon(h[0],e,s,0,i);if(h[0].oldPos+1>=d&&u+1>=o)return r(this.buildValues(h[0].lastComponent,e,s));let g=-1/0,v=1/0,w=()=>{for(let _=Math.max(g,-l);_<=Math.min(v,l);_+=2){let x,m=h[_-1],y=h[_+1];m&&(h[_-1]=void 0);let D=!1;if(y){let C=y.oldPos-_;D=y&&0<=C&&C<o}let E=m&&m.oldPos+1<d;if(!D&&!E){h[_]=void 0;continue}if(!E||D&&m.oldPos<y.oldPos?x=this.addToPath(y,!0,!1,0,i):x=this.addToPath(m,!1,!0,1,i),u=this.extractCommon(x,e,s,_,i),x.oldPos+1>=d&&u+1>=o)return r(this.buildValues(x.lastComponent,e,s))||!0;h[_]=x,x.oldPos+1>=d&&(v=Math.min(v,_-1)),u+1>=o&&(g=Math.max(g,_+1))}l++};if(n)(function _(){setTimeout(function(){if(l>c||Date.now()>p)return n(void 0);w()||_()},0)})();else for(;l<=c&&Date.now()<=p;){let _=w();if(_)return _}}addToPath(s,e,i,n,a){let r=s.lastComponent;return r&&!a.oneChangePerToken&&r.added===e&&r.removed===i?{oldPos:s.oldPos+n,lastComponent:{count:r.count+1,added:e,removed:i,previousComponent:r.previousComponent}}:{oldPos:s.oldPos+n,lastComponent:{count:1,added:e,removed:i,previousComponent:r}}}extractCommon(s,e,i,n,a){let r=e.length,o=i.length,d=s.oldPos,l=d-n,c=0;for(;l+1<r&&d+1<o&&this.equals(i[d+1],e[l+1],a);)l++,d++,c++,a.oneChangePerToken&&(s.lastComponent={count:1,previousComponent:s.lastComponent,added:!1,removed:!1});return c&&!a.oneChangePerToken&&(s.lastComponent={count:c,previousComponent:s.lastComponent,added:!1,removed:!1}),s.oldPos=d,l}equals(s,e,i){return i.comparator?i.comparator(s,e):s===e||!!i.ignoreCase&&s.toLowerCase()===e.toLowerCase()}removeEmpty(s){let e=[];for(let i=0;i<s.length;i++)s[i]&&e.push(s[i]);return e}castInput(s,e){return s}tokenize(s,e){return Array.from(s)}join(s){return s.join("")}postProcess(s,e){return s}get useLongestToken(){return!1}buildValues(s,e,i){let n=[],a;for(;s;)n.push(s),a=s.previousComponent,delete s.previousComponent,s=a;n.reverse();let r=n.length,o=0,d=0,l=0;for(;o<r;o++){let c=n[o];if(c.removed)c.value=this.join(i.slice(l,l+c.count)),l+=c.count;else{if(!c.added&&this.useLongestToken){let f=e.slice(d,d+c.count);f=f.map(function(p,h){let u=i[l+h];return u.length>p.length?u:p}),c.value=this.join(f)}else c.value=this.join(e.slice(d,d+c.count));d+=c.count,c.added||(l+=c.count)}}return n}};var Et=class extends H{},Ei=new Et;function se(t,s,e){return Ei.diff(t,s,e)}function yt(t,s){let e;for(e=0;e<t.length&&e<s.length;e++)if(t[e]!=s[e])return t.slice(0,e);return t.slice(0,e)}function St(t,s){let e;if(!t||!s||t[t.length-1]!=s[s.length-1])return"";for(e=0;e<t.length&&e<s.length;e++)if(t[t.length-(e+1)]!=s[s.length-(e+1)])return t.slice(-e);return t.slice(-e)}function nt(t,s,e){if(t.slice(0,s.length)!=s)throw Error(`string ${JSON.stringify(t)} doesn't start with prefix ${JSON.stringify(s)}; this is a bug`);return e+t.slice(s.length)}function st(t,s,e){if(!s)return t+e;if(t.slice(-s.length)!=s)throw Error(`string ${JSON.stringify(t)} doesn't end with suffix ${JSON.stringify(s)}; this is a bug`);return t.slice(0,-s.length)+e}function Ee(t,s){return nt(t,s,"")}function Ae(t,s){return st(t,s,"")}function Ct(t,s){return s.slice(0,cs(t,s))}function cs(t,s){let e=0;t.length>s.length&&(e=t.length-s.length);let i=s.length;t.length<s.length&&(i=t.length);let n=Array(i),a=0;n[0]=0;for(let r=1;r<i;r++){for(s[r]==s[a]?n[r]=n[a]:n[r]=a;a>0&&s[r]!=s[a];)a=n[a];s[r]==s[a]&&a++}a=0;for(let r=e;r<t.length;r++){for(;a>0&&t[r]!=s[a];)a=n[a];t[r]==s[a]&&a++}return a}function yi(t){return t.includes(`\r
`)&&!t.startsWith(`
`)&&!t.match(/[^\r]\n/)}function Si(t){return!t.includes(`\r
`)&&t.includes(`
`)}function ye(t){let s;for(s=t.length-1;s>=0&&t[s].match(/\s/);s--);return t.substring(s+1)}function J(t){let s=t.match(/^\s*/);return s?s[0]:""}var at="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",ds=new RegExp(`[${at}]+|\\s+|[^${at}]`,"ug"),kt=class extends H{equals(s,e,i){return i.ignoreCase&&(s=s.toLowerCase(),e=e.toLowerCase()),s.trim()===e.trim()}tokenize(s,e={}){let i;if(e.intlSegmenter){let r=e.intlSegmenter;if(r.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');i=Array.from(r.segment(s),o=>o.segment)}else i=s.match(ds)||[];let n=[],a=null;return i.forEach(r=>{/\s/.test(r)?a==null?n.push(r):n.push(n.pop()+r):a!=null&&/\s/.test(a)?n[n.length-1]==a?n.push(n.pop()+r):n.push(a+r):n.push(r),a=r}),n}join(s){return s.map((e,i)=>i==0?e:e.replace(/^\s+/,"")).join("")}postProcess(s,e){if(!s||e.oneChangePerToken)return s;let i=null,n=null,a=null;return s.forEach(r=>{r.added?n=r:r.removed?a=r:((n||a)&&Ci(i,a,n,r),i=r,n=null,a=null)}),(n||a)&&Ci(i,a,n,null),s}},fs=new kt;function Ci(t,s,e,i){if(s&&e){let n=J(s.value),a=ye(s.value),r=J(e.value),o=ye(e.value);if(t){let d=yt(n,r);t.value=st(t.value,r,d),s.value=Ee(s.value,d),e.value=Ee(e.value,d)}if(i){let d=St(a,o);i.value=nt(i.value,o,d),s.value=Ae(s.value,d),e.value=Ae(e.value,d)}}else if(e){if(t){let n=J(e.value);e.value=e.value.substring(n.length)}if(i){let n=J(i.value);i.value=i.value.substring(n.length)}}else if(t&&i){let n=J(i.value),a=J(s.value),r=ye(s.value),o=yt(n,a);s.value=Ee(s.value,o);let d=St(Ee(n,o),r);s.value=Ae(s.value,d),i.value=nt(i.value,n,d),t.value=st(t.value,n,n.slice(0,n.length-d.length))}else if(i){let n=J(i.value),a=ye(s.value),r=Ct(a,n);s.value=Ae(s.value,r)}else if(t){let n=ye(t.value),a=J(s.value),r=Ct(n,a);s.value=Ee(s.value,r)}}var Dt=class extends H{tokenize(s){let e=new RegExp(`(\\r?\\n)|[${at}]+|[^\\S\\n\\r]+|[^${at}]`,"ug");return s.match(e)||[]}},ki=new Dt;function K(t,s,e){return ki.diff(t,s,e)}var Tt=class extends H{constructor(){super(...arguments),this.tokenize=hs}equals(s,e,i){return i.ignoreWhitespace?((!i.newlineIsToken||!s.includes(`
`))&&(s=s.trim()),(!i.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):i.ignoreNewlineAtEof&&!i.newlineIsToken&&(s.endsWith(`
`)&&(s=s.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),super.equals(s,e,i)}},Di=new Tt;function $(t,s,e){return Di.diff(t,s,e)}function hs(t,s){s.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));let e=[],i=t.split(/(\n|\r\n)/);i[i.length-1]||i.pop();for(let n=0;n<i.length;n++){let a=i[n];n%2&&!s.newlineIsToken?e[e.length-1]+=a:e.push(a)}return e}var Vt=class extends H{tokenize(s){return s.slice()}join(s){return s}removeEmpty(s){return s}},Ti=new Vt;function Me(t,s,e){return Ti.diff(t,s,e)}function It(t){return Array.isArray(t)?t.map(s=>It(s)):Object.assign(Object.assign({},t),{hunks:t.hunks.map(s=>Object.assign(Object.assign({},s),{lines:s.lines.map((e,i)=>{var n;return e.startsWith("\\")||e.endsWith("\r")||!((n=s.lines[i+1])===null||n===void 0)&&n.startsWith("\\")?e:e+"\r"})}))})}function Lt(t){return Array.isArray(t)?t.map(s=>Lt(s)):Object.assign(Object.assign({},t),{hunks:t.hunks.map(s=>Object.assign(Object.assign({},s),{lines:s.lines.map(e=>e.endsWith("\r")?e.substring(0,e.length-1):e)}))})}function Vi(t){return Array.isArray(t)||(t=[t]),!t.some(s=>s.hunks.some(e=>e.lines.some(i=>!i.startsWith("\\")&&i.endsWith("\r"))))}function Ii(t){return Array.isArray(t)||(t=[t]),t.some(s=>s.hunks.some(e=>e.lines.some(i=>i.endsWith("\r"))))&&t.every(s=>s.hunks.every(e=>e.lines.every((i,n)=>{var a;return i.startsWith("\\")||i.endsWith("\r")||((a=e.lines[n+1])===null||a===void 0?void 0:a.startsWith("\\"))})))}function Li(t){let s=t.split(/\n/),e=[],i=0;function n(){let o={};for(e.push(o);i<s.length;){let d=s[i];if(/^(---|\+\+\+|@@)\s/.test(d))break;let l=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(d);l&&(o.index=l[1]),i++}for(a(o),a(o),o.hunks=[];i<s.length;){let d=s[i];if(/^(Index:\s|diff\s|---\s|\+\+\+\s|===================================================================)/.test(d))break;if(/^@@/.test(d))o.hunks.push(r());else{if(d)throw new Error("Unknown line "+(i+1)+" "+JSON.stringify(d));i++}}}function a(o){let d=/^(---|\+\+\+)\s+(.*)\r?$/.exec(s[i]);if(d){let l=d[2].split("	",2),c=(l[1]||"").trim(),f=l[0].replace(/\\\\/g,"\\");/^".*"$/.test(f)&&(f=f.substr(1,f.length-2)),d[1]==="---"?(o.oldFileName=f,o.oldHeader=c):(o.newFileName=f,o.newHeader=c),i++}}function r(){var o;let d=i,l=s[i++],c=l.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),f={oldStart:+c[1],oldLines:typeof c[2]=="undefined"?1:+c[2],newStart:+c[3],newLines:typeof c[4]=="undefined"?1:+c[4],lines:[]};f.oldLines===0&&(f.oldStart+=1),f.newLines===0&&(f.newStart+=1);let p=0,h=0;for(;i<s.length&&(h<f.oldLines||p<f.newLines||!((o=s[i])===null||o===void 0)&&o.startsWith("\\"));i++){let u=s[i].length==0&&i!=s.length-1?" ":s[i][0];if(u==="+"||u==="-"||u===" "||u==="\\")f.lines.push(s[i]),u==="+"?p++:u==="-"?h++:u===" "&&(p++,h++);else throw new Error(`Hunk at line ${d+1} contained invalid line ${s[i]}`)}if(!p&&f.newLines===1&&(f.newLines=0),!h&&f.oldLines===1&&(f.oldLines=0),p!==f.newLines)throw new Error("Added line count did not match for hunk at line "+(d+1));if(h!==f.oldLines)throw new Error("Removed line count did not match for hunk at line "+(d+1));return f}for(;i<s.length;)n();return e}function Fi(t,s,e){let i=!0,n=!1,a=!1,r=1;return function o(){if(i&&!a){if(n?r++:i=!1,t+r<=e)return t+r;a=!0}if(!n)return a||(i=!0),s<=t-r?t-r++:(n=!0,o())}}function Ft(t,s,e={}){let i;if(typeof s=="string"?i=Li(s):Array.isArray(s)?i=s:i=[s],i.length>1)throw new Error("applyPatch only works with a single input.");return us(t,i[0],e)}function us(t,s,e={}){(e.autoConvertLineEndings||e.autoConvertLineEndings==null)&&(yi(t)&&Vi(s)?s=It(s):Si(t)&&Ii(s)&&(s=Lt(s)));let i=t.split(`
`),n=s.hunks,a=e.compareLine||((u,g,v,w)=>g===w),r=e.fuzzFactor||0,o=0;if(r<0||!Number.isInteger(r))throw new Error("fuzzFactor must be a non-negative integer");if(!n.length)return t;let d="",l=!1,c=!1;for(let u=0;u<n[n.length-1].lines.length;u++){let g=n[n.length-1].lines[u];g[0]=="\\"&&(d[0]=="+"?l=!0:d[0]=="-"&&(c=!0)),d=g}if(l){if(c){if(!r&&i[i.length-1]=="")return!1}else if(i[i.length-1]=="")i.pop();else if(!r)return!1}else if(c){if(i[i.length-1]!="")i.push("");else if(!r)return!1}function f(u,g,v,w=0,_=!0,x=[],m=0){let y=0,D=!1;for(;w<u.length;w++){let E=u[w],C=E.length>0?E[0]:" ",k=E.length>0?E.substr(1):E;if(C==="-")if(a(g+1,i[g],C,k))g++,y=0;else return!v||i[g]==null?null:(x[m]=i[g],f(u,g+1,v-1,w,!1,x,m+1));if(C==="+"){if(!_)return null;x[m]=k,m++,y=0,D=!0}if(C===" ")if(y++,x[m]=i[g],a(g+1,i[g],C,k))m++,_=!0,D=!1,g++;else return D||!v?null:i[g]&&(f(u,g+1,v-1,w+1,!1,x,m+1)||f(u,g+1,v-1,w,!1,x,m+1))||f(u,g,v-1,w+1,!1,x,m)}return m-=y,g-=y,x.length=m,{patchedLines:x,oldLineLastI:g-1}}let p=[],h=0;for(let u=0;u<n.length;u++){let g=n[u],v,w=i.length-g.oldLines+r,_;for(let x=0;x<=r;x++){_=g.oldStart+h-1;let m=Fi(_,o,w);for(;_!==void 0&&(v=f(g.lines,_,x),!v);_=m());if(v)break}if(!v)return!1;for(let x=o;x<_;x++)p.push(i[x]);for(let x=0;x<v.patchedLines.length;x++){let m=v.patchedLines[x];p.push(m)}o=v.oldLineLastI+1,h=_+1-g.oldStart}for(let u=o;u<i.length;u++)p.push(i[u]);return p.join(`
`)}function At(t,s,e,i,n,a,r){let o;r?typeof r=="function"?o={callback:r}:o=r:o={},typeof o.context=="undefined"&&(o.context=4);let d=o.context;if(o.newlineIsToken)throw new Error("newlineIsToken may not be used with patch-generation functions, only with diffing functions");if(o.callback){let{callback:c}=o;$(e,i,Object.assign(Object.assign({},o),{callback:f=>{let p=l(f);c(p)}}))}else return l($(e,i,o));function l(c){if(!c)return;c.push({value:"",lines:[]});function f(_){return _.map(function(x){return" "+x})}let p=[],h=0,u=0,g=[],v=1,w=1;for(let _=0;_<c.length;_++){let x=c[_],m=x.lines||gs(x.value);if(x.lines=m,x.added||x.removed){if(!h){let y=c[_-1];h=v,u=w,y&&(g=d>0?f(y.lines.slice(-d)):[],h-=g.length,u-=g.length)}for(let y of m)g.push((x.added?"+":"-")+y);x.added?w+=m.length:v+=m.length}else{if(h)if(m.length<=d*2&&_<c.length-2)for(let y of f(m))g.push(y);else{let y=Math.min(m.length,d);for(let E of f(m.slice(0,y)))g.push(E);let D={oldStart:h,oldLines:v-h+y,newStart:u,newLines:w-u+y,lines:g};p.push(D),h=0,u=0,g=[]}v+=m.length,w+=m.length}}for(let _ of p)for(let x=0;x<_.lines.length;x++)_.lines[x].endsWith(`
`)?_.lines[x]=_.lines[x].slice(0,-1):(_.lines.splice(x+1,0,"\\ No newline at end of file"),x++);return{oldFileName:t,newFileName:s,oldHeader:n,newHeader:a,hunks:p}}}function rt(t){if(Array.isArray(t))return t.map(rt).join(`
`);let s=[];t.oldFileName==t.newFileName&&s.push("Index: "+t.oldFileName),s.push("==================================================================="),s.push("--- "+t.oldFileName+(typeof t.oldHeader=="undefined"?"":"	"+t.oldHeader)),s.push("+++ "+t.newFileName+(typeof t.newHeader=="undefined"?"":"	"+t.newHeader));for(let e=0;e<t.hunks.length;e++){let i=t.hunks[e];i.oldLines===0&&(i.oldStart-=1),i.newLines===0&&(i.newStart-=1),s.push("@@ -"+i.oldStart+","+i.oldLines+" +"+i.newStart+","+i.newLines+" @@");for(let n of i.lines)s.push(n)}return s.join(`
`)+`
`}function Ai(t,s,e,i,n,a,r){if(typeof r=="function"&&(r={callback:r}),r!=null&&r.callback){let{callback:o}=r;At(t,s,e,i,n,a,Object.assign(Object.assign({},r),{callback:d=>{o(d?rt(d):void 0)}}))}else{let o=At(t,s,e,i,n,a,r);return o?rt(o):void 0}}function Mt(t,s,e,i,n,a){return Ai(t,t,s,e,i,n,a)}function gs(t){let s=t.endsWith(`
`),e=t.split(`
`).map(i=>i+`
`);return s?e.pop():e.push(e.pop().slice(0,-1)),e}function Ve(t){let s=t.length;for(;--s>=0;)t[s]=0}var vs=0,_n=1,ms=2,ws=3,_s=258,si=29,Ye=256,Pe=Ye+1+si,ke=30,ai=19,xn=2*Pe+1,ue=15,Bt=16,xs=7,ri=256,bn=16,En=17,yn=18,Yt=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ht=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),bs=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Sn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Es=512,te=new Array((Pe+2)*2);Ve(te);var Oe=new Array(ke*2);Ve(Oe);var He=new Array(Es);Ve(He);var We=new Array(_s-ws+1);Ve(We);var oi=new Array(si);Ve(oi);var ut=new Array(ke);Ve(ut);function zt(t,s,e,i,n){this.static_tree=t,this.extra_bits=s,this.extra_base=e,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}var Cn,kn,Dn;function $t(t,s){this.dyn_tree=t,this.max_code=0,this.stat_desc=s}var Tn=t=>t<256?He[t]:He[256+(t>>>7)],Ze=(t,s)=>{t.pending_buf[t.pending++]=s&255,t.pending_buf[t.pending++]=s>>>8&255},N=(t,s,e)=>{t.bi_valid>Bt-e?(t.bi_buf|=s<<t.bi_valid&65535,Ze(t,t.bi_buf),t.bi_buf=s>>Bt-t.bi_valid,t.bi_valid+=e-Bt):(t.bi_buf|=s<<t.bi_valid&65535,t.bi_valid+=e)},q=(t,s,e)=>{N(t,e[s*2],e[s*2+1])},Vn=(t,s)=>{let e=0;do e|=t&1,t>>>=1,e<<=1;while(--s>0);return e>>>1},ys=t=>{t.bi_valid===16?(Ze(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},Ss=(t,s)=>{let e=s.dyn_tree,i=s.max_code,n=s.stat_desc.static_tree,a=s.stat_desc.has_stree,r=s.stat_desc.extra_bits,o=s.stat_desc.extra_base,d=s.stat_desc.max_length,l,c,f,p,h,u,g=0;for(p=0;p<=ue;p++)t.bl_count[p]=0;for(e[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<xn;l++)c=t.heap[l],p=e[e[c*2+1]*2+1]+1,p>d&&(p=d,g++),e[c*2+1]=p,!(c>i)&&(t.bl_count[p]++,h=0,c>=o&&(h=r[c-o]),u=e[c*2],t.opt_len+=u*(p+h),a&&(t.static_len+=u*(n[c*2+1]+h)));if(g!==0){do{for(p=d-1;t.bl_count[p]===0;)p--;t.bl_count[p]--,t.bl_count[p+1]+=2,t.bl_count[d]--,g-=2}while(g>0);for(p=d;p!==0;p--)for(c=t.bl_count[p];c!==0;)f=t.heap[--l],!(f>i)&&(e[f*2+1]!==p&&(t.opt_len+=(p-e[f*2+1])*e[f*2],e[f*2+1]=p),c--)}},In=(t,s,e)=>{let i=new Array(ue+1),n=0,a,r;for(a=1;a<=ue;a++)n=n+e[a-1]<<1,i[a]=n;for(r=0;r<=s;r++){let o=t[r*2+1];o!==0&&(t[r*2]=Vn(i[o]++,o))}},Cs=()=>{let t,s,e,i,n,a=new Array(ue+1);for(e=0,i=0;i<si-1;i++)for(oi[i]=e,t=0;t<1<<Yt[i];t++)We[e++]=i;for(We[e-1]=i,n=0,i=0;i<16;i++)for(ut[i]=n,t=0;t<1<<ht[i];t++)He[n++]=i;for(n>>=7;i<ke;i++)for(ut[i]=n<<7,t=0;t<1<<ht[i]-7;t++)He[256+n++]=i;for(s=0;s<=ue;s++)a[s]=0;for(t=0;t<=143;)te[t*2+1]=8,t++,a[8]++;for(;t<=255;)te[t*2+1]=9,t++,a[9]++;for(;t<=279;)te[t*2+1]=7,t++,a[7]++;for(;t<=287;)te[t*2+1]=8,t++,a[8]++;for(In(te,Pe+1,a),t=0;t<ke;t++)Oe[t*2+1]=5,Oe[t*2]=Vn(t,5);Cn=new zt(te,Yt,Ye+1,Pe,ue),kn=new zt(Oe,ht,0,ke,ue),Dn=new zt(new Array(0),bs,0,ai,xs)},Ln=t=>{let s;for(s=0;s<Pe;s++)t.dyn_ltree[s*2]=0;for(s=0;s<ke;s++)t.dyn_dtree[s*2]=0;for(s=0;s<ai;s++)t.bl_tree[s*2]=0;t.dyn_ltree[ri*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Fn=t=>{t.bi_valid>8?Ze(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Mi=(t,s,e,i)=>{let n=s*2,a=e*2;return t[n]<t[a]||t[n]===t[a]&&i[s]<=i[e]},Ot=(t,s,e)=>{let i=t.heap[e],n=e<<1;for(;n<=t.heap_len&&(n<t.heap_len&&Mi(s,t.heap[n+1],t.heap[n],t.depth)&&n++,!Mi(s,i,t.heap[n],t.depth));)t.heap[e]=t.heap[n],e=n,n<<=1;t.heap[e]=i},Bi=(t,s,e)=>{let i,n,a=0,r,o;if(t.sym_next!==0)do i=t.pending_buf[t.sym_buf+a++]&255,i+=(t.pending_buf[t.sym_buf+a++]&255)<<8,n=t.pending_buf[t.sym_buf+a++],i===0?q(t,n,s):(r=We[n],q(t,r+Ye+1,s),o=Yt[r],o!==0&&(n-=oi[r],N(t,n,o)),i--,r=Tn(i),q(t,r,e),o=ht[r],o!==0&&(i-=ut[r],N(t,i,o)));while(a<t.sym_next);q(t,ri,s)},Xt=(t,s)=>{let e=s.dyn_tree,i=s.stat_desc.static_tree,n=s.stat_desc.has_stree,a=s.stat_desc.elems,r,o,d=-1,l;for(t.heap_len=0,t.heap_max=xn,r=0;r<a;r++)e[r*2]!==0?(t.heap[++t.heap_len]=d=r,t.depth[r]=0):e[r*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=d<2?++d:0,e[l*2]=1,t.depth[l]=0,t.opt_len--,n&&(t.static_len-=i[l*2+1]);for(s.max_code=d,r=t.heap_len>>1;r>=1;r--)Ot(t,e,r);l=a;do r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Ot(t,e,1),o=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=o,e[l*2]=e[r*2]+e[o*2],t.depth[l]=(t.depth[r]>=t.depth[o]?t.depth[r]:t.depth[o])+1,e[r*2+1]=e[o*2+1]=l,t.heap[1]=l++,Ot(t,e,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],Ss(t,s),In(e,d,t.bl_count)},zi=(t,s,e)=>{let i,n=-1,a,r=s[0*2+1],o=0,d=7,l=4;for(r===0&&(d=138,l=3),s[(e+1)*2+1]=65535,i=0;i<=e;i++)a=r,r=s[(i+1)*2+1],!(++o<d&&a===r)&&(o<l?t.bl_tree[a*2]+=o:a!==0?(a!==n&&t.bl_tree[a*2]++,t.bl_tree[bn*2]++):o<=10?t.bl_tree[En*2]++:t.bl_tree[yn*2]++,o=0,n=a,r===0?(d=138,l=3):a===r?(d=6,l=3):(d=7,l=4))},$i=(t,s,e)=>{let i,n=-1,a,r=s[0*2+1],o=0,d=7,l=4;for(r===0&&(d=138,l=3),i=0;i<=e;i++)if(a=r,r=s[(i+1)*2+1],!(++o<d&&a===r)){if(o<l)do q(t,a,t.bl_tree);while(--o!==0);else a!==0?(a!==n&&(q(t,a,t.bl_tree),o--),q(t,bn,t.bl_tree),N(t,o-3,2)):o<=10?(q(t,En,t.bl_tree),N(t,o-3,3)):(q(t,yn,t.bl_tree),N(t,o-11,7));o=0,n=a,r===0?(d=138,l=3):a===r?(d=6,l=3):(d=7,l=4)}},ks=t=>{let s;for(zi(t,t.dyn_ltree,t.l_desc.max_code),zi(t,t.dyn_dtree,t.d_desc.max_code),Xt(t,t.bl_desc),s=ai-1;s>=3&&t.bl_tree[Sn[s]*2+1]===0;s--);return t.opt_len+=3*(s+1)+5+5+4,s},Ds=(t,s,e,i)=>{let n;for(N(t,s-257,5),N(t,e-1,5),N(t,i-4,4),n=0;n<i;n++)N(t,t.bl_tree[Sn[n]*2+1],3);$i(t,t.dyn_ltree,s-1),$i(t,t.dyn_dtree,e-1)},Ts=t=>{let s=4093624447,e;for(e=0;e<=31;e++,s>>>=1)if(s&1&&t.dyn_ltree[e*2]!==0)return 0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return 1;for(e=32;e<Ye;e++)if(t.dyn_ltree[e*2]!==0)return 1;return 0},Oi=!1,Vs=t=>{Oi||(Cs(),Oi=!0),t.l_desc=new $t(t.dyn_ltree,Cn),t.d_desc=new $t(t.dyn_dtree,kn),t.bl_desc=new $t(t.bl_tree,Dn),t.bi_buf=0,t.bi_valid=0,Ln(t)},An=(t,s,e,i)=>{N(t,(vs<<1)+(i?1:0),3),Fn(t),Ze(t,e),Ze(t,~e),e&&t.pending_buf.set(t.window.subarray(s,s+e),t.pending),t.pending+=e},Is=t=>{N(t,_n<<1,3),q(t,ri,te),ys(t)},Ls=(t,s,e,i)=>{let n,a,r=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=Ts(t)),Xt(t,t.l_desc),Xt(t,t.d_desc),r=ks(t),n=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=n&&(n=a)):n=a=e+5,e+4<=n&&s!==-1?An(t,s,e,i):t.strategy===4||a===n?(N(t,(_n<<1)+(i?1:0),3),Bi(t,te,Oe)):(N(t,(ms<<1)+(i?1:0),3),Ds(t,t.l_desc.max_code+1,t.d_desc.max_code+1,r+1),Bi(t,t.dyn_ltree,t.dyn_dtree)),Ln(t),i&&Fn(t)},Fs=(t,s,e)=>(t.pending_buf[t.sym_buf+t.sym_next++]=s,t.pending_buf[t.sym_buf+t.sym_next++]=s>>8,t.pending_buf[t.sym_buf+t.sym_next++]=e,s===0?t.dyn_ltree[e*2]++:(t.matches++,s--,t.dyn_ltree[(We[e]+Ye+1)*2]++,t.dyn_dtree[Tn(s)*2]++),t.sym_next===t.sym_end),As=Vs,Ms=An,Bs=Ls,zs=Fs,$s=Is,Os={_tr_init:As,_tr_stored_block:Ms,_tr_flush_block:Bs,_tr_tally:zs,_tr_align:$s},Ns=(t,s,e,i)=>{let n=t&65535|0,a=t>>>16&65535|0,r=0;for(;e!==0;){r=e>2e3?2e3:e,e-=r;do n=n+s[i++]|0,a=a+n|0;while(--r);n%=65521,a%=65521}return n|a<<16|0},Ue=Ns,Rs=()=>{let t,s=[];for(var e=0;e<256;e++){t=e;for(var i=0;i<8;i++)t=t&1?3988292384^t>>>1:t>>>1;s[e]=t}return s},Ps=new Uint32Array(Rs()),Hs=(t,s,e,i)=>{let n=Ps,a=i+e;t^=-1;for(let r=i;r<a;r++)t=t>>>8^n[(t^s[r])&255];return t^-1},B=Hs,ve={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ie={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Ws,_tr_stored_block:Qt,_tr_flush_block:Zs,_tr_tally:oe,_tr_align:Us}=Os,{Z_NO_FLUSH:le,Z_PARTIAL_FLUSH:js,Z_FULL_FLUSH:Gs,Z_FINISH:W,Z_BLOCK:Ni,Z_OK:z,Z_STREAM_END:Ri,Z_STREAM_ERROR:Y,Z_DATA_ERROR:qs,Z_BUF_ERROR:Nt,Z_DEFAULT_COMPRESSION:Ys,Z_FILTERED:Xs,Z_HUFFMAN_ONLY:ot,Z_RLE:Qs,Z_FIXED:Js,Z_DEFAULT_STRATEGY:Ks,Z_UNKNOWN:ea,Z_DEFLATED:vt}=Ie,ta=9,ia=15,na=8,sa=29,aa=256,Jt=aa+1+sa,ra=30,oa=19,la=2*Jt+1,ca=15,L=3,re=258,X=re+L+1,da=32,De=42,li=57,Kt=69,ei=73,ti=91,ii=103,ge=113,ze=666,O=1,Le=2,me=3,Fe=4,fa=3,pe=(t,s)=>(t.msg=ve[s],s),Pi=t=>t*2-(t>4?9:0),ae=t=>{let s=t.length;for(;--s>=0;)t[s]=0},ha=t=>{let s,e,i,n=t.w_size;s=t.hash_size,i=s;do e=t.head[--i],t.head[i]=e>=n?e-n:0;while(--s);s=n,i=s;do e=t.prev[--i],t.prev[i]=e>=n?e-n:0;while(--s)},ua=(t,s,e)=>(s<<t.hash_shift^e)&t.hash_mask,ce=ua,R=t=>{let s=t.state,e=s.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.output.set(s.pending_buf.subarray(s.pending_out,s.pending_out+e),t.next_out),t.next_out+=e,s.pending_out+=e,t.total_out+=e,t.avail_out-=e,s.pending-=e,s.pending===0&&(s.pending_out=0))},P=(t,s)=>{Zs(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,s),t.block_start=t.strstart,R(t.strm)},A=(t,s)=>{t.pending_buf[t.pending++]=s},Be=(t,s)=>{t.pending_buf[t.pending++]=s>>>8&255,t.pending_buf[t.pending++]=s&255},ni=(t,s,e,i)=>{let n=t.avail_in;return n>i&&(n=i),n===0?0:(t.avail_in-=n,s.set(t.input.subarray(t.next_in,t.next_in+n),e),t.state.wrap===1?t.adler=Ue(t.adler,s,n,e):t.state.wrap===2&&(t.adler=B(t.adler,s,n,e)),t.next_in+=n,t.total_in+=n,n)},Mn=(t,s)=>{let e=t.max_chain_length,i=t.strstart,n,a,r=t.prev_length,o=t.nice_match,d=t.strstart>t.w_size-X?t.strstart-(t.w_size-X):0,l=t.window,c=t.w_mask,f=t.prev,p=t.strstart+re,h=l[i+r-1],u=l[i+r];t.prev_length>=t.good_match&&(e>>=2),o>t.lookahead&&(o=t.lookahead);do if(n=s,!(l[n+r]!==u||l[n+r-1]!==h||l[n]!==l[i]||l[++n]!==l[i+1])){i+=2,n++;do;while(l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&i<p);if(a=re-(p-i),i=p-re,a>r){if(t.match_start=s,r=a,a>=o)break;h=l[i+r-1],u=l[i+r]}}while((s=f[s&c])>d&&--e!==0);return r<=t.lookahead?r:t.lookahead},Te=t=>{let s=t.w_size,e,i,n;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=s+(s-X)&&(t.window.set(t.window.subarray(s,s+s-i),0),t.match_start-=s,t.strstart-=s,t.block_start-=s,t.insert>t.strstart&&(t.insert=t.strstart),ha(t),i+=s),t.strm.avail_in===0)break;if(e=ni(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=e,t.lookahead+t.insert>=L)for(n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=ce(t,t.ins_h,t.window[n+1]);t.insert&&(t.ins_h=ce(t,t.ins_h,t.window[n+L-1]),t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,!(t.lookahead+t.insert<L)););}while(t.lookahead<X&&t.strm.avail_in!==0)},Bn=(t,s)=>{let e=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,i,n,a,r=0,o=t.strm.avail_in;do{if(i=65535,a=t.bi_valid+42>>3,t.strm.avail_out<a||(a=t.strm.avail_out-a,n=t.strstart-t.block_start,i>n+t.strm.avail_in&&(i=n+t.strm.avail_in),i>a&&(i=a),i<e&&(i===0&&s!==W||s===le||i!==n+t.strm.avail_in)))break;r=s===W&&i===n+t.strm.avail_in?1:0,Qt(t,0,0,r),t.pending_buf[t.pending-4]=i,t.pending_buf[t.pending-3]=i>>8,t.pending_buf[t.pending-2]=~i,t.pending_buf[t.pending-1]=~i>>8,R(t.strm),n&&(n>i&&(n=i),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+n),t.strm.next_out),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n,t.block_start+=n,i-=n),i&&(ni(t.strm,t.strm.output,t.strm.next_out,i),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i)}while(r===0);return o-=t.strm.avail_in,o&&(o>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=o&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-o,t.strm.next_in),t.strstart),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),r?Fe:s!==le&&s!==W&&t.strm.avail_in===0&&t.strstart===t.block_start?Le:(a=t.window_size-t.strstart,t.strm.avail_in>a&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,a+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),a>t.strm.avail_in&&(a=t.strm.avail_in),a&&(ni(t.strm,t.window,t.strstart,a),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.high_water<t.strstart&&(t.high_water=t.strstart),a=t.bi_valid+42>>3,a=t.pending_buf_size-a>65535?65535:t.pending_buf_size-a,e=a>t.w_size?t.w_size:a,n=t.strstart-t.block_start,(n>=e||(n||s===W)&&s!==le&&t.strm.avail_in===0&&n<=a)&&(i=n>a?a:n,r=s===W&&t.strm.avail_in===0&&i===n?1:0,Qt(t,t.block_start,i,r),t.block_start+=i,R(t.strm)),r?me:O)},Rt=(t,s)=>{let e,i;for(;;){if(t.lookahead<X){if(Te(t),t.lookahead<X&&s===le)return O;if(t.lookahead===0)break}if(e=0,t.lookahead>=L&&(t.ins_h=ce(t,t.ins_h,t.window[t.strstart+L-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),e!==0&&t.strstart-e<=t.w_size-X&&(t.match_length=Mn(t,e)),t.match_length>=L)if(i=oe(t,t.strstart-t.match_start,t.match_length-L),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=L){t.match_length--;do t.strstart++,t.ins_h=ce(t,t.ins_h,t.window[t.strstart+L-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=ce(t,t.ins_h,t.window[t.strstart+1]);else i=oe(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(P(t,!1),t.strm.avail_out===0))return O}return t.insert=t.strstart<L-1?t.strstart:L-1,s===W?(P(t,!0),t.strm.avail_out===0?me:Fe):t.sym_next&&(P(t,!1),t.strm.avail_out===0)?O:Le},Se=(t,s)=>{let e,i,n;for(;;){if(t.lookahead<X){if(Te(t),t.lookahead<X&&s===le)return O;if(t.lookahead===0)break}if(e=0,t.lookahead>=L&&(t.ins_h=ce(t,t.ins_h,t.window[t.strstart+L-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=L-1,e!==0&&t.prev_length<t.max_lazy_match&&t.strstart-e<=t.w_size-X&&(t.match_length=Mn(t,e),t.match_length<=5&&(t.strategy===Xs||t.match_length===L&&t.strstart-t.match_start>4096)&&(t.match_length=L-1)),t.prev_length>=L&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-L,i=oe(t,t.strstart-1-t.prev_match,t.prev_length-L),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=n&&(t.ins_h=ce(t,t.ins_h,t.window[t.strstart+L-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=L-1,t.strstart++,i&&(P(t,!1),t.strm.avail_out===0))return O}else if(t.match_available){if(i=oe(t,0,t.window[t.strstart-1]),i&&P(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return O}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=oe(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<L-1?t.strstart:L-1,s===W?(P(t,!0),t.strm.avail_out===0?me:Fe):t.sym_next&&(P(t,!1),t.strm.avail_out===0)?O:Le},ga=(t,s)=>{let e,i,n,a,r=t.window;for(;;){if(t.lookahead<=re){if(Te(t),t.lookahead<=re&&s===le)return O;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=L&&t.strstart>0&&(n=t.strstart-1,i=r[n],i===r[++n]&&i===r[++n]&&i===r[++n])){a=t.strstart+re;do;while(i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&i===r[++n]&&n<a);t.match_length=re-(a-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=L?(e=oe(t,1,t.match_length-L),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(e=oe(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),e&&(P(t,!1),t.strm.avail_out===0))return O}return t.insert=0,s===W?(P(t,!0),t.strm.avail_out===0?me:Fe):t.sym_next&&(P(t,!1),t.strm.avail_out===0)?O:Le},pa=(t,s)=>{let e;for(;;){if(t.lookahead===0&&(Te(t),t.lookahead===0)){if(s===le)return O;break}if(t.match_length=0,e=oe(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,e&&(P(t,!1),t.strm.avail_out===0))return O}return t.insert=0,s===W?(P(t,!0),t.strm.avail_out===0?me:Fe):t.sym_next&&(P(t,!1),t.strm.avail_out===0)?O:Le};function G(t,s,e,i,n){this.good_length=t,this.max_lazy=s,this.nice_length=e,this.max_chain=i,this.func=n}var $e=[new G(0,0,0,0,Bn),new G(4,4,8,4,Rt),new G(4,5,16,8,Rt),new G(4,6,32,32,Rt),new G(4,4,16,16,Se),new G(8,16,32,32,Se),new G(8,16,128,128,Se),new G(8,32,128,256,Se),new G(32,128,258,1024,Se),new G(32,258,258,4096,Se)],va=t=>{t.window_size=2*t.w_size,ae(t.head),t.max_lazy_match=$e[t.level].max_lazy,t.good_match=$e[t.level].good_length,t.nice_match=$e[t.level].nice_length,t.max_chain_length=$e[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=L-1,t.match_available=0,t.ins_h=0};function ma(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=vt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(la*2),this.dyn_dtree=new Uint16Array((2*ra+1)*2),this.bl_tree=new Uint16Array((2*oa+1)*2),ae(this.dyn_ltree),ae(this.dyn_dtree),ae(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(ca+1),this.heap=new Uint16Array(2*Jt+1),ae(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Jt+1),ae(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Xe=t=>{if(!t)return 1;let s=t.state;return!s||s.strm!==t||s.status!==De&&s.status!==li&&s.status!==Kt&&s.status!==ei&&s.status!==ti&&s.status!==ii&&s.status!==ge&&s.status!==ze?1:0},zn=t=>{if(Xe(t))return pe(t,Y);t.total_in=t.total_out=0,t.data_type=ea;let s=t.state;return s.pending=0,s.pending_out=0,s.wrap<0&&(s.wrap=-s.wrap),s.status=s.wrap===2?li:s.wrap?De:ge,t.adler=s.wrap===2?0:1,s.last_flush=-2,Ws(s),z},$n=t=>{let s=zn(t);return s===z&&va(t.state),s},wa=(t,s)=>Xe(t)||t.state.wrap!==2?Y:(t.state.gzhead=s,z),On=(t,s,e,i,n,a)=>{if(!t)return Y;let r=1;if(s===Ys&&(s=6),i<0?(r=0,i=-i):i>15&&(r=2,i-=16),n<1||n>ta||e!==vt||i<8||i>15||s<0||s>9||a<0||a>Js||i===8&&r!==1)return pe(t,Y);i===8&&(i=9);let o=new ma;return t.state=o,o.strm=t,o.status=De,o.wrap=r,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+L-1)/L),o.window=new Uint8Array(o.w_size*2),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=(o.lit_bufsize-1)*3,o.level=s,o.strategy=a,o.method=e,$n(t)},_a=(t,s)=>On(t,s,vt,ia,na,Ks),xa=(t,s)=>{if(Xe(t)||s>Ni||s<0)return t?pe(t,Y):Y;let e=t.state;if(!t.output||t.avail_in!==0&&!t.input||e.status===ze&&s!==W)return pe(t,t.avail_out===0?Nt:Y);let i=e.last_flush;if(e.last_flush=s,e.pending!==0){if(R(t),t.avail_out===0)return e.last_flush=-1,z}else if(t.avail_in===0&&Pi(s)<=Pi(i)&&s!==W)return pe(t,Nt);if(e.status===ze&&t.avail_in!==0)return pe(t,Nt);if(e.status===De&&e.wrap===0&&(e.status=ge),e.status===De){let n=vt+(e.w_bits-8<<4)<<8,a=-1;if(e.strategy>=ot||e.level<2?a=0:e.level<6?a=1:e.level===6?a=2:a=3,n|=a<<6,e.strstart!==0&&(n|=da),n+=31-n%31,Be(e,n),e.strstart!==0&&(Be(e,t.adler>>>16),Be(e,t.adler&65535)),t.adler=1,e.status=ge,R(t),e.pending!==0)return e.last_flush=-1,z}if(e.status===li){if(t.adler=0,A(e,31),A(e,139),A(e,8),e.gzhead)A(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),A(e,e.gzhead.time&255),A(e,e.gzhead.time>>8&255),A(e,e.gzhead.time>>16&255),A(e,e.gzhead.time>>24&255),A(e,e.level===9?2:e.strategy>=ot||e.level<2?4:0),A(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(A(e,e.gzhead.extra.length&255),A(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(t.adler=B(t.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=Kt;else if(A(e,0),A(e,0),A(e,0),A(e,0),A(e,0),A(e,e.level===9?2:e.strategy>=ot||e.level<2?4:0),A(e,fa),e.status=ge,R(t),e.pending!==0)return e.last_flush=-1,z}if(e.status===Kt){if(e.gzhead.extra){let n=e.pending,a=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+a>e.pending_buf_size;){let o=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+o),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>n&&(t.adler=B(t.adler,e.pending_buf,e.pending-n,n)),e.gzindex+=o,R(t),e.pending!==0)return e.last_flush=-1,z;n=0,a-=o}let r=new Uint8Array(e.gzhead.extra);e.pending_buf.set(r.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending+=a,e.gzhead.hcrc&&e.pending>n&&(t.adler=B(t.adler,e.pending_buf,e.pending-n,n)),e.gzindex=0}e.status=ei}if(e.status===ei){if(e.gzhead.name){let n=e.pending,a;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>n&&(t.adler=B(t.adler,e.pending_buf,e.pending-n,n)),R(t),e.pending!==0)return e.last_flush=-1,z;n=0}e.gzindex<e.gzhead.name.length?a=e.gzhead.name.charCodeAt(e.gzindex++)&255:a=0,A(e,a)}while(a!==0);e.gzhead.hcrc&&e.pending>n&&(t.adler=B(t.adler,e.pending_buf,e.pending-n,n)),e.gzindex=0}e.status=ti}if(e.status===ti){if(e.gzhead.comment){let n=e.pending,a;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>n&&(t.adler=B(t.adler,e.pending_buf,e.pending-n,n)),R(t),e.pending!==0)return e.last_flush=-1,z;n=0}e.gzindex<e.gzhead.comment.length?a=e.gzhead.comment.charCodeAt(e.gzindex++)&255:a=0,A(e,a)}while(a!==0);e.gzhead.hcrc&&e.pending>n&&(t.adler=B(t.adler,e.pending_buf,e.pending-n,n))}e.status=ii}if(e.status===ii){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(R(t),e.pending!==0))return e.last_flush=-1,z;A(e,t.adler&255),A(e,t.adler>>8&255),t.adler=0}if(e.status=ge,R(t),e.pending!==0)return e.last_flush=-1,z}if(t.avail_in!==0||e.lookahead!==0||s!==le&&e.status!==ze){let n=e.level===0?Bn(e,s):e.strategy===ot?pa(e,s):e.strategy===Qs?ga(e,s):$e[e.level].func(e,s);if((n===me||n===Fe)&&(e.status=ze),n===O||n===me)return t.avail_out===0&&(e.last_flush=-1),z;if(n===Le&&(s===js?Us(e):s!==Ni&&(Qt(e,0,0,!1),s===Gs&&(ae(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),R(t),t.avail_out===0))return e.last_flush=-1,z}return s!==W?z:e.wrap<=0?Ri:(e.wrap===2?(A(e,t.adler&255),A(e,t.adler>>8&255),A(e,t.adler>>16&255),A(e,t.adler>>24&255),A(e,t.total_in&255),A(e,t.total_in>>8&255),A(e,t.total_in>>16&255),A(e,t.total_in>>24&255)):(Be(e,t.adler>>>16),Be(e,t.adler&65535)),R(t),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?z:Ri)},ba=t=>{if(Xe(t))return Y;let s=t.state.status;return t.state=null,s===ge?pe(t,qs):z},Ea=(t,s)=>{let e=s.length;if(Xe(t))return Y;let i=t.state,n=i.wrap;if(n===2||n===1&&i.status!==De||i.lookahead)return Y;if(n===1&&(t.adler=Ue(t.adler,s,e,0)),i.wrap=0,e>=i.w_size){n===0&&(ae(i.head),i.strstart=0,i.block_start=0,i.insert=0);let d=new Uint8Array(i.w_size);d.set(s.subarray(e-i.w_size,e),0),s=d,e=i.w_size}let a=t.avail_in,r=t.next_in,o=t.input;for(t.avail_in=e,t.next_in=0,t.input=s,Te(i);i.lookahead>=L;){let d=i.strstart,l=i.lookahead-(L-1);do i.ins_h=ce(i,i.ins_h,i.window[d+L-1]),i.prev[d&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=d,d++;while(--l);i.strstart=d,i.lookahead=L-1,Te(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=L-1,i.match_available=0,t.next_in=r,t.input=o,t.avail_in=a,i.wrap=n,z},ya=_a,Sa=On,Ca=$n,ka=zn,Da=wa,Ta=xa,Va=ba,Ia=Ea,La="pako deflate (from Nodeca project)",Ne={deflateInit:ya,deflateInit2:Sa,deflateReset:Ca,deflateResetKeep:ka,deflateSetHeader:Da,deflate:Ta,deflateEnd:Va,deflateSetDictionary:Ia,deflateInfo:La},Fa=(t,s)=>Object.prototype.hasOwnProperty.call(t,s),Aa=function(t){let s=Array.prototype.slice.call(arguments,1);for(;s.length;){let e=s.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(let i in e)Fa(e,i)&&(t[i]=e[i])}}return t},Ma=t=>{let s=0;for(let i=0,n=t.length;i<n;i++)s+=t[i].length;let e=new Uint8Array(s);for(let i=0,n=0,a=t.length;i<a;i++){let r=t[i];e.set(r,n),n+=r.length}return e},mt={assign:Aa,flattenChunks:Ma},Nn=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Nn=!1}var je=new Uint8Array(256);for(let t=0;t<256;t++)je[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;je[254]=je[254]=1;var Ba=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let s,e,i,n,a,r=t.length,o=0;for(n=0;n<r;n++)e=t.charCodeAt(n),(e&64512)===55296&&n+1<r&&(i=t.charCodeAt(n+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),n++)),o+=e<128?1:e<2048?2:e<65536?3:4;for(s=new Uint8Array(o),a=0,n=0;a<o;n++)e=t.charCodeAt(n),(e&64512)===55296&&n+1<r&&(i=t.charCodeAt(n+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),n++)),e<128?s[a++]=e:e<2048?(s[a++]=192|e>>>6,s[a++]=128|e&63):e<65536?(s[a++]=224|e>>>12,s[a++]=128|e>>>6&63,s[a++]=128|e&63):(s[a++]=240|e>>>18,s[a++]=128|e>>>12&63,s[a++]=128|e>>>6&63,s[a++]=128|e&63);return s},za=(t,s)=>{if(s<65534&&t.subarray&&Nn)return String.fromCharCode.apply(null,t.length===s?t:t.subarray(0,s));let e="";for(let i=0;i<s;i++)e+=String.fromCharCode(t[i]);return e},$a=(t,s)=>{let e=s||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,s));let i,n,a=new Array(e*2);for(n=0,i=0;i<e;){let r=t[i++];if(r<128){a[n++]=r;continue}let o=je[r];if(o>4){a[n++]=65533,i+=o-1;continue}for(r&=o===2?31:o===3?15:7;o>1&&i<e;)r=r<<6|t[i++]&63,o--;if(o>1){a[n++]=65533;continue}r<65536?a[n++]=r:(r-=65536,a[n++]=55296|r>>10&1023,a[n++]=56320|r&1023)}return za(a,n)},Oa=(t,s)=>{s=s||t.length,s>t.length&&(s=t.length);let e=s-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?s:e+je[t[e]]>s?e:s},Ge={string2buf:Ba,buf2string:$a,utf8border:Oa};function Na(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Rn=Na,Pn=Object.prototype.toString,{Z_NO_FLUSH:Ra,Z_SYNC_FLUSH:Pa,Z_FULL_FLUSH:Ha,Z_FINISH:Wa,Z_OK:gt,Z_STREAM_END:Za,Z_DEFAULT_COMPRESSION:Ua,Z_DEFAULT_STRATEGY:ja,Z_DEFLATED:Ga}=Ie;function Qe(t){this.options=mt.assign({level:Ua,method:Ga,chunkSize:16384,windowBits:15,memLevel:8,strategy:ja},t||{});let s=this.options;s.raw&&s.windowBits>0?s.windowBits=-s.windowBits:s.gzip&&s.windowBits>0&&s.windowBits<16&&(s.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Rn,this.strm.avail_out=0;let e=Ne.deflateInit2(this.strm,s.level,s.method,s.windowBits,s.memLevel,s.strategy);if(e!==gt)throw new Error(ve[e]);if(s.header&&Ne.deflateSetHeader(this.strm,s.header),s.dictionary){let i;if(typeof s.dictionary=="string"?i=Ge.string2buf(s.dictionary):Pn.call(s.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(s.dictionary):i=s.dictionary,e=Ne.deflateSetDictionary(this.strm,i),e!==gt)throw new Error(ve[e]);this._dict_set=!0}}Qe.prototype.push=function(t,s){let e=this.strm,i=this.options.chunkSize,n,a;if(this.ended)return!1;for(s===~~s?a=s:a=s===!0?Wa:Ra,typeof t=="string"?e.input=Ge.string2buf(t):Pn.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),(a===Pa||a===Ha)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(n=Ne.deflate(e,a),n===Za)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),n=Ne.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===gt;if(e.avail_out===0){this.onData(e.output);continue}if(a>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};Qe.prototype.onData=function(t){this.chunks.push(t)};Qe.prototype.onEnd=function(t){t===gt&&(this.result=mt.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function ci(t,s){let e=new Qe(s);if(e.push(t,!0),e.err)throw e.msg||ve[e.err];return e.result}function qa(t,s){return s=s||{},s.raw=!0,ci(t,s)}function Ya(t,s){return s=s||{},s.gzip=!0,ci(t,s)}var Xa=Qe,Qa=ci,Ja=qa,Ka=Ya,er=Ie,tr={Deflate:Xa,deflate:Qa,deflateRaw:Ja,gzip:Ka,constants:er},lt=16209,ir=16191,nr=function(s,e){let i,n,a,r,o,d,l,c,f,p,h,u,g,v,w,_,x,m,y,D,E,C,k,S,T=s.state;i=s.next_in,k=s.input,n=i+(s.avail_in-5),a=s.next_out,S=s.output,r=a-(e-s.avail_out),o=a+(s.avail_out-257),d=T.dmax,l=T.wsize,c=T.whave,f=T.wnext,p=T.window,h=T.hold,u=T.bits,g=T.lencode,v=T.distcode,w=(1<<T.lenbits)-1,_=(1<<T.distbits)-1;e:do{u<15&&(h+=k[i++]<<u,u+=8,h+=k[i++]<<u,u+=8),x=g[h&w];t:for(;;){if(m=x>>>24,h>>>=m,u-=m,m=x>>>16&255,m===0)S[a++]=x&65535;else if(m&16){y=x&65535,m&=15,m&&(u<m&&(h+=k[i++]<<u,u+=8),y+=h&(1<<m)-1,h>>>=m,u-=m),u<15&&(h+=k[i++]<<u,u+=8,h+=k[i++]<<u,u+=8),x=v[h&_];i:for(;;){if(m=x>>>24,h>>>=m,u-=m,m=x>>>16&255,m&16){if(D=x&65535,m&=15,u<m&&(h+=k[i++]<<u,u+=8,u<m&&(h+=k[i++]<<u,u+=8)),D+=h&(1<<m)-1,D>d){s.msg="invalid distance too far back",T.mode=lt;break e}if(h>>>=m,u-=m,m=a-r,D>m){if(m=D-m,m>c&&T.sane){s.msg="invalid distance too far back",T.mode=lt;break e}if(E=0,C=p,f===0){if(E+=l-m,m<y){y-=m;do S[a++]=p[E++];while(--m);E=a-D,C=S}}else if(f<m){if(E+=l+f-m,m-=f,m<y){y-=m;do S[a++]=p[E++];while(--m);if(E=0,f<y){m=f,y-=m;do S[a++]=p[E++];while(--m);E=a-D,C=S}}}else if(E+=f-m,m<y){y-=m;do S[a++]=p[E++];while(--m);E=a-D,C=S}for(;y>2;)S[a++]=C[E++],S[a++]=C[E++],S[a++]=C[E++],y-=3;y&&(S[a++]=C[E++],y>1&&(S[a++]=C[E++]))}else{E=a-D;do S[a++]=S[E++],S[a++]=S[E++],S[a++]=S[E++],y-=3;while(y>2);y&&(S[a++]=S[E++],y>1&&(S[a++]=S[E++]))}}else if(m&64){s.msg="invalid distance code",T.mode=lt;break e}else{x=v[(x&65535)+(h&(1<<m)-1)];continue i}break}}else if(m&64)if(m&32){T.mode=ir;break e}else{s.msg="invalid literal/length code",T.mode=lt;break e}else{x=g[(x&65535)+(h&(1<<m)-1)];continue t}break}}while(i<n&&a<o);y=u>>3,i-=y,u-=y<<3,h&=(1<<u)-1,s.next_in=i,s.next_out=a,s.avail_in=i<n?5+(n-i):5-(i-n),s.avail_out=a<o?257+(o-a):257-(a-o),T.hold=h,T.bits=u},Ce=15,Hi=852,Wi=592,Zi=0,Pt=1,Ui=2,sr=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ar=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),rr=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),or=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),lr=(t,s,e,i,n,a,r,o)=>{let d=o.bits,l=0,c=0,f=0,p=0,h=0,u=0,g=0,v=0,w=0,_=0,x,m,y,D,E,C=null,k,S=new Uint16Array(Ce+1),T=new Uint16Array(Ce+1),V=null,F,I,U;for(l=0;l<=Ce;l++)S[l]=0;for(c=0;c<i;c++)S[s[e+c]]++;for(h=d,p=Ce;p>=1&&S[p]===0;p--);if(h>p&&(h=p),p===0)return n[a++]=1<<24|64<<16|0,n[a++]=1<<24|64<<16|0,o.bits=1,0;for(f=1;f<p&&S[f]===0;f++);for(h<f&&(h=f),v=1,l=1;l<=Ce;l++)if(v<<=1,v-=S[l],v<0)return-1;if(v>0&&(t===Zi||p!==1))return-1;for(T[1]=0,l=1;l<Ce;l++)T[l+1]=T[l]+S[l];for(c=0;c<i;c++)s[e+c]!==0&&(r[T[s[e+c]]++]=c);if(t===Zi?(C=V=r,k=20):t===Pt?(C=sr,V=ar,k=257):(C=rr,V=or,k=0),_=0,c=0,l=f,E=a,u=h,g=0,y=-1,w=1<<h,D=w-1,t===Pt&&w>Hi||t===Ui&&w>Wi)return 1;for(;;){F=l-g,r[c]+1<k?(I=0,U=r[c]):r[c]>=k?(I=V[r[c]-k],U=C[r[c]-k]):(I=32+64,U=0),x=1<<l-g,m=1<<u,f=m;do m-=x,n[E+(_>>g)+m]=F<<24|I<<16|U|0;while(m!==0);for(x=1<<l-1;_&x;)x>>=1;if(x!==0?(_&=x-1,_+=x):_=0,c++,--S[l]===0){if(l===p)break;l=s[e+r[c]]}if(l>h&&(_&D)!==y){for(g===0&&(g=h),E+=f,u=l-g,v=1<<u;u+g<p&&(v-=S[u+g],!(v<=0));)u++,v<<=1;if(w+=1<<u,t===Pt&&w>Hi||t===Ui&&w>Wi)return 1;y=_&D,n[y]=h<<24|u<<16|E-a|0}}return _!==0&&(n[E+_]=l-g<<24|64<<16|0),o.bits=h,0},Re=lr,cr=0,Hn=1,Wn=2,{Z_FINISH:ji,Z_BLOCK:dr,Z_TREES:ct,Z_OK:we,Z_STREAM_END:fr,Z_NEED_DICT:hr,Z_STREAM_ERROR:Z,Z_DATA_ERROR:Zn,Z_MEM_ERROR:Un,Z_BUF_ERROR:ur,Z_DEFLATED:Gi}=Ie,wt=16180,qi=16181,Yi=16182,Xi=16183,Qi=16184,Ji=16185,Ki=16186,en=16187,tn=16188,nn=16189,pt=16190,ee=16191,Ht=16192,sn=16193,Wt=16194,an=16195,rn=16196,on=16197,ln=16198,dt=16199,ft=16200,cn=16201,dn=16202,fn=16203,hn=16204,un=16205,Zt=16206,gn=16207,pn=16208,M=16209,jn=16210,Gn=16211,gr=852,pr=592,vr=15,mr=vr,vn=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function wr(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var _e=t=>{if(!t)return 1;let s=t.state;return!s||s.strm!==t||s.mode<wt||s.mode>Gn?1:0},qn=t=>{if(_e(t))return Z;let s=t.state;return t.total_in=t.total_out=s.total=0,t.msg="",s.wrap&&(t.adler=s.wrap&1),s.mode=wt,s.last=0,s.havedict=0,s.flags=-1,s.dmax=32768,s.head=null,s.hold=0,s.bits=0,s.lencode=s.lendyn=new Int32Array(gr),s.distcode=s.distdyn=new Int32Array(pr),s.sane=1,s.back=-1,we},Yn=t=>{if(_e(t))return Z;let s=t.state;return s.wsize=0,s.whave=0,s.wnext=0,qn(t)},Xn=(t,s)=>{let e;if(_e(t))return Z;let i=t.state;return s<0?(e=0,s=-s):(e=(s>>4)+5,s<48&&(s&=15)),s&&(s<8||s>15)?Z:(i.window!==null&&i.wbits!==s&&(i.window=null),i.wrap=e,i.wbits=s,Yn(t))},Qn=(t,s)=>{if(!t)return Z;let e=new wr;t.state=e,e.strm=t,e.window=null,e.mode=wt;let i=Xn(t,s);return i!==we&&(t.state=null),i},_r=t=>Qn(t,mr),mn=!0,Ut,jt,xr=t=>{if(mn){Ut=new Int32Array(512),jt=new Int32Array(32);let s=0;for(;s<144;)t.lens[s++]=8;for(;s<256;)t.lens[s++]=9;for(;s<280;)t.lens[s++]=7;for(;s<288;)t.lens[s++]=8;for(Re(Hn,t.lens,0,288,Ut,0,t.work,{bits:9}),s=0;s<32;)t.lens[s++]=5;Re(Wn,t.lens,0,32,jt,0,t.work,{bits:5}),mn=!1}t.lencode=Ut,t.lenbits=9,t.distcode=jt,t.distbits=5},Jn=(t,s,e,i)=>{let n,a=t.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(s.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(n=a.wsize-a.wnext,n>i&&(n=i),a.window.set(s.subarray(e-i,e-i+n),a.wnext),i-=n,i?(a.window.set(s.subarray(e-i,e),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0},br=(t,s)=>{let e,i,n,a,r,o,d,l,c,f,p,h,u,g,v=0,w,_,x,m,y,D,E,C,k=new Uint8Array(4),S,T,V=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(_e(t)||!t.output||!t.input&&t.avail_in!==0)return Z;e=t.state,e.mode===ee&&(e.mode=Ht),r=t.next_out,n=t.output,d=t.avail_out,a=t.next_in,i=t.input,o=t.avail_in,l=e.hold,c=e.bits,f=o,p=d,C=we;e:for(;;)switch(e.mode){case wt:if(e.wrap===0){e.mode=Ht;break}for(;c<16;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(e.wrap&2&&l===35615){e.wbits===0&&(e.wbits=15),e.check=0,k[0]=l&255,k[1]=l>>>8&255,e.check=B(e.check,k,2,0),l=0,c=0,e.mode=qi;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",e.mode=M;break}if((l&15)!==Gi){t.msg="unknown compression method",e.mode=M;break}if(l>>>=4,c-=4,E=(l&15)+8,e.wbits===0&&(e.wbits=E),E>15||E>e.wbits){t.msg="invalid window size",e.mode=M;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=l&512?nn:ee,l=0,c=0;break;case qi:for(;c<16;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(e.flags=l,(e.flags&255)!==Gi){t.msg="unknown compression method",e.mode=M;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=M;break}e.head&&(e.head.text=l>>8&1),e.flags&512&&e.wrap&4&&(k[0]=l&255,k[1]=l>>>8&255,e.check=B(e.check,k,2,0)),l=0,c=0,e.mode=Yi;case Yi:for(;c<32;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}e.head&&(e.head.time=l),e.flags&512&&e.wrap&4&&(k[0]=l&255,k[1]=l>>>8&255,k[2]=l>>>16&255,k[3]=l>>>24&255,e.check=B(e.check,k,4,0)),l=0,c=0,e.mode=Xi;case Xi:for(;c<16;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}e.head&&(e.head.xflags=l&255,e.head.os=l>>8),e.flags&512&&e.wrap&4&&(k[0]=l&255,k[1]=l>>>8&255,e.check=B(e.check,k,2,0)),l=0,c=0,e.mode=Qi;case Qi:if(e.flags&1024){for(;c<16;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}e.length=l,e.head&&(e.head.extra_len=l),e.flags&512&&e.wrap&4&&(k[0]=l&255,k[1]=l>>>8&255,e.check=B(e.check,k,2,0)),l=0,c=0}else e.head&&(e.head.extra=null);e.mode=Ji;case Ji:if(e.flags&1024&&(h=e.length,h>o&&(h=o),h&&(e.head&&(E=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(i.subarray(a,a+h),E)),e.flags&512&&e.wrap&4&&(e.check=B(e.check,i,h,a)),o-=h,a+=h,e.length-=h),e.length))break e;e.length=0,e.mode=Ki;case Ki:if(e.flags&2048){if(o===0)break e;h=0;do E=i[a+h++],e.head&&E&&e.length<65536&&(e.head.name+=String.fromCharCode(E));while(E&&h<o);if(e.flags&512&&e.wrap&4&&(e.check=B(e.check,i,h,a)),o-=h,a+=h,E)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=en;case en:if(e.flags&4096){if(o===0)break e;h=0;do E=i[a+h++],e.head&&E&&e.length<65536&&(e.head.comment+=String.fromCharCode(E));while(E&&h<o);if(e.flags&512&&e.wrap&4&&(e.check=B(e.check,i,h,a)),o-=h,a+=h,E)break e}else e.head&&(e.head.comment=null);e.mode=tn;case tn:if(e.flags&512){for(;c<16;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(e.wrap&4&&l!==(e.check&65535)){t.msg="header crc mismatch",e.mode=M;break}l=0,c=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=ee;break;case nn:for(;c<32;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}t.adler=e.check=vn(l),l=0,c=0,e.mode=pt;case pt:if(e.havedict===0)return t.next_out=r,t.avail_out=d,t.next_in=a,t.avail_in=o,e.hold=l,e.bits=c,hr;t.adler=e.check=1,e.mode=ee;case ee:if(s===dr||s===ct)break e;case Ht:if(e.last){l>>>=c&7,c-=c&7,e.mode=Zt;break}for(;c<3;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}switch(e.last=l&1,l>>>=1,c-=1,l&3){case 0:e.mode=sn;break;case 1:if(xr(e),e.mode=dt,s===ct){l>>>=2,c-=2;break e}break;case 2:e.mode=rn;break;case 3:t.msg="invalid block type",e.mode=M}l>>>=2,c-=2;break;case sn:for(l>>>=c&7,c-=c&7;c<32;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if((l&65535)!==(l>>>16^65535)){t.msg="invalid stored block lengths",e.mode=M;break}if(e.length=l&65535,l=0,c=0,e.mode=Wt,s===ct)break e;case Wt:e.mode=an;case an:if(h=e.length,h){if(h>o&&(h=o),h>d&&(h=d),h===0)break e;n.set(i.subarray(a,a+h),r),o-=h,a+=h,d-=h,r+=h,e.length-=h;break}e.mode=ee;break;case rn:for(;c<14;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(e.nlen=(l&31)+257,l>>>=5,c-=5,e.ndist=(l&31)+1,l>>>=5,c-=5,e.ncode=(l&15)+4,l>>>=4,c-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=M;break}e.have=0,e.mode=on;case on:for(;e.have<e.ncode;){for(;c<3;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}e.lens[V[e.have++]]=l&7,l>>>=3,c-=3}for(;e.have<19;)e.lens[V[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,S={bits:e.lenbits},C=Re(cr,e.lens,0,19,e.lencode,0,e.work,S),e.lenbits=S.bits,C){t.msg="invalid code lengths set",e.mode=M;break}e.have=0,e.mode=ln;case ln:for(;e.have<e.nlen+e.ndist;){for(;v=e.lencode[l&(1<<e.lenbits)-1],w=v>>>24,_=v>>>16&255,x=v&65535,!(w<=c);){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(x<16)l>>>=w,c-=w,e.lens[e.have++]=x;else{if(x===16){for(T=w+2;c<T;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(l>>>=w,c-=w,e.have===0){t.msg="invalid bit length repeat",e.mode=M;break}E=e.lens[e.have-1],h=3+(l&3),l>>>=2,c-=2}else if(x===17){for(T=w+3;c<T;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}l>>>=w,c-=w,E=0,h=3+(l&7),l>>>=3,c-=3}else{for(T=w+7;c<T;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}l>>>=w,c-=w,E=0,h=11+(l&127),l>>>=7,c-=7}if(e.have+h>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=M;break}for(;h--;)e.lens[e.have++]=E}}if(e.mode===M)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=M;break}if(e.lenbits=9,S={bits:e.lenbits},C=Re(Hn,e.lens,0,e.nlen,e.lencode,0,e.work,S),e.lenbits=S.bits,C){t.msg="invalid literal/lengths set",e.mode=M;break}if(e.distbits=6,e.distcode=e.distdyn,S={bits:e.distbits},C=Re(Wn,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,S),e.distbits=S.bits,C){t.msg="invalid distances set",e.mode=M;break}if(e.mode=dt,s===ct)break e;case dt:e.mode=ft;case ft:if(o>=6&&d>=258){t.next_out=r,t.avail_out=d,t.next_in=a,t.avail_in=o,e.hold=l,e.bits=c,nr(t,p),r=t.next_out,n=t.output,d=t.avail_out,a=t.next_in,i=t.input,o=t.avail_in,l=e.hold,c=e.bits,e.mode===ee&&(e.back=-1);break}for(e.back=0;v=e.lencode[l&(1<<e.lenbits)-1],w=v>>>24,_=v>>>16&255,x=v&65535,!(w<=c);){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(_&&!(_&240)){for(m=w,y=_,D=x;v=e.lencode[D+((l&(1<<m+y)-1)>>m)],w=v>>>24,_=v>>>16&255,x=v&65535,!(m+w<=c);){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}l>>>=m,c-=m,e.back+=m}if(l>>>=w,c-=w,e.back+=w,e.length=x,_===0){e.mode=un;break}if(_&32){e.back=-1,e.mode=ee;break}if(_&64){t.msg="invalid literal/length code",e.mode=M;break}e.extra=_&15,e.mode=cn;case cn:if(e.extra){for(T=e.extra;c<T;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}e.length+=l&(1<<e.extra)-1,l>>>=e.extra,c-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=dn;case dn:for(;v=e.distcode[l&(1<<e.distbits)-1],w=v>>>24,_=v>>>16&255,x=v&65535,!(w<=c);){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(!(_&240)){for(m=w,y=_,D=x;v=e.distcode[D+((l&(1<<m+y)-1)>>m)],w=v>>>24,_=v>>>16&255,x=v&65535,!(m+w<=c);){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}l>>>=m,c-=m,e.back+=m}if(l>>>=w,c-=w,e.back+=w,_&64){t.msg="invalid distance code",e.mode=M;break}e.offset=x,e.extra=_&15,e.mode=fn;case fn:if(e.extra){for(T=e.extra;c<T;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}e.offset+=l&(1<<e.extra)-1,l>>>=e.extra,c-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=M;break}e.mode=hn;case hn:if(d===0)break e;if(h=p-d,e.offset>h){if(h=e.offset-h,h>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=M;break}h>e.wnext?(h-=e.wnext,u=e.wsize-h):u=e.wnext-h,h>e.length&&(h=e.length),g=e.window}else g=n,u=r-e.offset,h=e.length;h>d&&(h=d),d-=h,e.length-=h;do n[r++]=g[u++];while(--h);e.length===0&&(e.mode=ft);break;case un:if(d===0)break e;n[r++]=e.length,d--,e.mode=ft;break;case Zt:if(e.wrap){for(;c<32;){if(o===0)break e;o--,l|=i[a++]<<c,c+=8}if(p-=d,t.total_out+=p,e.total+=p,e.wrap&4&&p&&(t.adler=e.check=e.flags?B(e.check,n,p,r-p):Ue(e.check,n,p,r-p)),p=d,e.wrap&4&&(e.flags?l:vn(l))!==e.check){t.msg="incorrect data check",e.mode=M;break}l=0,c=0}e.mode=gn;case gn:if(e.wrap&&e.flags){for(;c<32;){if(o===0)break e;o--,l+=i[a++]<<c,c+=8}if(e.wrap&4&&l!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=M;break}l=0,c=0}e.mode=pn;case pn:C=fr;break e;case M:C=Zn;break e;case jn:return Un;case Gn:default:return Z}return t.next_out=r,t.avail_out=d,t.next_in=a,t.avail_in=o,e.hold=l,e.bits=c,(e.wsize||p!==t.avail_out&&e.mode<M&&(e.mode<Zt||s!==ji))&&Jn(t,t.output,t.next_out,p-t.avail_out),f-=t.avail_in,p-=t.avail_out,t.total_in+=f,t.total_out+=p,e.total+=p,e.wrap&4&&p&&(t.adler=e.check=e.flags?B(e.check,n,p,t.next_out-p):Ue(e.check,n,p,t.next_out-p)),t.data_type=e.bits+(e.last?64:0)+(e.mode===ee?128:0)+(e.mode===dt||e.mode===Wt?256:0),(f===0&&p===0||s===ji)&&C===we&&(C=ur),C},Er=t=>{if(_e(t))return Z;let s=t.state;return s.window&&(s.window=null),t.state=null,we},yr=(t,s)=>{if(_e(t))return Z;let e=t.state;return e.wrap&2?(e.head=s,s.done=!1,we):Z},Sr=(t,s)=>{let e=s.length,i,n,a;return _e(t)||(i=t.state,i.wrap!==0&&i.mode!==pt)?Z:i.mode===pt&&(n=1,n=Ue(n,s,e,0),n!==i.check)?Zn:(a=Jn(t,s,e,e),a?(i.mode=jn,Un):(i.havedict=1,we))},Cr=Yn,kr=Xn,Dr=qn,Tr=_r,Vr=Qn,Ir=br,Lr=Er,Fr=yr,Ar=Sr,Mr="pako inflate (from Nodeca project)",ie={inflateReset:Cr,inflateReset2:kr,inflateResetKeep:Dr,inflateInit:Tr,inflateInit2:Vr,inflate:Ir,inflateEnd:Lr,inflateGetHeader:Fr,inflateSetDictionary:Ar,inflateInfo:Mr};function Br(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var zr=Br,Kn=Object.prototype.toString,{Z_NO_FLUSH:$r,Z_FINISH:Or,Z_OK:qe,Z_STREAM_END:Gt,Z_NEED_DICT:qt,Z_STREAM_ERROR:Nr,Z_DATA_ERROR:wn,Z_MEM_ERROR:Rr}=Ie;function Je(t){this.options=mt.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});let s=this.options;s.raw&&s.windowBits>=0&&s.windowBits<16&&(s.windowBits=-s.windowBits,s.windowBits===0&&(s.windowBits=-15)),s.windowBits>=0&&s.windowBits<16&&!(t&&t.windowBits)&&(s.windowBits+=32),s.windowBits>15&&s.windowBits<48&&(s.windowBits&15||(s.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Rn,this.strm.avail_out=0;let e=ie.inflateInit2(this.strm,s.windowBits);if(e!==qe)throw new Error(ve[e]);if(this.header=new zr,ie.inflateGetHeader(this.strm,this.header),s.dictionary&&(typeof s.dictionary=="string"?s.dictionary=Ge.string2buf(s.dictionary):Kn.call(s.dictionary)==="[object ArrayBuffer]"&&(s.dictionary=new Uint8Array(s.dictionary)),s.raw&&(e=ie.inflateSetDictionary(this.strm,s.dictionary),e!==qe)))throw new Error(ve[e])}Je.prototype.push=function(t,s){let e=this.strm,i=this.options.chunkSize,n=this.options.dictionary,a,r,o;if(this.ended)return!1;for(s===~~s?r=s:r=s===!0?Or:$r,Kn.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),a=ie.inflate(e,r),a===qt&&n&&(a=ie.inflateSetDictionary(e,n),a===qe?a=ie.inflate(e,r):a===wn&&(a=qt));e.avail_in>0&&a===Gt&&e.state.wrap>0&&t[e.next_in]!==0;)ie.inflateReset(e),a=ie.inflate(e,r);switch(a){case Nr:case wn:case qt:case Rr:return this.onEnd(a),this.ended=!0,!1}if(o=e.avail_out,e.next_out&&(e.avail_out===0||a===Gt))if(this.options.to==="string"){let d=Ge.utf8border(e.output,e.next_out),l=e.next_out-d,c=Ge.buf2string(e.output,d);e.next_out=l,e.avail_out=i-l,l&&e.output.set(e.output.subarray(d,d+l),0),this.onData(c)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(a===qe&&o===0)){if(a===Gt)return a=ie.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Je.prototype.onData=function(t){this.chunks.push(t)};Je.prototype.onEnd=function(t){t===qe&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=mt.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function di(t,s){let e=new Je(s);if(e.push(t),e.err)throw e.msg||ve[e.err];return e.result}function Pr(t,s){return s=s||{},s.raw=!0,di(t,s)}var Hr=Je,Wr=di,Zr=Pr,Ur=di,jr=Ie,Gr={Inflate:Hr,inflate:Wr,inflateRaw:Zr,ungzip:Ur,constants:jr},{Deflate:Mo,deflate:Bo,deflateRaw:zo,gzip:qr}=tr,{Inflate:$o,inflate:Oo,inflateRaw:No,ungzip:Yr}=Gr;var es=qr;var fi=Yr;var Qr={versionFolder:".versions",autoSave:!0,autoSaveInterval:5,autoClear:!0,maxVersions:50,enableMaxVersions:!0,maxDays:30,enableMaxDays:!1,useRelativeTime:!1,diffGranularity:"line",diffViewMode:"unified",enableDeduplication:!0,showNotifications:!0,excludedFolders:[],enableCompression:!0,enableIncrementalStorage:!0,versionsPerPage:20,rebuildBaseInterval:10,autoSaveOnModify:!0,autoSaveMinChanges:10,autoSaveOnInterval:!1,autoSaveOnFileSwitch:!0,autoSaveOnFocusLost:!1,autoSaveDelayOnModify:180,autoSaveDelayOnFileSwitch:2,autoSaveDelayOnFocusLost:2,enableQuickPreview:!0,enableVersionTags:!0,defaultTags:["\u91CD\u8981","\u91CC\u7A0B\u7891","\u53D1\u5E03","\u5907\u4EFD","\u8349\u7A3F"],showVersionStats:!0,enableStatusBarDiff:!0,showLastSaveTimeInStatusBar:!0,inlineDiffAlgorithm:"word",smartWordDiff:!0,diffShowOnlyChanges:!0},_t=class extends b.Plugin{constructor(){super(...arguments);this.autoSaveTimer=null;this.lastModifiedTime=new Map;this.pendingSaves=new Map;this.versionCache=new Map;this.previousActiveFile=null;this.globalTimeUpdater=null}async onload(){await this.loadSettings(),this.statusBarItem=this.addStatusBarItem(),this.updateStatusBar(),this.settings.enableStatusBarDiff&&(this.statusBarItem.addClass("version-control-statusbar-clickable"),this.statusBarItem.addEventListener("click",()=>{this.quickDiffFromStatusBar()})),this.registerView("version-history",e=>new Ke(e,this)),this.addRibbonIcon("history","\u7248\u672C\u5386\u53F2",()=>{this.activateVersionHistoryView()}),this.addCommand({id:"create-version",name:"\u521B\u5EFA\u7248\u672C\u5FEB\u7167",callback:()=>this.createManualVersion()}),this.addCommand({id:"show-version-history",name:"\u663E\u793A\u7248\u672C\u5386\u53F2",callback:()=>this.activateVersionHistoryView()}),this.addCommand({id:"create-full-snapshot",name:"\u521B\u5EFA\u5168\u5E93\u7248\u672C",callback:()=>this.createFullSnapshot()}),this.addCommand({id:"compare-with-version",name:"\u4E0E\u5386\u53F2\u7248\u672C\u5BF9\u6BD4",callback:()=>this.quickCompare()}),this.addCommand({id:"restore-last-version",name:"\u6062\u590D\u5230\u4E0A\u4E00\u7248\u672C",callback:()=>this.restoreLastVersion()}),this.addCommand({id:"optimize-storage",name:"\u4F18\u5316\u5B58\u50A8\u7A7A\u95F4",callback:()=>this.optimizeAllVersionFiles()}),this.addCommand({id:"quick-preview-version",name:"\u5FEB\u901F\u9884\u89C8\u4E0A\u4E00\u7248\u672C",callback:()=>this.quickPreviewLastVersion()}),this.addCommand({id:"star-current-version",name:"\u6807\u8BB0\u5F53\u524D\u7248\u672C\u4E3A\u91CD\u8981",callback:()=>this.starLastVersion()}),this.addSettingTab(new mi(this.app,this)),this.registerEvent(this.app.vault.on("modify",e=>{e instanceof b.TFile&&this.settings.autoSave&&this.settings.autoSaveOnModify&&this.handleFileModify(e)})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.settings.autoSave&&this.settings.autoSaveOnFileSwitch&&this.handleFileSwitch(),this.updateStatusBar()})),this.settings.autoSaveOnFocusLost&&this.registerDomEvent(window,"blur",()=>{this.settings.autoSave&&this.handleFocusLost()}),this.settings.autoSave&&this.settings.autoSaveOnInterval&&this.startAutoSave(),await this.ensureVersionFolder(),this.globalTimeUpdater=window.setInterval(()=>{this.updateAllRelativeTimes()},6e4),this.settings.showNotifications&&new b.Notice("\u2705 \u7248\u672C\u63A7\u5236\u63D2\u4EF6\u5DF2\u542F\u52A8")}onunload(){this.autoSaveTimer&&window.clearInterval(this.autoSaveTimer),this.globalTimeUpdater&&window.clearInterval(this.globalTimeUpdater),this.pendingSaves.forEach(e=>clearTimeout(e)),this.pendingSaves.clear(),this.versionCache.clear()}async loadSettings(){this.settings=Object.assign({},Qr,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.updateStatusBar()}updateAllRelativeTimes(){this.app.workspace.getActiveFile()&&(this.settings.useRelativeTime||this.settings.showLastSaveTimeInStatusBar)&&(this.updateStatusBar(),this.app.workspace.getLeavesOfType("version-history").forEach(n=>{n.view instanceof Ke&&n.view.updateRelativeTimes()}))}getSaveTypeLabel(e){return e.includes("[Auto Save - On Modify]")?"\u4FEE\u6539\u4FDD\u5B58":e.includes("[Auto Save - Interval]")?"\u5B9A\u65F6\u4FDD\u5B58":e.includes("[Auto Save - File Switch]")?"\u5207\u6362\u4FDD\u5B58":e.includes("[Auto Save - Focus Lost]")?"\u5931\u7126\u4FDD\u5B58":e.includes("[Full Snapshot]")?"\u5168\u5E93\u5FEB\u7167":e.includes("[Before Restore]")?"\u6062\u590D\u524D\u5907\u4EFD":e.includes("[Auto Save")?"\u81EA\u52A8\u4FDD\u5B58":"\u624B\u52A8\u4FDD\u5B58"}async updateStatusBar(){if(!this.settings.autoSave){this.statusBarItem.setText("\u23F8 \u7248\u672C\u63A7\u5236: \u5DF2\u6682\u505C"),this.statusBarItem.title="\u81EA\u52A8\u4FDD\u5B58\u5DF2\u6682\u505C";return}let e=this.app.workspace.getActiveFile();if(!this.settings.showLastSaveTimeInStatusBar||!e){this.statusBarItem.setText("\u23F1 \u7248\u672C\u63A7\u5236: \u5DF2\u542F\u7528"),this.statusBarItem.title="\u70B9\u51FB\u53EF\u5FEB\u901F\u5BF9\u6BD4\u5F53\u524D\u6587\u4EF6\u4E0E\u6700\u65B0\u7248\u672C";return}let i=await this.getAllVersions(e.path);if(i.length>0){let n=i[0],a=n.timestamp;this.lastModifiedTime.set(e.path,a);let r=this.getSaveTypeLabel(n.message),o=this.getRelativeTime(a);this.statusBarItem.setText(`${r}: ${o}`),this.statusBarItem.title=`${r}\u4E8E ${new Date(a).toLocaleString("zh-CN")}. \u70B9\u51FB\u53EF\u5FEB\u901F\u5BF9\u6BD4\u3002`}else this.lastModifiedTime.delete(e.path),this.statusBarItem.setText("\u23F1 \u7248\u672C\u63A7\u5236: \u5DF2\u542F\u7528"),this.statusBarItem.title="\u5F53\u524D\u6587\u4EF6\u65E0\u5386\u53F2\u7248\u672C\u3002\u70B9\u51FB\u53EF\u5FEB\u901F\u5BF9\u6BD4\u3002"}async quickDiffFromStatusBar(){if(!this.settings.enableStatusBarDiff)return;let e=this.app.workspace.getActiveFile();if(!e){new b.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new b.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u5BF9\u6BD4");return}let n=i[0];new ne(this.app,this,e,n.id).open()}async ensureVersionFolder(){let e=this.app.vault.adapter,i=this.settings.versionFolder;try{await e.exists(i)||await e.mkdir(i)}catch(n){console.error("\u521B\u5EFA\u7248\u672C\u6587\u4EF6\u5939\u5931\u8D25:",n),new b.Notice("\u26A0\uFE0F \u65E0\u6CD5\u521B\u5EFA\u7248\u672C\u6587\u4EF6\u5939,\u8BF7\u68C0\u67E5\u6743\u9650")}}async activateVersionHistoryView(){let{workspace:e}=this.app,i=e.getLeavesOfType("version-history")[0];if(!i){let n=e.getRightLeaf(!1);if(!n){new b.Notice("\u65E0\u6CD5\u6253\u5F00\u7248\u672C\u5386\u53F2\u89C6\u56FE");return}i=n,await i.setViewState({type:"version-history",active:!0})}e.revealLeaf(i)}startAutoSave(){this.autoSaveTimer&&window.clearInterval(this.autoSaveTimer),this.settings.autoSaveOnInterval&&(this.autoSaveTimer=window.setInterval(()=>{this.autoSaveCurrentFile()},this.settings.autoSaveInterval*60*1e3))}scheduleSave(e,i,n){if(this.isExcluded(e.path))return;let a=this.pendingSaves.get(e.path);if(a&&clearTimeout(a),i===0){this.autoSaveFile(e,n),this.pendingSaves.delete(e.path);return}let r=setTimeout(()=>{this.autoSaveFile(e,n),this.pendingSaves.delete(e.path)},i*1e3);this.pendingSaves.set(e.path,r)}async autoSaveFile(e,i){try{let n=await this.app.vault.read(e),a=await this.getAllVersions(e.path),r="";if(a.length>0){let d=a[0],l=this.hashContent(n);if(d.hash===l)return;r=await this.getVersionContent(e.path,d.id)}if(n===r||this.countChanges(r,n)<this.settings.autoSaveMinChanges)return;await this.createVersion(e,i,!1)}catch(n){console.error("\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25:",n)}}countChanges(e,i){let n=se(e,i),a=0;for(let r of n)(r.added||r.removed)&&(a+=r.value.length);return a}handleFileModify(e){this.scheduleSave(e,this.settings.autoSaveDelayOnModify,"[Auto Save - On Modify]")}async handleFileSwitch(){let e=this.app.workspace.getActiveFile();if(this.previousActiveFile&&this.previousActiveFile!==e)if(this.app.vault.getAbstractFileByPath(this.previousActiveFile.path))this.scheduleSave(this.previousActiveFile,this.settings.autoSaveDelayOnFileSwitch,"[Auto Save - File Switch]");else{let n=this.pendingSaves.get(this.previousActiveFile.path);n&&clearTimeout(n),this.pendingSaves.delete(this.previousActiveFile.path),this.lastModifiedTime.delete(this.previousActiveFile.path)}this.previousActiveFile=e}async handleFocusLost(){let e=this.app.workspace.getActiveFile();!e||this.isExcluded(e.path)||!this.app.vault.getAbstractFileByPath(e.path)||this.scheduleSave(e,this.settings.autoSaveDelayOnFocusLost,"[Auto Save - Focus Lost]")}async autoSaveCurrentFile(){let e=this.app.workspace.getActiveFile();!e||this.isExcluded(e.path)||await this.autoSaveFile(e,"[Auto Save - Interval]")}isExcluded(e){return this.settings.excludedFolders.some(i=>e.startsWith(i))}async createManualVersion(){let e=this.app.workspace.getActiveFile();if(!e){new b.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=this.pendingSaves.get(e.path);i&&(clearTimeout(i),this.pendingSaves.delete(e.path)),new gi(this.app,this.settings,async(n,a)=>{await this.createVersion(e,n,!0,a,!0)}).open()}async createVersion(e,i,n=!1,a=[],r=!1){try{let o=await this.app.vault.read(e),d=Date.now(),l=`${d}-${Math.random().toString(36).substring(2,9)}`,c=this.hashContent(o),f=await this.loadVersionFile(e.path);if(this.settings.enableDeduplication){let g=f.versions[0];if(g&&g.hash===c){if(r&&g.message.includes("[Auto Save")){g.message=i,g.timestamp=d,g.tags=a.length>0?a:g.tags,await this.saveVersionFile(e.path,f),this.versionCache.set(e.path,f),this.refreshVersionHistoryView(),this.updateStatusBar(),n&&this.settings.showNotifications&&new b.Notice("\u2705 \u7248\u672C\u5DF2\u521B\u5EFA (\u81EA\u52A8\u4FDD\u5B58\u5DF2\u66F4\u65B0)");return}n&&this.settings.showNotifications&&new b.Notice("\u2139\uFE0F \u5185\u5BB9\u672A\u53D8\u5316,\u8DF3\u8FC7\u521B\u5EFA\u7248\u672C");return}}let p,h=0,u=0;if(f.versions.length>0){let g=await this.getVersionContent(e.path,f.versions[0].id);$(g,o).forEach(w=>{w.added&&(h+=w.count||0),w.removed&&(u+=w.count||0)})}else h=o.split(`
`).length;if(this.settings.enableIncrementalStorage&&f.versions.length>0)if(f.baseVersion===void 0||f.baseVersion===null||f.versions.length%this.settings.rebuildBaseInterval===0)p={id:l,timestamp:d,message:i,content:o,size:o.length,hash:c,tags:a.length>0?a:void 0,starred:!1,addedLines:h,removedLines:u},f.baseVersion=o;else{let w=f.baseVersion||await this.reconstructLatestFullContent(f),_=this.createDiff(w,o);p={id:l,timestamp:d,message:i,diff:_,baseVersionId:f.versions[0].id,size:_.length,hash:c,tags:a.length>0?a:void 0,starred:!1,addedLines:h,removedLines:u}}else p={id:l,timestamp:d,message:i,content:o,size:o.length,hash:c,tags:a.length>0?a:void 0,starred:!1,addedLines:h,removedLines:u},this.settings.enableIncrementalStorage&&(f.baseVersion=o);f.versions.unshift(p),f.lastModified=d,this.settings.autoClear&&this.cleanupVersionsInMemory(f),this.buildVersionIndex(f),await this.saveVersionFile(e.path,f),this.versionCache.set(e.path,f),this.refreshVersionHistoryView(),this.lastModifiedTime.set(e.path,d),this.updateStatusBar(),n&&this.settings.showNotifications&&new b.Notice(`\u2705 \u7248\u672C\u5DF2\u521B\u5EFA: ${i}`)}catch(o){console.error("\u521B\u5EFA\u7248\u672C\u5931\u8D25:",o),new b.Notice("\u274C \u521B\u5EFA\u7248\u672C\u5931\u8D25,\u8BF7\u67E5\u770B\u63A7\u5236\u53F0")}}async reconstructLatestFullContent(e){return e.versions.length===0?"":this.getVersionContent(e.filePath,e.versions[0].id)}createDiff(e,i){return Mt("file",e,i,"","")}applyDiff(e,i){try{let n=Ft(e,i);return n===!1?(console.error("\u5E94\u7528\u5DEE\u5F02\u8865\u4E01\u5931\u8D25 (applyPatch returned false). \u8FD4\u56DE\u57FA\u7840\u5185\u5BB9\u3002"),new b.Notice("\u5E94\u7528\u5DEE\u5F02\u8865\u4E01\u5931\u8D25\uFF0C\u7248\u672C\u5185\u5BB9\u53EF\u80FD\u4E0D\u5B8C\u6574\u3002"),e):n}catch(n){return console.error("\u5E94\u7528\u5DEE\u5F02\u65F6\u6355\u83B7\u5230\u5F02\u5E38:",n),e}}buildVersionIndex(e){let i=new Map;e.versions.forEach((n,a)=>{i.set(n.id,a)}),e.versionIndex=i}hashContent(e){let i=0;for(let n=0;n<e.length;n++){let a=e.charCodeAt(n);i=(i<<5)-i+a,i=i&i}return i.toString(36)}cleanupVersionsInMemory(e){let i=e.versions,n=i.filter(o=>o.starred),a=i.filter(o=>!o.starred);if(this.settings.enableMaxVersions){let o=Math.max(this.settings.maxVersions-n.length,10);a=a.slice(0,o)}if(this.settings.enableMaxDays){let o=Date.now()-this.settings.maxDays*24*60*60*1e3;a=a.filter(d=>d.timestamp>=o)}i=[...n,...a].sort((o,d)=>d.timestamp-o.timestamp);let r=e.versions.length-i.length;return e.versions=i,r}async loadVersionFile(e){if(this.versionCache.has(e))return this.versionCache.get(e);let i=this.getVersionFilePath(e),n=this.app.vault.adapter;try{if(await n.exists(i)){let r;if(this.settings.enableCompression)try{let d=await n.readBinary(i);r=fi(new Uint8Array(d),{to:"string"})}catch(d){r=await n.read(i)}else r=await n.read(i);let o=JSON.parse(r);return o.versionIndex||this.buildVersionIndex(o),this.versionCache.set(e,o),o}}catch(r){console.error("\u52A0\u8F7D\u7248\u672C\u6587\u4EF6\u5931\u8D25:",r)}let a={filePath:e,versions:[],lastModified:Date.now()};return this.versionCache.set(e,a),a}async saveVersionFile(e,i){let n=this.getVersionFilePath(e),a=this.app.vault.adapter;try{let r={filePath:i.filePath,versions:i.versions,lastModified:i.lastModified};i.baseVersion!==void 0&&(r.baseVersion=i.baseVersion);let o=JSON.stringify(r,null,2);if(this.settings.enableCompression){let d=es(o);await a.writeBinary(n,d.buffer)}else await a.write(n,o)}catch(r){throw console.error("\u4FDD\u5B58\u7248\u672C\u6587\u4EF6\u5931\u8D25:",r),r}}getVersionFilePath(e){let i=this.sanitizeFileName(e);return`${this.settings.versionFolder}/${i}.json`}async getVersions(e,i=0){try{let n=await this.loadVersionFile(e);if(this.settings.versionsPerPage>0){let a=i*this.settings.versionsPerPage,r=a+this.settings.versionsPerPage;return n.versions.slice(a,r)}return n.versions}catch(n){return console.error("\u83B7\u53D6\u7248\u672C\u5217\u8868\u5931\u8D25:",n),[]}}async getAllVersions(e){try{return(await this.loadVersionFile(e)).versions}catch(i){return console.error("\u83B7\u53D6\u7248\u672C\u5217\u8868\u5931\u8D25:",i),[]}}async getVersionContent(e,i){var n;try{let a=await this.loadVersionFile(e),r=(n=a.versionIndex)==null?void 0:n.get(i),o=r!==void 0?a.versions[r]:a.versions.find(d=>d.id===i);if(!o)throw new Error(`\u7248\u672C ${i} \u4E0D\u5B58\u5728`);if(o.content!==void 0&&o.content!==null)return o.content;if(o.diff){if(a.baseVersion!==void 0&&a.baseVersion!==null)try{return this.applyDiff(a.baseVersion,o.diff)}catch(d){console.warn("\u4ECE\u57FA\u51C6\u7248\u672C\u5E94\u7528\u5DEE\u5F02\u5931\u8D25\uFF0C\u5C1D\u8BD5\u4F7F\u7528 baseVersionId:",d)}if(o.baseVersionId)try{let d=await this.getVersionContent(e,o.baseVersionId);return this.applyDiff(d,o.diff)}catch(d){console.error("\u4ECE baseVersionId \u5E94\u7528\u5DEE\u5F02\u5931\u8D25:",d)}}throw new Error(`\u65E0\u6CD5\u83B7\u53D6\u7248\u672C ${i} \u7684\u5185\u5BB9\uFF1A\u7F3A\u5C11 content \u548C\u6709\u6548\u7684 diff`)}catch(a){throw console.error("\u8BFB\u53D6\u7248\u672C\u5185\u5BB9\u5931\u8D25:",a),new Error(`\u65E0\u6CD5\u8BFB\u53D6\u7248\u672C\u5185\u5BB9: ${a.message}`)}}async verifyVersionFileIntegrity(e){try{let i=await this.loadVersionFile(e);if(!i.versions||!Array.isArray(i.versions))return console.error("\u7248\u672C\u6587\u4EF6\u7ED3\u6784\u65E0\u6548"),!1;if(this.settings.enableIncrementalStorage){let n=!1;for(let a of i.versions)if(a.content!==void 0&&(n=!0),a.diff&&!a.content&&!a.baseVersionId&&!i.baseVersion)return console.error(`\u7248\u672C ${a.id} \u7F3A\u5C11\u57FA\u51C6\u5F15\u7528`),!1;!n&&i.versions.length>0&&console.warn("\u8B66\u544A\uFF1A\u6CA1\u6709\u627E\u5230\u5B8C\u6574\u7248\u672C\uFF0C\u53EF\u80FD\u5BFC\u81F4\u6062\u590D\u5931\u8D25")}return!0}catch(i){return console.error("\u9A8C\u8BC1\u7248\u672C\u6587\u4EF6\u5B8C\u6574\u6027\u5931\u8D25:",i),!1}}async updateVersionTags(e,i,n){var a;try{let r=await this.loadVersionFile(e),o=(a=r.versionIndex)==null?void 0:a.get(i);o!==void 0&&(r.versions[o].tags=n.length>0?n:void 0,await this.saveVersionFile(e,r),this.versionCache.set(e,r),this.refreshVersionHistoryView())}catch(r){console.error("\u66F4\u65B0\u7248\u672C\u6807\u7B7E\u5931\u8D25:",r)}}async updateVersionNote(e,i,n){var a;try{let r=await this.loadVersionFile(e),o=(a=r.versionIndex)==null?void 0:a.get(i);o!==void 0&&(r.versions[o].note=n.trim()||void 0,await this.saveVersionFile(e,r),this.versionCache.set(e,r),this.refreshVersionHistoryView())}catch(r){console.error("\u66F4\u65B0\u7248\u672C\u5907\u6CE8\u5931\u8D25:",r)}}async toggleVersionStar(e,i){var n;try{let a=await this.loadVersionFile(e),r=(n=a.versionIndex)==null?void 0:n.get(i);r!==void 0&&(a.versions[r].starred=!a.versions[r].starred,await this.saveVersionFile(e,a),this.versionCache.set(e,a),this.refreshVersionHistoryView())}catch(a){console.error("\u5207\u6362\u661F\u6807\u5931\u8D25:",a)}}async starLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new b.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new b.Notice("\u6CA1\u6709\u53EF\u6807\u8BB0\u7684\u7248\u672C");return}await this.toggleVersionStar(e.path,i[0].id),new b.Notice("\u2B50 \u5DF2\u6807\u8BB0/\u53D6\u6D88\u6807\u8BB0")}async quickPreviewLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new b.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new b.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u9884\u89C8");return}new xt(this.app,this,e,i[0].id).open()}async deleteVersion(e,i){try{let n=await this.loadVersionFile(e);if(n.versions.some(r=>r.baseVersionId===i)){new b.Notice("\u274C \u65E0\u6CD5\u5220\u9664\u6B64\u7248\u672C\uFF0C\u56E0\u4E3A\u5B83\u88AB\u5176\u4ED6\u589E\u91CF\u7248\u672C\u6240\u4F9D\u8D56\u3002",7e3);return}n.versions=n.versions.filter(r=>r.id!==i),n.lastModified=Date.now(),this.buildVersionIndex(n),await this.saveVersionFile(e,n),this.versionCache.set(e,n),this.refreshVersionHistoryView()}catch(n){console.error("\u5220\u9664\u7248\u672C\u5931\u8D25:",n)}}async deleteVersions(e,i){try{let n=await this.loadVersionFile(e),a=new Set(i),r=n.versions.filter(d=>!a.has(d.id));if(r.some(d=>d.baseVersionId&&a.has(d.baseVersionId))){new b.Notice("\u274C \u6279\u91CF\u5220\u9664\u5931\u8D25\uFF1A\u9009\u4E2D\u7684\u7248\u672C\u4E2D\u5305\u542B\u5176\u4ED6\u7248\u672C\u7684\u4F9D\u8D56\u9879\u3002",7e3);return}n.versions=r,n.lastModified=Date.now(),this.buildVersionIndex(n),await this.saveVersionFile(e,n),this.versionCache.set(e,n),this.refreshVersionHistoryView()}catch(n){console.error("\u6279\u91CF\u5220\u9664\u7248\u672C\u5931\u8D25:",n)}}async restoreVersion(e,i){try{await this.createVersion(e,"[Before Restore]",!1);let n=await this.getVersionContent(e.path,i);await this.app.vault.modify(e,n),this.settings.showNotifications&&new b.Notice("\u2705 \u7248\u672C\u5DF2\u6062\u590D"),this.refreshVersionHistoryView()}catch(n){console.error("\u6062\u590D\u7248\u672C\u5931\u8D25:",n),new b.Notice("\u274C \u6062\u590D\u7248\u672C\u5931\u8D25")}}async restoreLastVersion(){let e=this.app.workspace.getActiveFile();if(!e){new b.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new b.Notice("\u6CA1\u6709\u53EF\u6062\u590D\u7684\u7248\u672C");return}let n=i[0];new de(this.app,"\u6062\u590D\u5230\u4E0A\u4E00\u7248\u672C",`\u786E\u5B9A\u8981\u6062\u590D\u5230\u7248\u672C: ${this.formatTime(n.timestamp)}?

\u5F53\u524D\u672A\u4FDD\u5B58\u7684\u4FEE\u6539\u5C06\u4F1A\u4E22\u5931,\u63D2\u4EF6\u4F1A\u5728\u6062\u590D\u524D\u81EA\u52A8\u521B\u5EFA\u5907\u4EFD\u7248\u672C\u3002`,async()=>{await this.restoreVersion(e,n.id)}).open()}async quickCompare(){let e=this.app.workspace.getActiveFile();if(!e){new b.Notice("\u6CA1\u6709\u6253\u5F00\u7684\u6587\u4EF6");return}let i=await this.getAllVersions(e.path);if(i.length===0){new b.Notice("\u6CA1\u6709\u5386\u53F2\u7248\u672C\u53EF\u5BF9\u6BD4");return}let n=i[0];new ne(this.app,this,e,n.id).open()}async createFullSnapshot(){let e=this.app.vault.getMarkdownFiles(),i=0,n=0,a=new b.Notice("\u6B63\u5728\u521B\u5EFA\u5168\u5E93\u7248\u672C...",0);for(let r of e){if(this.isExcluded(r.path)){n++;continue}try{await this.createVersion(r,"[Full Snapshot]",!1),i++}catch(o){console.error(`\u521B\u5EFA\u7248\u672C\u5931\u8D25: ${r.path}`,o)}}a.hide(),this.settings.showNotifications&&new b.Notice(`\u2705 \u5168\u5E93\u7248\u672C\u5DF2\u521B\u5EFA
\u6210\u529F: ${i} \u4E2A\u6587\u4EF6${n>0?`
\u8DF3\u8FC7: ${n} \u4E2A\u6587\u4EF6`:""}`)}async optimizeAllVersionFiles(){var i,n;let e=new b.Notice("\u6B63\u5728\u4F18\u5316\u5B58\u50A8...",0);try{let a=this.app.vault.adapter,r=this.settings.versionFolder;if(!await a.exists(r)){e.hide(),new b.Notice("\u7248\u672C\u6587\u4EF6\u5939\u4E0D\u5B58\u5728");return}let o=await a.list(r),d=0,l=0;for(let c of o.files)if(c.endsWith(".json"))try{let f=((i=await a.stat(c))==null?void 0:i.size)||0,p=c.replace(this.settings.versionFolder+"/","").replace(".json",""),h=await this.loadVersionFile(p);this.buildVersionIndex(h),await this.saveVersionFile(h.filePath,h);let u=((n=await a.stat(c))==null?void 0:n.size)||0;l+=f-u,d++}catch(f){console.error("\u4F18\u5316\u6587\u4EF6\u5931\u8D25:",c,f)}e.hide(),new b.Notice(`\u2705 \u4F18\u5316\u5B8C\u6210
\u5904\u7406: ${d} \u4E2A\u6587\u4EF6
\u8282\u7701: ${this.formatFileSize(l)}`)}catch(a){e.hide(),console.error("\u4F18\u5316\u5931\u8D25:",a),new b.Notice("\u274C \u4F18\u5316\u5931\u8D25")}}async getStorageStats(){let e=this.app.vault.adapter,i=this.settings.versionFolder;try{if(!await e.exists(i))return{totalSize:0,versionCount:0,fileCount:0,compressionRatio:0,starredCount:0,taggedCount:0};let n=await e.list(i),a=0,r=0,o=0,d=0,l=0,c=0;for(let p of n.files)if(p.endsWith(".json"))try{let h=await e.stat(p),u=(h==null?void 0:h.size)||0;a+=u;let g;if(this.settings.enableCompression)try{let v=await e.readBinary(p),w=fi(new Uint8Array(v),{to:"string"});g=JSON.parse(w)}catch(v){let w=await e.read(p);g=JSON.parse(w)}else{let v=await e.read(p);g=JSON.parse(v)}g.versions&&Array.isArray(g.versions)&&(r+=g.versions.length,g.versions.forEach(v=>{v.content?d+=v.content.length:v.diff&&(d+=v.diff.length),v.starred&&l++,v.tags&&v.tags.length>0&&c++}),o++)}catch(h){console.error("\u8BFB\u53D6\u7248\u672C\u6587\u4EF6\u5931\u8D25:",p,h)}let f=d>0?(1-a/d)*100:0;return{totalSize:a,versionCount:r,fileCount:o,compressionRatio:f,starredCount:l,taggedCount:c}}catch(n){return console.error("\u83B7\u53D6\u5B58\u50A8\u7EDF\u8BA1\u5931\u8D25:",n),{totalSize:0,versionCount:0,fileCount:0,compressionRatio:0,starredCount:0,taggedCount:0}}}async exportVersions(e){try{let i=await this.loadVersionFile(e),n=`${this.settings.versionFolder}/export_${this.sanitizeFileName(e)}_${Date.now()}.json`;await this.app.vault.adapter.write(n,JSON.stringify(i,null,2)),new b.Notice(`\u2705 \u7248\u672C\u5DF2\u5BFC\u51FA\u5230: ${n}`)}catch(i){console.error("\u5BFC\u51FA\u7248\u672C\u5931\u8D25:",i),new b.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}async exportVersionAsFile(e,i){try{let n=await this.getVersionContent(e,i),r=`${e.replace(/\.[^/.]+$/,"")}_v${i.substring(0,8)}.md`;await this.app.vault.create(r,n),new b.Notice(`\u2705 \u7248\u672C\u5DF2\u5BFC\u51FA\u4E3A: ${r}`)}catch(n){console.error("\u5BFC\u51FA\u7248\u672C\u4E3A\u6587\u4EF6\u5931\u8D25:",n),new b.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}sanitizeFileName(e){return e.replace(/[\/\\:*?"<>|]/g,"_")}formatFileSize(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`}formatTime(e){return this.settings.useRelativeTime?this.getRelativeTime(e):new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}getRelativeTime(e){let i=Date.now()-e,n=Math.floor(i/1e3),a=Math.floor(n/60),r=Math.floor(a/60),o=Math.floor(r/24),d=Math.floor(o/30),l=Math.floor(o/365);return l>0?`${l} \u5E74\u524D`:d>0?`${d} \u4E2A\u6708\u524D`:o>0?`${o} \u5929\u524D`:r>0?`${r} \u5C0F\u65F6\u524D`:a>0?`${a} \u5206\u949F\u524D`:n<10?"\u521A\u521A":`${n} \u79D2\u524D`}refreshVersionHistoryView(){this.app.workspace.getLeavesOfType("version-history").forEach(i=>{i.view instanceof Ke&&i.view.refresh()})}},xt=class extends b.Modal{constructor(e,i,n,a){super(e);this.isRenderedView=!0;this.plugin=i,this.file=n,this.versionId=a}async onOpen(){let{contentEl:e}=this;e.addClass("quick-preview-modal");try{this.versionContent=await this.plugin.getVersionContent(this.file.path,this.versionId);let n=(await this.plugin.getAllVersions(this.file.path)).find(u=>u.id===this.versionId),a=e.createEl("div",{cls:"preview-header"});if(a.createEl("h2",{text:"\u{1F4C4} \u5FEB\u901F\u9884\u89C8"}),n){let u=a.createEl("div",{cls:"preview-info"});u.createEl("span",{text:`\u23F0 ${this.plugin.formatTime(n.timestamp)}`,cls:"preview-time"}),u.createEl("span",{text:`\u{1F4AC} ${n.message}`,cls:"preview-message"}),u.createEl("span",{text:`\u{1F4E6} ${this.plugin.formatFileSize(n.size)}`,cls:"preview-size"})}let r=e.createEl("div",{cls:"preview-toolbar"});this.toggleButton=r.createEl("button",{text:"\u{1F453} \u5207\u6362\u539F\u59CB\u6587\u672C"}),this.toggleButton.addEventListener("click",()=>{this.isRenderedView=!this.isRenderedView,this.renderContent()}),r.createEl("button",{text:"\u{1F4CB} \u590D\u5236\u5185\u5BB9",cls:"mod-cta"}).addEventListener("click",()=>{navigator.clipboard.writeText(this.versionContent).then(()=>{new b.Notice("\u2705 \u5185\u5BB9\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(()=>{new b.Notice("\u274C \u590D\u5236\u5931\u8D25")})}),r.createEl("button",{text:"\u21A9\uFE0F \u6062\u590D\u6B64\u7248\u672C"}).addEventListener("click",async()=>{this.close(),await this.plugin.restoreVersion(this.file,this.versionId)}),r.createEl("button",{text:"\u{1F500} \u8BE6\u7EC6\u5BF9\u6BD4"}).addEventListener("click",()=>{this.close(),new ne(this.app,this.plugin,this.file,this.versionId).open()}),r.createEl("button",{text:"\u{1F4BE} \u5BFC\u51FA\u6587\u4EF6"}).addEventListener("click",async()=>{await this.plugin.exportVersionAsFile(this.file.path,this.versionId)}),this.contentContainer=e.createEl("div",{cls:"preview-content-container"}),this.renderContent();let f=e.createEl("div",{cls:"preview-stats-bar"}),p=this.versionContent.split(`
`);f.createEl("span",{text:`\u{1F4DD} ${p.length} \u884C`}),f.createEl("span",{text:`\u{1F524} ${this.versionContent.length} \u5B57\u7B26`});let h=this.versionContent.split(/\s+/).filter(u=>u.length>0).length;f.createEl("span",{text:`\u{1F4C4} ${h} \u8BCD`})}catch(i){e.createEl("p",{text:"\u274C \u52A0\u8F7D\u9884\u89C8\u5931\u8D25"}),console.error("\u9884\u89C8\u52A0\u8F7D\u5931\u8D25:",i)}}async renderContent(){if(this.contentContainer.empty(),this.isRenderedView){this.toggleButton.setText("\u{1F453} \u5207\u6362\u539F\u59CB\u6587\u672C");let e=this.contentContainer.createEl("div",{cls:"preview-rendered-content"});await b.MarkdownRenderer.renderMarkdown(this.versionContent,e,this.file.path,this.plugin)}else{this.toggleButton.setText("\u{1F4D6} \u5207\u6362\u6E32\u67D3\u89C6\u56FE");let e=this.contentContainer.createEl("div",{cls:"preview-raw-container"}),i=this.versionContent.split(`
`),n=e.createEl("div",{cls:"preview-line-numbers"});i.forEach((r,o)=>{n.createEl("div",{text:String(o+1),cls:"line-number"})}),e.createEl("pre").createEl("code",{text:this.versionContent})}}onClose(){let{contentEl:e}=this;e.empty()}},Ke=class extends b.ItemView{constructor(e,i){super(e);this.selectedVersions=new Set;this.currentFile=null;this.searchQuery="";this.currentPage=0;this.totalVersions=0;this.filterTag=null;this.showStarredOnly=!1;this.plugin=i}getViewType(){return"version-history"}getDisplayText(){return"\u7248\u672C\u5386\u53F2"}getIcon(){return"history"}async onOpen(){this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.currentPage=0,this.refresh()})),await this.refresh()}async onClose(){}updateRelativeTimes(){if(!this.plugin.settings.useRelativeTime)return;let e=this.containerEl.children[1];if(!e)return;e.findAll(".version-time").forEach(n=>{let a=n.dataset.timestamp;if(a){let r=parseInt(a,10);n.textContent=this.plugin.getRelativeTime(r)}})}getRelativeDateGroup(e){let i=new Date,n=new Date(e),a=new Date(i.getFullYear(),i.getMonth(),i.getDate()),r=new Date(i.getFullYear(),i.getMonth(),i.getDate()-1),o=new Date(n.getFullYear(),n.getMonth(),n.getDate());return o.getTime()===a.getTime()?"\u4ECA\u5929":o.getTime()===r.getTime()?"\u6628\u5929":i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()?"\u672C\u6708":i.getFullYear()===n.getFullYear()?`${n.getMonth()+1}\u6708`:`${n.getFullYear()}\u5E74`}async calculateDiffStatsForVersion(e,i){var r;let n=(r=e.versionIndex)==null?void 0:r.get(i);if(n===void 0)return;let a=e.versions[n];if(!(typeof a.addedLines=="number"&&typeof a.removedLines=="number"))try{let o=await this.plugin.getVersionContent(e.filePath,a.id),d=e.versions[n+1],l=0,c=0;if(d){let f=await this.plugin.getVersionContent(e.filePath,d.id);$(f,o).forEach(h=>{h.added&&(l+=h.count||0),h.removed&&(c+=h.count||0)})}else l=o.split(`
`).length;a.addedLines=l,a.removedLines=c}catch(o){console.error(`\u8BA1\u7B97\u7248\u672C ${a.id} \u7684\u5DEE\u5F02\u7EDF\u8BA1\u5931\u8D25:`,o),a.addedLines=0,a.removedLines=0}}async refresh(){let e=this.containerEl.children[1],i=document.createDocumentFragment(),n=i.createEl("div");n.addClass("version-history-view");let a=this.app.workspace.getActiveFile();if(this.currentFile=a,!a){this.renderEmptyState(n,"\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6"),e.empty(),e.appendChild(i);return}let r=n.createEl("div",{cls:"version-header"}),o=r.createEl("div",{cls:"version-title"});o.createEl("h3",{text:a.basename}),o.createEl("span",{text:a.path,cls:"version-file-path"});let d=r.createEl("div",{cls:"version-file-stats"});try{let V=await this.app.vault.read(a),F=await this.app.vault.adapter.stat(a.path);d.createEl("span",{text:`\u{1F4C4} \u5927\u5C0F: ${this.plugin.formatFileSize(V.length)}`,cls:"file-stat-item"}),F&&d.createEl("span",{text:`\u{1F4C5} \u4FEE\u6539: ${new Date(F.mtime).toLocaleString("zh-CN")}`,cls:"file-stat-item"})}catch(V){console.error("\u83B7\u53D6\u6587\u4EF6\u4FE1\u606F\u5931\u8D25:",V)}let l=r.createEl("div",{cls:"version-header-actions"}),c=l.createEl("input",{type:"text",placeholder:"\u641C\u7D22\u7248\u672C...",cls:"version-search"});c.value=this.searchQuery,c.addEventListener("input",V=>{this.searchQuery=V.target.value,this.currentPage=0,this.refresh()}),l.createEl("button",{text:this.showStarredOnly?"\u5DF2\u7B5B\u9009\u661F\u6807":"\u7B5B\u9009\u661F\u6807",cls:this.showStarredOnly?"mod-cta":"",attr:{title:"\u4EC5\u663E\u793A\u661F\u6807\u7248\u672C"}}).addEventListener("click",()=>{this.showStarredOnly=!this.showStarredOnly,this.currentPage=0,this.refresh()}),l.createEl("button",{text:"\u5237\u65B0",attr:{title:"\u624B\u52A8\u5237\u65B0\u7248\u672C\u5217\u8868"}}).addEventListener("click",()=>{new b.Notice("\u6B63\u5728\u5237\u65B0..."),this.plugin.versionCache.delete(a.path),this.refresh()}),l.createEl("button",{text:"+ \u521B\u5EFA",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),l.createEl("button",{text:"\u66F4\u591A",attr:{title:"\u66F4\u591A\u64CD\u4F5C"}}).addEventListener("click",V=>{let F=new b.Menu;F.addItem(I=>I.setTitle("\u{1F4CA} \u67E5\u770B\u7EDF\u8BA1").setIcon("bar-chart").onClick(()=>{this.showDetailedStats()})),F.addItem(I=>I.setTitle("\u{1F4E5} \u5BFC\u51FA\u7248\u672C\u6570\u636E").setIcon("download").onClick(()=>{this.plugin.exportVersions(a.path)})),F.addItem(I=>I.setTitle("\u{1F4C2} \u521B\u5EFA\u5168\u5E93\u7248\u672C").setIcon("folder").onClick(()=>{this.plugin.createFullSnapshot()})),F.addItem(I=>I.setTitle("\u{1F5D1}\uFE0F \u6E05\u7406\u65E7\u7248\u672C").setIcon("trash").onClick(async()=>{await this.cleanupOldVersions(a)})),F.showAtMouseEvent(V)});let g=await this.plugin.loadVersionFile(a.path),v=g.versions;if(this.totalVersions=v.length,this.totalVersions===0){this.renderEmptyState(n,"\u6682\u65E0\u7248\u672C\u5386\u53F2"),e.empty(),e.appendChild(i);return}if(v.length>0)try{let V=await this.app.vault.read(a),F=v[0],I=await this.plugin.getVersionContent(a.path,F.id);if(V!==I){let U=$(I,V),xe=0,fe=0;U.forEach(j=>{j.added&&(xe+=j.count||0),j.removed&&(fe+=j.count||0)});let he=n.createEl("div",{cls:"version-diff-banner"});he.createEl("span",{text:"\u26A0\uFE0F \u6587\u4EF6\u5DF2\u4FEE\u6539"}),he.createEl("span",{text:`+${xe} -${fe}`,cls:"diff-stats"}),he.createEl("button",{text:"\u{1F4BE} \u7ACB\u5373\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),he.createEl("button",{text:"\u{1F441}\uFE0F \u67E5\u770B\u5DEE\u5F02"}).addEventListener("click",()=>{new ne(this.app,this.plugin,a,F.id).open()})}}catch(V){console.error("\u68C0\u67E5\u6587\u4EF6\u5DEE\u5F02\u5931\u8D25:",V)}let w=v;if(this.showStarredOnly&&(w=w.filter(V=>V.starred)),this.filterTag&&(w=w.filter(V=>V.tags&&V.tags.includes(this.filterTag))),this.searchQuery&&(w=w.filter(V=>V.message.toLowerCase().includes(this.searchQuery.toLowerCase())||this.plugin.formatTime(V.timestamp).toLowerCase().includes(this.searchQuery.toLowerCase())||V.tags&&V.tags.some(F=>F.toLowerCase().includes(this.searchQuery.toLowerCase())))),w.length===0){this.renderEmptyState(n,"\u672A\u627E\u5230\u5339\u914D\u7684\u7248\u672C"),e.empty(),e.appendChild(i);return}let _=this.plugin.settings.versionsPerPage>0?this.plugin.settings.versionsPerPage:w.length,x=Math.ceil(w.length/_),m=this.currentPage*_,y=Math.min(m+_,w.length),D=w.slice(m,y),E=!1,C=D.filter(V=>typeof V.addedLines!="number"||typeof V.removedLines!="number").map(V=>(E=!0,this.calculateDiffStatsForVersion(g,V.id)));if(C.length>0&&await Promise.all(C),E&&await this.plugin.saveVersionFile(a.path,g),this.selectedVersions.size>0){let V=n.createEl("div",{cls:"version-toolbar"});V.createEl("span",{text:`\u5DF2\u9009\u62E9 ${this.selectedVersions.size} \u4E2A\u7248\u672C`}),V.createEl("button",{text:"\u6E05\u7A7A\u9009\u62E9"}).addEventListener("click",()=>{this.selectedVersions.clear(),this.refresh()}),V.createEl("button",{text:"\u6279\u91CF\u5220\u9664",cls:"mod-warning"}).addEventListener("click",()=>this.batchDelete(a))}let k=n.createEl("div",{cls:"version-list"}),S={};D.forEach(V=>{let F=this.getRelativeDateGroup(V.timestamp);S[F]||(S[F]=[]),S[F].push(V)});for(let V in S){k.createEl("h4",{text:V,cls:"version-group-header"});let F=S[V];for(let I of F){let U=k.createEl("div",{cls:"version-item"});I.starred&&U.addClass("version-starred");let xe=U.createEl("input",{type:"checkbox",cls:"version-checkbox"});xe.checked=this.selectedVersions.has(I.id),xe.addEventListener("change",()=>{xe.checked?this.selectedVersions.add(I.id):this.selectedVersions.delete(I.id),this.refresh()});let fe=U.createEl("div",{cls:"version-info"}),he=fe.createEl("div",{cls:"version-time-row"});he.createEl("span",{text:I.starred?"\u2B50":"\u2606",cls:"version-star-btn"}).addEventListener("click",async()=>{await this.plugin.toggleVersionStar(a.path,I.id)});let wi=he.createEl("span",{text:this.plugin.formatTime(I.timestamp),cls:"version-time"});wi.dataset.timestamp=String(I.timestamp);let j=fe.createEl("div",{cls:"version-message-row"}),et=this.plugin.getSaveTypeLabel(I.message),tt="version-tag-auto";et==="\u624B\u52A8\u4FDD\u5B58"?tt="version-tag-manual":et==="\u5168\u5E93\u5FEB\u7167"?tt="version-tag-snapshot":et==="\u6062\u590D\u524D\u5907\u4EFD"&&(tt="version-tag-backup"),j.createEl("span",{text:et,cls:`version-tag ${tt}`}),I.diff?j.createEl("span",{text:"\u589E\u91CF",cls:"version-tag version-tag-incremental"}):I.content&&j.createEl("span",{text:"\u5B8C\u6574",cls:"version-tag version-tag-full"}),I.tags&&I.tags.length>0&&I.tags.forEach(Q=>{j.createEl("span",{text:Q,cls:"version-tag version-tag-custom"}).addEventListener("click",()=>{this.filterTag=Q,this.currentPage=0,this.refresh()})}),j.createEl("span",{text:I.message.replace(/\[.*?\]/g,"").trim()||"\u65E0\u63CF\u8FF0",cls:"version-message"}),I.note&&fe.createEl("div",{text:`\u{1F4DD} ${I.note}`,cls:"version-note"});let _i=fe.createEl("div",{cls:"version-stats-row"});_i.createEl("span",{text:this.plugin.formatFileSize(I.size),cls:"version-size"});let be=_i.createEl("div",{cls:"version-diff-stats"});if(typeof I.addedLines=="number"&&typeof I.removedLines=="number"){let Q=I.addedLines+I.removedLines;if(Q>0){let xi=I.addedLines/Q*100,is=I.removedLines/Q*100,bi=be.createEl("div",{cls:"diff-stats-bar"});I.addedLines>0&&bi.createEl("div",{cls:"diff-stats-added",attr:{style:`width: ${xi}%`}}),I.removedLines>0&&bi.createEl("div",{cls:"diff-stats-removed",attr:{style:`width: ${is}%`}}),be.createEl("span",{text:`+${I.addedLines}`,cls:"diff-stats-text-added"}),be.createEl("span",{text:`-${I.removedLines}`,cls:"diff-stats-text-removed"}),be.title=`\u65B0\u589E ${I.addedLines} \u884C, \u5220\u9664 ${I.removedLines} \u884C`}else be.setText("\u65E0\u4EE3\u7801\u53D8\u66F4")}else be.setText("\u8BA1\u7B97\u4E2D...");let it=U.createEl("div",{cls:"version-actions"});this.plugin.settings.enableQuickPreview&&it.createEl("button",{text:"\u9884\u89C8",cls:"version-btn",attr:{title:"\u5FEB\u901F\u9884\u89C8"}}).addEventListener("click",()=>{new xt(this.app,this.plugin,a,I.id).open()}),it.createEl("button",{text:"\u6062\u590D",cls:"version-btn"}).addEventListener("click",()=>{this.confirmRestore(a,I.id)}),it.createEl("button",{text:"\u6BD4\u8F83",cls:"version-btn"}).addEventListener("click",()=>{this.showDiffModal(a,I.id)}),it.createEl("button",{text:"\u66F4\u591A",cls:"version-btn"}).addEventListener("click",Q=>{this.showVersionContextMenu(Q,a,I)})}}if(x>1){let V=n.createEl("div",{cls:"version-pagination"}),F=V.createEl("button",{text:"\u2190 \u4E0A\u4E00\u9875",cls:"version-pagination-btn"});F.disabled=this.currentPage===0,F.addEventListener("click",()=>{this.currentPage>0&&(this.currentPage--,this.refresh())}),V.createEl("span",{text:`\u7B2C ${this.currentPage+1} / ${x} \u9875`,cls:"version-pagination-info"});let I=V.createEl("button",{text:"\u4E0B\u4E00\u9875 \u2192",cls:"version-pagination-btn"});I.disabled=this.currentPage>=x-1,I.addEventListener("click",()=>{this.currentPage<x-1&&(this.currentPage++,this.refresh())})}let T=n.createEl("div",{cls:"version-footer"});T.createEl("span",{text:`\u5171 ${this.totalVersions} \u4E2A\u7248\u672C`}),(this.searchQuery||this.showStarredOnly||this.filterTag)&&T.createEl("span",{text:` \xB7 \u663E\u793A ${w.length} \u4E2A\u7ED3\u679C`}),T.createEl("span",{text:` \xB7 \u663E\u793A ${m+1}-${y}`}),e.empty(),e.appendChild(i)}showVersionContextMenu(e,i,n){let a=new b.Menu;a.addItem(r=>r.setTitle("\u4E0E\u5F53\u524D\u6587\u4EF6\u5BF9\u6BD4").setIcon("file-diff").onClick(()=>{this.showDiffModal(i,n.id)})),a.addItem(r=>r.setTitle("\u4E0E\u53E6\u4E00\u4E2A\u7248\u672C\u5BF9\u6BD4").setIcon("files").onClick(()=>{this.selectVersionForCompare(i,n.id)})),a.addSeparator(),a.addItem(r=>r.setTitle(n.starred?"\u53D6\u6D88\u661F\u6807":"\u6DFB\u52A0\u661F\u6807").setIcon("star").onClick(async()=>{await this.plugin.toggleVersionStar(i.path,n.id)})),this.plugin.settings.enableVersionTags&&a.addItem(r=>r.setTitle("\u7F16\u8F91\u6807\u7B7E").setIcon("tag").onClick(()=>{new hi(this.app,this.plugin,i.path,n.id,n.tags||[]).open()})),a.addItem(r=>r.setTitle("\u6DFB\u52A0/\u7F16\u8F91\u5907\u6CE8").setIcon("edit").onClick(()=>{new ui(this.app,this.plugin,i.path,n.id,n.note||"").open()})),a.addSeparator(),a.addItem(r=>r.setTitle("\u5BFC\u51FA\u4E3A\u6587\u4EF6").setIcon("download").onClick(async()=>{await this.plugin.exportVersionAsFile(i.path,n.id)})),a.addItem(r=>r.setTitle("\u5220\u9664\u7248\u672C").setIcon("trash").onClick(async()=>{new de(this.app,"\u786E\u8BA4\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u6B64\u7248\u672C\u5417?

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500!`,async()=>{await this.plugin.deleteVersion(i.path,n.id)}).open()})),a.showAtMouseEvent(e)}async showDetailedStats(){let e=this.currentFile;if(!e)return;let i=await this.plugin.getAllVersions(e.path),n=i.filter(c=>c.starred).length,a=i.filter(c=>c.tags&&c.tags.length>0).length,r=i.reduce((c,f)=>c+f.size,0),o=i.filter(c=>c.message.includes("[Auto Save]")).length,d=i.length-o,l="";if(i.length>1){let c=i[i.length-1].timestamp,f=i[0].timestamp,p=Math.floor((f-c)/(1e3*60*60*24));l=p>0?`${p} \u5929`:"\u4E0D\u8DB31\u5929"}else i.length===1&&(l="\u4EC5\u4E00\u4E2A\u7248\u672C");new b.Notice(`\u{1F4CA} ${e.basename} \u7EDF\u8BA1

\u603B\u7248\u672C\u6570: ${i.length}
\u2B50 \u661F\u6807: ${n}
\u{1F3F7}\uFE0F \u5DF2\u6807\u7B7E: ${a}
\u{1F916} \u81EA\u52A8: ${o}
\u270B \u624B\u52A8: ${d}
\u{1F4E6} \u603B\u5927\u5C0F: ${this.plugin.formatFileSize(r)}
\u{1F4C5} \u65F6\u95F4\u8DE8\u5EA6: ${l}`,8e3)}async cleanupOldVersions(e){new de(this.app,"\u6E05\u7406\u65E7\u7248\u672C",`\u6839\u636E\u8BBE\u7F6E\u7684\u6E05\u7406\u89C4\u5219\u5220\u9664\u65E7\u7248\u672C\u3002
\u661F\u6807\u7248\u672C\u5C06\u88AB\u4FDD\u7559\u3002

\u662F\u5426\u7EE7\u7EED?`,async()=>{let i=await this.plugin.loadVersionFile(e.path),n=i.versions.length,a=this.plugin.cleanupVersionsInMemory(i);a>0?(await this.plugin.saveVersionFile(e.path,i),this.plugin.versionCache.set(e.path,i),new b.Notice(`\u2705 \u5DF2\u6E05\u7406 ${a} \u4E2A\u65E7\u7248\u672C`),this.refresh()):new b.Notice("\u2139\uFE0F \u6CA1\u6709\u9700\u8981\u6E05\u7406\u7684\u7248\u672C")}).open()}renderEmptyState(e,i){let n=e.createEl("div",{cls:"version-history-empty"});n.createEl("div",{text:"\u{1F4CB}",cls:"version-empty-icon"}),n.createEl("div",{text:i}),this.currentFile&&i==="\u6682\u65E0\u7248\u672C\u5386\u53F2"&&n.createEl("button",{text:"\u521B\u5EFA\u7B2C\u4E00\u4E2A\u7248\u672C",cls:"mod-cta"}).addEventListener("click",()=>{this.plugin.createManualVersion()}),(this.filterTag||this.showStarredOnly||this.searchQuery)&&n.createEl("button",{text:"\u6E05\u9664\u7B5B\u9009/\u641C\u7D22",cls:"mod-cta"}).addEventListener("click",()=>{this.filterTag=null,this.showStarredOnly=!1,this.searchQuery="",this.currentPage=0,this.refresh()})}confirmRestore(e,i){new de(this.app,"\u786E\u8BA4\u6062\u590D\u7248\u672C",`\u5F53\u524D\u672A\u4FDD\u5B58\u7684\u4FEE\u6539\u5C06\u4F1A\u4E22\u5931,\u63D2\u4EF6\u4F1A\u5728\u6062\u590D\u524D\u81EA\u52A8\u521B\u5EFA\u5907\u4EFD\u7248\u672C\u3002

\u662F\u5426\u7EE7\u7EED?`,async()=>{await this.plugin.restoreVersion(e,i)}).open()}async batchDelete(e){new de(this.app,"\u786E\u8BA4\u6279\u91CF\u5220\u9664",`\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684 ${this.selectedVersions.size} \u4E2A\u7248\u672C\u5417?

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500!`,async()=>{let i=Array.from(this.selectedVersions);await this.plugin.deleteVersions(e.path,i),this.selectedVersions.clear()}).open()}showDiffModal(e,i){new ne(this.app,this.plugin,e,i).open()}selectVersionForCompare(e,i){new vi(this.app,this.plugin,e,i,n=>{new ne(this.app,this.plugin,e,i,n).open()}).open()}},hi=class extends b.Modal{constructor(e,i,n,a,r){super(e);this.selectedTags=new Set;this.plugin=i,this.filePath=n,this.versionId=a,this.currentTags=r,this.selectedTags=new Set(r)}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"\u7F16\u8F91\u7248\u672C\u6807\u7B7E"});let i=e.createEl("div",{cls:"tag-edit-container"}),n=i.createEl("div",{cls:"tag-section"});n.createEl("h3",{text:"\u5E38\u7528\u6807\u7B7E"});let a=n.createEl("div",{cls:"tag-list"});this.plugin.settings.defaultTags.forEach(g=>{let v=a.createEl("span",{text:g,cls:this.selectedTags.has(g)?"tag-item tag-selected":"tag-item"});v.addEventListener("click",()=>{this.selectedTags.has(g)?(this.selectedTags.delete(g),v.removeClass("tag-selected")):(this.selectedTags.add(g),v.addClass("tag-selected"))})});let r=i.createEl("div",{cls:"tag-section"});r.createEl("h3",{text:"\u81EA\u5B9A\u4E49\u6807\u7B7E"});let o=r.createEl("div",{cls:"tag-input-container"}),d=o.createEl("input",{type:"text",placeholder:"\u8F93\u5165\u65B0\u6807\u7B7E..."});d.style.width="100%";let l=o.createEl("button",{text:"\u6DFB\u52A0",cls:"mod-cta"});l.addEventListener("click",()=>{let g=d.value.trim();g&&!this.selectedTags.has(g)&&(this.selectedTags.add(g),this.renderSelectedTags(f),d.value="")}),d.addEventListener("keydown",g=>{g.key==="Enter"&&l.click()});let c=i.createEl("div",{cls:"tag-section"});c.createEl("h3",{text:"\u5DF2\u9009\u6807\u7B7E"});let f=c.createEl("div",{cls:"tag-list"});this.renderSelectedTags(f);let p=e.createEl("div",{cls:"modal-button-container"});p.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),p.createEl("button",{text:"\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",async()=>{await this.plugin.updateVersionTags(this.filePath,this.versionId,Array.from(this.selectedTags)),new b.Notice("\u2705 \u6807\u7B7E\u5DF2\u66F4\u65B0"),this.close()})}renderSelectedTags(e){e.empty(),this.selectedTags.forEach(i=>{e.createEl("span",{text:i,cls:"tag-item tag-removable"}).createEl("span",{text:"\xD7",cls:"tag-remove"}).addEventListener("click",()=>{this.selectedTags.delete(i),this.renderSelectedTags(e)})})}onClose(){let{contentEl:e}=this;e.empty()}},ui=class extends b.Modal{constructor(e,i,n,a,r){super(e);this.plugin=i,this.filePath=n,this.versionId=a,this.currentNote=r}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"\u7F16\u8F91\u7248\u672C\u5907\u6CE8"});let i=e.createEl("textarea",{placeholder:"\u4E3A\u6B64\u7248\u672C\u6DFB\u52A0\u8BE6\u7EC6\u5907\u6CE8..."});i.value=this.currentNote,i.style.width="100%",i.style.minHeight="150px";let n=e.createEl("div",{cls:"modal-button-container"});n.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\u4FDD\u5B58",cls:"mod-cta"}).addEventListener("click",async()=>{await this.plugin.updateVersionNote(this.filePath,this.versionId,i.value.trim()),new b.Notice("\u2705 \u5907\u6CE8\u5DF2\u66F4\u65B0"),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}},gi=class extends b.Modal{constructor(e,i,n){super(e);this.result="";this.tags=[];this.settings=i,this.onSubmit=n}onOpen(){let{contentEl:e}=this;if(e.createEl("h2",{text:"\u521B\u5EFA\u7248\u672C"}),new b.Setting(e).setName("\u63D0\u4EA4\u4FE1\u606F").setDesc("\u63CF\u8FF0\u6B64\u7248\u672C\u7684\u66F4\u6539\u5185\u5BB9").addText(r=>{this.inputEl=r,r.setPlaceholder("\u4F8B\u5982:\u6DFB\u52A0\u65B0\u7AE0\u8282\u3001\u4FEE\u590D\u9519\u8BEF\u7B49...").onChange(o=>{this.result=o}),r.inputEl.style.width="100%",r.inputEl.focus()}),this.settings.enableVersionTags&&this.settings.defaultTags.length>0){let r=e.createEl("div",{cls:"tag-section"});r.createEl("h3",{text:"\u6DFB\u52A0\u6807\u7B7E (\u53EF\u9009)"});let o=r.createEl("div",{cls:"tag-list"});this.settings.defaultTags.forEach(d=>{let l=o.createEl("span",{text:d,cls:"tag-item"});l.addEventListener("click",()=>{l.hasClass("tag-selected")?(l.removeClass("tag-selected"),this.tags=this.tags.filter(c=>c!==d)):(l.addClass("tag-selected"),this.tags.push(d))})})}let i=e.createEl("div",{cls:"modal-button-container"});i.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),i.createEl("button",{text:"\u521B\u5EFA",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.onSubmit(this.result||"[Manual Save]",this.tags)}),this.inputEl.inputEl.addEventListener("keydown",r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),this.close(),this.onSubmit(this.result||"[Manual Save]",this.tags))})}onClose(){let{contentEl:e}=this;e.empty()}},de=class extends b.Modal{constructor(e,i,n,a){super(e);this.title=i,this.message=n,this.onConfirm=a}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:this.title});let i=e.createEl("p",{cls:"confirm-message"});i.style.whiteSpace="pre-line",i.textContent=this.message;let n=e.createEl("div",{cls:"modal-button-container"});n.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:"\u786E\u8BA4",cls:"mod-warning"}).addEventListener("click",()=>{this.close(),this.onConfirm()})}onClose(){let{contentEl:e}=this;e.empty()}},ne=class extends b.Modal{constructor(e,i,n,a,r){super(e);this.currentDiffIndex=0;this.totalDiffs=0;this.diffElements=[];this.collapsedSections=new Set;this.ignoreWhitespace=!1;this.showLineNumbers=!0;this.wrapLines=!0;this.leftContent="";this.rightContent="";this.enableMoveDetection=!0;this.showWhitespace=!1;this.currentView="text";this.isRenderedViewBuilt=!1;this.isStructuredViewBuilt=!1;this.allVersions=[];this.plugin=i,this.file=n,this.versionId=a,this.secondVersionId=r||"current",this.currentGranularity=this.plugin.settings.diffGranularity,this.showOnlyChanges=this.plugin.settings.diffShowOnlyChanges}processDiffForMoves(e){let i=e.map(o=>({...o,type:o.added?"added":o.removed?"removed":"context"})),n=new Map,a=new Map;i.forEach((o,d)=>{if(o.removed){let l=o.value.trim();n.has(l)||n.set(l,[]),n.get(l).push(d)}else if(o.added){let l=o.value.trim();a.has(l)||a.set(l,[]),a.get(l).push(d)}});let r=0;for(let[o,d]of n.entries())if(a.has(o)){let l=a.get(o),c=Math.min(d.length,l.length);for(let f=0;f<c;f++){let p=d.shift(),h=l.shift();i[p].type="moved-from",i[p].moveId=r,i[h].type="moved-to",i[h].moveId=r,r++}}return i}visualizeWhitespace(e){return e.replace(/\t/g,"\u2192   ").replace(/ /g,"\xB7")}smartDiffWords(e,i){let n=/(\w+|[^\w]+)/g,a=e.match(n)||[],r=i.match(n)||[],o=Me(a,r),d=[];return o.forEach(l=>{let c=l.value.join("");if(d.length>0){let f=d[d.length-1];if(f.added===l.added&&f.removed===l.removed){f.value+=c,f.count=(f.count||0)+(l.count||0);return}}d.push({value:c,added:l.added,removed:l.removed,count:l.count})}),d}splitIntoSentences(e){if(!e)return[];let i=/.+?[.!?\n](?:\s|\n|$)|.+?\n\n|.+?$/g,n=e.match(i);return n?n.map(a=>a.trim()).filter(a=>a.length>0):[]}parseToSemanticBlocks(e){if(!e)return[];let i=[],n=e.split(/\n\n+/);for(let a of n){let r=a.trim();if(!r)continue;let o="paragraph";r.startsWith("#")?o="heading":r.startsWith("```")?o="code":r.startsWith(">")?o="quote":r.match(/^(\*|-|\+)\s/)||r.match(/^\d+\.\s/)?o="list":r.match(/^(---|___|\*\*\*)$/)&&(o="thematicBreak"),i.push({type:o,content:r,hash:this.plugin.hashContent(r)})}return i}async onOpen(){let{contentEl:e}=this;e.addClass("diff-modal"),b.Platform.isMobile&&e.addClass("is-mobile"),e.createEl("h2",{text:"\u{1F4CA} \u7248\u672C\u5DEE\u5F02\u5BF9\u6BD4"});let i=e.createEl("div"),n=e.createEl("div",{cls:"diff-main-container"});this.textDiffContainer=n.createEl("div",{cls:"diff-container"}),this.renderedDiffContainer=n.createEl("div",{cls:"rendered-diff-container",attr:{style:"display: none;"}}),this.structuredDiffContainer=n.createEl("div",{cls:"structured-diff-container",attr:{style:"display: none;"}}),this.loadingOverlay=n.createEl("div",{cls:"diff-loading-overlay",attr:{style:"display: none;"}}),this.loadingOverlay.createEl("div",{text:"\u6B63\u5728\u52A0\u8F7D\u65B0\u7248\u672C...",cls:"diff-loading-message"}),this.addMobileInteraction(this.renderedDiffContainer),this.addMobileInteraction(this.structuredDiffContainer);try{this.allVersions=await this.plugin.getAllVersions(this.file.path)}catch(E){new b.Notice("\u274C \u52A0\u8F7D\u7248\u672C\u5217\u8868\u5931\u8D25"),this.close();return}this.renderVersionSelectors(i),this.infoBannerContainer=i.createEl("div",{cls:"diff-info-banner-compact"});let a=i.createEl("div",{cls:"diff-toolbar-redesigned"}),r=a.createEl("div",{cls:"diff-view-switcher"}),o=r.createEl("button",{text:"\u6587\u672C",cls:"active"}),d=r.createEl("button",{text:"\u6E32\u67D3"}),l=r.createEl("button",{text:"\u7ED3\u6784"}),c=a.createEl("div",{cls:"diff-toolbar-group"}),f=c.createEl("button",{text:"\xAB",attr:{"aria-label":"\u7B2C\u4E00\u4E2A\u5DEE\u5F02"}}),p=c.createEl("button",{text:"\u2039",attr:{"aria-label":"\u4E0A\u4E00\u4E2A\u5DEE\u5F02 (\u2191)"}}),h=c.createEl("span",{cls:"diff-stats"}),u=c.createEl("button",{text:"\u203A",attr:{"aria-label":"\u4E0B\u4E00\u4E2A\u5DEE\u5F02 (\u2193)"}}),g=c.createEl("button",{text:"\xBB",attr:{"aria-label":"\u6700\u540E\u4E00\u4E2A\u5DEE\u5F02"}}),v=a.createEl("div");v.style.flexGrow="1";let w=a.createEl("div",{cls:"diff-toolbar-group"});w.createEl("button",{text:"\u64CD\u4F5C ...",attr:{"aria-label":"\u66F4\u591A\u64CD\u4F5C"}}).addEventListener("click",E=>{let C=new b.Menu;C.addItem(k=>k.setTitle("\u{1F50D} \u641C\u7D22").setIcon("search").onClick(()=>this.showSearchBox())),C.addItem(k=>k.setTitle("\u{1F4CB} \u590D\u5236\u5DEE\u5F02").setIcon("copy").onClick(()=>this.copyDiffToClipboard())),C.addItem(k=>k.setTitle("\u{1F4BE} \u5BFC\u51FA\u62A5\u544A").setIcon("download").onClick(()=>this.exportDiffReport())),C.addItem(k=>k.setTitle("\u{1F4CA} \u67E5\u770B\u7EDF\u8BA1").setIcon("bar-chart").onClick(()=>this.showDetailedStats())),C.showAtMouseEvent(E)});let x=a.createEl("div",{cls:"diff-toolbar-group"});x.createEl("button",{text:"\u8BBE\u7F6E \u2699\uFE0F",attr:{"aria-label":"\u89C6\u56FE\u8BBE\u7F6E"}}).addEventListener("click",E=>{let C=new b.Menu;C.addItem(S=>S.setTitle("\u5DEE\u5F02\u7C92\u5EA6").setDisabled(!0)),C.addItem(S=>S.setTitle("\u5B57\u7B26").setChecked(this.currentGranularity==="char").onClick(()=>this.updateGranularity("char"))),C.addItem(S=>S.setTitle("\u5355\u8BCD").setChecked(this.currentGranularity==="word").onClick(()=>this.updateGranularity("word"))),C.addItem(S=>S.setTitle("\u884C").setChecked(this.currentGranularity==="line").onClick(()=>this.updateGranularity("line"))),C.addItem(S=>S.setTitle("\u53E5\u5B50").setChecked(this.currentGranularity==="sentence").onClick(()=>this.updateGranularity("sentence"))),C.addItem(S=>S.setTitle("\u8BED\u4E49").setChecked(this.currentGranularity==="semantic").onClick(()=>this.updateGranularity("semantic"))),C.addItem(S=>S.setTitle("\u667A\u80FD\u5BF9\u6BD4").setDisabled(!0).setSection("diff-settings-group-label")),C.addItem(S=>S.setTitle("\u667A\u80FD\u5355\u8BCD\u6A21\u5F0F").setChecked(this.plugin.settings.smartWordDiff).onClick(async()=>{this.plugin.settings.smartWordDiff=!this.plugin.settings.smartWordDiff,await this.plugin.saveSettings(),this.renderTextDiff()})),C.addItem(S=>S.setTitle("\u884C\u5185\u5DEE\u5F02\u7B97\u6CD5").setDisabled(!0)),C.addItem(S=>S.setTitle("\u6309\u5355\u8BCD").setChecked(this.plugin.settings.inlineDiffAlgorithm==="word").onClick(async()=>{this.plugin.settings.inlineDiffAlgorithm="word",await this.plugin.saveSettings(),this.renderTextDiff()})),C.addItem(S=>S.setTitle("\u6309\u5B57\u7B26").setChecked(this.plugin.settings.inlineDiffAlgorithm==="char").onClick(async()=>{this.plugin.settings.inlineDiffAlgorithm="char",await this.plugin.saveSettings(),this.renderTextDiff()})),C.addSeparator(),C.addItem(S=>S.setTitle("\u89C6\u56FE\u6A21\u5F0F").setDisabled(!0));let k=this.containerEl.querySelector('.diff-select[aria-label="\u89C6\u56FE\u6A21\u5F0F"]');C.addItem(S=>S.setTitle("\u7EDF\u4E00\u89C6\u56FE").setChecked(k.value==="unified").onClick(()=>{k.value="unified",k.dispatchEvent(new Event("change"))})),C.addItem(S=>S.setTitle("\u5DE6\u53F3\u5206\u680F").setChecked(k.value==="split").onClick(()=>{k.value="split",k.dispatchEvent(new Event("change"))})),C.addSeparator(),C.addItem(S=>S.setTitle("\u81EA\u52A8\u6362\u884C").setChecked(this.wrapLines).onClick(()=>{this.wrapLines=!this.wrapLines,this.renderTextDiff()})),C.addItem(S=>S.setTitle("\u663E\u793A\u884C\u53F7").setChecked(this.showLineNumbers).onClick(()=>{this.showLineNumbers=!this.showLineNumbers,this.renderTextDiff()})),C.addItem(S=>S.setTitle("\u5FFD\u7565\u7A7A\u767D").setChecked(this.ignoreWhitespace).onClick(()=>{this.ignoreWhitespace=!this.ignoreWhitespace,this.renderTextDiff()})),C.addItem(S=>S.setTitle("\u663E\u793A\u7A7A\u767D").setChecked(this.showWhitespace).onClick(()=>{this.showWhitespace=!this.showWhitespace,this.renderTextDiff()})),C.addItem(S=>S.setTitle("\u68C0\u6D4B\u79FB\u52A8").setChecked(this.enableMoveDetection).onClick(()=>{this.enableMoveDetection=!this.enableMoveDetection,this.renderTextDiff()})),C.addItem(S=>S.setTitle("\u4EC5\u663E\u793A\u53D8\u66F4").setChecked(this.showOnlyChanges).onClick(()=>{this.showOnlyChanges=!this.showOnlyChanges,this.renderTextDiff()})),C.addSeparator(),C.addItem(S=>S.setTitle("\u5C55\u5F00\u6240\u6709").setIcon("chevrons-down-up").onClick(()=>{this.collapsedSections.clear(),this.renderTextDiff()})),C.addItem(S=>S.setTitle("\u6298\u53E0\u6240\u6709").setIcon("chevrons-up-down").onClick(()=>{this.textDiffContainer.querySelectorAll(".diff-collapse-btn").forEach((V,F)=>this.collapsedSections.add(F)),this.renderTextDiff()})),C.showAtMouseEvent(E)});let y=i.createEl("select",{cls:"diff-select",attr:{"aria-label":"\u89C6\u56FE\u6A21\u5F0F",style:"display: none;"}});y.createEl("option",{text:"\u7EDF\u4E00\u89C6\u56FE",value:"unified"}),y.createEl("option",{text:"\u5DE6\u53F3\u5206\u680F",value:"split"}),y.value=this.plugin.settings.diffViewMode,y.addEventListener("change",()=>{this.collapsedSections.clear(),this.renderTextDiff()});let D=E=>{this.currentView=E,o.toggleClass("active",E==="text"),d.toggleClass("active",E==="rendered"),l.toggleClass("active",E==="structured"),this.textDiffContainer.style.display=E==="text"?"":"none",this.renderedDiffContainer.style.display=E==="rendered"?"":"none",this.structuredDiffContainer.style.display=E==="structured"?"":"none";let C=E==="text";[c,w,x].forEach(k=>k.style.display=C?"flex":"none"),E==="rendered"&&!this.isRenderedViewBuilt&&(this.renderRenderedView(),this.isRenderedViewBuilt=!0),E==="structured"&&!this.isStructuredViewBuilt&&(this.renderStructuredDiff(),this.isStructuredViewBuilt=!0)};o.addEventListener("click",()=>D("text")),d.addEventListener("click",()=>D("rendered")),l.addEventListener("click",()=>D("structured")),p.addEventListener("click",()=>this.navigateDiff(-1)),u.addEventListener("click",()=>this.navigateDiff(1)),f.addEventListener("click",()=>this.navigateDiff("first")),g.addEventListener("click",()=>this.navigateDiff("last")),this.scope.register([],"ArrowUp",()=>(this.currentView==="text"&&!p.disabled&&p.click(),!1)),this.scope.register([],"ArrowDown",()=>(this.currentView==="text"&&!u.disabled&&u.click(),!1)),this.scope.register(["Mod"],"f",E=>(this.currentView==="text"&&(E.preventDefault(),this.showSearchBox()),!1)),this.textDiffContainer.addEventListener("mouseover",E=>{let k=E.target.closest("[data-move-id]");if(k){let S=k.dataset.moveId;this.textDiffContainer.querySelectorAll(`[data-move-id="${S}"]`).forEach(T=>T.addClass("diff-move-highlight"))}}),this.textDiffContainer.addEventListener("mouseout",E=>{let k=E.target.closest("[data-move-id]");if(k){let S=k.dataset.moveId;this.textDiffContainer.querySelectorAll(`[data-move-id="${S}"]`).forEach(T=>T.removeClass("diff-move-highlight"))}}),await this.updateDiffView()}addMobileInteraction(e){let i,n=r=>{let o=r.target;!o||o.tagName==="A"||o.tagName==="BUTTON"||(i=setTimeout(()=>{this.handleViewDoubleClick(r),new b.Notice("\u957F\u6309\u8DF3\u8F6C\u6210\u529F\uFF01")},800))},a=()=>{clearTimeout(i)};e.addEventListener("mousedown",n),e.addEventListener("mouseup",a),e.addEventListener("mouseleave",a),e.addEventListener("touchstart",n,{passive:!0}),e.addEventListener("touchend",a),e.addEventListener("touchcancel",a),e.addEventListener("dblclick",this.handleViewDoubleClick.bind(this))}handleViewDoubleClick(e){var l;e.preventDefault();let i=e.target;if(!i)return;let n=(l=i.textContent)==null?void 0:l.trim();if(!n||n.length<3)return;let a=i.closest(".rendered-diff-panel:first-child")!==null,r=i.closest(".rendered-diff-panel:last-child")!==null,o=i.closest(".structured-section"),d=null;if(this.currentView==="rendered")a?d=this.leftContent:r&&(d=this.rightContent);else if(this.currentView==="structured"&&o){let c=o.className.match(/structured-(added|removed|modified)/);c&&(c[1]==="removed"?d=this.leftContent:d=this.rightContent)}d&&this.findLineAndSwitchToTextView(n,d)}findLineAndSwitchToTextView(e,i){let n=e.substring(0,50),a=i.indexOf(n);if(a===-1){new b.Notice("\u2139\uFE0F \u672A\u80FD\u5B9A\u4F4D\u5230\u6E90\u7801\u4F4D\u7F6E");return}let o=(i.substring(0,a).match(/\n/g)||[]).length+1,d=this.containerEl.querySelector(".diff-view-switcher"),l=d==null?void 0:d.querySelector("button:first-child");l&&l.click(),setTimeout(()=>{let c=this.containerEl.querySelector('.diff-select[aria-label="\u89C6\u56FE\u6A21\u5F0F"]'),f=null;if(c.value==="unified"?f=this.textDiffContainer.querySelector(`.diff-line[data-line-number-right="${o}"]`)||this.textDiffContainer.querySelector(`.diff-line[data-line-number-left="${o}"]`):f=this.textDiffContainer.querySelector(`.diff-panel .diff-line[data-line-number="${o}"]`),f){let p=f;p.scrollIntoView({behavior:"smooth",block:"center"}),p.addClass("diff-line-highlight"),new b.Notice(`\u2705 \u5DF2\u5B9A\u4F4D\u5230\u6E90\u7801\u7B2C ${o} \u884C`),setTimeout(()=>{p.removeClass("diff-line-highlight")},2e3)}else new b.Notice(`\u2139\uFE0F \u5DF2\u5207\u6362\u89C6\u56FE\uFF0C\u4F46\u65E0\u6CD5\u9AD8\u4EAE\u7B2C ${o} \u884C`)},100)}updateGranularity(e){this.currentGranularity=e,this.collapsedSections.clear(),this.renderTextDiff()}navigateDiff(e){if(this.totalDiffs!==0){if(e==="first")this.currentDiffIndex=0;else if(e==="last")this.currentDiffIndex=this.totalDiffs-1;else{let i=this.currentDiffIndex+e;i>=0&&i<this.totalDiffs&&(this.currentDiffIndex=i)}this.updateNavState(),this.scrollToDiff()}}updateNavState(){let e=this.containerEl.querySelector(".diff-stats"),i=this.containerEl.querySelectorAll(".diff-toolbar-group button"),[n,a,,r,o]=Array.from(i);this.totalDiffs>0?(e.setText(`${this.currentDiffIndex+1} / ${this.totalDiffs}`),a.disabled=this.currentDiffIndex===0,n.disabled=this.currentDiffIndex===0,r.disabled=this.currentDiffIndex>=this.totalDiffs-1,o.disabled=this.currentDiffIndex>=this.totalDiffs-1):(e.setText(this.leftContent===this.rightContent?"\u2705":"0/0"),[n,a,r,o].forEach(d=>d.disabled=!0))}async applyChanges(e,i){if(this.secondVersionId==="current")try{let a=(await this.app.vault.read(this.file)).split(`
`);a.splice(i,0,e),await this.app.vault.modify(this.file,a.join(`
`)),new b.Notice("\u2705 \u5DF2\u5E94\u7528\u66F4\u6539"),await this.updateDiffView()}catch(n){new b.Notice("\u274C \u5E94\u7528\u66F4\u6539\u5931\u8D25"),console.error(n)}}async revertChanges(e,i,n=null){if(this.secondVersionId==="current")try{let r=(await this.app.vault.read(this.file)).split(`
`),o=i;if(o>=r.length||r[o]!==e){let d=r.indexOf(e);if(d!==-1)o=d;else throw new Error("\u65E0\u6CD5\u627E\u5230\u8981\u64A4\u9500\u7684\u884C\u3002")}n!==null?r[o]=n:r.splice(o,1),await this.app.vault.modify(this.file,r.join(`
`)),new b.Notice("\u2705 \u5DF2\u64A4\u9500\u66F4\u6539"),await this.updateDiffView()}catch(a){new b.Notice(`\u274C \u64A4\u9500\u66F4\u6539\u5931\u8D25: ${a.message}`),console.error(a)}}async showLineHistory(e){let i=new b.Notice("\u6B63\u5728\u641C\u7D22\u884C\u5386\u53F2...",0);try{let n=await this.findVersionsContainingLine(e);i.hide(),n.length>0?new pi(this.app,this.plugin,this.file,e,n).open():new b.Notice("\u672A\u5728\u5386\u53F2\u7248\u672C\u4E2D\u627E\u5230\u8BE5\u884C\u5185\u5BB9\u3002")}catch(n){i.hide(),new b.Notice("\u274C \u641C\u7D22\u884C\u5386\u53F2\u5931\u8D25"),console.error(n)}}async findVersionsContainingLine(e){let i=[],n=await this.plugin.getAllVersions(this.file.path);for(let a of n)try{(await this.plugin.getVersionContent(this.file.path,a.id)).includes(e)&&i.push(a)}catch(r){console.warn(`\u65E0\u6CD5\u83B7\u53D6\u7248\u672C ${a.id} \u7684\u5185\u5BB9`)}return i}renderVersionSelectors(e){let i=e.createEl("div",{cls:"diff-version-selector-container"}),n=i.createEl("div",{cls:"diff-version-selector"});n.createEl("span",{text:"\u7248\u672C A:",cls:"diff-selector-label"}),n.createEl("button",{text:"\u52A0\u8F7D\u4E2D...",cls:"diff-selector-btn",attr:{id:"diff-left-version-btn"}}).addEventListener("click",l=>{this.showVersionSelectionMenu(l,"left")}),i.createEl("button",{text:"\u2194\uFE0F",cls:"diff-swap-btn",attr:{title:"\u4EA4\u6362\u5BF9\u6BD4\u7248\u672C"}}).addEventListener("click",async()=>{[this.versionId,this.secondVersionId]=[this.secondVersionId,this.versionId],await this.updateDiffView()});let o=i.createEl("div",{cls:"diff-version-selector"});o.createEl("span",{text:"\u7248\u672C B:",cls:"diff-selector-label"}),o.createEl("button",{text:"\u52A0\u8F7D\u4E2D...",cls:"diff-selector-btn",attr:{id:"diff-right-version-btn"}}).addEventListener("click",l=>{this.showVersionSelectionMenu(l,"right")})}showVersionSelectionMenu(e,i){let n=new b.Menu;n.addItem(a=>a.setTitle("\u{1F4C4} \u5F53\u524D\u6587\u4EF6").setIcon("file-text").onClick(()=>{this.handleVersionChange(i,"current")})),this.allVersions.length===0?(n.addSeparator(),n.addItem(a=>a.setTitle("\u6682\u65E0\u5386\u53F2\u7248\u672C").setDisabled(!0))):(n.addSeparator(),this.allVersions.forEach(a=>{n.addItem(r=>r.setTitle(`${this.plugin.formatTime(a.timestamp)} - ${a.message}`).setIcon("history").onClick(()=>{this.handleVersionChange(i,a.id)}))})),n.showAtMouseEvent(e)}async handleVersionChange(e,i){let n=this.versionId,a=this.secondVersionId;if(e==="left"){if(i===n)return;i===a?[this.versionId,this.secondVersionId]=[this.secondVersionId,this.versionId]:this.versionId=i}else{if(i===a)return;i===n?[this.versionId,this.secondVersionId]=[this.secondVersionId,this.versionId]:this.secondVersionId=i}await this.updateDiffView()}async updateDiffView(){this.loadingOverlay.style.display="flex";try{this.versionId==="current"?this.leftContent=await this.app.vault.read(this.file):this.leftContent=await this.plugin.getVersionContent(this.file.path,this.versionId),this.secondVersionId==="current"?this.rightContent=await this.app.vault.read(this.file):this.rightContent=await this.plugin.getVersionContent(this.file.path,this.secondVersionId),this.updateSelectorButtonLabels(),this.isRenderedViewBuilt=!1,this.isStructuredViewBuilt=!1,this.currentView==="text"?this.renderTextDiff():this.currentView==="rendered"?(this.renderRenderedView(),this.isRenderedViewBuilt=!0):this.currentView==="structured"&&(this.renderStructuredDiff(),this.isStructuredViewBuilt=!0)}catch(e){console.error("\u52A0\u8F7D\u5DEE\u5F02\u5931\u8D25:",e),new b.Notice("\u274C \u52A0\u8F7D\u7248\u672C\u5185\u5BB9\u5931\u8D25")}finally{this.loadingOverlay.style.display="none"}}updateSelectorButtonLabels(){let e=this.containerEl.querySelector("#diff-left-version-btn"),i=this.containerEl.querySelector("#diff-right-version-btn");if(e)if(this.versionId==="current")e.setText("\u{1F4C4} \u5F53\u524D\u6587\u4EF6");else{let n=this.allVersions.find(a=>a.id===this.versionId);e.setText(n?`\u{1F552} ${this.plugin.formatTime(n.timestamp)}`:"\u672A\u77E5\u7248\u672C")}if(i)if(this.secondVersionId==="current")i.setText("\u{1F4C4} \u5F53\u524D\u6587\u4EF6");else{let n=this.allVersions.find(a=>a.id===this.secondVersionId);i.setText(n?`\u{1F552} ${this.plugin.formatTime(n.timestamp)}`:"\u672A\u77E5\u7248\u672C")}}async renderRenderedView(){this.renderedDiffContainer.empty();let e=this.renderedDiffContainer.createEl("div",{cls:"rendered-diff-panel"}),i=this.renderedDiffContainer.createEl("div",{cls:"rendered-diff-panel"}),n=this.allVersions.find(E=>E.id===this.versionId),a=this.allVersions.find(E=>E.id===this.secondVersionId),r=this.versionId==="current"?"\u5F53\u524D\u6587\u4EF6":n?`\u7248\u672C A: ${this.plugin.formatTime(n.timestamp)}`:"\u7248\u672C A",o=this.secondVersionId==="current"?"\u5F53\u524D\u6587\u4EF6":a?`\u7248\u672C B: ${this.plugin.formatTime(a.timestamp)}`:"\u7248\u672C B";e.createEl("h3",{text:r}),i.createEl("h3",{text:o});let d=e.createEl("div",{cls:"rendered-diff-content"}),l=i.createEl("div",{cls:"rendered-diff-content"}),c=this.currentGranularity==="line"?$(this.leftContent,this.rightContent):this.currentGranularity==="word"?K(this.leftContent,this.rightContent):se(this.leftContent,this.rightContent),f="",p="",h="[[VC-DEL]]",u="[[/VC-DEL]]",g="[[VC-ADD]]",v="[[/VC-ADD]]";for(let E of c){let C=E.value;E.added?p+=g+C+v:E.removed?f+=h+C+u:(f+=C,p+=C)}let w=createDiv(),_=createDiv();await b.MarkdownRenderer.renderMarkdown(f,w,this.file.path,this.plugin),await b.MarkdownRenderer.renderMarkdown(p,_,this.file.path,this.plugin);let x=w.innerHTML,m=_.innerHTML;x=x.replace(/\[\[VC-DEL\]\]/g,'<span class="diff-rendered-removed">').replace(/\[\[\/VC-DEL\]\]/g,"</span>"),m=m.replace(/\[\[VC-ADD\]\]/g,'<span class="diff-rendered-added">').replace(/\[\[\/VC-ADD\]\]/g,"</span>"),d.innerHTML=x,l.innerHTML=m;let y=!1,D=(E,C)=>{y||(y=!0,C.scrollTop=E.scrollTop,setTimeout(()=>{y=!1},50))};d.addEventListener("scroll",()=>D(d,l)),l.addEventListener("scroll",()=>D(l,d))}renderTextDiff(){let e=this.textDiffContainer;e.empty(),this.diffElements=[],this.currentDiffIndex=0,this.totalDiffs=0;let i=this.leftContent,n=this.rightContent;if(this.ignoreWhitespace&&(i=this.leftContent.replace(/\s+/g," ").trim(),n=this.rightContent.replace(/\s+/g," ").trim()),!i&&!n){e.createEl("div",{text:"\u4E24\u4E2A\u7248\u672C\u90FD\u662F\u7A7A\u6587\u4EF6",cls:"diff-empty-notice"});return}e.toggleClass("show-whitespace-active",this.showWhitespace);let a=this.containerEl.querySelector('.diff-select[aria-label="\u89C6\u56FE\u6A21\u5F0F"]');if(this.currentGranularity==="sentence")if(a.value==="unified")e.removeClass("diff-split"),this.renderSentenceUnifiedDiff(e,i,n);else{e.addClass("diff-split");let r=this.containerEl.querySelector("#diff-left-version-btn"),o=this.containerEl.querySelector("#diff-right-version-btn");this.renderSentenceSplitDiff(e,i,n,r.textContent||"\u7248\u672C A",o.textContent||"\u7248\u672C B")}else if(this.currentGranularity==="semantic")this.renderSemanticDiff(e,i,n);else if(a.value==="unified")e.removeClass("diff-split"),this.renderUnifiedDiff(e,i,n);else{e.addClass("diff-split");let r=this.containerEl.querySelector("#diff-left-version-btn"),o=this.containerEl.querySelector("#diff-right-version-btn");this.renderSplitDiff(e,i,n,r.textContent||"\u7248\u672C A",o.textContent||"\u7248\u672C B")}this.wrapLines?e.addClass("diff-wrap-lines"):e.removeClass("diff-wrap-lines"),this.totalDiffs=this.diffElements.length,this.updateNavState(),this.totalDiffs>0&&setTimeout(()=>this.scrollToDiff(),100),this.updateCompactDiffInfo(),this.plugin.refreshVersionHistoryView()}updateCompactDiffInfo(){let e=this.infoBannerContainer;if(!e)return;e.empty();let i=this.leftContent,n=this.rightContent;this.ignoreWhitespace&&(i=this.leftContent.replace(/\s+/g," ").trim(),n=this.rightContent.replace(/\s+/g," ").trim());let a=$(i,n),r=0,o=0;for(let f of a)f.added?r+=f.count||0:f.removed&&(o+=f.count||0);let d=this.leftContent.split(`
`).length,l=r+o,c=d>0?(l/d*100).toFixed(1):"0";e.createEl("span",{text:`\u{1F4CA} \u603B\u884C\u6570: ${d}`,cls:"diff-info-item"}),e.createEl("span",{text:`+${r}`,cls:"diff-info-added"}),e.createEl("span",{text:`-${o}`,cls:"diff-info-removed"}),e.createEl("span",{text:`~${l}`,cls:"diff-info-changed"}),e.createEl("span",{text:`\u53D8\u5316\u7387: ${c}%`,cls:"diff-info-percent"}),e.addClass("diff-info-updated"),setTimeout(()=>{e.removeClass("diff-info-updated")},500)}showDetailedStats(){let e=$(this.leftContent,this.rightContent),i=0,n=0,a=0,r=0;for(let c of e)c.added?(i+=(c.value.match(/\n/g)||[]).length,a+=c.value.length):c.removed&&(n+=(c.value.match(/\n/g)||[]).length,r+=c.value.length);let o=this.leftContent.split(`
`).length,d=this.rightContent.split(`
`).length,l=this.calculateSimilarity(this.leftContent,this.rightContent);new b.Notice(`\u{1F4CA} \u8BE6\u7EC6\u7EDF\u8BA1

\u5DE6\u4FA7\u7248\u672C: ${o} \u884C, ${this.leftContent.length} \u5B57\u7B26
\u53F3\u4FA7\u7248\u672C: ${d} \u884C, ${this.rightContent.length} \u5B57\u7B26

\u65B0\u589E: ${i} \u884C, ${a} \u5B57\u7B26
\u5220\u9664: ${n} \u884C, ${r} \u5B57\u7B26
\u76F8\u4F3C\u5EA6: ${l.toFixed(1)}%
\u5DEE\u5F02\u5757: ${this.totalDiffs} \u4E2A`,1e4)}calculateSimilarity(e,i){let n=e.length,a=i.length,r=Math.max(n,a);if(r===0)return 100;let o=0,d=Math.min(n,a);for(let l=0;l<d;l++)e[l]===i[l]&&o++;return o/r*100}showSearchBox(){let e=this.containerEl.createEl("div",{cls:"diff-search-container"}),i=e.createEl("input",{type:"text",placeholder:"\u641C\u7D22\u5DEE\u5F02\u5185\u5BB9...",cls:"diff-search-input"}),n=e.createEl("span",{cls:"diff-search-results"}),a=e.createEl("button",{text:"\xD7",cls:"diff-search-close"}),r=[],o=0;i.addEventListener("input",()=>{let l=i.value.toLowerCase();if(r.forEach(c=>c.removeClass("diff-search-match")),r=[],o=0,l.length<2){n.setText("");return}this.diffElements.forEach(c=>{var p;(((p=c.textContent)==null?void 0:p.toLowerCase())||"").includes(l)&&(c.addClass("diff-search-match"),r.push(c))}),r.length>0?(n.setText(`${o+1} / ${r.length}`),r[0].addClass("diff-search-current"),r[0].scrollIntoView({behavior:"smooth",block:"center"})):n.setText("\u65E0\u7ED3\u679C")}),i.addEventListener("keydown",l=>{l.key==="Enter"?(l.preventDefault(),r.length>0&&(r[o].removeClass("diff-search-current"),o=(o+1)%r.length,r[o].addClass("diff-search-current"),r[o].scrollIntoView({behavior:"smooth",block:"center"}),n.setText(`${o+1} / ${r.length}`))):l.key==="Escape"&&e.remove()}),a.addEventListener("click",()=>{r.forEach(l=>{l.removeClass("diff-search-match"),l.removeClass("diff-search-current")}),e.remove()});let d=this.containerEl.querySelector(".diff-toolbar-redesigned");d&&d.insertAdjacentElement("afterend",e),i.focus()}async exportDiffReport(){try{let e=$(this.leftContent,this.rightContent),i=`# \u7248\u672C\u5DEE\u5F02\u62A5\u544A

`;i+=`**\u6587\u4EF6**: ${this.file.path}
`,i+=`**\u751F\u6210\u65F6\u95F4**: ${new Date().toLocaleString("zh-CN")}

`;let n=await this.plugin.getAllVersions(this.file.path),a=n.find(c=>c.id===this.versionId);if(a?i+=`**\u5BF9\u6BD4\u7248\u672C**: ${this.plugin.formatTime(a.timestamp)}
`:this.versionId==="current"&&(i+=`**\u5BF9\u6BD4\u7248\u672C**: \u5F53\u524D\u6587\u4EF6
`),this.secondVersionId){let c=n.find(f=>f.id===this.secondVersionId);c?i+=`**\u76EE\u6807\u7248\u672C**: ${this.plugin.formatTime(c.timestamp)}
`:this.secondVersionId==="current"&&(i+=`**\u76EE\u6807\u7248\u672C**: \u5F53\u524D\u6587\u4EF6
`)}i+=`
## \u7EDF\u8BA1\u4FE1\u606F

`;let r=0,o=0,d=0;for(let c of e){let f=c.value.split(`
`).length-1;c.added?r+=f:c.removed?o+=f:d+=f}i+=`- \u65B0\u589E\u884C\u6570: ${r}
`,i+=`- \u5220\u9664\u884C\u6570: ${o}
`,i+=`- \u672A\u53D8\u5316\u884C\u6570: ${d}
`,i+=`- \u603B\u884C\u6570: ${r+o+d}

`,i+=`## \u5DEE\u5F02\u5185\u5BB9

`,i+="```diff\n";for(let c of e){let f=c.added?"+":c.removed?"-":" ",p=c.value.split(`
`);p.forEach((h,u)=>{u<p.length-1&&(i+=`${f} ${h}
`)})}i+="```\n";let l=`diff_report_${Date.now()}.md`;await this.app.vault.create(l,i),new b.Notice(`\u2705 \u5DEE\u5F02\u62A5\u544A\u5DF2\u5BFC\u51FA: ${l}`)}catch(e){console.error("\u5BFC\u51FA\u5DEE\u5F02\u62A5\u544A\u5931\u8D25:",e),new b.Notice("\u274C \u5BFC\u51FA\u5931\u8D25")}}renderUnifiedDiff(e,i,n){if(this.currentGranularity==="char"||this.currentGranularity==="word"){let g=(this.currentGranularity==="char"?se:this.plugin.settings.smartWordDiff?this.smartDiffWords:K)(i,n),v=e.createEl("div",{cls:"line-content"}),w=0;g.forEach(_=>{let x=this.showWhitespace?this.visualizeWhitespace(_.value):_.value,m=v.createEl("span",{text:x});_.added?(m.addClass("diff-word-added"),m.dataset.diffIndex=String(w++),this.diffElements.push(m)):_.removed&&(m.addClass("diff-word-removed"),m.dataset.diffIndex=String(w++),this.diffElements.push(m))});return}let a=$(i,n),r=this.enableMoveDetection?this.processDiffForMoves(a):a.map(u=>({...u,type:u.added?"added":u.removed?"removed":"context"})),o=1,d=1,l=0,f=(()=>this.plugin.settings.inlineDiffAlgorithm==="char"?se:this.plugin.settings.smartWordDiff?this.smartDiffWords:K)(),p=u=>{let g=document.createDocumentFragment();return u.forEach(v=>{let w=v.added?"diff-word-added":v.removed?"diff-word-removed":"",_=this.showWhitespace?this.visualizeWhitespace(v.value):v.value;w?g.append(createEl("span",{text:_,cls:w})):g.append(document.createTextNode(_))}),g},h=(u,g,v,w,_,x=null)=>{let m=e.createEl("div",{cls:`diff-line diff-${g}`});g!=="context"&&(m.dataset.diffIndex=String(l++),this.diffElements.push(m)),_!==void 0&&(m.dataset.moveId=String(_)),v&&(m.dataset.lineNumberLeft=String(v)),w&&(m.dataset.lineNumberRight=String(w));let y=m.createEl("div",{cls:"line-number-container"});if(this.showLineNumbers&&(y.createEl("span",{cls:"line-number line-number-left",text:v?String(v):""}),y.createEl("span",{cls:"line-number line-number-right",text:w?String(w):""})),y.createEl("span",{text:"\u{1F4DC}",cls:"diff-line-history-btn",attr:{"aria-label":"\u67E5\u770B\u884C\u5386\u53F2"}}).addEventListener("click",()=>this.showLineHistory(typeof u=="string"?u:u.textContent||"")),this.secondVersionId==="current"){if(g==="added"||g==="modified"&&w){let k=y.createEl("span",{text:"-",cls:"diff-line-action-btn",attr:{"aria-label":"\u64A4\u9500\u6B64\u66F4\u6539"}}),S=typeof u=="string"?u:u.textContent||"";k.addEventListener("click",()=>this.revertChanges(S,w-1,x))}(g==="removed"||g==="modified"&&v)&&y.createEl("span",{text:"+",cls:"diff-line-action-btn",attr:{"aria-label":"\u5E94\u7528\u6B64\u66F4\u6539"}}).addEventListener("click",()=>this.applyChanges(typeof u=="string"?u:u.textContent||"",w||d))}let E=" ";g==="added"?E="+":g==="removed"?E="-":g==="moved-from"?E="\u2BAB":g==="moved-to"?E="\u2BAA":g==="modified"&&(E="~"),m.createEl("span",{cls:"diff-marker",text:E});let C=m.createEl("span",{cls:"line-content"});typeof u=="string"?C.setText(this.showWhitespace?this.visualizeWhitespace(u):u):C.appendChild(u),b.Platform.isMobile&&m.addEventListener("dblclick",k=>{var V;k.stopPropagation();let S=m.hasClass("actions-visible"),T=(V=m.parentElement)==null?void 0:V.querySelectorAll(".diff-line");T==null||T.forEach(F=>F.removeClass("actions-visible")),S||m.addClass("actions-visible")})};for(let u=0;u<r.length;u++){let g=r[u],v=r[u+1];if(g.removed&&v&&v.added){let w=g.value.replace(/\n$/,"").split(`
`),_=v.value.replace(/\n$/,"").split(`
`);if(w.length===_.length)for(let x=0;x<w.length;x++){let m=w[x],y=_[x],D=f(m,y),E=p(D.filter(k=>!k.added)),C=p(D.filter(k=>!k.removed));h(E,"removed",o++,null),h(C,"added",null,d++,void 0,m)}else g.value.replace(/\n$/,"").split(`
`).forEach(x=>{h(x,"removed",o++,null)}),v.value.replace(/\n$/,"").split(`
`).forEach(x=>{h(x,"added",null,d++,void 0,null)});u++}else{let w=g.value.replace(/\n$/,"").split(`
`);for(let _ of w)g.type==="moved-from"?h(_,"moved-from",o++,null,g.moveId):g.type==="moved-to"?h(_,"moved-to",null,d++,g.moveId):g.added?h(_,"added",null,d++,void 0,null):g.removed?h(_,"removed",o++,null):(this.showOnlyChanges||h(_,"context",o,d),o++,d++)}}}renderSplitDiff(e,i,n,a,r){let o=e.createEl("div",{cls:"diff-panel"}),d=e.createEl("div",{cls:"diff-panel"});o.createEl("h3",{text:a}),d.createEl("h3",{text:r});let l=o.createEl("div",{cls:"diff-content"}),c=d.createEl("div",{cls:"diff-content"});this.renderSplitViewAdvanced(l,c,i,n)}renderSplitViewAdvanced(e,i,n,a){if(this.currentGranularity==="char"||this.currentGranularity==="word"){let v=(this.currentGranularity==="char"?se:this.plugin.settings.smartWordDiff?this.smartDiffWords:K)(n,a),w=0;v.forEach(_=>{let x=this.showWhitespace?this.visualizeWhitespace(_.value):_.value;if(_.added){let m=i.createEl("span",{text:x,cls:"diff-word-added"});m.dataset.diffIndex=String(w++),this.diffElements.push(m)}else if(_.removed){let m=e.createEl("span",{text:x,cls:"diff-word-removed"});m.dataset.diffIndex=String(w++),this.diffElements.push(m)}else e.createEl("span",{text:x}),i.createEl("span",{text:x})});return}let r=$(n,a),o=this.enableMoveDetection?this.processDiffForMoves(r):r.map(g=>({...g,type:g.added?"added":g.removed?"removed":"context"})),d=1,l=1,c=0,p=(()=>this.plugin.settings.inlineDiffAlgorithm==="char"?se:this.plugin.settings.smartWordDiff?this.smartDiffWords:K)(),h=g=>{let v=document.createDocumentFragment();return g.forEach(w=>{let _=w.added?"diff-word-added":w.removed?"diff-word-removed":"",x=this.showWhitespace?this.visualizeWhitespace(w.value):w.value;_?v.append(createEl("span",{text:x,cls:_})):v.append(document.createTextNode(x))}),v},u=(g,v,w,_,x,m=null)=>{let y=g.createEl("div",{cls:`diff-line diff-${w}`});w!=="context"&&w!=="placeholder"&&(y.dataset.diffIndex=String(c++),this.diffElements.push(y)),_&&(y.dataset.lineNumber=String(_)),x!==void 0&&(y.dataset.moveId=String(x));let D=y.createEl("div",{cls:"line-number-container"});if(this.showLineNumbers&&D.createEl("span",{cls:"line-number",text:_?String(_):""}),D.createEl("span",{text:"\u{1F4DC}",cls:"diff-line-history-btn",attr:{"aria-label":"\u67E5\u770B\u884C\u5386\u53F2"}}).addEventListener("click",()=>this.showLineHistory(typeof v=="string"?v:v.textContent||"")),this.secondVersionId==="current"){let k=g===i;if(k&&(w==="added"||w==="modified")){let S=D.createEl("span",{text:"-",cls:"diff-line-action-btn",attr:{"aria-label":"\u64A4\u9500\u6B64\u66F4\u6539"}}),T=typeof v=="string"?v:v.textContent||"";S.addEventListener("click",()=>this.revertChanges(T,_-1,m))}!k&&(w==="removed"||w==="modified")&&D.createEl("span",{text:"+",cls:"diff-line-action-btn",attr:{"aria-label":"\u5E94\u7528\u6B64\u66F4\u6539"}}).addEventListener("click",()=>this.applyChanges(typeof v=="string"?v:v.textContent||"",l))}let C=y.createEl("span",{cls:"line-content"});typeof v=="string"?C.setText(this.showWhitespace?this.visualizeWhitespace(v):v):C.appendChild(v),b.Platform.isMobile&&y.addEventListener("dblclick",k=>{var V,F;k.stopPropagation();let S=y.hasClass("actions-visible"),T=(F=(V=y.parentElement)==null?void 0:V.parentElement)==null?void 0:F.querySelectorAll(".diff-line");T==null||T.forEach(I=>I.removeClass("actions-visible")),S||y.addClass("actions-visible")})};for(let g=0;g<o.length;g++){let v=o[g],w=o[g+1];if(v.removed&&w&&w.added){let _=v.value.replace(/\n$/,"").split(`
`),x=w.value.replace(/\n$/,"").split(`
`),m=Math.max(_.length,x.length);for(let y=0;y<m;y++){let D=_[y],E=x[y];if(D!==void 0&&E!==void 0){let C=p(D,E),k=h(C.filter(T=>!T.added)),S=h(C.filter(T=>!T.removed));u(e,k,"modified",d++),u(i,S,"modified",l++,void 0,D)}else D!==void 0?(u(e,D,"removed",d++),u(i,"","placeholder",null)):E!==void 0&&(u(e,"","placeholder",null),u(i,E,"added",l++,void 0,null))}g++}else if(v.type==="moved-from"){let _=v.value.replace(/\n$/,"").split(`
`);for(let x of _)u(e,x,"moved-from",d++,v.moveId),u(i,"","placeholder",null)}else if(v.type==="moved-to"){let _=v.value.replace(/\n$/,"").split(`
`);for(let x of _)u(e,"","placeholder",null),u(i,x,"moved-to",l++,v.moveId)}else if(v.added){let _=v.value.replace(/\n$/,"").split(`
`);for(let x of _)u(e,"","placeholder",null),u(i,x,"added",l++,v.moveId,null)}else if(v.removed){let _=v.value.replace(/\n$/,"").split(`
`);for(let x of _)u(e,x,"removed",d++,v.moveId),u(i,"","placeholder",null)}else{let _=v.value.replace(/\n$/,"").split(`
`);for(let x of _)this.showOnlyChanges||(u(e,x,"context",d),u(i,x,"context",l)),d++,l++}}}renderSentenceUnifiedDiff(e,i,n){let a=this.splitIntoSentences(i),r=this.splitIntoSentences(n),o=Me(a,r),d=0,l=this.plugin.settings.smartWordDiff?this.smartDiffWords:K,c=p=>{let h=document.createDocumentFragment();return p.forEach(u=>{let g=u.added?"diff-word-added":u.removed?"diff-word-removed":"";h.append(createEl("span",{text:u.value,cls:g}))}),h},f=(p,h)=>{let u=e.createEl("div",{cls:`diff-line diff-${h}`});h!=="context"&&(u.dataset.diffIndex=String(d++),this.diffElements.push(u));let g=" ";h==="added"?g="+":h==="removed"?g="-":h==="modified"&&(g="~"),u.createEl("span",{cls:"diff-marker",text:g});let v=u.createEl("span",{cls:"line-content"});typeof p=="string"?v.setText(p):v.appendChild(p)};for(let p=0;p<o.length;p++){let h=o[p],u=o[p+1];if(h.removed&&u&&u.added){let g=h.value.join(" "),v=u.value.join(" "),w=l(g,v);f(c(w),"modified"),p++}else h.added?h.value.forEach(g=>f(g,"added")):h.removed?h.value.forEach(g=>f(g,"removed")):this.showOnlyChanges||h.value.forEach(g=>f(g,"context"))}}renderSentenceSplitDiff(e,i,n,a,r){let o=e.createEl("div",{cls:"diff-panel"}),d=e.createEl("div",{cls:"diff-panel"});o.createEl("h3",{text:a}),d.createEl("h3",{text:r});let l=o.createEl("div",{cls:"diff-content"}),c=d.createEl("div",{cls:"diff-content"}),f=this.splitIntoSentences(i),p=this.splitIntoSentences(n),h=Me(f,p),u=0,g=this.plugin.settings.smartWordDiff?this.smartDiffWords:K,v=(_,x)=>{let m=document.createDocumentFragment();return _.forEach(y=>{if(x==="added"&&y.removed||x==="removed"&&y.added)return;let D=y.added?"diff-word-added":y.removed?"diff-word-removed":"";m.append(createEl("span",{text:y.value,cls:D}))}),m},w=(_,x,m)=>{let y=_.createEl("div",{cls:`diff-line diff-${m}`});m!=="context"&&m!=="placeholder"&&(y.dataset.diffIndex=String(u++),this.diffElements.push(y));let D=y.createEl("span",{cls:"line-content"});typeof x=="string"?D.setText(x):D.appendChild(x)};for(let _=0;_<h.length;_++){let x=h[_],m=h[_+1];if(x.removed&&m&&m.added){let y=x.value.join(" "),D=m.value.join(" "),E=g(y,D);w(l,v(E,"removed"),"modified"),w(c,v(E,"added"),"modified"),_++}else x.added?x.value.forEach(y=>{w(l,"","placeholder"),w(c,y,"added")}):x.removed?x.value.forEach(y=>{w(l,y,"removed"),w(c,"","placeholder")}):this.showOnlyChanges||x.value.forEach(y=>{w(l,y,"context"),w(c,y,"context")})}}renderSemanticDiff(e,i,n){let a=this.parseToSemanticBlocks(i),r=this.parseToSemanticBlocks(n),o=(h,u,g)=>{let v=null;for(let w=0;w<u.length;w++){if(g.has(w))continue;let _=this.calculateSimilarity(h.content,u[w].content);_>((v==null?void 0:v.score)||.5)&&(v={index:w,score:_})}return v},d=new Array(a.length).fill(null),l=new Set;for(let h=0;h<a.length;h++){let u=o(a[h],r,l);u&&(d[h]=u.index,l.add(u.index))}let c=0,f=(h,u,g)=>{let v=e.createEl("div",{cls:`diff-semantic-block diff-${u}`});u!=="context"&&(v.dataset.diffIndex=String(c++),this.diffElements.push(v));let w=v.createEl("div",{cls:"diff-semantic-header"}),_=" ";u==="added"?_="+":u==="removed"?_="-":u==="modified"&&(_="~"),w.createEl("span",{cls:"diff-marker",text:_}),w.createEl("span",{text:h.type.toUpperCase(),cls:"diff-semantic-type"});let x=v.createEl("div",{cls:"diff-semantic-content"});g?x.appendChild(g):x.createEl("pre",{text:h.content})},p=0;for(let h=0;h<a.length;h++){let u=d[h];for(;p<(u!=null?u:r.length);)[...l].includes(p)||f(r[p],"added"),p++;if(u!==null){let g=a[h],v=r[u];if(g.hash===v.hash)this.showOnlyChanges||f(g,"context");else{let w=createDiv();this.renderUnifiedDiff(w,g.content,v.content),f(v,"modified",w)}p=u+1}else f(a[h],"removed")}for(;p<r.length;)l.has(p)||f(r[p],"added"),p++}scrollToDiff(){if(this.diffElements.length===0||this.currentDiffIndex>=this.diffElements.length)return;let e=this.diffElements[this.currentDiffIndex];this.diffElements.forEach(i=>i.removeClass("diff-current")),e.addClass("diff-current"),e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}copyDiffToClipboard(){let e=this.containerEl.querySelector(".diff-container");e&&navigator.clipboard.writeText(e.textContent||"").then(()=>{new b.Notice("\u2705 \u5DEE\u5F02\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}).catch(()=>{new b.Notice("\u274C \u590D\u5236\u5931\u8D25")})}renderStructuredDiff(){let e=this.structuredDiffContainer;e.empty();let i=this.parseMarkdownSections(this.leftContent),n=this.parseMarkdownSections(this.rightContent),a=this.compareSections(i,n);if(a.length===0){e.createEl("div",{text:"\u2705 \u5185\u5BB9\u76F8\u540C",cls:"diff-empty-notice"});return}for(let r of a){let o=e.createEl("details",{cls:`structured-section structured-${r.type}`}),d=o.createEl("summary"),l="",c="",f=!1;switch(r.type){case"added":l="\u65B0\u589E",c=r.section.heading,f=!0;break;case"removed":l="\u5220\u9664",c=r.section.heading,f=!0;break;case"modified":l="\u4FEE\u6539",c=r.right.heading,f=!0;break;case"unchanged":l="\u672A\u53D8",c=r.right.heading;break}d.createEl("span",{text:l,cls:`diff-badge diff-badge-${r.type}`}),d.createEl("span",{text:c,cls:"section-heading"}),o.open=f;let p=o.createEl("div",{cls:"section-content"});r.type==="modified"?this.renderUnifiedDiff(p,r.left.content,r.right.content):r.type==="added"?p.createEl("pre",{text:r.section.content}):r.type==="removed"&&p.createEl("pre",{text:r.section.content})}}parseMarkdownSections(e){let i=[],n=/^(#+)\s+(.*)/,a=e.split(`
`),r=null,o=[],d=0;for(let l of a){let c=l.match(n);c?(r?(r.content=o.join(`
`).trim(),i.push(r)):o.length>0&&o.join("").trim()!==""&&i.push({heading:"\uFF08\u6587\u6863\u5F00\u5934\uFF09",level:0,content:o.join(`
`).trim(),originalIndex:d++}),o=[],r={heading:c[2],level:c[1].length,content:"",originalIndex:d++}):o.push(l)}return r?(r.content=o.join(`
`).trim(),i.push(r)):o.length>0&&o.join("").trim()!==""&&i.push({heading:i.length>0?"\uFF08\u6587\u6863\u672B\u5C3E\uFF09":"\uFF08\u5168\u6587\uFF09",level:0,content:o.join(`
`).trim(),originalIndex:d++}),i}compareSections(e,i){let n=[],a=new Map(e.map(o=>[o.heading,o])),r=new Set;for(let o of i){let d=a.get(o.heading);if(d){if(d.content.trim()===o.content.trim())n.push({type:"unchanged",left:d,right:o});else{let l=$(d.content,o.content),c=this.processDiffForMoves(l);n.push({type:"modified",left:d,right:o,diff:c})}r.add(o.heading)}else n.push({type:"added",section:o})}for(let o of e)r.has(o.heading)||n.push({type:"removed",section:o});return n.sort((o,d)=>{let l=c=>c.type==="added"?c.section.originalIndex:c.type==="modified"||c.type==="unchanged"?c.right.originalIndex:1/0;return l(o)-l(d)})}onClose(){let{contentEl:e}=this;e.empty()}},pi=class extends b.Modal{constructor(e,i,n,a,r){super(e);this.plugin=i,this.file=n,this.lineText=a,this.versions=r}onOpen(){let{contentEl:e}=this;e.addClass("line-history-modal"),e.createEl("h2",{text:"\u884C\u5386\u53F2"}),e.createEl("p",{text:"\u4EE5\u4E0B\u7248\u672C\u4E2D\u5305\u542B\u4E86\u8FD9\u884C\u5185\u5BB9:"}),e.createEl("pre",{text:this.lineText});let i=e.createEl("div",{cls:"version-select-list"});if(this.versions.length===0){i.createEl("div",{text:"\u6CA1\u6709\u627E\u5230\u5339\u914D\u7684\u5386\u53F2\u7248\u672C\u3002",cls:"version-select-empty"});return}for(let n of this.versions){let a=i.createEl("div",{cls:"version-select-item"}),r=a.createEl("div",{cls:"version-info"});r.createEl("div",{text:this.plugin.formatTime(n.timestamp),cls:"version-time"}),r.createEl("div",{text:n.message,cls:"version-message"}),a.createEl("button",{text:"\u5BF9\u6BD4"}).addEventListener("click",()=>{this.close(),new ne(this.app,this.plugin,this.file,n.id).open()})}}onClose(){this.contentEl.empty()}},vi=class extends b.Modal{constructor(e,i,n,a,r){super(e);this.searchQuery="";this.plugin=i,this.file=n,this.firstVersionId=a,this.onSelect=r}async onOpen(){let{contentEl:e}=this;e.addClass("version-select-modal"),e.createEl("h2",{text:"\u9009\u62E9\u5BF9\u6BD4\u7248\u672C"}),e.createEl("p",{text:"\u9009\u62E9\u8981\u4E0E\u4E4B\u5BF9\u6BD4\u7684\u7248\u672C",cls:"version-select-hint"}),e.createEl("div",{cls:"version-search-container"}).createEl("input",{type:"text",placeholder:"\u641C\u7D22\u7248\u672C...",cls:"version-search-input"}).addEventListener("input",r=>{this.searchQuery=r.target.value,this.renderVersionList()});let a=e.createEl("div",{cls:"version-select-list"});this.renderVersionList()}async renderVersionList(){let e=this.containerEl.querySelector(".version-select-list");if(!e)return;e.empty();let n=(await this.plugin.getAllVersions(this.file.path)).filter(a=>{if(a.id===this.firstVersionId)return!1;if(!this.searchQuery)return!0;let r=this.searchQuery.toLowerCase();return a.message.toLowerCase().includes(r)||this.plugin.formatTime(a.timestamp).toLowerCase().includes(r)});if(n.length===0){e.createEl("div",{text:this.searchQuery?`\u672A\u627E\u5230\u5339\u914D "${this.searchQuery}" \u7684\u7248\u672C`:"\u6CA1\u6709\u5176\u4ED6\u7248\u672C",cls:"version-select-empty"});return}for(let a of n){let r=e.createEl("div",{cls:"version-select-item"}),o=r.createEl("div",{cls:"version-info"});o.createEl("div",{text:this.plugin.formatTime(a.timestamp),cls:"version-time"}),o.createEl("div",{text:a.message,cls:"version-message"}),o.createEl("div",{text:this.plugin.formatFileSize(a.size),cls:"version-size"}),r.createEl("button",{text:"\u9009\u62E9"}).addEventListener("click",()=>{this.close(),this.onSelect(a.id)})}}onClose(){let{contentEl:e}=this;e.empty()}},mi=class extends b.PluginSettingTab{constructor(e,i){super(e,i);this.plugin=i}async display(){let{containerEl:e}=this;if(e.empty(),e.createEl("h2",{text:"\u7248\u672C\u63A7\u5236\u8BBE\u7F6E"}),this.plugin.settings.showVersionStats){let l=await this.plugin.getStorageStats(),c=e.createEl("div",{cls:"version-stats"});c.createEl("h3",{text:"\u{1F4CA} \u5B58\u50A8\u7EDF\u8BA1"});let f=c.createEl("div",{cls:"stats-grid"});f.createEl("div",{text:`\u603B\u5927\u5C0F: ${this.plugin.formatFileSize(l.totalSize)}`}),f.createEl("div",{text:`\u7248\u672C\u6570\u91CF: ${l.versionCount}`}),f.createEl("div",{text:`\u6587\u4EF6\u6570\u91CF: ${l.fileCount}`}),f.createEl("div",{text:`\u661F\u6807\u7248\u672C: ${l.starredCount}`}),f.createEl("div",{text:`\u6807\u7B7E\u7248\u672C: ${l.taggedCount}`}),(this.plugin.settings.enableCompression||this.plugin.settings.enableIncrementalStorage)&&f.createEl("div",{text:`\u538B\u7F29\u7387: ${l.compressionRatio.toFixed(1)}%`}),c.createEl("button",{text:"\u{1F504} \u5237\u65B0\u7EDF\u8BA1"}).addEventListener("click",()=>{this.display()})}e.createEl("h3",{text:"\u2699\uFE0F \u57FA\u7840\u8BBE\u7F6E"}),new b.Setting(e).setName("\u5728\u72B6\u6001\u680F\u663E\u793A\u4E0A\u6B21\u4FDD\u5B58\u65F6\u95F4").setDesc("\u5F00\u542F\u540E\uFF0C\u72B6\u6001\u680F\u5C06\u663E\u793A\u76F8\u5BF9\u7684\u4E0A\u6B21\u4FDD\u5B58\u65F6\u95F4\uFF1B\u5173\u95ED\u5219\u663E\u793A\u901A\u7528\u72B6\u6001\u3002").addToggle(l=>l.setValue(this.plugin.settings.showLastSaveTimeInStatusBar).onChange(async c=>{this.plugin.settings.showLastSaveTimeInStatusBar=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u542F\u7528\u72B6\u6001\u680F\u5FEB\u901F\u5BF9\u6BD4").setDesc("\u70B9\u51FB\u72B6\u6001\u680F\u53EF\u5FEB\u901F\u5BF9\u6BD4\u5F53\u524D\u6587\u4EF6\u4E0E\u6700\u65B0\u7248\u672C").addToggle(l=>l.setValue(this.plugin.settings.enableStatusBarDiff).onChange(async c=>{this.plugin.settings.enableStatusBarDiff=c,await this.plugin.saveSettings(),c?this.plugin.statusBarItem.addClass("version-control-statusbar-clickable"):this.plugin.statusBarItem.removeClass("version-control-statusbar-clickable")})),new b.Setting(e).setName("\u7248\u672C\u5B58\u50A8\u8DEF\u5F84").setDesc("\u6307\u5B9A\u7248\u672C\u6570\u636E\u7684\u5B58\u50A8\u4F4D\u7F6E(\u76F8\u5BF9\u4E8E\u5E93\u6839\u76EE\u5F55)").addText(l=>l.setPlaceholder(".versions").setValue(this.plugin.settings.versionFolder).onChange(async c=>{this.plugin.settings.versionFolder=c||".versions",await this.plugin.saveSettings(),await this.plugin.ensureVersionFolder()})),new b.Setting(e).setName("\u663E\u793A\u901A\u77E5").setDesc("\u5728\u521B\u5EFA\u3001\u6062\u590D\u7248\u672C\u65F6\u663E\u793A\u63D0\u793A\u6D88\u606F").addToggle(l=>l.setValue(this.plugin.settings.showNotifications).onChange(async c=>{this.plugin.settings.showNotifications=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u663E\u793A\u7EDF\u8BA1\u4FE1\u606F").setDesc("\u5728\u8BBE\u7F6E\u9875\u9762\u663E\u793A\u7248\u672C\u7EDF\u8BA1").addToggle(l=>l.setValue(this.plugin.settings.showVersionStats).onChange(async c=>{this.plugin.settings.showVersionStats=c,await this.plugin.saveSettings(),this.display()})),e.createEl("h3",{text:"\u{1F3F7}\uFE0F \u7248\u672C\u6807\u7B7E\u4E0E\u5907\u6CE8"}),new b.Setting(e).setName("\u542F\u7528\u7248\u672C\u6807\u7B7E").setDesc("\u4E3A\u7248\u672C\u6DFB\u52A0\u6807\u7B7E\u4EE5\u4FBF\u5206\u7C7B\u548C\u7B5B\u9009").addToggle(l=>l.setValue(this.plugin.settings.enableVersionTags).onChange(async c=>{this.plugin.settings.enableVersionTags=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u9ED8\u8BA4\u6807\u7B7E\u5217\u8868").setDesc("\u9884\u8BBE\u7684\u5E38\u7528\u6807\u7B7E(\u6BCF\u884C\u4E00\u4E2A)").addTextArea(l=>{l.setValue(this.plugin.settings.defaultTags.join(`
`)).setPlaceholder(`\u91CD\u8981
\u91CC\u7A0B\u7891
\u53D1\u5E03
\u5907\u4EFD
\u8349\u7A3F`).onChange(async c=>{this.plugin.settings.defaultTags=c.split(`
`).map(f=>f.trim()).filter(f=>f.length>0),await this.plugin.saveSettings()}),l.inputEl.rows=4,l.inputEl.style.width="100%"}),new b.Setting(e).setName("\u542F\u7528\u5FEB\u901F\u9884\u89C8").setDesc("\u5728\u7248\u672C\u5386\u53F2\u4E2D\u663E\u793A\u5FEB\u901F\u9884\u89C8\u6309\u94AE").addToggle(l=>l.setValue(this.plugin.settings.enableQuickPreview).onChange(async c=>{this.plugin.settings.enableQuickPreview=c,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView()})),e.createEl("h3",{text:"\u{1F916} \u81EA\u52A8\u4FDD\u5B58"}),new b.Setting(e).setName("\u542F\u7528\u81EA\u52A8\u4FDD\u5B58").setDesc("\u81EA\u52A8\u521B\u5EFA\u7248\u672C\u5FEB\u7167").addToggle(l=>l.setValue(this.plugin.settings.autoSave).onChange(async c=>{this.plugin.settings.autoSave=c,await this.plugin.saveSettings(),c&&this.plugin.settings.autoSaveOnInterval?this.plugin.startAutoSave():this.plugin.autoSaveTimer&&window.clearInterval(this.plugin.autoSaveTimer)}));let i=e.createEl("div",{cls:"setting-item-description"});i.innerHTML="\u9009\u62E9\u4EE5\u4E0B\u4E00\u79CD\u6216\u591A\u79CD\u81EA\u52A8\u4FDD\u5B58\u89E6\u53D1\u65B9\u5F0F:",i.style.marginBottom="10px",i.style.color="var(--text-muted)",new b.Setting(e).setName("\u270F\uFE0F \u4FEE\u6539\u65F6\u81EA\u52A8\u4FDD\u5B58").setDesc("\u6587\u4EF6\u4FEE\u6539\u540E\u5EF6\u8FDF\u4FDD\u5B58(\u63A8\u8350)").addToggle(l=>l.setValue(this.plugin.settings.autoSaveOnModify).onChange(async c=>{this.plugin.settings.autoSaveOnModify=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u4FEE\u6539\u65F6\u4FDD\u5B58\u5EF6\u8FDF (\u5206\u949F)").setDesc("\u4FEE\u6539\u540E\u7B49\u5F85\u591A\u4E45\u624D\u4FDD\u5B58\u3002\u652F\u6301\u5C0F\u6570,\u4F8B\u5982 0.5 \u4EE3\u886830\u79D2\u3002").addText(l=>l.setValue(String(this.plugin.settings.autoSaveDelayOnModify/60)).onChange(async c=>{let f=parseFloat(c);!isNaN(f)&&f>=0&&(this.plugin.settings.autoSaveDelayOnModify=f*60,await this.plugin.saveSettings())})),new b.Setting(e).setName("\u6700\u5C0F\u53D8\u5316\u5B57\u7B26\u6570").setDesc("\u53EA\u6709\u53D8\u5316\u8D85\u8FC7\u6B64\u5B57\u7B26\u6570\u65F6\u624D\u4FDD\u5B58\u7248\u672C").addSlider(l=>l.setLimits(0,100,5).setValue(this.plugin.settings.autoSaveMinChanges).setDynamicTooltip().onChange(async c=>{this.plugin.settings.autoSaveMinChanges=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u23F0 \u5B9A\u65F6\u81EA\u52A8\u4FDD\u5B58").setDesc("\u6309\u56FA\u5B9A\u65F6\u95F4\u95F4\u9694\u4FDD\u5B58").addToggle(l=>l.setValue(this.plugin.settings.autoSaveOnInterval).onChange(async c=>{this.plugin.settings.autoSaveOnInterval=c,await this.plugin.saveSettings(),c&&this.plugin.settings.autoSave?this.plugin.startAutoSave():this.plugin.autoSaveTimer&&(window.clearInterval(this.plugin.autoSaveTimer),this.plugin.autoSaveTimer=null)})),new b.Setting(e).setName("\u5B9A\u65F6\u95F4\u9694 (\u5206\u949F)").setDesc("\u6BCF\u9694\u591A\u4E45\u81EA\u52A8\u68C0\u67E5\u5E76\u4FDD\u5B58").addText(l=>l.setPlaceholder("5").setValue(String(this.plugin.settings.autoSaveInterval)).onChange(async c=>{let f=parseInt(c);!isNaN(f)&&f>0&&(this.plugin.settings.autoSaveInterval=f,await this.plugin.saveSettings(),this.plugin.settings.autoSave&&this.plugin.settings.autoSaveOnInterval&&this.plugin.startAutoSave())})),new b.Setting(e).setName("\u{1F4C4} \u5207\u6362\u6587\u4EF6\u65F6\u4FDD\u5B58").setDesc("\u5207\u6362\u5230\u5176\u4ED6\u6587\u4EF6\u65F6\u81EA\u52A8\u4FDD\u5B58\u5F53\u524D\u6587\u4EF6").addToggle(l=>l.setValue(this.plugin.settings.autoSaveOnFileSwitch).onChange(async c=>{this.plugin.settings.autoSaveOnFileSwitch=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u5207\u6362\u6587\u4EF6\u65F6\u4FDD\u5B58\u5EF6\u8FDF (\u5206\u949F)").setDesc("\u5207\u6362\u6587\u4EF6\u540E\u7B49\u5F85\u591A\u4E45\u624D\u4FDD\u5B58\u3002\u652F\u6301\u5C0F\u6570,\u4F8B\u5982 0.1 \u4EE3\u88686\u79D2\u3002").addText(l=>l.setValue(String(this.plugin.settings.autoSaveDelayOnFileSwitch/60)).onChange(async c=>{let f=parseFloat(c);!isNaN(f)&&f>=0&&(this.plugin.settings.autoSaveDelayOnFileSwitch=f*60,await this.plugin.saveSettings())})),new b.Setting(e).setName("\u{1F441}\uFE0F \u5931\u53BB\u7126\u70B9\u65F6\u4FDD\u5B58").setDesc("\u7A97\u53E3\u5931\u53BB\u7126\u70B9\u65F6\u81EA\u52A8\u4FDD\u5B58(\u5207\u6362\u5E94\u7528\u65F6)").addToggle(l=>l.setValue(this.plugin.settings.autoSaveOnFocusLost).onChange(async c=>{this.plugin.settings.autoSaveOnFocusLost=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u5931\u53BB\u7126\u70B9\u65F6\u4FDD\u5B58\u5EF6\u8FDF (\u5206\u949F)").setDesc("\u5931\u53BB\u7126\u70B9\u540E\u7B49\u5F85\u591A\u4E45\u624D\u4FDD\u5B58\u3002\u652F\u6301\u5C0F\u6570,\u4F8B\u5982 0.1 \u4EE3\u88686\u79D2\u3002").addText(l=>l.setValue(String(this.plugin.settings.autoSaveDelayOnFocusLost/60)).onChange(async c=>{let f=parseFloat(c);!isNaN(f)&&f>=0&&(this.plugin.settings.autoSaveDelayOnFocusLost=f*60,await this.plugin.saveSettings())})),new b.Setting(e).setName("\u542F\u7528\u53BB\u91CD").setDesc("\u8DF3\u8FC7\u5185\u5BB9\u76F8\u540C\u7684\u7248\u672C\u521B\u5EFA,\u8282\u7701\u5B58\u50A8\u7A7A\u95F4").addToggle(l=>l.setValue(this.plugin.settings.enableDeduplication).onChange(async c=>{this.plugin.settings.enableDeduplication=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u6392\u9664\u7684\u6587\u4EF6\u5939").setDesc("\u4E0D\u5BF9\u8FD9\u4E9B\u6587\u4EF6\u5939\u4E2D\u7684\u6587\u4EF6\u521B\u5EFA\u7248\u672C(\u6BCF\u884C\u4E00\u4E2A\u8DEF\u5F84)").addTextArea(l=>{l.setValue(this.plugin.settings.excludedFolders.join(`
`)).setPlaceholder(`\u4F8B\u5982:
templates/
.trash/`).onChange(async c=>{this.plugin.settings.excludedFolders=c.split(`
`).map(f=>f.trim()).filter(f=>f.length>0),await this.plugin.saveSettings()}),l.inputEl.rows=4,l.inputEl.style.width="100%"}),e.createEl("h3",{text:"\u{1F4BE} \u5B58\u50A8\u4F18\u5316"}),new b.Setting(e).setName("\u542F\u7528\u538B\u7F29").setDesc("\u4F7F\u7528 gzip \u538B\u7F29\u7248\u672C\u6587\u4EF6,\u663E\u8457\u51CF\u5C11\u5B58\u50A8\u7A7A\u95F4\u5360\u7528").addToggle(l=>l.setValue(this.plugin.settings.enableCompression).onChange(async c=>{this.plugin.settings.enableCompression=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u542F\u7528\u589E\u91CF\u5B58\u50A8").setDesc("\u53EA\u4FDD\u5B58\u7248\u672C\u95F4\u7684\u5DEE\u5F02,\u5927\u5E45\u964D\u4F4E\u5B58\u50A8\u7A7A\u95F4\u4F7F\u7528").addToggle(l=>l.setValue(this.plugin.settings.enableIncrementalStorage).onChange(async c=>{this.plugin.settings.enableIncrementalStorage=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u57FA\u51C6\u7248\u672C\u95F4\u9694").setDesc("\u6BCFN\u4E2A\u7248\u672C\u521B\u5EFA\u4E00\u6B21\u5B8C\u6574\u5FEB\u7167(\u5EFA\u8BAE10-20),\u7528\u4E8E\u589E\u91CF\u5B58\u50A8\u7684\u57FA\u51C6").addText(l=>l.setPlaceholder("10").setValue(String(this.plugin.settings.rebuildBaseInterval)).onChange(async c=>{let f=parseInt(c);!isNaN(f)&&f>0&&(this.plugin.settings.rebuildBaseInterval=f,await this.plugin.saveSettings())})),new b.Setting(e).setName("\u6BCF\u9875\u663E\u793A\u7248\u672C\u6570").setDesc("\u7248\u672C\u5386\u53F2\u89C6\u56FE\u4E2D\u6BCF\u9875\u663E\u793A\u7684\u7248\u672C\u6570\u91CF(0=\u4E0D\u5206\u9875)").addText(l=>l.setPlaceholder("20").setValue(String(this.plugin.settings.versionsPerPage)).onChange(async c=>{let f=parseInt(c);!isNaN(f)&&f>=0&&(this.plugin.settings.versionsPerPage=f,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView())})),new b.Setting(e).setName("\u4F18\u5316\u5B58\u50A8").setDesc("\u91CD\u65B0\u538B\u7F29\u548C\u4F18\u5316\u6240\u6709\u7248\u672C\u6587\u4EF6").addButton(l=>l.setButtonText("\u7ACB\u5373\u4F18\u5316").onClick(async()=>{await this.plugin.optimizeAllVersionFiles(),this.display()})),e.createEl("h3",{text:"\u{1F5D1}\uFE0F \u81EA\u52A8\u6E05\u7406"}),new b.Setting(e).setName("\u542F\u7528\u81EA\u52A8\u6E05\u7406").setDesc("\u81EA\u52A8\u5220\u9664\u65E7\u7248\u672C\u4EE5\u8282\u7701\u7A7A\u95F4").addToggle(l=>l.setValue(this.plugin.settings.autoClear).onChange(async c=>{this.plugin.settings.autoClear=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u6309\u6570\u91CF\u6E05\u7406").setDesc("\u4FDD\u7559\u6307\u5B9A\u6570\u91CF\u7684\u6700\u65B0\u7248\u672C").addToggle(l=>l.setValue(this.plugin.settings.enableMaxVersions).onChange(async c=>{this.plugin.settings.enableMaxVersions=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u6700\u5927\u7248\u672C\u6570").setDesc("\u6BCF\u4E2A\u6587\u4EF6\u6700\u591A\u4FDD\u7559\u7684\u7248\u672C\u6570\u91CF").addText(l=>l.setPlaceholder("50").setValue(String(this.plugin.settings.maxVersions)).onChange(async c=>{let f=parseInt(c);!isNaN(f)&&f>0&&(this.plugin.settings.maxVersions=f,await this.plugin.saveSettings())})),new b.Setting(e).setName("\u6309\u5929\u6570\u6E05\u7406").setDesc("\u81EA\u52A8\u5220\u9664\u8D85\u8FC7\u6307\u5B9A\u5929\u6570\u7684\u7248\u672C").addToggle(l=>l.setValue(this.plugin.settings.enableMaxDays).onChange(async c=>{this.plugin.settings.enableMaxDays=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u6700\u5927\u4FDD\u7559\u5929\u6570").setDesc("\u5220\u9664\u8D85\u8FC7\u6B64\u5929\u6570\u7684\u65E7\u7248\u672C").addText(l=>l.setPlaceholder("30").setValue(String(this.plugin.settings.maxDays)).onChange(async c=>{let f=parseInt(c);!isNaN(f)&&f>0&&(this.plugin.settings.maxDays=f,await this.plugin.saveSettings())})),e.createEl("h3",{text:"\u{1F3A8} \u663E\u793A\u8BBE\u7F6E"}),new b.Setting(e).setName("\u4F7F\u7528\u76F8\u5BF9\u65F6\u95F4").setDesc('\u663E\u793A"3\u5C0F\u65F6\u524D"\u800C\u4E0D\u662F\u5177\u4F53\u65F6\u95F4').addToggle(l=>l.setValue(this.plugin.settings.useRelativeTime).onChange(async c=>{this.plugin.settings.useRelativeTime=c,await this.plugin.saveSettings(),this.plugin.refreshVersionHistoryView()})),e.createEl("h3",{text:"\u{1F500} \u5DEE\u5F02\u5BF9\u6BD4\u8BBE\u7F6E"}),new b.Setting(e).setName("\u9ED8\u8BA4\u5DEE\u5F02\u7C92\u5EA6").setDesc("\u9009\u62E9\u5DEE\u5F02\u5BF9\u6BD4\u7684\u9ED8\u8BA4\u7CBE\u7EC6\u7A0B\u5EA6").addDropdown(l=>l.addOption("char","\u5B57\u7B26\u7EA7").addOption("word","\u5355\u8BCD\u7EA7").addOption("line","\u884C\u7EA7").addOption("sentence","\u53E5\u5B50\u7EA7 (\u9002\u5408\u957F\u6587)").addOption("semantic","\u8BED\u4E49\u7EA7 (\u5B9E\u9A8C\u6027)").setValue(this.plugin.settings.diffGranularity).onChange(async c=>{this.plugin.settings.diffGranularity=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u9ED8\u8BA4\u89C6\u56FE\u6A21\u5F0F").setDesc("\u9009\u62E9\u5DEE\u5F02\u5BF9\u6BD4\u7684\u9ED8\u8BA4\u663E\u793A\u65B9\u5F0F").addDropdown(l=>l.addOption("unified","\u7EDF\u4E00\u89C6\u56FE").addOption("split","\u5DE6\u53F3\u5206\u680F").setValue(this.plugin.settings.diffViewMode).onChange(async c=>{this.plugin.settings.diffViewMode=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u9ED8\u8BA4\u4EC5\u663E\u793A\u53D8\u66F4").setDesc("\u5F00\u542F\u540E\uFF0C\u5DEE\u5F02\u5BF9\u6BD4\u7A97\u53E3\u9ED8\u8BA4\u53EA\u663E\u793A\u6709\u53D8\u5316\u7684\u5185\u5BB9\u3002").addToggle(l=>l.setValue(this.plugin.settings.diffShowOnlyChanges).onChange(async c=>{this.plugin.settings.diffShowOnlyChanges=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u542F\u7528\u667A\u80FD\u5355\u8BCD\u5BF9\u6BD4").setDesc("\u5F00\u542F\u540E\uFF0C\u201C\u5355\u8BCD\u7EA7\u201D\u5BF9\u6BD4\u4F1A\u66F4\u667A\u80FD\u5730\u5904\u7406\u6807\u70B9\u7B26\u53F7\uFF0C\u51CF\u5C11\u8BEF\u62A5\u3002").addToggle(l=>l.setValue(this.plugin.settings.smartWordDiff).onChange(async c=>{this.plugin.settings.smartWordDiff=c,await this.plugin.saveSettings()})),new b.Setting(e).setName("\u884C\u5185\u5DEE\u5F02\u7B97\u6CD5").setDesc("\u5F53\u4F7F\u7528\u201C\u884C\u7EA7\u201D\u5BF9\u6BD4\u65F6\uFF0C\u6307\u5B9A\u884C\u5185\u9AD8\u4EAE\u7684\u7B97\u6CD5\u3002").addDropdown(l=>l.addOption("word","\u6309\u5355\u8BCD\uFF08\u63A8\u8350\uFF09").addOption("char","\u6309\u5B57\u7B26\uFF08\u66F4\u7CBE\u786E\uFF09").setValue(this.plugin.settings.inlineDiffAlgorithm).onChange(async c=>{this.plugin.settings.inlineDiffAlgorithm=c,await this.plugin.saveSettings()})),e.createEl("h3",{text:"\u{1F6E0}\uFE0F \u7EF4\u62A4\u64CD\u4F5C"}),new b.Setting(e).setName("\u6E05\u7406\u6240\u6709\u7248\u672C").setDesc("\u5220\u9664\u6240\u6709\u7248\u672C\u6570\u636E(\u8C28\u614E\u64CD\u4F5C)").addButton(l=>l.setButtonText("\u6E05\u7A7A\u6240\u6709\u7248\u672C").setWarning().onClick(async()=>{new de(this.app,"\u786E\u8BA4\u6E05\u7A7A\u6240\u6709\u7248\u672C",`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664\u6240\u6709\u6587\u4EF6\u7684\u6240\u6709\u7248\u672C\u5386\u53F2!

\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500,\u8BF7\u8C28\u614E\u64CD\u4F5C!`,async()=>{await this.clearAllVersions()}).open()})),new b.Setting(e).setName("\u5BFC\u51FA\u7248\u672C\u6570\u636E").setDesc("\u5C06\u7248\u672C\u6587\u4EF6\u5939\u6253\u5305\u5BFC\u51FA").addButton(l=>l.setButtonText("\u521B\u5EFA\u5907\u4EFD").onClick(async()=>{new b.Notice("\u8BF7\u624B\u52A8\u590D\u5236 .versions \u6587\u4EF6\u5939\u8FDB\u884C\u5907\u4EFD")})),e.createEl("h3",{text:"\u{1F4D6} \u4F7F\u7528\u8BF4\u660E"});let n=e.createEl("div",{cls:"version-info-section"}),a=n.createEl("div",{cls:"feature-item"});a.createEl("strong",{text:"\u2728 \u65B0\u529F\u80FD:"});let r=a.createEl("ul");r.createEl("li",{text:"\u7248\u672C\u6807\u7B7E\u7CFB\u7EDF - \u4E3A\u91CD\u8981\u7248\u672C\u6DFB\u52A0\u6807\u7B7E\u8FDB\u884C\u5206\u7C7B"}),r.createEl("li",{text:"\u5FEB\u901F\u9884\u89C8 - \u65E0\u9700\u5B8C\u6574\u5BF9\u6BD4\u5373\u53EF\u67E5\u770B\u7248\u672C\u5185\u5BB9"}),r.createEl("li",{text:"\u7248\u672C\u5907\u6CE8 - \u4E3A\u7248\u672C\u6DFB\u52A0\u8BE6\u7EC6\u8BF4\u660E"}),r.createEl("li",{text:"\u661F\u6807\u6807\u8BB0 - \u6807\u8BB0\u91CD\u8981\u7248\u672C\u4FBF\u4E8E\u67E5\u627E"}),r.createEl("li",{text:"\u9AD8\u7EA7\u7B5B\u9009 - \u6309\u6807\u7B7E\u3001\u661F\u6807\u7B5B\u9009\u7248\u672C"}),r.createEl("li",{text:"\u589E\u5F3A\u5DEE\u5F02\u5BF9\u6BD4 - \u667A\u80FD\u884C\u5185\u9AD8\u4EAE\u3001\u667A\u80FD\u6298\u53E0\u3001\u952E\u76D8\u5BFC\u822A"});let o=n.createEl("div",{cls:"feature-item"});o.createEl("strong",{text:"\u{1F4A1} \u4F7F\u7528\u6280\u5DE7:"});let d=o.createEl("ul");d.createEl("li",{text:"\u53F3\u952E\u70B9\u51FB\u7248\u672C\u53EF\u67E5\u770B\u66F4\u591A\u64CD\u4F5C\u9009\u9879"}),d.createEl("li",{text:"\u70B9\u51FB\u6807\u7B7E\u53EF\u5FEB\u901F\u7B5B\u9009\u76F8\u5173\u7248\u672C"}),d.createEl("li",{text:"\u4F7F\u7528\u661F\u6807\u6807\u8BB0\u91CD\u8981\u7684\u91CC\u7A0B\u7891\u7248\u672C"}),d.createEl("li",{text:'\u5B9A\u671F\u8FD0\u884C"\u4F18\u5316\u5B58\u50A8"\u4EE5\u4FDD\u6301\u6700\u4F73\u6027\u80FD'}),d.createEl("li",{text:"\u589E\u91CF\u5B58\u50A8\u548C\u538B\u7F29\u53EF\u8282\u770190%\u4EE5\u4E0A\u7684\u7A7A\u95F4"}),d.createEl("li",{text:"\u5DEE\u5F02\u5BF9\u6BD4\u4E2D\u4F7F\u7528\u65B9\u5411\u952E \u2191/\u2193 \u5FEB\u901F\u5BFC\u822A"})}async clearAllVersions(){try{let e=this.app.vault.adapter,i=this.plugin.settings.versionFolder;await e.exists(i)&&(await e.rmdir(i,!0),await this.plugin.ensureVersionFolder(),this.plugin.versionCache.clear(),new b.Notice("\u2705 \u5DF2\u6E05\u7A7A\u6240\u6709\u7248\u672C"),this.plugin.refreshVersionHistoryView(),this.display())}catch(e){console.error("\u6E05\u7A7A\u7248\u672C\u5931\u8D25:",e),new b.Notice("\u274C \u6E05\u7A7A\u5931\u8D25,\u8BF7\u67E5\u770B\u63A7\u5236\u53F0")}}};
/*! Bundled license information:

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
