/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var F=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var G=(f,i)=>{for(var t in i)F(f,t,{get:i[t],enumerable:!0})},_=(f,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let n of H(i))!q.call(f,n)&&n!==t&&F(f,n,{get:()=>i[n],enumerable:!(e=W(i,n))||e.enumerable});return f};var J=f=>_(F({},"__esModule",{value:!0}),f);var X={};G(X,{default:()=>k});module.exports=J(X);var h=require("obsidian");var P=class{diff(i,t,e={}){let n;typeof e=="function"?(n=e,e={}):"callback"in e&&(n=e.callback);let s=this.castInput(i,e),o=this.castInput(t,e),a=this.removeEmpty(this.tokenize(s,e)),c=this.removeEmpty(this.tokenize(o,e));return this.diffWithOptionsObj(a,c,e,n)}diffWithOptionsObj(i,t,e,n){var s;let o=u=>{if(u=this.postProcess(u,e),n){setTimeout(function(){n(u)},0);return}else return u},a=t.length,c=i.length,r=1,l=a+c;e.maxEditLength!=null&&(l=Math.min(l,e.maxEditLength));let d=(s=e.timeout)!==null&&s!==void 0?s:1/0,y=Date.now()+d,v=[{oldPos:-1,lastComponent:void 0}],C=this.extractCommon(v[0],t,i,0,e);if(v[0].oldPos+1>=c&&C+1>=a)return o(this.buildValues(v[0].lastComponent,t,i));let V=-1/0,S=1/0,b=()=>{for(let u=Math.max(V,-r);u<=Math.min(S,r);u+=2){let p,L=v[u-1],E=v[u+1];L&&(v[u-1]=void 0);let x=!1;if(E){let g=E.oldPos-u;x=E&&0<=g&&g<a}let w=L&&L.oldPos+1<c;if(!x&&!w){v[u]=void 0;continue}if(!w||x&&L.oldPos<E.oldPos?p=this.addToPath(E,!0,!1,0,e):p=this.addToPath(L,!1,!0,1,e),C=this.extractCommon(p,t,i,u,e),p.oldPos+1>=c&&C+1>=a)return o(this.buildValues(p.lastComponent,t,i))||!0;v[u]=p,p.oldPos+1>=c&&(S=Math.min(S,u-1)),C+1>=a&&(V=Math.max(V,u+1))}r++};if(n)(function u(){setTimeout(function(){if(r>l||Date.now()>y)return n(void 0);b()||u()},0)})();else for(;r<=l&&Date.now()<=y;){let u=b();if(u)return u}}addToPath(i,t,e,n,s){let o=i.lastComponent;return o&&!s.oneChangePerToken&&o.added===t&&o.removed===e?{oldPos:i.oldPos+n,lastComponent:{count:o.count+1,added:t,removed:e,previousComponent:o.previousComponent}}:{oldPos:i.oldPos+n,lastComponent:{count:1,added:t,removed:e,previousComponent:o}}}extractCommon(i,t,e,n,s){let o=t.length,a=e.length,c=i.oldPos,r=c-n,l=0;for(;r+1<o&&c+1<a&&this.equals(e[c+1],t[r+1],s);)r++,c++,l++,s.oneChangePerToken&&(i.lastComponent={count:1,previousComponent:i.lastComponent,added:!1,removed:!1});return l&&!s.oneChangePerToken&&(i.lastComponent={count:l,previousComponent:i.lastComponent,added:!1,removed:!1}),i.oldPos=c,r}equals(i,t,e){return e.comparator?e.comparator(i,t):i===t||!!e.ignoreCase&&i.toLowerCase()===t.toLowerCase()}removeEmpty(i){let t=[];for(let e=0;e<i.length;e++)i[e]&&t.push(i[e]);return t}castInput(i,t){return i}tokenize(i,t){return Array.from(i)}join(i){return i.join("")}postProcess(i,t){return i}get useLongestToken(){return!1}buildValues(i,t,e){let n=[],s;for(;i;)n.push(i),s=i.previousComponent,delete i.previousComponent,i=s;n.reverse();let o=n.length,a=0,c=0,r=0;for(;a<o;a++){let l=n[a];if(l.removed)l.value=this.join(e.slice(r,r+l.count)),r+=l.count;else{if(!l.added&&this.useLongestToken){let d=t.slice(c,c+l.count);d=d.map(function(y,v){let C=e[r+v];return C.length>y.length?C:y}),l.value=this.join(d)}else l.value=this.join(t.slice(c,c+l.count));c+=l.count,l.added||(r+=l.count)}}return n}};var B=class extends P{constructor(){super(...arguments),this.tokenize=R}equals(i,t,e){return e.ignoreWhitespace?((!e.newlineIsToken||!i.includes(`
`))&&(i=i.trim()),(!e.newlineIsToken||!t.includes(`
`))&&(t=t.trim())):e.ignoreNewlineAtEof&&!e.newlineIsToken&&(i.endsWith(`
`)&&(i=i.slice(0,-1)),t.endsWith(`
`)&&(t=t.slice(0,-1))),super.equals(i,t,e)}},j=new B;function A(f,i,t){return j.diff(f,i,t)}function R(f,i){i.stripTrailingCr&&(f=f.replace(/\r\n/g,`
`));let t=[],e=f.split(/(\n|\r\n)/);e[e.length-1]||e.pop();for(let n=0;n<e.length;n++){let s=e[n];n%2&&!i.newlineIsToken?t[t.length-1]+=s:t.push(s)}return t}var U={storageLocation:"vault",customStoragePath:"",autoSaveInterval:5,maxVersionCount:50,retentionDays:30,cleanupStrategy:"both"},D="version-history-view",T=class extends h.ItemView{constructor(t,e){super(t);this.currentFile=null;this.selectedVersions=new Set;this.plugin=e}getViewType(){return D}getDisplayText(){return"\u7248\u672C\u5386\u53F2"}getIcon(){return"history"}async onOpen(){let t=this.containerEl.children[1];t.empty(),t.addClass("version-history-container"),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.updateView()})),this.updateView()}async updateView(){let t=this.containerEl.children[1];t.empty();let e=this.app.workspace.getActiveFile();if(this.currentFile=e,!e){t.createEl("div",{text:"\u8BF7\u6253\u5F00\u4E00\u4E2A\u6587\u4EF6\u4EE5\u67E5\u770B\u7248\u672C\u5386\u53F2",cls:"version-empty-state"});return}let n=t.createEl("div",{cls:"version-header"});n.createEl("h4",{text:`${e.name} \u7684\u7248\u672C\u5386\u53F2`});let s=n.createEl("div",{cls:"version-button-group"});s.createEl("button",{text:"\u521B\u5EFA\u7248\u672C",cls:"mod-cta"}).addEventListener("click",()=>{new I(this.app,this.plugin,e).open()}),s.createEl("button",{text:"\u6279\u91CF\u5220\u9664",cls:"mod-warning"}).addEventListener("click",()=>{this.batchDelete()});let c=await this.plugin.getFileHistory(e.path);if(!c||c.versions.length===0){t.createEl("div",{text:"\u6682\u65E0\u7248\u672C\u5386\u53F2",cls:"version-empty-state"});return}let r=t.createEl("div",{cls:"version-list"});[...c.versions].sort((d,y)=>y.timestamp-d.timestamp).forEach((d,y)=>{let v=r.createEl("div",{cls:"version-item"});v.createEl("input",{type:"checkbox"}).addEventListener("change",w=>{w.target.checked?this.selectedVersions.add(d.id):this.selectedVersions.delete(d.id)});let V=v.createEl("div",{cls:"version-info"}),S=V.createEl("div",{cls:"version-time"});S.createEl("strong",{text:new Date(d.timestamp).toLocaleString("zh-CN")}),y===0&&S.createEl("span",{text:" (\u6700\u65B0)",cls:"version-badge"}),V.createEl("div",{cls:"version-message"}).setText(d.message||(d.isManual?"\u624B\u52A8\u4FDD\u5B58":"[Auto Save]")),V.createEl("div",{cls:"version-meta"}).setText(`\u5927\u5C0F: ${this.formatSize(d.size)} | ID: ${d.id.substring(0,8)}`);let p=v.createEl("div",{cls:"version-actions"});p.createEl("button",{text:"\u6062\u590D",cls:"mod-cta"}).addEventListener("click",()=>{new M(this.app,this.plugin,e,d).open()}),p.createEl("button",{text:"\u4E0E\u5F53\u524D\u6BD4\u8F83"}).addEventListener("click",async()=>{await this.plugin.showDiff(e,"current",d.id)}),p.createEl("button",{text:"\u2022\u2022\u2022"}).addEventListener("click",w=>{let g=new h.Menu;g.addItem(m=>{m.setTitle("\u4E0E\u5176\u4ED6\u7248\u672C\u6BD4\u8F83").setIcon("git-compare").onClick(()=>{new N(this.app,this.plugin,e,d).open()})}),g.addItem(m=>{m.setTitle("\u5220\u9664\u6B64\u7248\u672C").setIcon("trash").onClick(async()=>{await this.plugin.deleteVersion(e.path,d.id),this.updateView()})}),g.showAtMouseEvent(w)})})}async batchDelete(){if(this.selectedVersions.size===0){new h.Notice("\u8BF7\u5148\u9009\u62E9\u8981\u5220\u9664\u7684\u7248\u672C");return}if(!(!this.currentFile||!await new Promise(e=>{let n=new h.Modal(this.app);n.titleEl.setText("\u786E\u8BA4\u6279\u91CF\u5220\u9664"),n.contentEl.setText(`\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684 ${this.selectedVersions.size} \u4E2A\u7248\u672C\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u590D\u3002`);let s=n.contentEl.createEl("div",{cls:"modal-button-group"});s.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>{n.close(),e(!1)}),s.createEl("button",{text:"\u786E\u8BA4\u5220\u9664",cls:"mod-warning"}).addEventListener("click",()=>{n.close(),e(!0)}),n.open()}))){for(let e of this.selectedVersions)await this.plugin.deleteVersion(this.currentFile.path,e);this.selectedVersions.clear(),new h.Notice(`\u5DF2\u5220\u9664 ${this.selectedVersions.size} \u4E2A\u7248\u672C`),this.updateView()}}formatSize(t){return t<1024?t+" B":t<1024*1024?(t/1024).toFixed(2)+" KB":(t/(1024*1024)).toFixed(2)+" MB"}async onClose(){}},I=class extends h.Modal{constructor(t,e,n){super(t);this.message="";this.plugin=e,this.file=n}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\u521B\u5EFA\u65B0\u7248\u672C"});let e=t.createEl("div",{cls:"version-input-container"});e.createEl("label",{text:"\u63D0\u4EA4\u4FE1\u606F:"}),e.createEl("textarea",{placeholder:"\u63CF\u8FF0\u6B64\u7248\u672C\u7684\u53D8\u66F4\u5185\u5BB9...",cls:"version-message-input"}).addEventListener("input",c=>{this.message=c.target.value});let s=t.createEl("div",{cls:"modal-button-group"});s.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),s.createEl("button",{text:"\u521B\u5EFA",cls:"mod-cta"}).addEventListener("click",async()=>{await this.plugin.createManualVersion(this.file,this.message),new h.Notice("\u7248\u672C\u521B\u5EFA\u6210\u529F"),this.close()})}onClose(){let{contentEl:t}=this;t.empty()}},M=class extends h.Modal{constructor(t,e,n,s){super(t);this.plugin=e,this.file=n,this.version=s}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\u26A0\uFE0F \u786E\u8BA4\u6062\u590D\u7248\u672C",cls:"version-warning-title"});let e=t.createEl("div",{cls:"version-warning-box"});e.createEl("p",{text:"\u8B66\u544A\uFF1A\u6062\u590D\u5230\u6B64\u7248\u672C\u5C06\u4F1A\u8986\u76D6\u5F53\u524D\u6587\u4EF6\u5185\u5BB9\uFF01",cls:"version-warning-text"}),e.createEl("p",{text:"\u5F53\u524D\u672A\u4FDD\u5B58\u7684\u6240\u6709\u4FEE\u6539\u5C06\u4F1A\u4E22\u5931\uFF0C\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002",cls:"version-warning-text"});let n=t.createEl("div",{cls:"version-restore-info"});n.createEl("p",{text:`\u76EE\u6807\u7248\u672C: ${new Date(this.version.timestamp).toLocaleString("zh-CN")}`}),n.createEl("p",{text:`\u63D0\u4EA4\u4FE1\u606F: ${this.version.message}`});let s=t.createEl("div",{cls:"modal-button-group"});s.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),s.createEl("button",{text:"\u786E\u8BA4\u6062\u590D",cls:"mod-warning"}).addEventListener("click",async()=>{await this.plugin.restoreVersion(this.file,this.version.id),new h.Notice("\u7248\u672C\u6062\u590D\u6210\u529F"),this.close()})}onClose(){let{contentEl:t}=this;t.empty()}},N=class extends h.Modal{constructor(t,e,n,s){super(t);this.plugin=e,this.file=n,this.baseVersion=s}async onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"\u9009\u62E9\u6BD4\u8F83\u7248\u672C"});let e=t.createEl("p",{text:`\u57FA\u7840\u7248\u672C: ${new Date(this.baseVersion.timestamp).toLocaleString("zh-CN")}`}),n=await this.plugin.getFileHistory(this.file.path);if(!n)return;let s=t.createEl("select",{cls:"version-select"});n.versions.filter(r=>r.id!==this.baseVersion.id).sort((r,l)=>l.timestamp-r.timestamp).forEach(r=>{let l=s.createEl("option");l.value=r.id,l.text=`${new Date(r.timestamp).toLocaleString("zh-CN")} - ${r.message}`});let o=t.createEl("div",{cls:"modal-button-group"});o.createEl("button",{text:"\u53D6\u6D88"}).addEventListener("click",()=>this.close()),o.createEl("button",{text:"\u6BD4\u8F83",cls:"mod-cta"}).addEventListener("click",async()=>{let r=s.value;await this.plugin.showDiff(this.file,this.baseVersion.id,r),this.close()})}onClose(){let{contentEl:t}=this;t.empty()}},O=class extends h.Modal{constructor(t,e,n,s,o){super(t);this.currentDiffIndex=0;this.totalDiffs=0;this.plugin=e,this.file=n,this.leftVersion=s,this.rightVersion=o,this.modalEl.addClass("version-diff-modal")}async onOpen(){let{contentEl:t}=this;t.empty();let e=t.createEl("div",{cls:"diff-header"}),n=this.leftVersion==="current"?"\u5F53\u524D\u7248\u672C":new Date(this.leftVersion.timestamp).toLocaleString("zh-CN"),s=new Date(this.rightVersion.timestamp).toLocaleString("zh-CN");e.createEl("h3",{text:`\u6BD4\u8F83: ${n} \u27F7 ${s}`});let o=t.createEl("div",{cls:"diff-toolbar"}),a=o.createEl("button",{text:"\u2190 \u4E0A\u4E00\u4E2A\u5DEE\u5F02"}),c=o.createEl("span",{cls:"diff-counter"}),r=o.createEl("button",{text:"\u4E0B\u4E00\u4E2A\u5DEE\u5F02 \u2192"}),l=o.createEl("input",{type:"text",placeholder:"\u641C\u7D22...",cls:"diff-search"}),d=t.createEl("div",{cls:"diff-container"}),y=this.leftVersion==="current"?await this.app.vault.read(this.file):this.leftVersion.content,v=this.rightVersion.content,C=A(y,v),V=d.createEl("div",{cls:"diff-pane diff-left"}),S=d.createEl("div",{cls:"diff-pane diff-right"});V.createEl("h4",{text:n}),S.createEl("h4",{text:s});let b=1,u=1,p=[];C.forEach(E=>{let x=E.value.split(`
`);x[x.length-1]===""&&x.pop(),!E.added&&!E.removed?x.forEach(w=>{let g=V.createEl("div",{cls:"diff-line"});g.createEl("span",{text:String(b++),cls:"line-num"}),g.createEl("span",{text:w||" ",cls:"line-content"});let m=S.createEl("div",{cls:"diff-line"});m.createEl("span",{text:String(u++),cls:"line-num"}),m.createEl("span",{text:w||" ",cls:"line-content"})}):E.removed?x.forEach(w=>{let g=V.createEl("div",{cls:"diff-line diff-removed"});g.createEl("span",{text:String(b++),cls:"line-num"}),g.createEl("span",{text:w||" ",cls:"line-content"}),p.push(g);let m=S.createEl("div",{cls:"diff-line diff-empty"});m.createEl("span",{text:"",cls:"line-num"}),m.createEl("span",{text:"",cls:"line-content"})}):E.added&&x.forEach(w=>{let g=V.createEl("div",{cls:"diff-line diff-empty"});g.createEl("span",{text:"",cls:"line-num"}),g.createEl("span",{text:"",cls:"line-content"});let m=S.createEl("div",{cls:"diff-line diff-added"});m.createEl("span",{text:String(u++),cls:"line-num"}),m.createEl("span",{text:w||" ",cls:"line-content"}),p.push(m)})}),this.totalDiffs=p.length,c.setText(`(${this.currentDiffIndex+1} / ${this.totalDiffs})`);let L=E=>{p.length!==0&&(this.currentDiffIndex=(E%p.length+p.length)%p.length,p[this.currentDiffIndex].scrollIntoView({behavior:"smooth",block:"center"}),c.setText(`(${this.currentDiffIndex+1} / ${this.totalDiffs})`))};a.addEventListener("click",()=>L(this.currentDiffIndex-1)),r.addEventListener("click",()=>L(this.currentDiffIndex+1)),l.addEventListener("input",E=>{let x=E.target.value.toLowerCase();d.querySelectorAll(".line-content").forEach(g=>{var $;let m=g;($=m.textContent)!=null&&$.toLowerCase().includes(x)?m.addClass("search-highlight"):m.removeClass("search-highlight")})})}onClose(){let{contentEl:t}=this;t.empty()}},k=class extends h.Plugin{constructor(){super(...arguments);this.versionStorage=new Map}async onload(){await this.loadSettings(),await this.loadVersionData(),this.registerView(D,t=>new T(t,this)),this.addRibbonIcon("history","\u7248\u672C\u5386\u53F2",()=>{this.activateView()}),this.addCommand({id:"create-version",name:"\u521B\u5EFA\u7248\u672C\u5FEB\u7167",editorCallback:(t,e)=>{e.file&&new I(this.app,this,e.file).open()}}),this.addCommand({id:"show-version-history",name:"\u663E\u793A\u7248\u672C\u5386\u53F2",callback:()=>{this.activateView()}}),this.addSettingTab(new z(this.app,this)),this.setupAutoSave(),this.registerEvent(this.app.vault.on("modify",async t=>{t instanceof h.TFile&&t.extension})),this.registerEvent(this.app.workspace.on("quit",async()=>{await this.saveAllModified()}))}async activateView(){let{workspace:t}=this.app,e=t.getLeavesOfType(D)[0];if(!e){let n=t.getRightLeaf(!1);n&&(e=n,await e.setViewState({type:D}))}e&&t.revealLeaf(e)}setupAutoSave(){this.autoSaveInterval&&window.clearInterval(this.autoSaveInterval),this.autoSaveInterval=window.setInterval(async()=>{await this.autoSaveAllFiles()},this.settings.autoSaveInterval*60*1e3),this.registerInterval(this.autoSaveInterval)}async autoSaveAllFiles(){let t=this.app.vault.getMarkdownFiles();for(let e of t)await this.createAutoVersion(e);await this.cleanupOldVersions()}async createAutoVersion(t){let e=await this.app.vault.read(t),n=this.versionStorage.get(t.path);n&&n.versions.length>0&&n.versions[n.versions.length-1].content===e||await this.createVersion(t,e,"[Auto Save]",!1)}async createManualVersion(t,e){let n=await this.app.vault.read(t);await this.createVersion(t,n,e,!0)}async createVersion(t,e,n,s){let o={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),content:e,message:n,size:new Blob([e]).size,isManual:s},a=this.versionStorage.get(t.path);a||(a={filePath:t.path,versions:[]},this.versionStorage.set(t.path,a)),a.versions.push(o),await this.saveVersionData(),this.app.workspace.getLeavesOfType(D).forEach(r=>{r.view instanceof T&&r.view.updateView()})}async restoreVersion(t,e){let n=this.versionStorage.get(t.path);if(!n)return;let s=n.versions.find(o=>o.id===e);s&&await this.app.vault.modify(t,s.content)}async deleteVersion(t,e){let n=this.versionStorage.get(t);n&&(n.versions=n.versions.filter(s=>s.id!==e),await this.saveVersionData())}async cleanupOldVersions(){let t=Date.now(),e=this.settings.retentionDays*24*60*60*1e3;for(let[n,s]of this.versionStorage.entries()){let o=[...s.versions];if((this.settings.cleanupStrategy==="days-first"||this.settings.cleanupStrategy==="both")&&(o=o.filter(a=>t-a.timestamp<e||a.isManual)),this.settings.cleanupStrategy==="count-first"||this.settings.cleanupStrategy==="both"){let a=o.filter(r=>r.isManual),c=o.filter(r=>!r.isManual).slice(-this.settings.maxVersionCount);o=[...a,...c].sort((r,l)=>r.timestamp-l.timestamp)}s.versions=o}await this.saveVersionData()}async showDiff(t,e,n){let s=this.versionStorage.get(t.path);if(!s)return;let o=e==="current"?"current":s.versions.find(c=>c.id===e),a=s.versions.find(c=>c.id===n);if(!a||e!=="current"&&!o){new h.Notice("\u7248\u672C\u4E0D\u5B58\u5728");return}new O(this.app,this,t,o,a).open()}getFileHistory(t){return this.versionStorage.get(t)}async saveAllModified(){let t=this.app.workspace.getActiveFile();t&&await this.createAutoVersion(t)}async loadVersionData(){let t=`${this.getStoragePath()}/version-data.json`;try{let e=await this.app.vault.adapter.read(t),n=JSON.parse(e);this.versionStorage=new Map(Object.entries(n))}catch(e){this.versionStorage=new Map}}async saveVersionData(){let t=`${this.getStoragePath()}/version-data.json`,e=JSON.stringify(Object.fromEntries(this.versionStorage),null,2);try{await this.app.vault.adapter.write(t,e)}catch(n){console.error("Failed to save version data:",n)}}getStoragePath(){return this.settings.storageLocation==="custom"&&this.settings.customStoragePath?this.settings.customStoragePath:".obsidian/versions"}async loadSettings(){this.settings=Object.assign({},U,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.setupAutoSave()}onunload(){this.saveAllModified()}},z=class extends h.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"\u7248\u672C\u63A7\u5236\u8BBE\u7F6E"}),new h.Setting(t).setName("\u5B58\u50A8\u4F4D\u7F6E").setDesc("\u9009\u62E9\u7248\u672C\u6570\u636E\u7684\u5B58\u50A8\u4F4D\u7F6E").addDropdown(s=>s.addOption("vault","Vault \u5185\uFF08.obsidian/versions\uFF09").addOption("custom","\u81EA\u5B9A\u4E49\u8DEF\u5F84").setValue(this.plugin.settings.storageLocation).onChange(async o=>{this.plugin.settings.storageLocation=o,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.storageLocation==="custom"&&new h.Setting(t).setName("\u81EA\u5B9A\u4E49\u5B58\u50A8\u8DEF\u5F84").setDesc("\u6307\u5B9A\u7248\u672C\u6570\u636E\u7684\u5B58\u50A8\u8DEF\u5F84\uFF08\u76F8\u5BF9\u4E8E vault \u6839\u76EE\u5F55\uFF09").addText(s=>s.setPlaceholder("\u4F8B\u5982: ../version-backup").setValue(this.plugin.settings.customStoragePath).onChange(async o=>{this.plugin.settings.customStoragePath=o,await this.plugin.saveSettings()})),t.createEl("h3",{text:"\u81EA\u52A8\u4FDD\u5B58\u8BBE\u7F6E"}),new h.Setting(t).setName("\u81EA\u52A8\u4FDD\u5B58\u95F4\u9694\uFF08\u5206\u949F\uFF09").setDesc("\u6587\u4EF6\u4FEE\u6539\u540E\u81EA\u52A8\u521B\u5EFA\u7248\u672C\u7684\u65F6\u95F4\u95F4\u9694").addText(s=>s.setPlaceholder("5").setValue(String(this.plugin.settings.autoSaveInterval)).onChange(async o=>{let a=parseInt(o);!isNaN(a)&&a>0&&(this.plugin.settings.autoSaveInterval=a,await this.plugin.saveSettings())})),t.createEl("h3",{text:"\u7248\u672C\u6E05\u7406\u8BBE\u7F6E"}),new h.Setting(t).setName("\u4FDD\u7559\u7248\u672C\u6570\u91CF\u4E0A\u9650").setDesc("\u6BCF\u4E2A\u6587\u4EF6\u6700\u591A\u4FDD\u7559\u7684\u7248\u672C\u6570\u91CF\uFF08\u624B\u52A8\u7248\u672C\u4E0D\u53D7\u6B64\u9650\u5236\uFF09").addText(s=>s.setPlaceholder("50").setValue(String(this.plugin.settings.maxVersionCount)).onChange(async o=>{let a=parseInt(o);!isNaN(a)&&a>0&&(this.plugin.settings.maxVersionCount=a,await this.plugin.saveSettings())})),new h.Setting(t).setName("\u4FDD\u7559\u5929\u6570").setDesc("\u81EA\u52A8\u5220\u9664\u8D85\u8FC7\u6B64\u5929\u6570\u7684\u65E7\u7248\u672C\uFF08\u624B\u52A8\u7248\u672C\u4E0D\u53D7\u6B64\u9650\u5236\uFF09").addText(s=>s.setPlaceholder("30").setValue(String(this.plugin.settings.retentionDays)).onChange(async o=>{let a=parseInt(o);!isNaN(a)&&a>0&&(this.plugin.settings.retentionDays=a,await this.plugin.saveSettings())})),new h.Setting(t).setName("\u6E05\u7406\u7B56\u7565").setDesc("\u9009\u62E9\u7248\u672C\u6E05\u7406\u7684\u4F18\u5148\u7EA7\u7B56\u7565").addDropdown(s=>s.addOption("days-first","\u4F18\u5148\u6309\u5929\u6570\u6E05\u7406").addOption("count-first","\u4F18\u5148\u6309\u6570\u91CF\u6E05\u7406").addOption("both","\u540C\u65F6\u6EE1\u8DB3\u4E24\u4E2A\u6761\u4EF6").setValue(this.plugin.settings.cleanupStrategy).onChange(async o=>{this.plugin.settings.cleanupStrategy=o,await this.plugin.saveSettings()})),new h.Setting(t).setName("\u7ACB\u5373\u6E05\u7406\u65E7\u7248\u672C").setDesc("\u6839\u636E\u5F53\u524D\u8BBE\u7F6E\u7ACB\u5373\u6E05\u7406\u6240\u6709\u6587\u4EF6\u7684\u65E7\u7248\u672C").addButton(s=>s.setButtonText("\u6267\u884C\u6E05\u7406").setCta().onClick(async()=>{await this.plugin.cleanupOldVersions(),new h.Notice("\u65E7\u7248\u672C\u6E05\u7406\u5B8C\u6210")})),t.createEl("h3",{text:"\u7EDF\u8BA1\u4FE1\u606F"});let e=this.plugin.versionStorage.size,n=0;this.plugin.versionStorage.forEach(s=>{n+=s.versions.length}),t.createEl("p",{text:`\u5DF2\u8DDF\u8E2A\u6587\u4EF6\u6570: ${e}`}),t.createEl("p",{text:`\u603B\u7248\u672C\u6570: ${n}`})}};
